(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1047:function(e,t,a){},1048:function(e,t,a){},1058:function(e,t,a){},1062:function(e,t,a){},1112:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(24),c=a.n(o);a(566),a(567),a(568),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i,s=a(5),l=a.n(s),u=a(8),p=a(14),d=(a(571),a(47)),m=a(27),f=a(7),h=a(25),b=a(32),g=a(31),v=a(83),y=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("logout"!==t.data.currentPage){e.next=7;break}return a=new b.ActionProxy,e.next=4,a.post(g.default.LOGOUT,{});case 4:return sessionStorage.removeItem(v.a.name),sessionStorage.removeItem("user"),e.abrupt("return",{data:{currentPage:"admin",logined:!1}});case 7:return e.abrupt("return",{data:{currentPage:t.data.currentPage}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),E=y.handler,O=y.action,k=a(20),j=a(12),w=a(272),S=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"setupLogin",value:function(e){var t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags},a=e.resp.headers.get(v.a.name);sessionStorage.setItem(v.a.name,a),sessionStorage.setItem("user",JSON.stringify(t)),(new w.a).set(v.a.name,a,{path:"/"})}},{key:"updateUser",value:function(e){var t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags};sessionStorage.setItem("user",JSON.stringify(t))}},{key:"extraOption",value:function(){var e=sessionStorage.getItem("user");if(!e)return{};try{return JSON.parse(JSON.parse(e).extraOption)}catch(t){return{}}}},{key:"isAdmin",value:function(){var e=sessionStorage.getItem("user");return!!e&&"admin"===JSON.parse(e).role}},{key:"logined",value:function(){return!!sessionStorage.getItem(v.a.name)}},{key:"formLayout2",value:function(){return{formItemLayout:{labelCol:{xs:{span:4},sm:{span:8}},wrapperCol:{xs:{span:4},sm:{span:8}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}},{key:"formLayout1",value:function(){return{formItemLayout:{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}}]),e}(),x=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="workshop","register"!==t.__state.currentPage||S.logined()||(a="register"),e.abrupt("return",{data:Object(k.a)({},t.data,{logined:S.logined(),currentPage:a})});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),C=x.handler,T=x.action,N=a(76),R=function e(){Object(f.a)(this,e)};R.SWITCH="switch",R.CHECK_LOGINED="checkLogined";var D=(i={},Object(m.a)(i,R.SWITCH,E),Object(m.a)(i,R.CHECK_LOGINED,C),Object(m.a)(i,"setState",N.SetStateActionHandler),i);function A(e,t){switch(t.type){case R.SWITCH:return O(e,t.data);case R.CHECK_LOGINED:return T(e,t.data);case"setState":return Object(N.SetStateAction)(e,t.data);default:return e}}a(572);var I=a(63),F=a(1126),P=a(1115),L=a(475),_=a(482),M=a(476),q=a(477),V=a(478),G=a(479),B=a(480),U=a(143),J=a.n(U),K=I.a.SubMenu,H=r.a.createContext();function W(e){var t=e.currentPage,a=e.userLogined,o=e.isUserAdmin,c=Object(n.useContext)($c).dispacher,i=Object(n.useState)(t),s=Object(p.a)(i,2),l=s[0],u=s[1],d=Object(n.useState)(a),m=Object(p.a)(d,2),f=m[0],b=m[1],g=Object(n.useState)(o),v=Object(p.a)(g,2),y=v[0],E=v[1],O=Object(n.useState)(void 0),k=Object(p.a)(O,2),j=k[0],w=k[1],S=Object(n.useRef)();return Object(n.useEffect)(function(){var t=e.currentPage,a=e.userLogined,n=e.isUserAdmin;u(t),b(a),E(n)},[e]),r.a.createElement(H.Provider,null,r.a.createElement(J.a,{title:"Confirm",visible:j||!1,onCancel:function(){w(void 0)},onOk:function(){w(void 0),u(S.current),c(h.a.buildEvent(R.SWITCH,{currentPage:S.current}))},cancelText:"Cancel",okText:"Leave"},r.a.createElement(F.a,{description:j,type:"info"})),r.a.createElement(I.a,{onClick:function(e){"workshop"===l&&"workshop"!==e.key?(S.current=e.key,w("Do you wanna leave workshop? Please make sure you have saved your work before you leave.")):(u(e.key),c(h.a.buildEvent(R.SWITCH,{currentPage:e.key})))},selectedKeys:[l],mode:"horizontal"},r.a.createElement(I.a.Item,{key:"home"},r.a.createElement("span",{style:{fontSize:32}},"MLSQL Web Console")),r.a.createElement(P.a,{type:"vertical"}),!f&&r.a.createElement(I.a.Item,{key:"login",icon:r.a.createElement(L.a,null)},"Login"),!f&&r.a.createElement(I.a.Item,{key:"register",icon:r.a.createElement(_.a,null)},"Register"),f&&r.a.createElement(I.a.Item,{key:"console",icon:r.a.createElement(M.a,null)},"Console"),f&&r.a.createElement(I.a.Item,{key:"workshop",icon:r.a.createElement(q.a,null)},"Analysis Workshop"),f&&r.a.createElement(I.a.Item,{key:"settings",icon:r.a.createElement(V.a,null)},"Settings"),f&&y&&r.a.createElement(I.a.Item,{key:"admin",icon:r.a.createElement(V.a,null)},"Admin"),f&&r.a.createElement(K,{icon:r.a.createElement(G.a,null),title:"More..."},r.a.createElement(I.a.Item,{key:"doc"},"\u4e2d\u6587\u6587\u6863"),r.a.createElement(I.a.Item,{key:"logout",icon:r.a.createElement(B.a,null)},"Logout"))))}var z,Q=a(1131),Y=a(1121),X=a(536),$=a(62),Z=(a(377),h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c,i,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,n=a.userName,r=a.password,o=a.password2,r===o){e.next=3;break}return e.abrupt("return",{data:{error:"Passwords are not matched"}});case 3:return c=new b.ActionProxy,e.next=6,c.post(g.default.REGISTER,{userName:n,password:r});case 6:return i=e.sent,s={},200!==i.status?s={error:JSON.parse(i.content).msg}:(S.setupLogin(i),s={error:void 0,logined:!0,current:t.__state.current+1}),e.abrupt("return",{data:s});case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),ee=Z.handler,te=Z.action,ae=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.ActionProxy,e.next=3,a.post(g.default.LOGIN,t.data);case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",{data:{logined:!1,error:JSON.parse(n.content).msg}});case 6:return S.setupLogin(n),e.abrupt("return",{data:{logined:!0}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),ne=ae.handler,re=ae.action,oe=function e(){Object(f.a)(this,e)};oe.REGISTER="register",oe.LOGIN="login";var ce=(z={},Object(m.a)(z,oe.REGISTER,ee),Object(m.a)(z,oe.LOGIN,ne),z);function ie(e,t){switch(t.type){case oe.REGISTER:return te(e,t.data);case oe.LOGIN:return re(e,t.data);default:return e}}var se=a(87),le=a(88);function ue(){var e=Object(se.a)(["\n  width: 100%;    \n  margin: 0px 10px 10px 0px;\n"]);return ue=function(){return e},e}var pe=le.a.div(ue());var de=function(e){return r.a.createElement(pe,null,r.a.createElement(F.a,Object.assign({},e,{closable:!0,type:e.type||"error",message:"Message",description:e.message})))},me=r.a.createContext(),fe={logined:!1,error:void 0};function he(){var e=Object(n.useContext)($c).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout,c=Object(d.useReducerAsync)(ie,fe,ce),i=Object(p.a)(c,2),s=i[0],l=i[1],u=s.logined,m=s.error;return Object(n.useEffect)(function(){e({type:R.CHECK_LOGINED,data:{}})},[u]),r.a.createElement(me.Provider,{value:{}},r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(Q.a,{title:"Register"},m&&r.a.createElement(de,{type:"error",message:m}),r.a.createElement(Y.a,Object.assign({},a,{className:"login-form",onFinish:function(e){l({type:oe.REGISTER,data:e})}}),r.a.createElement(Y.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(X.a,null)),r.a.createElement(Y.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(X.a.Password,null)),r.a.createElement(Y.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(X.a.Password,null)),r.a.createElement(Y.a.Item,o,r.a.createElement($.a,{type:"primary",htmlType:"submit"},"Go"))))))}var be={logined:!1,error:void 0},ge=r.a.createContext();function ve(){var e=S.formLayout1(),t=e.formItemLayout,a=e.tailLayout,o=Object(n.useContext)($c).dispacher,c=Object(d.useReducerAsync)(ie,be,ce),i=Object(p.a)(c,2),s=i[0],l=i[1],u=s.logined,m=s.error;return Object(n.useEffect)(function(){o({type:R.CHECK_LOGINED,data:{logined:u}})},[u]),r.a.createElement(ge.Provider,null,r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(Q.a,{title:"Login"},m&&r.a.createElement(de,{type:"error",message:m}),r.a.createElement(Y.a,Object.assign({},t,{className:"login-form",onFinish:function(e){l(h.a.buildEvent(oe.LOGIN,e))}}),r.a.createElement(Y.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(X.a,null)),r.a.createElement(Y.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(X.a.Password,null)),r.a.createElement(Y.a.Item,a,r.a.createElement($.a,{type:"primary",htmlType:"submit"},"Go"))))))}var ye=a(10),Ee=a(9),Oe=a(11),ke=a(13),je=(a(188),a(293),a(70)),we=a.n(je),Se=(a(391),a(294),a(295),a(32).ActionProxy),xe=a(31).default,Ce=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"getSuggestList",value:function(){var e=Object(u.a)(l.a.mark(function e(t,a,n){var r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Se,e.next=3,r.post(xe.RUN,{executeMode:"autoSuggest",sql:t,lineNum:a+1,columnNum:n,isDebug:!1,queryType:"robot"});case 3:if(!(o=e.sent)||200!==o.status){e.next=9;break}return c=o.content,e.abrupt("return",c);case 9:return e.abrupt("return",[]);case 10:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()}]),e}(),Te=(a(392),a(1124)),Ne={GET:"get",POST:"post",PUT:"put"},Re=401,De={name:"access-token"},Ae="/api_v1/script_file",Ie="/api_v1/run/script",Fe="/api_v1/file/upload",Pe=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,[{key:"isLogin",value:function(){return null!==sessionStorage.getItem(De.name)}},{key:"userName",value:function(e){new qe("/api_v1/user/userName").request(Ne.GET,{},function(t){t.status===Re?sessionStorage.removeItem(De.name):t.content.then(function(t){e(JSON.parse(t).userName)}).catch(function(e){})},function(e){console.log(e)})}},{key:"user",value:function(e){new qe("/api_v1/user/userName").request2({},function(t){e(t)},function(e){})}},{key:"login",value:function(e,t,a,n){this.registerOrLogin("/api_v1/user/login",e,t,a,n)}},{key:"logout",value:function(){sessionStorage.removeItem(De.name)}},{key:"register",value:function(e,t,a,n){this.registerOrLogin("/api_v1/user/register",e,t,a,n)}},{key:"registerOrLogin",value:function(e,t,a,n,r){var o={userName:t,password:a};new qe(e).request(Ne.POST,o,function(e){e.accessToken&&(sessionStorage.setItem(De.name,e.accessToken),(new w.a).set(De.name,e.accessToken,{path:"/"}));n(e)},function(e){r(e)})}}]),e}(),Le=a(104),_e=function e(t){Object(f.a)(this,e),this.value=t},Me=function e(t,a,n){var r=this;Object(f.a)(this,e),this.json=function(e,t){r.content.then(function(a){try{var n=JSON.parse(a);e(n)}catch(r){console.log(r),t(a)}})},this.status=t,this.content=a,this.accessToken=n},qe=function(){function e(t){Object(f.a)(this,e),this.url=t}return Object(j.a)(e,[{key:"request2",value:function(e,t,a){this.request(Ne.POST,e,function(e){e.json(function(e){t(e)},function(e){a(e)})},function(e){try{e.value().content(function(e){var t=e;try{t=JSON.parse(e).msg}catch(n){}a(t)})}catch(t){a(e?e.toString():"result is null")}})}},{key:"runScript",value:function(e,t,a,n){var r=new Pe,o=Le(),c=this;r.user(function(r){var i=r.userName,s=r.backendTags,l={sql:t,owner:i,jobName:o,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:s||""};Object.assign(l,e),(e.background||!1)&&Object.assign(l,{async:!0,callback:""}),c.request(Ne.POST,l,function(e){if(200===e.status)e.json(function(e){a(e)},function(e){n(e)});else try{e.content.then(function(t){var a=t;try{a=JSON.parse(t).msg}catch(r){}n("backend status:"+e.status+"\n"+a)})}catch(t){n("backend status:"+e.status)}},function(e){try{e.value().content(function(e){var t=e;try{t=JSON.parse(e).msg}catch(a){}n(t)})}catch(t){n(e?e.toString():"result is null")}})})}},{key:"request",value:function(e,t,a,n){e=e.toUpperCase();var r=[];for(var o in t){var c=encodeURIComponent(o),i=encodeURIComponent(t[o]);r.push(c+"="+i)}var s=this.url;return"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&"),fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(De.name)||""},body:r}).then(function(e){a(new Me(e.status,e.text(),e.headers.get(De.name)))}).catch(function(e){n(new _e(e))})}},{key:"newRunScript",value:function(e,t,a,n){var r=new Pe,o=Le(),c=this;r.user(function(r){var i=r.userName,s=r.backendTags;if(s){var l={sql:t,owner:i,jobName:o,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:s||""};Object.assign(l,e),(e.background||!1)&&Object.assign(l,{async:!0,callback:""}),c.new_request(Ne.POST,l,a,n)}else n("\n                \n                ---------------Warning--------------------\n                \n                Please make sure you have backend configured. \n                If not, please contact admin;\n                \n                ------------------------------------------\n                ")})}},{key:"new_request",value:function(e,t,a,n){e=e.toUpperCase();var r=[];for(var o in t){var c=encodeURIComponent(o),i=encodeURIComponent(t[o]);r.push(c+"="+i)}var s=this.url;"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&");var l=0;return fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(De.name)||""},body:r}).then(function(e){return 200===(l=e.status)&&e.json().then(function(e){a(e)}),e}).then(function(e){var t=function(){e.text().then(function(e){try{n(JSON.parse(e).msg)}catch(t){n(e)}})};switch(l){case 201:break;case 400:case 500:t();break;default:console.log("unhandled")}}).catch(function(e){n(e.message)})}}]),e}(),Ve=function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!==typeof Error)throw new Error(t);throw t}},Ge=function e(){Object(f.a)(this,e),this.makeSQL=function(e){return"JobList"===e?"load _mlsql_.`jobs` as output;":"ConnectMySQL"===e?'connect jdbc where\n url="jdbc:mysql://127.0.0.1:3306/wow?characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false"\n and driver="com.mysql.jdbc.Driver"\n and user=""\n and password=""\n as db_1;':"ShowResource"===e?"load _mlsql_.`resource` as output;":""}},Be=a(200),Ue=a(94),Je=function(e){function t(e){return Object(f.a)(this,t),Object(ye.a)(this,Object(Ee.a)(t).call(this,e))}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"getText",value:function(){return this.editor.getValue()}},{key:"getSelection",value:function(){var e=this.editor.getSelectionRange();return this.session.getTextRange(e)}}]),t}(function(){function e(t){Object(f.a)(this,e),this.inner=t,this.session=this.inner.editor.session,this.editor=this.inner.editor}return Object(j.a)(e,[{key:"setText",value:function(e){return this.editor.setValue(e),this}},{key:"append",value:function(e){return this.session.insert({row:this.session.getLength(),column:0},"\n"+e),this}},{key:"insertAfterCursor",value:function(e){var t=this.editor.getCursorPosition();return this.session.insert(t,e),this.editor.focus(),this}}]),e}()),Ke=a(104),He=new b.ActionProxy,We=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"ls",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.ActionProxy,e.next=3,a.runScript("!hdfs -ls -F ".concat(t,";"),Ke(),{queryType:"robot"});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"killJob",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.runScript("!kill "+t+";",Ke(),{queryType:"robot"});case 2:return a=e.sent,e.next=5,He.get(g.default.JOB_KILL,{jobName:t});case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"runJob",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]&&r[1],e.next=3,He.runScript(t,Ke(),{async:a});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"showFunctions",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.runScript("",Ke(),{executeMode:"sqlFunctions"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"jobs",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ke(),e.next=3,He.runScript("load _mlsql_.`jobs` as wow;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",{jobName:t,res:a});case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"tablesInDeltaLake",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ke(),e.next=3,He.runScript("!delta show tables;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"tablesInWorkshop",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.get(g.default.ANALYSIS_TABLES,{});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"tableInfo",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.get(g.default.ANALYSIS_TABLE_INFO,{tableName:t});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"jobProgress",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c,i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.runScript("load _mlsql_.`jobs/get/".concat(t,"` as wow;"),Ke(),{queryType:"robot"});case 2:if(a=e.sent,n={currentJobIndex:0,totalJobs:1},200!==a.status){e.next=17;break}if(r=a.content[0]){e.next=8;break}return e.abrupt("return",n);case 8:if(o=r.progress.currentJobIndex,1!==(c=r.progress.totalJob)){e.next=16;break}return e.next=13,He.runScript("load _mlsql_.`jobs/".concat(t,"` as wow;"),Ke(),{queryType:"robot"});case 13:i=e.sent,o=i.content[0].completedJobsNum,c=i.content[0].activeJobsNum+o;case 16:return e.abrupt("return",{currentJobIndex:o,totalJobs:c});case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"resourceInfo",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.runScript("load _mlsql_.`resource` as output;",Ke(),{queryType:"robot"});case 2:return t=e.sent,a=t.content[0].totalCores,n=t.content[0].activeTasks,e.abrupt("return",{activeTasks:n,totalCores:a});case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}(),ze=a(104),Qe=function(){function e(t){var a=this;Object(f.a)(this,e),this.enterLoading=function(){a.commandGroupRef.setState({loading:!0})},this.exitLoading=function(){a.commandGroupRef.setState({loading:!1})},this.queryPanel=t,this.client=new b.ActionProxy,this.jobName=ze(),this.editorOp=this.queryPanel.getEditorOp(),this.consoleOp=this.queryPanel.getConsoleOp();var n=this.editorOp.getSelection();this.sql=n||this.editorOp.getText(),this.commandGroupRef=this.queryPanel.commandGroup.current,this.jobProgressRef=this.queryPanel.jobProgressRef,this.taskProgressRef=this.queryPanel.taskProgressRef.current,this.displayRef=this.queryPanel.queryApp.display.current,this.dashRef=this.queryPanel.queryApp.dash.current,this.timeout=this.commandGroupRef.state.timeout,this.logInfo={},this.closed=!1}return Object(j.a)(e,[{key:"log",value:function(e){return this.consoleOp.append(e),this}},{key:"prepare",value:function(){this.enterLoading(),this.consoleOp.setText(""),this.displayRef.update(JSON.parse("[]"))}},{key:"measureTime",value:function(e){return this.exitLoading(),(new Date).getTime()-e}},{key:"saveFile",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.queryPanel.state.scriptId){e.next=4;break}return this.log("No file are opened, cannot execute save action"),e.abrupt("return");case 4:return e.next=6,this.client.post(g.default.SAVE_SCRIPT_FILE,{id:a,content:this.editorOp.getText()});case 6:return 200!==(n=e.sent).status&&this.log(n.content),200===n.status&&this.log("File[".concat(a,"] have been saved.")),e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.prepare(),a=(new Date).getTime(),e.next=4,this.client.runScript(this.sql,this.jobName,Object.assign(t,{jobName:this.jobName,async:!0,timeout:this.timeout,engineName:this.queryPanel.engineName}));case 4:if(200===(n=e.sent).status){e.next=8;break}return this.log("Fail to submit job\nTime cost:"+this.measureTime(a)+"ms"),e.abrupt("return",[]);case 8:return this.intervalTimer=setInterval(Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.monitorJob();case 2:return e.next=4,r.monitorLog();case 4:case"end":return e.stop()}},e)})),1e3),this.dashRef.queryHistory&&this.dashRef.queryHistory.reload(),this.jobProgressRef.enter(),e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelMonitor",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null),this.jobProgressRef.exit();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"monitorJob",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(g.default.JOB_DETAIL,{jobName:this.jobName});case 2:t=e.sent,3===(a=t.content).status&&(this.closed=!0,this.cancelMonitor(),this.exitLoading(),this.jobProgressRef.exit(),this.log(a.reason)),2===a.status&&(this.closed=!0,this.cancelMonitor(),this.exitLoading(),this.jobProgressRef.exit(),n=JSON.parse(a.response),this.displayRef.update(n),this.queryPanel.queryApp.setData(n));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"monitorLog",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=ze(),e.next=3,this.client.runScript("load _mlsql_.`log/".concat(this.logInfo.offset||-1,'` where filePath="engine_log" as output;'),t,{queryType:"robot"});case 3:if(200===(a=e.sent).status){e.next=6;break}return e.abrupt("return");case 6:(n=a.content[0]).value&&n.value.length>0&&this.log(n.value.map(function(e){return e.split("__MMMMMM__")[1]}).join("\n")),this.logInfo.offset=n.offset;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"killJob",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jobName){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,We.killJob(this.jobName);case 4:t=e.sent;try{this.log(t.content[0].description)}catch(a){this.log(t.content)}this.closed=!0,this.jobName=null,this.cancelMonitor(),this.exitLoading();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Ye=a(278),Xe=a.n(Ye),$e=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).enter=function(e){a.setState({loading:!0}),a.intervalTimer=setInterval(Object(u.a)(l.a.mark(function e(){var t,n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.queryPanel.executor.jobName,e.next=3,We.jobProgress(t);case 3:n=e.sent,r=n.currentJobIndex,o=n.totalJobs,a.setState({progress:r/o*100});case 7:case"end":return e.stop()}},e)})),1e3)},a.exit=function(){a.intervalTimer&&(clearInterval(a.intervalTimer),a.intervalTimer=null,a.finalTime=(a.timer.getTime()/1e3).toFixed(2)+"s",a.setState({loading:!1}))},a.queryPanel=e.parent,a.state={loading:!1,progress:0},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return this.state.loading?n.createElement("div",null,n.createElement($.a,{type:"primary",style:{marginRight:"20px"}},"Time Cost:",n.createElement(Xe.a,{ref:function(t){return e.timer=t}},n.createElement(Xe.a.Minutes,{formatValue:function(e){return"".concat(e," m. ")}}),n.createElement(Xe.a.Seconds,{formatValue:function(e){return"".concat(e," s. ")}}))),n.createElement(Te.a,{type:"circle",percent:this.state.progress})):this.finalTime?n.createElement($.a,{type:"primary",style:{margin:"0px 0px 20px 0px"}},"Time Cost: ",this.finalTime):n.createElement("div",null)}}]),t}(n.Component),Ze=(a(757),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).enter=function(e){},a.exit=function(){},a.queryPanel=e.parent,a.state={percent:0},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n,r,o,c,i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.resourceInfo();case 2:return t=e.sent,a=t.activeTasks,n=t.totalCores,e.next=7,We.jobs();case 7:r=e.sent,o=r.jobName,c=r.res,i=c.content.filter(function(e){return e.jobName!==o}).length,this.setState({percent:a/n*100,totalCores:n,activeTasks:a,jobNum:i});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return n.createElement("div",{className:"rp-main"},n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"CPU Usage(total cores:",this.state.totalCores,"): "),n.createElement(Te.a,{percent:this.state.percent,style:{maxWidth:"300px"}})),n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"Jobs Running: ",n.createElement("span",null,this.state.jobNum))))}}]),t}(n.Component));function et(e){var t=Object(n.useState)(void 0),a=Object(p.a)(t,2),o=(a[0],a[1],Object(n.useState)([])),c=Object(p.a)(o,2),i=c[0],s=c[1],d=Object(n.useState)(!1),m=Object(p.a)(d,2),f=(m[0],m[1]),h=Object(n.useState)(void 0),v=Object(p.a)(h,2),y=v[0],E=v[1];Object(n.useEffect)(function(){(function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),t=new b.ActionProxy,e.next=4,t.get(g.default.ENGINE_LIST,{});case 4:a=e.sent,s(a.content.data),n=S.extraOption().backend,a.content.data.length>0&&!n&&E(a.content.data[0].name),f(!1);case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(function(){e.useEngine(y)},[y]);return r.a.createElement(Be.a,{onChange:function(e){E(e)},style:{width:"120px"}},i.map(function(e){return r.a.createElement(Be.a.Option,{value:e.name},e.name)}))}var tt=Be.a.Option,at=(a(104),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).text=function(e,t){a.setState({value:e,scriptId:t},function(){a.aceEditorRef.current.editor.setValue(e,1)})},a.executeSave=Object(u.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Qe(Object(ke.a)(Object(ke.a)(a))),e.next=3,t.saveFile({});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)})),a.getAllText=function(){return a.getAceEditor().getValue()},a.getSelection=function(){return a.getEditorOp().getSelection()},a.appendToEditor=function(e){return a.getEditorOp().insertAfterCursor(e)},a.getEditorOp=function(){return new Je(a.aceEditorRef.current)},a.getConsoleOp=function(){return new Je(a.queryApp.messageBox.current)},a.getAceEditor=function(){return a.getEditorOp().editor},a.getMessageBoxAceEditor=function(){return a.getConsoleOp().editor},a.appendLog=function(e){return a.getConsoleOp().append(e)},a.getDashBoard=function(){return a.queryApp.dash.current},a.getDisplay=function(){return a.queryApp.display.current},a.enterLoading=function(e){a.commandGroup.current.setState({loading:!0}),a.resourceProgressRef.current.enter({jobName:e}),a.jobProgressRef.enter({jobName:e}),a.taskProgressRef.current.enter({jobName:e})},a.exitLoading=function(){a.commandGroup.current.setState({loading:!1}),a.jobProgressRef.exit(),a.resourceProgressRef.current.exit(),a.taskProgressRef.current.exit()},a.etOver=function(e){var t=a.queryApp.etRef.current,n=t.getData("eventName"),r=t.getData("popName"),o=t.getData("processType"),c=t.getData("pathAlias"),i=t.getData("tableHidden"),s=t.getData("pathHidden"),l=t.getData("outputTableHidden"),u=t.getData("outputTableAlias"),p=t.getData("tableAlias");"direct"===o?a.appendToEditor((new Ge).makeSQL(n)):t.setState({etPop:!0,eventName:n,popName:r,processType:o,pathAlias:c,tableHidden:i,pathHidden:s,outputTableHidden:l,outputTableAlias:u,tableAlias:p})},a.language=a.props.language||"sql",a.queryApp=a.props.parent,a.aceEditorRef=n.createRef(),a.commandGroup=n.createRef(),a.taskProgressRef=n.createRef(),a.cancelQuery=a.cancelQuery.bind(Object(ke.a)(Object(ke.a)(a))),a.executeQuery=a.executeQuery.bind(Object(ke.a)(Object(ke.a)(a))),a.state={value:"",loading:!1},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this);var e={getCompletions:function(){var e=Object(u.a)(l.a.mark(function e(t,a,n,r,o){var c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.getSuggestList(t.getValue(),n.row,n.column);case 2:c=e.sent,o(null,c.map(function(e){var t="";return"desc"in e.extra&&(t=e.extra.desc),{caption:e.name,value:e.name,meta:t}}));case 4:case"end":return e.stop()}},e)}));return function(t,a,n,r,o){return e.apply(this,arguments)}}()};this.getAceEditor().completers=[e]}},{key:"onChange",value:function(e){}},{key:"executeQuery",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.executor||this.executor.closed){e.next=4;break}return this.log("Job ".concat(this.jobName," is still running.")),this.log("Try to kill this job or wait it to finish"),e.abrupt("return");case 4:return this.executor=new Qe(this),e.next=7,this.executor.run({});case 7:return t=e.sent,this.executor.closed||(this.executor.closed=!0),e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cancelQuery",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.executor&&this.executor.killJob();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:function(e){return e.preventDefault()},onDrop:this.etOver},n.createElement(Ue.Resizable,{defaultSize:{height:"500px"},onResize:function(){e.aceEditorRef.current.editor.resize()}},n.createElement(we.a,{ref:this.aceEditorRef,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(nt,{ref:this.commandGroup,parent:this}),n.createElement($e,{ref:function(t){e.jobProgressRef=t},parent:this}),n.createElement(rt,{ref:this.taskProgressRef,parent:this}))}}]),t}(n.Component)),nt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).onChange=function(e){a.setState({timeout:e})},a.state={loading:!1,timeout:"-1"},a.parent=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement($.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement($.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement($.a,{onClick:this.parent.executeSave},"Save"),"Job Timeout:",n.createElement(Be.a,{onChange:this.onChange,style:{width:"120px"}},n.createElement(tt,{value:"10000"},"10s"),n.createElement(tt,{value:"30000"},"30s"),n.createElement(tt,{value:"60000"},"60s"),n.createElement(tt,{value:"1800000"},"30m"),n.createElement(tt,{value:"7200000"},"2h"),n.createElement(tt,{value:"28800000"},"8h"),n.createElement(tt,{value:"-1"},"unlimited")),n.createElement(P.a,{type:"vertical"}),"Engine:",n.createElement(et,{useEngine:function(t){e.engineName=t}}))}}]),t}(n.Component),rt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).enter=function(e){var t=Object(ke.a)(Object(ke.a)(a));a.setState({mark:!0}),setTimeout(function(){t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(function(){if("loading"!==t.taskCompute){t.taskCompute="loading";var a=new qe(Ie);Ve(e.hasOwnProperty("jobName"),"jobName is required");var n=e.jobName;a.runScript({},"load _mlsql_.`jobs/".concat(n,"` as output;"),function(e){t.taskCompute="loaded";var a=e[0],n={numTasks:0,numActiveTasks:0,numCompletedTasks:0};a.activeJobs.forEach(function(e){n.numTasks+=e.numTasks,n.numActiveTasks+=e.numActiveTasks,n.numCompletedTasks+=e.numCompletedTasks}),t.setState({percent:n.numActiveTasks/n.numTasks*100,successPercent:n.numCompletedTasks/n.numTasks*100,title:"Tasks (for all stages): Succeeded/Total:\n".concat(n.numCompletedTasks,"/").concat(n.numTasks,"(").concat(n.numActiveTasks," running)")})},function(e){t.taskCompute="loaded";try{t.parent.appendLog(e)}catch(a){console.log(a)}})}},1e3))},1e3)},a.exit=function(){a.taskCompute="loaded",a.resourceCompute="loaded",a.setState({loading:!1,percent:0,successPercent:0,mark:!1}),a.intervalTimer&&clearInterval(a.intervalTimer)},a.state={loading:!1,percent:0,successPercent:0,mark:!1},a.parent=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return this.state.loading?n.createElement("div",null,this.state.title,n.createElement(Te.a,{percent:this.state.percent,successPercent:this.state.successPercent})):n.createElement("div",null)}}]),t}(n.Component),ot=at,ct=(a(760),a(1119)),it=a(1125),st=a(208),lt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).setRender=function(e,t){var r=t[0][e.key];if(a.config&&a.config.render){var o=a.config.render[e.key];o&&(e.render=o)}else{try{if(n.Component.isPrototypeOf(r.type))return void(e.render=function(e){return n.createElement("span",null,e)})}catch(c){}"html"!=e.key?"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=function(e){return n.createElement("pre",null,e.toString())}):e.render=function(e){return n.createElement("span",null,e.toString())}:e.render=function(e){return n.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return n.createElement("span",null,JSON.stringify(e).substring(0,300))}:e.render=function(e){return n.createElement("pre",null,e.substring(0,300))}}},a.update=function(e,t){a.config=t;var n=[],r={},o=[],c=Object(ke.a)(Object(ke.a)(a));e.forEach(function(t){for(var a in t)if(!r[a]){var o={title:a,dataIndex:a,key:a};c.setRender(o,e),n.push(o),r[a]=!0}}),e.forEach(function(e,t){var a={};n.forEach(function(t){a[t.key]=e[t.key]}),a.key=t,o.push(a)}),a.setState({columns:n,data:o})},a.rowDoubleClick=function(e,t,n){"codeExample"!==e.name&&"doc"!==e.name||a.setState({view:{enabled:!0,content:e.value}})},a.disablePreview=function(){a.setState({view:{enabled:!1}})},a.tableStyle=e.style||{},a.state={columns:[],rows:[],view:{enabled:!1}},a.config={},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",{style:this.tableStyle},n.createElement(ct.a,{onRow:function(t,a){return{onDoubleClick:function(n){e.rowDoubleClick(t,a,n)}}},columns:this.state.columns,dataSource:this.state.data}),n.createElement(it.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(st,{source:this.state.view.content||""})))}}]),t}(n.Component),ut=a(1122),pt=a(354),dt=a(540),mt=a(538),ft=a(502),ht=a.n(ft),bt={width:200,height:200,borderWidth:2,borderColor:"#666",borderStyle:"dashed",borderRadius:5},gt={borderStyle:"solid",borderColor:"#6c6",backgroundColor:"#eee"},vt={borderStyle:"solid",borderColor:"#c66",backgroundColor:"#eee"},yt={display:"flex"},Et=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(ye.a)(this,Object(Ee.a)(t).call(this))).onDrop=function(t){e.setState({files:t});var a=ht.a.post(Fe);a.set("Access-Token",sessionStorage.getItem(De.name)||""),t.forEach(function(e){a.attach(e.path,e)}),a.end(function(a,n){e.setState({files:[]}),a?(console.log(a),e.setState({msg:a.toString()+"\n Sometimes this caused by your upload space is not enough or backend fails"})):n.ok&&e.setState({msg:"total files:"+t.length+" are uploaded. \n You can check the files with command: !hdfs -ls /tmp/upload; "})})},e.state={files:[]},e}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this.state.files.map(function(e){return r.a.createElement("li",{key:e.name},e.path," - ",e.size," bytes")});return r.a.createElement("section",{style:yt},r.a.createElement("div",null,r.a.createElement(dt.a,{onDrop:this.onDrop,getDataTransferItems:function(e){return Object(mt.a)(e)}},function(e){var t=e.getRootProps,a=e.getInputProps,n=e.isDragActive,o=e.isDragAccept,c=e.isDragReject,i=(e.acceptedFiles,e.rejectedFiles,Object(k.a)({},bt));return i=n?Object(k.a)({},i,gt):i,i=c?Object(k.a)({},i,vt):i,r.a.createElement("div",Object.assign({},t(),{style:i}),r.a.createElement("input",a()),r.a.createElement("div",null,o?"Drop":"Drag"," files here..."),c&&r.a.createElement("div",null,"Unsupported file type..."))})),r.a.createElement("aside",null,r.a.createElement("h4",null,0===e.length?"":"Files"),r.a.createElement("ul",null,e)),r.a.createElement("div",null,this.state.msg?this.state.msg:""))}}]),t}(r.a.Component),Ot=a(270),kt=a(40),jt=a(446),wt=function(){var e=jt();return"#000000"===e&&(e="#8884d8"),e},St=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"render",value:function(e){var t=e[0].hasOwnProperty("z");e.hasOwnProperty("dataType")||e.forEach(function(e){e.dataType="default",t||(e.z=0)});var a=e.reduce(function(e,t){t.x,t.y,t.z;var a=t.dataType,n=e.get(a);return n?n.push(t):e.set(a,[t]),e},new Map),n=e[0]._dash_config||{},o=Object(Ot.a)(a.keys()).map(function(e){var t=Object.assign({fill:wt(),shape:"triangle"},n[e]||{});return r.a.createElement(kt.g,Object.assign({key:e,name:e,data:a.get(e)},t))}),c=Object.assign({type:"number",dataKey:"x"},n.x||{}),i=Object.assign({type:"number",dataKey:"y"},n.y||{}),s=Object.assign({type:"number",dataKey:"z"},n.z||{});return r.a.createElement(kt.h,{width:400,height:400,margin:{top:20,right:20,bottom:20,left:20}},r.a.createElement(kt.c,null),r.a.createElement(kt.j,c),r.a.createElement(kt.k,i),t?r.a.createElement(kt.l,s):"",r.a.createElement(kt.i,{cursor:{strokeDasharray:"3 3"}}),r.a.createElement(kt.d,null),o)}}]),e}();St.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},St.isShouldRender=function(e){return St.basicCheck(e,function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&(e.hasOwnProperty("_dash_config")||e.hasOwnProperty("dash"))&&("scatter"===e.dash||"scatter"===(e._dash_config||{}).dash)})};var xt=a(446),Ct=function(){var e=xt();return"#000000"===e&&(e="#8884d8"),e},Tt=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"render",value:function(e){var t=e[0],a=[],n=t._dash_config||{};return"line"===t.dash||"line"===n.dash?(Object.keys(t).forEach(function(e){if("number"===typeof t[e]){var o=Object.assign({stroke:Ct()},n[e]||{});a.push(r.a.createElement(kt.e,Object.assign({key:e,type:"monotone",dataKey:e},o)))}}),r.a.createElement(kt.f,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(kt.c,{strokeDasharray:"3 3"}),r.a.createElement(kt.j,{dataKey:"x"}),r.a.createElement(kt.k,null),r.a.createElement(kt.i,null),r.a.createElement(kt.d,null),a)):"bar"===t.dash||"bar"===n.dash?(Object.keys(t).forEach(function(e){if("number"===typeof t[e]){var o=Object.assign({fill:Ct()},n[e]||{});a.push(r.a.createElement(kt.a,Object.assign({key:e,dataKey:e},o)))}}),r.a.createElement(kt.b,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(kt.c,{strokeDasharray:"3 3"}),r.a.createElement(kt.j,{dataKey:"x"}),r.a.createElement(kt.k,null),r.a.createElement(kt.i,null),r.a.createElement(kt.d,null),a)):void 0}}]),e}();Tt.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},Tt.isShouldRender=function(e){return Tt.basicCheck(e,function(e){return e.hasOwnProperty("x")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config"))})};var Nt=a(513),Rt=a.n(Nt),Dt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).renderStream=function(){var e=a.state.data,t=[],n=[];e.forEach(function(e){var a=JSON.parse(e.value),r=Rt.a.utc(a.timestamp).format("DD,h:mm:ss");t.push({x:r,inputRowsPerSecond:a.inputRowsPerSecond,processedRowsPerSecond:a.processedRowsPerSecond}),n.push({x:r,numInputRows:a.numInputRows})}),a.setState({dataForRender:t,dataForRender2:n})},a.queryApp=e.parent.parent,a.state={data:e.data,dataForRender:[],titleMap:{}},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.renderStream()}},{key:"render",value:function(){return 0===this.state.dataForRender.length?null:r.a.createElement("div",null,r.a.createElement(kt.f,{width:800,height:300,data:this.state.dataForRender},r.a.createElement(kt.e,{type:"monotone",dataKey:"inputRowsPerSecond",stroke:"#8884d8"}),r.a.createElement(kt.e,{type:"monotone",dataKey:"processedRowsPerSecond",stroke:"#82ca9d"}),r.a.createElement(kt.c,{stroke:"#ccc"}),r.a.createElement(kt.j,{dataKey:"x"}),r.a.createElement(kt.k,null),r.a.createElement(kt.d,null)),r.a.createElement(kt.f,{width:800,height:300,data:this.state.dataForRender2},r.a.createElement(kt.e,{type:"monotone",dataKey:"numInputRows",stroke:"#8884d8"}),r.a.createElement(kt.c,{stroke:"#ccc"}),r.a.createElement(kt.j,{dataKey:"x"}),r.a.createElement(kt.k,null),r.a.createElement(kt.d,null)))}}]),t}(n.Component);Dt.isStream=function(e){if(e.length<1)return!1;try{if(!JSON.parse(e[0].value).runId)return!1}catch(t){return!1}return!0},Dt.isShouldRender=function(e){return Dt.isStream(e)},Dt.renderRawData=function(e){if(!Dt.isShouldRender(e))return"";var t=[];return e.forEach(function(e){var a=JSON.parse(e.value);t.push(JSON.stringify(a,null,2))}),t.join("\n")};var At=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"render",value:function(e){var t=e[0];return r.a.createElement(It,{data:t})}}]),e}();At.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},At.isShouldRender=function(e){return At.basicCheck(e,function(e){return e.hasOwnProperty("html")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config"))})};var It=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).refresh=function(e){a.setState({data:e})},a.state={data:a.props.data},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Ue.Resizable,{defaultSize:{height:"500px"}},r.a.createElement("iframe",{sandbox:"allow-scripts",style:{width:"100%",height:"100%"},srcDoc:this.state.data.html,frameBorder:"0",scrolling:"yes",ref:function(t){e.ifr=t}})))}}]),t}(r.a.Component),Ft=function(e){function t(e){var a;Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).toggleDetail=function(){a.setState({showDetail:!a.state.showDetail})},a.toggleResponse=function(){a.setState({showResponse:!a.state.showResponse})},a.queryApp=e.parent.queryApp,a.client=new b.ActionProxy,a.state={showDetail:!1,executeAgainStatus:{}};var n=function(e,t){return r.a.createElement($.a,{type:"link",onClick:function(){var e=Object(u.a)(l.a.mark(function e(n){var r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.target.parentNode,o=r.parentNode.cellIndex,c="",e.t0=o,e.next=2===e.t0?6:4===e.t0?8:7===e.t0?10:12;break;case 6:return c="content",e.abrupt("break",12);case 8:return c="reason",e.abrupt("break",12);case 10:return c="response",e.abrupt("break",12);case 12:return console.log(o),e.next=15,a.showDetail(t.name,c);case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e))};return a.renderConfig={render:{content:n,response:function(e,t){return r.a.createElement($.a,{type:"link",onClick:function(){var e=Object(u.a)(l.a.mark(function e(n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.showResponse(t.name);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e))},reason:n,status:function(e){var t="",a={};switch(e){case"fail":case"killed":t="danger";break;case"success":t="primary",a={backgroundColor:"green"};break;case"running":t="primary"}return r.a.createElement($.a,{type:t,style:a},e)},__command__:function(e,t){var n=t.name;return"running"!==t.status?r.a.createElement($.a,{type:"primary",key:n,loading:a.state.executeAgainStatus[n],onClick:function(){var e=Object(u.a)(l.a.mark(function e(r){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.state.executeAgainStatus[n]=!0,a.setState(a.state.executeAgainStatus),e.next=4,We.runJob(t.content);case 4:a.reload();case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},"Execute again"):r.a.createElement($.a,{key:n,onClick:function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.killJob(n);case 2:e.sent,a.reload();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},"Kill")}}},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({executeAgainStatus:{}}),e.next=3,this.client.get(g.default.JOB_LIST,{});case 3:200==(t=e.sent).status&&this.display&&this.display.update(this.processData(t.content),this.renderConfig);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"processData",value:function(e){return e.map(function(e){var t="running"===e.status?e.jobName:"";return Object.assign(e,{__command__:t})})}},{key:"showDetail",value:function(){var e=Object(u.a)(l.a.mark(function e(t,a){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(g.default.JOB_DETAIL,{jobName:t});case 2:n=e.sent,this.setState({showDetail:!0,detailConsoleMessage:n.content[a]});case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"showResponse",value:function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(g.default.JOB_DETAIL,{jobName:t});case 2:a=e.sent,this.setState({showResponse:!0}),this.respDisplay&&this.respDisplay.update(JSON.parse(a.content.response));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(it.a,{title:"View",visible:this.state.showDetail,onCancel:this.toggleDetail,onOk:this.toggleDetail,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(we.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.detailConsoleMessage||""})),r.a.createElement(it.a,{title:"View",visible:this.state.showResponse,onCancel:this.toggleResponse,onOk:this.toggleResponse,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(lt,{style:{overflow:"scroll"},ref:function(t){e.respDisplay=t},parent:this})),r.a.createElement("div",{style:{marginBottom:16}},r.a.createElement($.a,{type:"primary",onClick:function(){e.reload()}},"Reload")),r.a.createElement(lt,{ref:function(t){e.display=t},parent:this}))}}]),t}(r.a.Component),Pt=ut.a.Panel,Lt=pt.a.TabPane;function _t(e){}var Mt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).isNormalXY=function(e){return t.basicCheck(e,function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&"number"===typeof e.y})},a.xYRender=function(e){return r.a.createElement(kt.a,{height:200,title:"Bar",data:e})},a.renderDash=function(){var e=a.state.data;return Dt.isShouldRender(e)?r.a.createElement(Dt,{data:e,parent:Object(ke.a)(Object(ke.a)(a))}):St.isShouldRender(e)?St.render(e):a.isNormalXY(e)?a.xYRender(e):Tt.isShouldRender(e)?Tt.render(e):At.isShouldRender(e)?At.render(e):r.a.createElement("div",null)},a.queryApp=e.parent,a.state={data:[],dataForRender:[],titleMap:{}},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"refresh",value:function(){try{var e=this.queryApp.queryResData||[];this.setState({data:e})}catch(t){}}},{key:"render",value:function(){var e=this;return r.a.createElement(ut.a,{onChange:_t},r.a.createElement(Pt,{header:"Tools/Dashboard",key:"0"},r.a.createElement(pt.a,{defaultActiveKey:"0",onChange:_t,onTabClick:function(t){"0"===t&&e.resourceProgressRef.reload()}},r.a.createElement(Lt,{tab:"Cluster Info",key:"0"},r.a.createElement(Ze,{ref:function(t){return e.resourceProgressRef=t},parent:this})),r.a.createElement(Lt,{tab:"Upload",key:"1"},r.a.createElement(Et,null)),r.a.createElement(Lt,{tab:"Dashboard",key:"2"},this.renderDash()),r.a.createElement(Lt,{tab:"RawData",key:"3"},r.a.createElement("pre",null,Dt.renderRawData(this.state.data))),r.a.createElement(Lt,{tab:"History",key:"4"},r.a.createElement(Ft,{ref:function(t){return e.queryHistory=t},parent:this})))))}}]),t}(n.PureComponent);Mt.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0};var qt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).originalEditor=function(){return a.editor.editor},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.originalEditor().container.style.lineHeight=3}},{key:"render",value:function(){var e=this;return r.a.createElement(we.a,{maxLines:1/0,width:"100%",ref:function(t){e.editor=t},value:this.props.initialCode,mode:"sql",theme:"github"})}}]),t}(r.a.Component),Vt=a(1118),Gt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).evtExecute=function(){a.setState({isExecute:!0}),a.state.executeUnit.execute()},a.cancelExecute=function(){a.setState({isExecute:!1})},a.state={isExecute:!1,executeUnit:e.executeUnit},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.state.isExecute?r.a.createElement("span",{onClick:this.cancelExecute},r.a.createElement(Vt.a,{type:"sync",spin:!0})):r.a.createElement("span",{onClick:this.evtExecute},r.a.createElement(Vt.a,{type:"caret-right"})))}}]),t}(r.a.Component),Bt=a(104),Ut=function e(t){var a=this;Object(f.a)(this,e),this.run=function(e,t,n){var r=Bt();new qe(Ie).newRunScript({jobName:r,timeout:a.timeout},e,t,n)},this.saveFile=function(e,t,a){new qe(Ae).request(Ne.POST,{id:t,content:e},function(e){200!=e.status?e.json(function(e){a(e.msg)},function(e){a(e)}):a("saved")},function(e){a(e)})},this.timeout=t},Jt=a(208),Kt=function(e){function t(e){var a;Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).setRender=function(e,t,r){var o=t[0][e.key];if(r&&r.render){var c=a.state.config.render[e.key];c&&(e.render=c)}else{try{if(n.Component.isPrototypeOf(o.type))return void(e.render=function(e){return n.createElement("span",null,e)})}catch(i){}"object"!==typeof o?"array"!==typeof o?"boolean"!==typeof o?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=function(e){return n.createElement("pre",null,e.toString())}):e.render=function(e){return n.createElement("span",null,e.toString())}:e.render=function(e){return n.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return n.createElement("span",null,JSON.stringify(e).substring(0,300))}}},a.parseData=function(e,t){var n=[],r={},o=[],c=Object(ke.a)(Object(ke.a)(a));return e.forEach(function(t){for(var a in t)if(!r[a]){var o={title:a,dataIndex:a,key:a};c.setRender(o,e),n.push(o),r[a]=!0}}),e.forEach(function(e,t){var a={};n.forEach(function(t){a[t.key]=e[t.key]}),a.key=t,o.push(a)}),[n,o]},a.refresh=function(e,t){var n=a.parseData(e,t),r=Object(p.a)(n,2),o=r[0],c=r[1];a.setState({columns:o,rows:c,config:t})},a.rowDoubleClick=function(e,t,n){"codeExample"!==e.name&&"doc"!==e.name||a.setState({view:{enabled:!0,content:e.value}})},a.disablePreview=function(){a.setState({view:{enabled:!1}})};var r=a.parseData(e.data||[],e.config||{}),o=Object(p.a)(r,2),c=o[0],i=o[1];return a.state={columns:c,rows:i,view:{enabled:!1}},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement(ct.a,{onRow:function(t,a){return{onDoubleClick:function(n){e.rowDoubleClick(t,a,n)}}},columns:e.state.columns,dataSource:e.state.rows}),n.createElement(it.a,{title:"View",visible:e.state.view.enabled,onCancel:e.disablePreview,onOk:e.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(Jt,{source:e.state.view.content||""})))}}]),t}(n.Component),Ht=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).refresh=function(e){if(a.setState({displayData:e,errorMsg:""}),a.displayTableRef&&a.displayTableRef.refresh(a.state.displayData,{}),a.displayDashRef){var t=a.state.displayData[0];a.displayDashRef.refresh(t)}},a.fail=function(e){a.setState({errorMsg:e}),a.editor&&a.editor.editor.setValue(e)},a.displayDash=function(){if(a.state.displayData&&At.isShouldRender(a.state.displayData)){var e=a.state.displayData[0];return r.a.createElement(It,{data:e,ref:function(e){return a.displayDashRef=e}})}return r.a.createElement("div",null)},a.displayError=function(){return a.state.errorMsg?r.a.createElement("div",null,r.a.createElement(we.a,{maxLines:1/0,width:"100%",ref:function(e){a.editor=e},value:a.state.errorMsg,mode:"text",theme:"ace/theme/textmate"})):r.a.createElement("div",null)},a.displayTable=function(){return a.state.displayData?r.a.createElement(Kt,{data:a.state.displayData,ref:function(e){return a.displayTableRef=e}}):r.a.createElement("div",null)},a.state={errorMsg:""},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.displayError(),this.displayTable(),this.displayDash())}}]),t}(r.a.Component),Wt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).execute=function(){var e=a.codeBlock.originalEditor().getValue();new Ut(3e5).run(e,function(e){a.displayGroup.refresh(e),a.commandGroup.setState({isExecute:!1}),a.notebook.nextExecuteUnit()},function(e){a.displayGroup.fail(e),a.commandGroup.setState({isExecute:!1})})},a.codeBlockIsEmpty=function(){return""===a.getCodeStr()},a.getCodeStr=function(){return a.codeBlock.originalEditor().getValue()},a.notebook=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(qt,{initialCode:this.props.initialCode,ref:function(t){e.codeBlock=t},executeUnit:this}),r.a.createElement(Gt,{ref:function(t){e.commandGroup=t},executeUnit:this}),r.a.createElement(Ht,{ref:function(t){return e.displayGroup=t}}))}}]),t}(r.a.Component),zt="set notebooksplitter='notebooksplitter';",Qt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).createNewExecuteUnit=function(e){return r.a.createElement(Wt,{parent:Object(ke.a)(Object(ke.a)(a)),initialCode:e,ref:function(e){return a.addRef(e)}})},a.addRef=function(e){e&&a.executeUnitRefs.push(e)},a.nextExecuteUnit=function(){a.executeUnitRefs.slice(-1)[0].codeBlockIsEmpty()||(a.executeUnits.push(a.createNewExecuteUnit()),a.setState({executeUnits:a.executeUnits})),a.saveNoteBook()},a.saveNoteBook=function(){var e=a.executeUnitRefs.map(function(e){return e.getCodeStr()}).join(zt);a.engine.saveFile(e,a.scriptId,function(e){})},a.text=function(e,t){a.scriptId=t,a.initialCode=e,e&&"undefined"!==e&&(a.executeUnitRefs=[],a.executeUnits=a.initialCode.split(zt).map(function(e){return a.createNewExecuteUnit(e)}),a.setState({executeUnits:a.executeUnits}))},a.executeUnitRefs=[],a.executeUnits=[a.createNewExecuteUnit("")],a.state={executeUnits:a.executeUnits},a.engine=new Ut(3e5),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this)}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.executeUnits)}}]),t}(r.a.Component),Yt=a(104),Xt=function(){function e(t){Object(f.a)(this,e),this.appendLog=t,this.log={}}return Object(j.a)(e,[{key:"cancelQueryLog",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryLog",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.cancelQueryLog(),this.intervalTimer=setInterval(Object(u.a)(l.a.mark(function e(){var a,n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Yt(),n=new b.ActionProxy,e.next=4,n.runScript("load _mlsql_.`log/".concat(t.log.offset||-1,'` where filePath="engine_log" as output;'),a,{});case 4:r=e.sent,(o=r.content[0]).value.length>0&&t.appendLog(o.value.map(function(e){return e.split("__MMMMMM__")[1]}).join("\n")),t.log.offset=o.offset;case 8:case"end":return e.stop()}},e)})),2e3);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),$t=(Be.a.Option,a(104)),Zt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).text=function(e,t){a.setState({value:e,scriptId:t},function(){a.aceEditorRef.editor.setValue(e,1)})},a.executeSave=function(){var e=new qe(Ae),t=Object(ke.a)(Object(ke.a)(a)),n=a.getMessageBoxAceEditor();t.state.scriptId?e.request(Ne.POST,{id:t.state.scriptId,content:t.getAceEditor().getValue()},function(e){200!=e.status?e.json(function(e){t.appendLog(e.msg)},function(e){t.appendLog(e)}):t.appendLog("saved")},function(e){t.appendLog(e)}):n.setValue("no file are opened, cannot executeSave")},a.getAllText=function(){return a.getAceEditor().getValue()},a.getSelection=function(){var e=a.getAceEditor().getSelectionRange();return a.getAceEditor().session.getTextRange(e)},a.appendToEditor=function(e){var t=a.getAceEditor(),n=t.getCursorPosition();t.session.insert(n,e),t.focus()},a.getAceEditor=function(){return a.aceEditorRef.editor},a.getMessageBoxAceEditor=function(){return a.queryApp.messageBox.current.editor},a.appendLog=function(e){var t=a.getMessageBoxAceEditor().session;t.insert({row:t.getLength(),column:0},"\n"+e)},a.getDashBoard=function(){return a.queryApp.dash.current},a.getDisplay=function(){return a.queryApp.display.current},a.language=a.props.language||"sql",a.queryApp=a.props.parent.queryApp,a.state={value:"",loading:!1},a.executeQuery=a.executeQuery.bind(Object(ke.a)(Object(ke.a)(a))),a.cancelQuery=a.cancelQuery.bind(Object(ke.a)(Object(ke.a)(a))),a.logMonitor=new Xt(a.appendLog),a.log={},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this)}},{key:"onChange",value:function(e){}},{key:"executeQuery",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n,r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.commandGroup.setState({loading:!0}),this.jobName=$t(),t=new b.ActionProxy,(a=this).getMessageBoxAceEditor().setValue(""),a.getDisplay().update(JSON.parse("[]")),n=a.getSelection(),r=a.getAllText(),""!==n&&(r=n),o=a.state.scriptId,this.logMonitor.queryLog(),e.next=13,t.runScript(r,this.jobName,{scriptId:o,runMode:"python",executeMode:"python"});case 13:if(200===(c=e.sent).status){e.next=19;break}return this.logMonitor.cancelQueryLog(),this.appendLog(c.content),this.commandGroup.setState({loading:!1}),e.abrupt("return");case 19:try{this.appendLog(c.content.join("\n"))}catch(i){this.appendLog(c.content.msg)}this.logMonitor.cancelQueryLog(),this.commandGroup.setState({loading:!1});case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cancelQuery",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jobName){e.next=2;break}return e.abrupt("return");case 2:return t=$t(),a=new b.ActionProxy,e.next=6,a.runScript("!kill "+this.jobName+";",t,{});case 6:n=e.sent;try{this.appendLog(n.content[0].description)}catch(r){this.appendLog(n.content)}this.jobName=null,this.logMonitor.cancelQueryLog();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:function(e){return e.preventDefault()},onDrop:this.etOver},n.createElement(Ue.Resizable,{defaultSize:{height:"500px"},onResize:function(){e.aceEditorRef.current.editor.resize()}},n.createElement(we.a,{ref:function(t){return e.aceEditorRef=t},mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(ea,{ref:function(t){return e.commandGroup=t},parent:this}))}}]),t}(n.Component),ea=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).onChange=function(e){a.setState({timeout:e})},a.state={loading:!1,timeout:"-1"},a.parent=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement($.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement($.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement($.a,{onClick:this.parent.executeSave},"Save"))}}]),t}(n.Component),ta=Zt,aa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).addRef=function(e){e&&(a.editor=e)},a.text=function(e,t){a.editor.text(e,t)},a.queryApp=a.props.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(ta,{parent:this,ref:function(t){return e.addRef(t)},language:"python"}))}}]),t}(r.a.Component),na=pt.a.TabPane,ra=function(e){function t(e){var a;Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).pushRef=function(e){a.myRefs.push(e)},a.getCurrentEditor=function(){var e=a.state.activeKey,t=null;return a.myRefs.forEach(function(a){a.activeKey===e&&(t=a)}),t},a.onChange=function(e){var t=null;a.state.panes.forEach(function(a){a.key===e&&(t=a)}),t&&!t.title.endsWith(".mlsql")?a.parent.setState({displayEditor:"normal"}):t&&!t.title.endsWith(".nb")?a.parent.setState({displayEditor:"notebook"}):a.parent.setState({displayEditor:"pythoneditor"}),a.setState({activeKey:e})},a.onEdit=function(e,t){a[t](e)},a.addFull=function(e,t){var r=a.state.panes,o="newTab".concat(a.newTabIndex++);r.push({title:e||"MLSQL "+a.newTabIndex,content:function(r){return e.endsWith(".mlsql")?n.createElement(ot,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:r}),t&&t({ref:e,activeKey:r})},activeKey:r}):e.endsWith(".nb")?n.createElement(Qt,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:r}),t&&t({ref:e,activeKey:r})},activeKey:r}):e.endsWith(".py")?n.createElement(aa,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:r}),t&&t({ref:e,activeKey:r})},activeKey:r}):void 0}(o),key:o}),a.setState({panes:r,activeKey:o})},a.add=function(){a.addFull("MLSQL "+(a.newTabIndex+1),function(e){})},a.getPaneIndexByActiveKey=function(e){var t;return a.state.panes.forEach(function(a,n){a.key===e&&(t=n-1)}),t},a.remove=function(e){var t=a.state.activeKey,n=a.getPaneIndexByActiveKey(e),r=a.state.panes.filter(function(t){return t.key!==e});r.length&&t===e&&(t=n>=0?r[n].key:r[0].key);var o=a.myRefs.filter(function(t){return t.activeKey===e});a.myRefs=a.myRefs.filter(function(t){return t.activeKey!==e}),a.parent.closeEditor(o[0]),a.setState({panes:r,activeKey:t})},a.parent=e.parent,a.myRefs=[],a.newTabIndex=0;var r=[{title:"MLSQL 1",content:n.createElement(ot,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:"newTab0"})},activeKey:"newTab0"}),key:"newTab0"}];return a.state={activeKey:r[0].key,panes:r},a.newTabIndex++,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement(pt.a,{onChange:this.onChange,activeKey:this.state.activeKey,type:"editable-card",onEdit:this.onEdit},this.state.panes.map(function(e){return n.createElement(na,{tab:e.title,key:e.key,closable:e.closable},e.content)}))}}]),t}(n.Component),oa=a(184),ca=a(99),ia=X.a.Group,sa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).etPopLoad=e.parent,a.state={},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement("span",null,"parameters:"),n.createElement(ia,{compact:!0},this.state.dataForRender))}}]),t}(n.Component),la=a(104),ua=function e(){Object(f.a)(this,e)};ua.getTempTableName=function(){return(la()+"").replace(/-/g,"")},ua.getJobName=function(){return la()+""},ua.escapeQuote=function(e){return e?e.replace(/[\""]/g,'\\"'):e},ua.unQuote=function(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,e.length-1):e.startsWith("'")&&e.endsWith("'")?e.slice(1,e.length-1):e.startsWith("'''")&&e.endsWith("'''")?e.slice(3,e.length-3):e},ua.visitDown=function(e,t){t(e),e.children&&e.children.map(function(e){ua.visitDown(e,t)})},ua.visitUp=function(e,t){e.children&&e.children.map(function(e){ua.visitUp(e,t)}),t(e)},ua.robotFetchParam=function(){return{queryType:"robot",fetchType:"take",includeSchema:!0}},ua.robotFetchParamWithCollect=function(){return{queryType:"robot",includeSchema:!0}},ua.getField=function(e){return e.startsWith("`")&&e.endsWith("`")?e:"`".concat(e,"`")},ua.distinct=function(e,t){var a={};return e.filter(function(e){return!(e[t]in a)&&(a[e[t]]=e[t],!0)})},ua.fastCompareObject=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},ua.deepCompareObject=function(e,t){var a,n;return function e(t,r){var o;if(isNaN(t)&&isNaN(r)&&"number"===typeof t&&"number"===typeof r)return!0;if(t===r)return!0;if("function"===typeof t&&"function"===typeof r||t instanceof Date&&r instanceof Date||t instanceof RegExp&&r instanceof RegExp||t instanceof String&&r instanceof String||t instanceof Number&&r instanceof Number)return t.toString()===r.toString();if(!(t instanceof Object&&r instanceof Object))return!1;if(t.isPrototypeOf(r)||r.isPrototypeOf(t))return!1;if(t.constructor!==r.constructor)return!1;if(t.prototype!==r.prototype)return!1;if(a.indexOf(t)>-1||n.indexOf(r)>-1)return!1;for(o in r){if(r.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof r[o]!==typeof t[o])return!1}for(o in t){if(r.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof r[o]!==typeof t[o])return!1;switch(typeof t[o]){case"object":case"function":if(a.push(t),n.push(r),!e(t[o],r[o]))return!1;a.pop(),n.pop();break;default:if(t[o]!==r[o])return!1}}return!0}(e,t)};var pa,da,ma=X.a.Group,fa=Be.a.Option,ha=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).componentDidMount=Object(u.a)(l.a.mark(function e(){var t,r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object(ke.a)(Object(ke.a)(a)),t=new b.ActionProxy,e.next=4,t.runScript("load _mlsql_.`datasources` as output;",ua.getJobName(),ua.robotFetchParamWithCollect());case 4:r=e.sent,o=ua.distinct(r.content.data,"name"),c=[],o.forEach(function(e){c.push(n.createElement(fa,{key:e.name,value:e.name},e.name))}),a.setState({datasourcesRender:c});case 9:case"end":return e.stop()}},e)})),a.params=function(e){a.data.params[e.target.getAttribute("name")]=e.target.value},a.sourceType=function(e,t){a.data.sourceTypeV=e;var r=Object(ke.a)(Object(ke.a)(a));new qe(Ie).runScript({},"load _mlsql_.`datasources/params/".concat(e,"` as output;"),function(e){var t=[];e.forEach(function(e){t.push(n.createElement(oa.a,{key:"row-".concat(e.param)},n.createElement(ca.a,null,n.createElement(X.a,{key:"input-".concat(e.param),style:{marginBottom:"10px"},name:e.param,onChange:r.params,type:"text",addonBefore:e.param,placeholder:e.description}))))}),r.loadParamsRef.current.setState({dataForRender:t})},function(e){})},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.makeMLSQL=function(){var e=Object(ke.a)(Object(ke.a)(a)),t=[];for(var n in a.data.params){var r=a.data.params[n];if(r){var o='"'+r+'"';"code"!==n&&"fitParam.[group].code"!==n||(o="'''"+r+"'''"),t.push(n.replace(/\[group\]/g,"0")+"="+o)}}var c="";return t.length>0&&(c="where"),"load ".concat(e.data.sourceTypeV,".`").concat(e.data.pathV,"` ").concat(c," ").concat(t.join("and\\n ")," as ").concat(e.data.tableNameV,";")},a.etpop=e.parent,a.data={params:{}},a.state={datasourcesRender:[]},a.loadParamsRef=n.createRef(),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement(ma,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,"soureType:",n.createElement(Be.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.datasourcesRender)))),n.createElement("br",null),this.props.ignorePath?n.createElement("div",null):n.createElement(ma,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{onChange:this.path,type:"text",label:"Path",addonBefore:"Path",placeholder:"File path or tableName"})))),n.createElement("br",null),this.props.ignoreTableName?n.createElement("div",null):n.createElement(ma,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"tableName"})))),n.createElement("br",null),n.createElement(sa,{parent:this,ref:this.loadParamsRef}))}}]),t}(n.Component),ba=X.a.Group,ga=(Be.a.Option,X.a.TextArea),va=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).renderParam=function(e){return"keepVersion"===e.param&&"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(oa.a,null,n.createElement(ca.a,null,e.param,":",n.createElement(ga,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",rows:10}))):n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",addonBefore:e.param,placeholder:e.description})))},a.params=function(e){a.data.params[e.target.getAttribute("name")]=e.target.value},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.makeMLSQL=function(){Object(ke.a)(Object(ke.a)(a));var e=[];for(var t in a.data.params){var n=a.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+n+'"')}return 0==e.length&&e.push('keepVersion="true"'),"train ".concat(a.data.tableNameV," as ").concat(a.name,".`").concat(a.data.pathV,"` where \n").concat(e.join(" and\n "),";")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[]},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this;new qe(Ie).runScript({},"load modelParams.`".concat(t.name,"` as output;"),function(a){var r=[];a.forEach(function(t){var a=e.renderParam(t);null!==a&&(r.push(a),r.push(n.createElement("br",null)))}),t.setState({dataForRender:r})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement("span",null,"Training data and model path:"),n.createElement(ba,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:"tableName",placeholder:"the table of training data"})))),n.createElement("br",null),n.createElement(ba,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{onChange:this.path,type:"text",size:"large",addonBefore:"Model save path",placeholder:"the location you save you model"})))),n.createElement("br",null),n.createElement("span",null,"Algorithm parameters:"),n.createElement(ba,{compact:!0},this.state.dataForRender))}}]),t}(n.Component),ya=X.a.Group,Ea=Be.a.Option,Oa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).sourceType=function(e,t){a.data.sourceTypeV=e},a.saveMode=function(e,t){a.data.saveModeV=e},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.partitionBy=function(e){a.data.partitionByV=e.target.value},a.fileNum=function(e){a.data.fileNumV=e.target.value},a.makeMLSQL=function(){var e=Object(ke.a)(Object(ke.a)(a)),t="";a.data.partitionByV&&(t="partitionBy "+a.data.partitionByV);var n='key="value"';return a.data.fileNumV&&(n='fileNum="'.concat(a.data.fileNumV,'"')),"save ".concat(e.data.saveModeV," ").concat(e.data.tableNameV," as ").concat(e.data.sourceTypeV,".`").concat(e.data.pathV,"` \n where ").concat(n," ").concat(t,";")},a.etpop=e.parent,a.data={},a.state={datasourcesRender:[]},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new qe(Ie).runScript({},"load _mlsql_.`datasources` as output;",function(t){var a=[];t.forEach(function(e){a.push(n.createElement(Ea,{key:e.name,value:e.name},e.name))}),e.setState({datasourcesRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(ya,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,"soureType:",n.createElement(Be.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.datasourcesRender)))),n.createElement("br",null),n.createElement(ya,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,"SaveMode:",n.createElement(Be.a,{onChange:this.saveMode,showSearch:!0,style:{width:200},placeholder:"Choose save mode type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(Ea,{key:"overwrite",value:"overwrite"},"overwrite"),n.createElement(Ea,{key:"append",value:"append"},"append"),n.createElement(Ea,{key:"errorIfExists",value:"errorIfExists"},"errorIfExists"),n.createElement(Ea,{key:"ignore",value:"ignore"},"ignore"))))),n.createElement("br",null),n.createElement(ya,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"the tableName will be saved"})))),n.createElement("br",null),n.createElement(ya,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{onChange:this.path,type:"text",addonBefore:"Target Path",placeholder:"File path or tableName"})))),n.createElement("br",null),n.createElement(ya,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{type:"text",onChange:this.partitionBy,addonBefore:"partitionBy",placeholder:"partitionBy"})))),n.createElement("br",null),n.createElement(ya,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{type:"text",onChange:this.fileNum,addonBefore:"fileNum",placeholder:"fileNum"})))),n.createElement("br",null))}}]),t}(n.Component),ka=a(150),ja=X.a.Group,wa=(Be.a.Option,X.a.TextArea),Sa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).renderParam=function(e){return"keepVersion"===e.param||"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(oa.a,null,n.createElement(ca.a,null,e.param,":",n.createElement(wa,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",rows:10}))):n.createElement(oa.a,{key:e.param},n.createElement(ca.a,null,n.createElement(X.a,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",addonBefore:e.param,placeholder:e.description})))},a.params=function(e){a.data.params[e.target.getAttribute("name")]=e.target.value},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.outputTableName=function(e){a.data.outputTableNameV=e.target.value},a.showTableName=function(){return"true"!==a.state.tableHidden?n.createElement(ja,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{type:"text",onChange:a.tableName,size:"large",addonBefore:a.state.tableAlias?a.state.tableAlias:"Input table",placeholder:""})))):null},a.showOutputTableName=function(){return"true"!==a.state.outputTableHidden?n.createElement(ja,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{type:"text",onChange:a.outputTableName,size:"large",addonBefore:a.state.outputTableAlias?a.state.outputTableAlias:"Output table",placeholder:""})))):null},a.pathNameForRender=function(){return a.state.pathAlias?a.state.pathAlias:"Save path"},a.showPathName=function(){return"true"!==a.state.pathHidden?n.createElement(ja,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{onChange:a.path,type:"text",size:"large",addonBefore:a.pathNameForRender(),placeholder:""})))):""},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden,outputTableHidden:e.outputTableHidden,outputTableAlias:e.outputTableAlias,tableAlias:e.tableAlias},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this;new qe(Ie).runScript({},"load modelParams.`".concat(t.name,"` as output;"),function(a){var r=[];a.forEach(function(t){var a=e.renderParam(t);null!==a&&(r.push(a),r.push(n.createElement("br",null)))}),t.setState({dataForRender:r})},function(e){})}},{key:"_makeMLSQL",value:function(){var e=[];for(var t in this.data.params){var a=this.data.params[t],n='"'+a+'"';"code"!==t&&"fitParam.[group].code"!==t||(n="'''"+a+"'''"),e.push(t.replace(/\[group\]/g,"0")+"="+n)}var r="";e.length>0&&(r="where");var o="";return this.data.outputTableNameV&&(o="as ".concat(this.data.outputTableNameV)),"run ".concat(this.data.tableNameV||"command"," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(r," ").concat(e.join("and\n ")," ").concat(o,";")}},{key:"_render",value:function(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(ja,{compact:!0},this.state.dataForRender))}}]),t}(n.Component),xa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).makeMLSQL=function(){return Object(ka.a)(Object(Ee.a)(t.prototype),"_makeMLSQL",Object(ke.a)(a)).call(Object(ke.a)(a))},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return Object(ka.a)(Object(Ee.a)(t.prototype),"_render",this).call(this)}}]),t}(Sa),Ca=X.a.Group,Ta=(Be.a.Option,function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).makeMLSQL=function(){Object(ke.a)(Object(ke.a)(a));var e=[];for(var t in a.data.params){var n=a.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+n+'"')}return 0==e.length&&e.push('keepVersion="true"'),"run command as ".concat(a.name,".`` where \n").concat(e.join(" and\n "),";")},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement(Ca,{compact:!0},this.state.dataForRender))}}]),t}(xa)),Na=(a(1030),a(1031),a(1032),a(515)),Ra=a.n(Na),Da=Be.a.Option,Aa=X.a.TextArea,Ia=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).udfName=function(e){a.data.udfNameV=e.target.value},a.dataType=function(e){a.data.dataTypeV=e.target.value},a.udfType=function(e){a.udfTypeV=e},a.code=function(e){a.codeV=e},a.langSelect=function(e){a.lang=e,a.codeCheckRef.current.checked=!1,a.setState({dataType:!1}),"python"===a.lang&&a.setState({dataType:!0}),a.setState({codeLang:e})},a.setCodeExample=function(e){e?a.codeRef.current.editor.setValue(a.codeExample()):a.codeRef.current.editor.setValue("")},a.codeExample=function(){var e=a.state.codeLang||"scala";return"scala"===e?"def apply(a:Double,b:Double)={\n   a + b\n}":"python"===e?"def apply(self,m):\n    return m":"java"===e?"import java.util.HashMap;\nimport java.util.Map;\npublic class UDF {\n  public Map<String, Integer[]> apply(String s) {\n    Map<String, Integer[]> m = new HashMap<>();\n    Integer[] arr = {1};\n    m.put(s, arr);\n    return m;\n  }\n}":null},a.showDataType=function(){return a.state.dataType?n.createElement(oa.a,null,n.createElement(ca.a,null,"dataType:",n.createElement(Aa,{style:{marginBottom:"10px"},name:"dataType",rows:10,onChange:a.dataType,type:"text",addonBefore:"dataType",placeholder:"This is not required when lang is scala\nAs we know python is not strongly typed language, so\nwe should manually spcify the return type.\nmap(string,string) means a map with key is string type,value also is string type.\narray(string) means a array with string type element.\nnested is support e.g. array(array(map(string,array(string))))\n\n"}))):null},a.showCode=function(){return n.createElement("div",null,n.createElement(oa.a,null,n.createElement(ca.a,null,"code:",n.createElement(we.a,{ref:a.codeRef,mode:a.state.codeLang||"scala",theme:"github",width:"400px",height:"300px",name:"code",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,onChange:a.code,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}}))),n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(ca.a,{span:8},"Show CodeExample:",n.createElement(Ra.a,{ref:a.codeCheckRef,onChange:a.setCodeExample})))))},a.makeMLSQL=function(){Object(ke.a)(Object(ke.a)(a));var e=[];return e.push('lang="'.concat(a.lang,'"')),e.push("code='''".concat(a.codeV,"'''")),e.push('udfType="'.concat(a.udfTypeV,'"')),a.dataTypeV&&e.push("dataType='''".concat(a.dataTypeV,"'''")),"register ScriptUDF.`` as ".concat(a.data.udfNameV," where \n").concat(e.join("\nand "),";")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[]},a.codeRef=n.createRef(),a.codeCheckRef=n.createRef(),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{onChange:this.udfName,type:"text",size:"large",addonBefore:"UDF Name",placeholder:"the name of udf"}))),n.createElement("br",null),n.createElement(oa.a,null,n.createElement(ca.a,{span:4},n.createElement("span",null,"udfType:")),n.createElement(ca.a,{span:20},n.createElement(Be.a,{showSearch:!0,onChange:this.udfType,style:{width:200},placeholder:"Select udf type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(Da,{value:"udf"},"udf"),n.createElement(Da,{value:"udaf"},"udaf")))),n.createElement("br",null),n.createElement(oa.a,null,n.createElement(ca.a,{span:4},n.createElement("span",null,"Lang:")),n.createElement(ca.a,{span:20},n.createElement(Be.a,{showSearch:!0,style:{width:200},placeholder:"Select language type",optionFilterProp:"children",onChange:this.langSelect,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(Da,{value:"java"},"java"),n.createElement(Da,{value:"scala"},"scala"),n.createElement(Da,{value:"python"},"python")))),n.createElement("br",null),this.showDataType(),n.createElement("br",null),this.showCode(),n.createElement("br",null),n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{style:{marginBottom:"10px"},name:"methodName",onChange:this.params,type:"text",addonBefore:"methodName",placeholder:"methodName"}))))}}]),t}(n.Component),Fa=(X.a.Group,Be.a.Option),Pa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).etName=function(e){a.etName=e},a.makeMLSQL=function(){return"load modelExample.`".concat(a.etName,"` as output;")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new qe(Ie).runScript({},"load model.`list` as output;",function(t){var a=[];t.forEach(function(e){a.push(n.createElement(Fa,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(oa.a,null,n.createElement(ca.a,null,"ET:",n.createElement(Be.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.dataForRender))))}}]),t}(n.Component),La=(X.a.Group,Be.a.Option),_a=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).makeMLSQL=function(){var e=Object(ke.a)(Object(ke.a)(a));return"register ".concat(e.data.sourceTypeV,".`").concat(e.data.pathV,"` as ").concat(e.data.outputTableNameV,";")},a.etName=function(e){a.data.sourceTypeV=e},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new qe(Ie).runScript({},"load model.`list` as output;",function(t){var a=[];t.forEach(function(e){a.push(n.createElement(La,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(oa.a,null,n.createElement(ca.a,null,"ET:",n.createElement(Be.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.dataForRender))))}}]),t}(xa),Ma=X.a.Group,qa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).makeMLSQL=function(){var e="";a.data.outputTableNameV&&(e="as ".concat(a.data.outputTableNameV));var n=Object(ka.a)(Object(Ee.a)(t.prototype),"_makeMLSQL",Object(ke.a)(a)).call(Object(ke.a)(a)).replace(e,""),r="predict ".concat(a.data.tableNameV," as ").concat(a.name,".`").concat(a.data.pathV||"","` ").concat(e,";");return"".concat(n,"\n        ").concat(r,"\n        register ").concat(a.name,".`").concat(a.data.pathV||"","` as ").concat(a.data.functionNameV,"; \n        ").stripMargin()},a.functionName=function(e){a.data.functionNameV=e.target.value},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(Ma,{compact:!0},n.createElement(oa.a,null,n.createElement(ca.a,null,n.createElement(X.a,{onChange:this.functionName,type:"text",size:"large",addonBefore:"functionName",placeholder:"A function you can use to convert String to number or number to String"})))),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(Ma,{compact:!0},this.state.dataForRender))}}]),t}(Sa),Va=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).makeMLSQL=function(){var e="/api_v1/public/file/download?fileName=".concat(encodeURIComponent(a.data.pathV)),t=document.createElement("a");return t.href=e,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),""},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(ka.a)(Object(Ee.a)(t.prototype),"_render",this).call(this)}}]),t}(Sa),Ga=(X.a.Group,Be.a.Option),Ba=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).etName=function(e){a.etName=e},a.makeMLSQL=function(){return"load _mlsql_.`progress/".concat(a.etName,"` as output;")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new qe(Ie).runScript({},"load _mlsql_.`jobs` as output;",function(t){var a=t.filter(function(e){return"stream"===e.jobType}).map(function(e){return n.createElement(Ga,{key:e.jobName,value:e.jobName},e.jobName)});e.setState({dataForRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(oa.a,null,n.createElement(ca.a,null,"Stream Jobs:",n.createElement(Be.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose Stream Name",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.dataForRender))))}}]),t}(n.Component),Ua=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).disableEtModalVisible=function(){a.et.setState({etPop:!1,etModalVisible:!1})},a.enableEtModalVisible=function(){var e=a.popChild.current.makeMLSQL();a.et.makeMLSQL(e),a.et.setState({etPop:!1,etModalVisible:!1})},a.renderContent=function(){return"load"===a.et.state.eventName?n.createElement(ha,{parent:Object(ke.a)(Object(ke.a)(a)),ref:a.popChild}):"save"===a.et.state.eventName?n.createElement(Oa,{name:a.et.state.eventName,ref:a.popChild}):"DownloadExt"===a.et.state.eventName?n.createElement(Ta,{name:a.et.state.eventName,ref:a.popChild}):"StringIndex"===a.et.state.eventName?n.createElement(qa,{name:a.et.state.eventName,ref:a.popChild}):"DownloadFile"===a.et.state.eventName?n.createElement(Va,Object.assign({name:a.et.state.eventName,ref:a.popChild},a.et.state)):"ETExample"===a.et.state.eventName?n.createElement(Pa,{name:a.et.state.eventName,ref:a.popChild}):"ETStreamProgress"===a.et.state.eventName?n.createElement(Ba,{name:a.et.state.eventName,ref:a.popChild}):"ScriptUDF"===a.et.state.eventName?n.createElement(Ia,{name:a.et.state.eventName,ref:a.popChild}):"register"===a.et.state.eventName?n.createElement(_a,Object.assign({name:a.et.state.eventName,ref:a.popChild},a.et.state)):"tool"===a.et.state.processType?n.createElement(xa,Object.assign({name:a.et.state.eventName,ref:a.popChild},a.et.state)):n.createElement(va,{name:a.et.state.eventName,ref:a.popChild})},a.et=e.parent,a.popChild=n.createRef(),a.state={etModalVisible:!0,title:e.title},a.data={},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement(J.a,{title:this.state.title,visible:this.state.etModalVisible,onCancel:this.disableEtModalVisible,onOk:this.enableEtModalVisible,okText:"Ok",cancelText:"Cancel"},this.renderContent()))}}]),t}(n.Component),Ja=a(50),Ka=a.n(Ja),Ha=ut.a.Panel,Wa=(pt.a.TabPane,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).setData=function(e,t){a.itemData[e]=t},a.getData=function(e){return a.itemData[e]},a.onDragStart=function(e){var t=e.target.getAttribute("processtype");a.setData("eventName",e.target.getAttribute("name")),a.setData("popName",e.target.getAttribute("help")),a.setData("processType",t),a.setData("pathAlias",e.target.getAttribute("pathalias")||""),a.setData("outputTableAlias",e.target.getAttribute("outputtablealias")||""),a.setData("tableAlias",e.target.getAttribute("tablealias")||""),a.setData("tableHidden",e.target.getAttribute("tablehidden")||!1),a.setData("pathHidden",e.target.getAttribute("pathhidden")||!1),a.setData("outputTableHidden",e.target.getAttribute("outputtablehidden")||!1)},a.makeMLSQL=function(e){a.queryApp.getCurrentEditor().ref.appendToEditor(e)},a.renderPop=function(){return a.state.etPop?n.createElement(Ua,{parent:Object(ke.a)(Object(ke.a)(a)),title:a.state.popName}):null},a.etDoubleClick=function(e){a.onDragStart(e),a.queryApp.getCurrentEditor().ref.etOver(e)},a.queryApp=e.parent,a.state={},a.itemData={},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(ut.a,{style:{margin:"0px 0px",padding:"0px 0px"}},n.createElement(Ha,{header:"Quick Menu",key:"1"},n.createElement(oa.a,{gutter:16},n.createElement(ca.a,{span:8},n.createElement(Q.a,{title:"Load/Save Data"},n.createElement(Ka.a,{tyle:{marginBottom:"10px"},title:"Load/Save Data",onDragStart:this.onDragStart,name:"load",help:"Load file/db as table",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Load data"),n.createElement(Ka.a,{tyle:{marginBottom:"10px"},title:"Save Data",onDragStart:this.onDragStart,name:"save",help:"Save table into file/db ",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Save data"))),n.createElement(ca.a,{span:8},n.createElement(Q.a,{title:"Algorithms"},n.createElement(Ka.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"TfIdfInPlace",help:"Use TfIdfInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"TfIdf"),n.createElement(Ka.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Word2VecInPlace",help:"Use Word2VecInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Word2vec"),n.createElement(Ka.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RandomForest",help:"Use RandomForest to train a model",draggable:!0,color:"magenta"},"RandomForest"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonAlg",help:"Run python lib to train",draggable:!0,color:"magenta"},"Python Algorithm"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"BigDLClassifyExt",help:"Use BigDL to develop deep learning algorithm",draggable:!0,color:"magenta"},"Deep Learning"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"NaiveBayes",help:"Use NaiveBayes",draggable:!0,color:"magenta"},"NaiveBayes"))),n.createElement(ca.a,{span:8},n.createElement(Q.a,{title:"Python"},n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonEnvExt",processtype:"tool",help:"Create Python Env",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Create Python Env"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonParallelExt",processtype:"tool",help:"Run python project",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Run python project")))),n.createElement("br",null),n.createElement(oa.a,{gutter:16},n.createElement(ca.a,{span:8},n.createElement(Q.a,{title:"Register model as Function"},n.createElement(Ka.a,{onDragStart:this.onDragStart,name:"ScriptUDF",processtype:"tool",onDoubleClick:this.etDoubleClick,help:"Use ScriptUDF create udf",draggable:!0,color:"magenta"},"Create UDF"),n.createElement(Ka.a,{onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"register",help:"Register model to function ",pathalias:"Model saved path",outputtablealias:"Function name",tablealias:"Function name",tablehidden:"true",pathhidden:"false",outputtablehidden:"false",draggable:!0,color:"magenta"},"Register Model As Function"))),n.createElement(ca.a,{span:8},n.createElement(Q.a,{title:"Jobs"},n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"JobList",onDoubleClick:this.etDoubleClick,processtype:"direct",draggable:!0,color:"magenta"},"Show jobs"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Kill",onDoubleClick:this.etDoubleClick,processtype:"tool",pathalias:"groupId or jobName",tablehidden:"true",help:"Kill your job",draggable:!0,color:"magenta"},"Kill job"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETStreamProgress",processtype:"",help:"Show Progress of Stream",draggable:!0,color:"magenta"},"Show Stream Job Progress"))),n.createElement(ca.a,{span:8},n.createElement(Q.a,{title:"Tools"},n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadExt",processtype:"tool",help:"Use DownloadExt to download files you have uploaded",draggable:!0,color:"magenta"},"Download uploaded file"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ImageLoaderExt",processtype:"tool",help:"Use ImageLoaderExt to load images",pathalias:"",tablehidden:"true",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Load images"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ConnectMySQL",processtype:"direct",help:"",draggable:!0,color:"magenta"},"Connect MySQL"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"JDBC",processtype:"tool",pathalias:"DB name in connect",tablehidden:"false",help:"Run DLL on MySQL",draggable:!0,color:"magenta"},"MySQL DDL"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"TreeBuildExt",processtype:"tool",pathalias:"",tablehidden:"false",pathhidden:"true",help:"Build tree from parent-child",draggable:!0,color:"magenta"},"Parent-Child"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETExample",processtype:"",help:"Show Example of ET",draggable:!0,color:"magenta"},"Show ET Example"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RepartitionExt",processtype:"tool",help:"Change Table Partition Num",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Repartition table"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"SendMessage",processtype:"tool",help:"Send email",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Send Mail"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"CacheExt",processtype:"tool",help:"Cache table",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Cache Table"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"StringIndex",processtype:"tool",help:"Convert String to number",pathalias:"Mapping path",tablehidden:"false",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Convert String to number"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadFile",processtype:"tool",help:"Download File",pathalias:"Target file",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Download File to computer"),n.createElement(Ka.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ShowResource",processtype:"direct",draggable:!0,color:"magenta"},"Cluster Resource")))))),this.renderPop())}}]),t}(n.Component)),za=a(1129),Qa=a(253),Ya=a(474),Xa=za.a.TreeNode,$a=za.a.DirectoryTree,Za=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).state={dbs:{},loading:!1},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,We.tablesInDeltaLake();case 3:200===(t=e.sent).status&&(a={},t.content.forEach(function(e){a[e.database]?a[e.database].push(e.table):a[e.database]=[e.table]}),this.setState({dbs:a})),this.setState({loading:!1});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"show",value:function(){return Object.entries(this.state.dbs).map(function(e){var t=Object(p.a)(e,2),a=t[0],r=t[1];return n.createElement(Xa,{title:a,key:a},r.map(function(e){return n.createElement(Xa,{icon:n.createElement(Ya.a,null),title:e,key:"".concat(a,".").concat(e),isLeaf:!0})}))})}},{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return n.createElement(Qa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement($a,null,this.show()))}}]),t}(n.Component),en=za.a.TreeNode,tn=za.a.DirectoryTree,an=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).getFileList=function(){var e=Object(u.a)(l.a.mark(function e(t){var n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.ls(t);case 2:if(200!==(n=e.sent).status||n.content[0]._corrupt_record){e.next=6;break}return r=n.content.map(function(e){return e.is_dir=a.isDir(e),e.key=e.path,e.title=e.path.split("/").slice(-1)[0],e.isLeaf=!e.is_dir,e}),e.abrupt("return",r);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.isDir=function(e){return e.permission.startsWith("d")},a.onLoadData=function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getFileList(t.props.dataRef.path);case 2:t.props.dataRef.children=e.sent,a.setState({root:Object(Ot.a)(a.state.root)});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.renderTreeNodes=function(e){return e.map(function(e){return e.children?n.createElement(en,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e},a.renderTreeNodes(e.children)):n.createElement(en,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e})})},a.state={root:[],loading:!1},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,this.getFileList("/");case 3:t=e.sent,this.setState({loading:!1,root:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return n.createElement("div",null,n.createElement(Qa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(tn,{loadData:this.onLoadData},this.renderTreeNodes(this.state.root))))}}]),t}(n.Component),nn=(a(448),a(471)),rn=a(469),on=a(467),cn=a(468),sn=a(76),ln={setState:sn.SetStateActionHandler},un={setState:sn.SetStateAction},pn=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c,i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new b.ActionProxy,n=t.data,r=n.node,o=n.consoleApp,r.isDir){e.next=10;break}return e.next=5,a.get(g.default.SCRIPT_FILE_GET,{id:r.id});case 5:if(200===(c=e.sent).status){e.next=8;break}return e.abrupt("return",{data:{error:"Fail to get file ".concat(r.label,". Reason: ").concat(c.content)}});case 8:i=c.content,o.openExistsOrNewEditor({id:r.id,content:i.content,name:i.name});case 10:return e.abrupt("return",{data:{}});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),dn=pn.handler,mn=pn.action,fn=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c,i,s,u,p,d,m;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new b.ActionProxy,n=t.data,r=n.createType,n.consoleApp,o=n.form,c=n.scriptContent,i=void 0===c?"":c,s=o.getFieldValue(),u=s.fileName){e.next=5;break}return e.abrupt("return",{data:{createFileError:"Please input the file name"}});case 5:p=t.__state.node,d=!1,e.t0=r,e.next="file"===e.t0?10:"folder"===e.t0?14:16;break;case 10:if(d=!1,u.endsWith(".mlsql")||u.endsWith(".nb")||u.endsWith(".py")){e.next=13;break}return e.abrupt("return",{data:{createFileError:"fileName should end with .mlsql or .nb or .py"}});case 13:return e.abrupt("break",16);case 14:return d=!0,e.abrupt("break",16);case 16:return m={fileName:u,isDir:d,content:i,parentId:p.id},e.next=19,a.post(g.default.SAVE_SCRIPT_FILE,m);case 19:return e.sent,e.abrupt("return",{data:Object(k.a)({},t.data,{reloading:ua.getJobName()})});case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),hn=fn.handler,bn=fn.action,gn=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.expandedKeys,n=t.__state.expandedKeys,r=a.filter(function(e){return!n.includes(e)}),o=n.filter(function(e){return!a.includes(e)}),c=new b.ActionProxy,r.forEach(function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.post(g.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!0});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o.forEach(function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.post(g.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!1});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",{data:{expandedKeys:a}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),vn=gn.handler,yn=gn.action,En=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.node,e.next=3,b.ActionProxy.client.post(g.default.SCRIPT_FILE_REMOVE,{id:a.id});case 3:return e.abrupt("return",{data:Object(k.a)({},t.data,{reloading:ua.getTempTableName()})});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),On=En.handler,kn=En.action,jn=function e(){Object(f.a)(this,e)};jn.openScriptFile="openScriptFile",jn.createScriptFile="createScriptFile",jn.deleteScriptFile="deleteScriptFile",jn.expand="expand";var wn=Object(k.a)({},ln,(pa={},Object(m.a)(pa,jn.openScriptFile,dn),Object(m.a)(pa,jn.createScriptFile,hn),Object(m.a)(pa,jn.expand,vn),Object(m.a)(pa,jn.deleteScriptFile,On),pa)),Sn=Object(k.a)({},un,(da={},Object(m.a)(da,jn.openScriptFile,mn),Object(m.a)(da,jn.createScriptFile,bn),Object(m.a)(da,jn.expand,yn),Object(m.a)(da,jn.deleteScriptFile,kn),da));function xn(e,t){return Sn[t.type](e,t.data)}var Cn=a(472),Tn=a(470),Nn=(a(1113),function e(){var t=this;Object(f.a)(this,e),this.build=function(e){var t,a,n={},r=[];for(a=0;a<e.length;a+=1)n[e[a].id]=a,e[a].childNodes=[];for(a=0;a<e.length;a+=1)if(0!==(t=e[a]).parentId)try{e[n[t.parentId]].childNodes.push(t)}catch(o){console.log("------------"),console.log(t),console.log(n[t.parentId])}else r.push(t);return r},this.convert=function(e){return e.childNodes&&e.childNodes.length>0&&(e.children=e.childNodes,e.children.map(function(e){return t.convert(e)})),e.id=String(e.id),e.key=e.id,e.title=r.a.createElement("span",null,e.label),e.isLeaf=!e.isDir,e.isDir?e.icon=r.a.createElement(Cn.a,null):e.icon=r.a.createElement(Tn.a,null),e}});function Rn(){var e=Object(se.a)(["\n  width: 100%; \n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 30px 30px;\n"]);return Rn=function(){return e},e}var Dn=le.a.div(Rn());var An=function(){return r.a.createElement(Dn,null,r.a.createElement(Qa.a,{tip:"Loading...."}))},In=function(e){var t=e.contextMenuRef,a=e.dispacher,o=e.onRender,c=Object(n.useState)(void 0),i=Object(p.a)(c,2),s=i[0],l=i[1];return{onRightClick:Object(n.useCallback)(function(e){var a=e.event,n=e.node,r=a.clientX,o=a.clientY,c=function(e){t.current&&(!t.current.contains(e.target)&&l(void 0))};document.addEventListener("click",c);var i=function(){l(void 0)};return document.addEventListener("scroll",i),l({pageX:r,pageY:o,id:n.id}),function(){document.removeEventListener("click",c),document.removeEventListener("scroll",i)}},[l]),ui:Object(n.useCallback)(function(){if(s){var e=Object(k.a)({},s),n=e.pageX,c=e.pageY,i=(e.id,{zIndex:1e4,position:"fixed",left:"".concat(n,"px"),top:"".concat(c,"px"),borderRadius:"3px",boxShadow:"0 0 0 1px rgba(16, 22, 26, 0.1), 0 2px 4px rgba(16, 22, 26, 0.2), 0 8px 24px rgba(16, 22, 26, 0.2)"});return r.a.createElement("div",{ref:t,style:i},o({rightClickNodeTreeItem:s,setRightClickNodeTreeItem:l,dispacher:a}))}},[s])}},Fn=za.a.DirectoryTree,Pn={nodes:[],error:void 0,createFileError:void 0,createType:void 0,createTitle:void 0,operateModal:!1,reloading:void 0,loading:!0,expandedKeys:[]},Ln=r.a.createContext();function _n(e){var t=e.consoleApp,a=Object(d.useReducerAsync)(xn,Pn,wn),o=Object(p.a)(a,2),c=o[0],i=o[1],s=c.loading,m=c.nodes,f=c.error,h=c.createFileError,v=c.createType,y=c.operateModal,E=c.createTitle,O=c.reloading,k=c.expandedKeys,j=new b.ActionProxy,w=Object(n.useRef)(),S=Y.a.useForm(),x=Object(p.a)(S,1)[0];Object(n.useEffect)(function(){(function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.get(g.default.SCRIPT_FILE_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=new Nn,n=a.build(t.content).sort(function(e,t){return e.id-t.id}),r=n.map(function(e){return a.convert(e)}),ua.visitDown(r[0],function(e){e.isExpanded&&k.push(e.id)}),i({type:"setState",data:{nodes:r,loading:!1,expandedKeys:k}});case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[O]);var C=In({contextMenuRef:w,dispacher:i,onRender:function(e){var t=e.rightClickNodeTreeItem,a=e.setRightClickNodeTreeItem,n=e.dispacher,o=t.id,c=void 0;return ua.visitDown(m[0],function(e){e.id===o&&(c=e)}),o===m[0].id?r.a.createElement(I.a,null,r.a.createElement(I.a.Item,{icon:r.a.createElement(nn.a,null),onClick:function(){n({type:"setState",data:{node:c,createType:"folder",createTitle:"Create Project",operateModal:!0}})}},"Create Project")):c.isDir?r.a.createElement(I.a,null,r.a.createElement(I.a.Item,{icon:r.a.createElement(rn.a,null),onClick:function(){n({type:"setState",data:{node:c,createType:"file",createTitle:"Create File",operateModal:!0}}),a(void 0)},key:1},"Create Script"),r.a.createElement(I.a.Item,{icon:r.a.createElement(nn.a,null),onClick:function(){n({type:"setState",data:{node:c,createType:"folder",createTitle:"Create Folder",operateModal:!0}}),a(void 0)},key:2},"Create Folder"),r.a.createElement(I.a.Item,{icon:r.a.createElement(on.a,null),onClick:function(){n({type:jn.deleteScriptFile,data:{node:c}}),a(void 0)},key:3},"Delete")):r.a.createElement(I.a,null,r.a.createElement(I.a.Item,{onClick:function(){n({type:jn.deleteScriptFile,data:{node:c}}),a(void 0)},key:1},"Delete"))}}),T=C.onRightClick,N=C.ui;return r.a.createElement(Ln.Provider,{value:{dispacher:i}},N(),r.a.createElement(it.a,{title:E,visible:y,onCancel:function(){i({type:"setState",data:{operateModal:!1}})},onOk:function(){i({type:jn.createScriptFile,data:{operateModal:!1,consoleApp:t,createType:v,form:x}})},cancelText:"Cancel",OkText:"Ok"},h&&r.a.createElement(de,{message:h}),r.a.createElement(Y.a,{form:x},r.a.createElement(Y.a.Item,{name:"fileName",label:"File Name"},r.a.createElement(X.a,null)))),f&&r.a.createElement(de,{message:f}),s&&r.a.createElement(An,null),!s&&r.a.createElement(Fn,{onExpand:function(e){i({type:jn.expand,data:{expandedKeys:e}})},autoExpandParent:!0,expandedKeys:k,onDoubleClick:function(e,a){i({type:jn.openScriptFile,data:{consoleApp:t,node:a}})},expandAction:"click",onRightClick:T,switcherIcon:r.a.createElement(cn.a,null),treeData:m}))}var Mn=pt.a.TabPane,qn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).queryApp=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement(pt.a,{defaultActiveKey:"1",style:{maxWidth:"350px"},onTabClick:function(t){"2"===t&&e.deltaLakeTreeRef&&e.deltaLakeTreeRef.reload()}},n.createElement(Mn,{tab:"Script",key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(_n,{consoleApp:this.queryApp}))),n.createElement(Mn,{tab:"DeltaLake",key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(Za,{ref:function(t){return e.deltaLakeTreeRef=t}}))),n.createElement(Mn,{tab:"FileSystem",key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(an,{ref:function(t){return e.fileSystemTreeRef=t}}))))}}]),t}(n.Component),Vn=(a(449),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).openExistsOrNewEditor=function(e){var t=Object(ke.a)(Object(ke.a)(a));if(a.fileToEditorMap.hasOwnProperty(e.id)){var n=a.fileToEditorMap[e.id];n.ref.text(e.content,e.id),a.editorGroup.current.onChange(n.activeKey)}else a.editorGroup.current.addFull(e.name,function(a){a.ref.text(e.content,e.id),t.fileToEditorMap[e.id]=a});e.name.endsWith(".nb")?t.setState({displayEditor:"notebook"}):e.name.endsWith(".py")?t.setState({displayEditor:"pythoneditor"}):t.setState({displayEditor:"normal"})},a.closeEditor=function(e){var t=Object.keys(a.fileToEditorMap).filter(function(t){return a.fileToEditorMap[t].activeKey!==e.activeKey}).reduce(function(e,t){return e[t]=a.fileToEditorMap[t],e},{});a.fileToEditorMap=t},a.getCurrentEditor=function(){return a.editorGroup.current.getCurrentEditor()},a.setData=function(e){a.queryResData=e,a.dash.current.refresh()},a.tableAndDash=function(){if("notebook"!==a.state.displayEditor||"pythoneditor"!==a.state.displayEditor)return r.a.createElement("div",null,r.a.createElement(Ue.Resizable,{defaultSize:{height:"300px"},onResize:function(){a.messageBox.current.editor.resize()}},r.a.createElement(we.a,{height:"100%",width:"100%",ref:a.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",null,r.a.createElement(Mt,{ref:a.dash,parent:Object(ke.a)(Object(ke.a)(a))})),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(lt,{ref:a.display,parent:Object(ke.a)(Object(ke.a)(a))})))},a.state={sqlContent:"",displayEditor:"normal"},a.editorGroup=r.a.createRef(),a.messageBox=r.a.createRef(),a.display=r.a.createRef(),a.dash=r.a.createRef(),a.etRef=r.a.createRef(),a.fileToEditorMap={},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"ws-app"},r.a.createElement("div",{className:"ws-left-pane"},r.a.createElement(Ue.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},r.a.createElement(qn,{ref:function(t){return e.leftTreePaneRef=t},parent:this}))),r.a.createElement("div",{className:"ws-right-pane"},r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(Wa,{ref:this.etRef,parent:this})),r.a.createElement(ra,{ref:this.editorGroup,parent:this}),this.tableAndDash()))}}]),t}(n.Component)),Gn=a(1130),Bn=function(){function e(t){Object(f.a)(this,e),this.superclass=t}return Object(j.a)(e,[{key:"with",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.reduce(function(e,t){return t(e)},this.superclass)}}]),e}(),Un=function(e){return new Bn(e)},Jn=function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).toggleNewSession=function(){a.setState({showNewSession:!a.state.showNewSession})},a.showNewSession=function(e){if(e.node.props.table){var t={table:e.node.props.table,db:e.node.props.db};a.setState({showNewSession:!0,currentTable:t})}},a.currentTableName=function(){return a.state.currentTable?a.state.currentTable.db+"."+a.state.currentTable.table:""},a.showTable=function(){var e=Object(u.a)(l.a.mark(function e(t){var n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({showNewSession:!1}),n=a.state.currentTable,r=n.db,o=n.table,Nc.workshop.newSession(t,r,o),a.workshop.newSession(t,r,o);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(Oe.a)(t,e),t}(e)},Kn=(za.a.TreeNode,za.a.DirectoryTree),Hn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).showNewSession=function(e){var t={table:e.node.props.dataRef.path,db:""};a.setState({showNewSession:!0,currentTable:t})},a.showTable=function(){var e=Object(u.a)(l.a.mark(function e(t,n,r){var o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({showNewSession:!1}),o=a.state.currentTable,o.db,c=o.table,a.workshop.newSession(t,n,c,r);case 3:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.render=function(){return n.createElement("div",null,n.createElement(it.a,{title:"Open Table: [".concat(a.currentTableName(),"]?"),visible:a.state.showNewSession,onCancel:a.toggleNewSession,onOk:function(){a.showTable("file",a.loadPopRef.data.sourceTypeV,a.loadPopRef.data.params)},cancelText:"Cancel",OkText:"Ok"},n.createElement(ha,{key:a.currentTableName(),ignorePath:!0,ignoreTableName:!0,ref:function(e){return a.loadPopRef=e},parent:Object(ke.a)(Object(ke.a)(a))})),n.createElement(Qa.a,{tip:"Loading...",spinning:a.state.loading},n.createElement(Kn,{loadData:a.onLoadData,expandAction:"doubleClick",onRightClick:a.showNewSession},a.renderTreeNodes(a.state.root))))},a.workshop=e.parent.workshop,a}return Object(Oe.a)(t,e),t}(Un(an).with(Jn)),Wn=za.a.TreeNode,zn=za.a.DirectoryTree,Qn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).tableClick=function(e){a.setState({rightClickNodeTreeItem:{pageX:e.event.pageX,pageY:e.event.pageY,table:e.node.props.table,db:e.node.props.db}})},a.workshop=e.parent.workshop,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"show",value:function(){return Object.entries(this.state.dbs).map(function(e){var t=Object(p.a)(e,2),a=t[0],r=t[1];return n.createElement(Wn,{title:a,key:a},r.map(function(e){return n.createElement(Wn,{icon:n.createElement(Ya.a,null),title:e,table:e,db:a,key:"".concat(a,".").concat(e),isLeaf:!0})}))})}},{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement(it.a,{title:"Open Table",visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:function(){e.showTable("delta")},cancelText:"Cancel",OkText:"Ok"},"Open  ".concat(this.currentTableName(),"]?")),n.createElement(Qa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(zn,{onRightClick:this.showNewSession},this.show())))}}]),t}(Un(Za).with(Jn)),Yn=za.a.TreeNode,Xn=za.a.DirectoryTree,$n=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).state={dbs:{},loading:!1},a.workshop=e.parent.workshop,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,We.tablesInWorkshop();case 3:200===(t=e.sent).status&&(a={},t.content.forEach(function(e){a[e.sessionId]?a[e.sessionId].push(e.tableName):a[e.sessionId]=[e.tableName]}),this.setState({dbs:a})),this.setState({loading:!1});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"show",value:function(){return Object.entries(this.state.dbs).flatMap(function(e){var t=Object(p.a)(e,2),a=t[0];return t[1].map(function(e){return n.createElement(Yn,{icon:n.createElement(Ya.a,null),table:e,db:a,title:e,key:e,isLeaf:!0})})})}},{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement(it.a,{title:"Open Table",visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:function(){e.showTable("temp")},cancelText:"Cancel",OkText:"Ok"},"Open  ".concat(this.currentTableName(),"]?")),n.createElement(Qa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Xn,{onRightClick:this.showNewSession},this.show())))}}]),t}(Un(n.Component).with(Jn)),Zn=pt.a.TabPane,er=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).workshop=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement(pt.a,{defaultActiveKey:"1",onTabClick:function(t){"2"===t&&e.deltaLakeTreeRef&&e.deltaLakeTreeRef.reload()}},n.createElement(Zn,{tab:"Table Workshop",key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement($n,{ref:function(t){return e.workshopTableTreeRef=t},parent:this}))),n.createElement(Zn,{tab:"DeltaLake",key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(Qn,{ref:function(t){return e.deltaLakeTreeRef=t},parent:this}))),n.createElement(Zn,{tab:"FileSystem",key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Hn,{ref:function(t){return e.fileSystemTreeRef=t},parent:this}))))}}]),t}(n.Component),tr=(a(104),a(1047),a(1120)),ar=a(1116),nr=(a(1048),I.a.SubMenu,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).enter=function(){a.setState({applyLoading:!0}),a.workshop.setState({tableLoading:!0})},a.exit=function(){a.setState({applyLoading:!1}),a.workshop.setState({tableLoading:!1})},a.showSaveDiagram=function(){a.toggle()},a.toggle=function(){a.setState({saveDiagram:!a.state.saveDiagram})},a.handleTableInput=function(){},a.handlePersit=function(){},a.props=e,a.state={applyLoading:!1,saveDiagram:!1},a.workshop=e.parent.workshop,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{style:this.props.style,className:this.props.className||"aos-box"},n.createElement(it.a,{title:"View",visible:this.state.saveDiagram,onCancel:this.toggle,onOk:this.props.onSave,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(Y.a,{className:"login-form"},n.createElement(Y.a.Item,null,n.createElement(X.a,{addonBefore:"tableName",onChange:this.props.handleTableInput||this.handleTableInput,placeholder:""})),n.createElement(Y.a.Item,{label:"Persist table(take more space):"},n.createElement(ar.a,{onChange:this.props.handlePersit||this.handlePersit})))),n.createElement("div",{className:"aos-button"},n.createElement($.a,{loading:this.state.applyLoading,onClick:this.props.onApply,type:"primary"},"Apply")),n.createElement("div",{className:"aos-button"},n.createElement($.a,{disabled:this.state.applyLoading,onClick:this.toggle,type:"primary"},"Save As")),n.createElement("div",{className:"aos-button"},n.createElement($.a,{disabled:this.state.applyLoading,onClick:this.props.onRollback},"Rollback")))}}]),t}(n.Component)),rr=function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).onSave=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.workshop.save(a.tableNameForSave,a.persistForSave);case 2:200===e.sent&&(a.workshop.refreshOperateStation(),a.workshop.refreshTableWorkshop());case 4:case"end":return e.stop()}},e)})),a.onRollback=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.ApplyOrSaveRef.enter(),e.next=3,a.workshop.rollback();case 3:200===e.sent&&(a.workshop.refreshOperateStation(),a.workshop.refreshTableWorkshop()),a.ApplyOrSaveRef.exit();case 6:case"end":return e.stop()}},e)})),a.handleTableInput=function(e){a.tableNameForSave=e.target.value},a.handlePersit=function(e){a.persistForSave=e},a}return Object(Oe.a)(t,e),t}(e)},or=(a(450),Be.a.Option),cr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).reload=Object(u.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.joinStation.joinInfo.currentTable.schema,e.next=3,We.tableInfo(a.joinTable);case 3:200===(n=e.sent).status&&a.setState({currentTableFields:t.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}},e)})),a.componentDidMount=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.reload();case 2:case"end":return e.stop()}},e)})),a.next=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,e),a.joinStation.next()},a.render=function(){return n.createElement(Y.a,{className:"login-form",onFinish:a.next},n.createElement(Y.a.Item,{name:"leftField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(Be.a,{label:"Current Table",showSearch:!0,style:{width:200},placeholder:a.currentTable,optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},a.state.currentTableFields.map(function(e){return n.createElement(or,{key:e.name,value:e.name},e.name)}))),n.createElement(Y.a.Item,{name:"rightField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(Be.a,{label:"Join Table",showSearch:!0,style:{width:200},placeholder:a.joinTable,optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},a.state.joinTableFields.map(function(e){return n.createElement(or,{key:e.name,value:e.name},e.name)}))),n.createElement(Y.a.Item,null,n.createElement($.a,{type:"primary",htmlType:"submit"},"Next")))},a.workshop=e.parent.workshop,a.joinStation=e.parent,a.currentTable=a.joinStation.joinInfo.currentTable.table,a.joinTable=a.joinStation.joinInfo.joinTable,a.state={currentTableFields:[],joinTableFields:[]},a}return Object(Oe.a)(t,e),t}(n.Component),ir=a(1127),sr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).filterOption=function(e,t){return t.title.indexOf(e)>-1},a.handleChange=function(e){a.setState({targetKeys:e}),a.props.handleChange&&a.props.handleChange({targetKeys:e})},a.getSelectFields=function(){return a.state.targetKeys||[]},a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"wow",value:function(e){return{data:e.schemaFields.map(function(e){return{title:e.name,key:e.name}}),targetKeys:[]}}},{key:"componentDidUpdate",value:function(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(k.a)({},this.wow(this.props)))}},{key:"render",value:function(){return n.createElement(ir.a,{dataSource:this.state.data,showSearch:!0,filterOption:this.filterOption,targetKeys:this.state.targetKeys,onChange:this.handleChange,render:function(e){return e.title}})}}]),t}(n.Component),lr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).reload=Object(u.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.joinStation.joinInfo.currentTable.schema,e.next=3,We.tableInfo(a.joinTable);case 3:200===(n=e.sent).status&&a.setState({currentTableFields:t.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}},e)})),a.componentDidMount=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.reload();case 2:case"end":return e.stop()}},e)})),a.handleLeft=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,{leftProjectFields:e.targetKeys})},a.handleRight=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,{rightProjectFields:e.targetKeys})},a.reset=function(){a.joinStation.parent.reload()},a.render=function(){return n.createElement(Y.a,{labelCol:{span:6}},n.createElement(Y.a.Item,{name:"leftProjectFields",label:"currentTable"},n.createElement(sr,{handleChange:a.handleLeft,schemaFields:a.state.currentTableFields,ref:function(e){return a.leftProjectFields=e},parent:Object(ke.a)(Object(ke.a)(a))})),n.createElement(Y.a.Item,{name:"rightProjectFields",label:a.joinTable+""},n.createElement(sr,{handleChange:a.handleRight,schemaFields:a.state.joinTableFields,ref:function(e){return a.rightProjectFields=e},parent:Object(ke.a)(Object(ke.a)(a))})),n.createElement(Y.a.Item,null,n.createElement(Y.a.Item,null," ",n.createElement($.a,{danger:!0},"Reset"))))},a.workshop=e.parent.workshop,a.joinStation=e.parent,a.currentTable=a.joinStation.joinInfo.currentTable.table,a.joinTable=a.joinStation.joinInfo.joinTable,a.state={currentTableFields:[],joinTableFields:[]},a}return Object(Oe.a)(t,e),t}(n.Component),ur=Be.a.Option,pr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).reload=Object(u.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.tablesInWorkshop();case 2:t=e.sent,n=[],200===t.status&&(n=t.content.map(function(e){return{name:e.tableName,value:e.tableName}})),a.setState({tables:n});case 6:case"end":return e.stop()}},e)})),a.componentDidMount=Object(u.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.reload();case 2:case"end":return e.stop()}},e)})),a.next=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,e),a.joinStation.next()},a.render=function(){return n.createElement(Y.a,{className:"login-form",onFinish:a.next},n.createElement(Y.a.Item,{name:"joinType",rules:[{required:!0,message:"Please select join type!"}]},n.createElement(Be.a,{showSearch:!0,style:{width:200},placeholder:"Select Join Type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(ur,{key:"inner",value:"inner join"},"Inner Join"),n.createElement(ur,{key:"left",value:"left join"},"Left Join"),n.createElement(ur,{key:"right",value:"right join"},"Right Join"),n.createElement(ur,{key:"full",value:"full join"},"Full Join"))),n.createElement(Y.a.Item,{name:"joinTable",rules:[{required:!0,message:"Please select join table!"}]},n.createElement(Be.a,{showSearch:!0,style:{width:200},placeholder:"Choose Join Table",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},a.state.tables.map(function(e){return n.createElement(ur,{key:e.name,value:e.value},e.name)}))),n.createElement(Y.a.Item,null,n.createElement($.a,{type:"primary",htmlType:"submit"},"Next")))},a.workshop=e.parent.workshop,a.joinStation=e.parent,a.state={tables:[]},a}return Object(Oe.a)(t,e),t}(n.Component);function dr(){var e=Object(se.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\ntext-align: center;\npadding-top: 80px;\nwidth: 100%;\n"]);return dr=function(){return e},e}var mr,fr,hr=tr.a.Step,br=le.a.div(dr()),gr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).onApply=Object(u.a)(l.a.mark(function e(){var t,n,r,o,c,i,s,u,p,d,m,f,h,b,g,v,y,E;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.workshop.currentTable.table,n=a.joinInfo,r=n.joinTable,o=n.joinType,c=n.leftField,i=n.rightField,s=n.leftProjectFields,u=n.rightProjectFields,s||u){e.next=5;break}return a.workshop.toggleMessage("Fields are not selected."),e.abrupt("return");case 5:return a.ApplyOrSaveRef.enter(),e.next=8,We.tableInfo(r);case 8:return p=e.sent,d=p.content,m=s&&s.map(function(e){return"".concat(t,".`").concat(e,"`")}).join(","),f=u&&u.map(function(e){return"".concat(r,".`").concat(e,"`")}).join(","),h="".concat(t,".`").concat(c,"`"),b="".concat(r,".`").concat(i,"`"),g="".concat(o," ").concat(r," on ").concat(h," = ").concat(b),v="",m&&f&&(v=m+","+f),m&&!f&&(v=m),!m&&f&&(v=f),y=ua.getTempTableName(),E="".concat(d.content," \n select ").concat(v," from ").concat(t," ").concat(g," as ").concat(y,";"),console.log(E),e.next=24,a.workshop.apply({tableName:y,sql:E});case 24:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 26:case"end":return e.stop()}},e)})),a.next=function(){a.setState({currentStep:a.state.currentStep+1})},a.preview=function(){a.setState({currentStep:a.state.currentStep-1})},a.workshop=e.parent.workshop,a.joinInfo={currentTable:a.workshop.currentTable},a.state={currentStep:0,steps:[n.createElement(pr,{parent:Object(ke.a)(Object(ke.a)(a))}),n.createElement(cr,{parent:Object(ke.a)(Object(ke.a)(a))}),n.createElement(lr,{parent:Object(ke.a)(Object(ke.a)(a))})]},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",{className:"join-app"},n.createElement("div",{className:"station-menu"},n.createElement(nr,{parent:this,onRollback:this.onRollback,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}})),n.createElement("div",null,n.createElement(tr.a,{current:this.state.currentStep},n.createElement(hr,{key:0,title:"Table",description:"Choose the table you wanna join from workshop"}),n.createElement(hr,{key:1,title:"Join Condition ",description:"Choose the join condition in both tables"}),n.createElement(hr,{key:2,title:"Fields",description:"Choose the fields you want from both tables"}))),n.createElement("div",{className:"join-app-form"}," ",n.createElement(br,null,this.state.steps[this.state.currentStep])))}}]),t}(Un(n.Component).with(rr)),vr=a(208),yr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).setRender=function(e,t){var r=t[0][e.key];if(a.config&&a.config.render)Object.keys(a.config).map(function(t){var n=a.config[t][e.key];n&&(e[t]=n)});else{try{if(n.Component.isPrototypeOf(r.type))return void(e.render=function(e){return n.createElement("span",null,e)})}catch(o){}"html"!=e.key?"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=function(e){return n.createElement("pre",null,e.toString())}):e.render=function(e){return n.createElement("span",null,e.toString())}:e.render=function(e){return n.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return n.createElement("span",null,JSON.stringify(e).substring(0,300))}:e.render=function(e){return n.createElement("pre",null,e.substring(0,300))}}},a.update=function(e,t){a.config=t;var n=[],r={},o=[],c=Object(ke.a)(Object(ke.a)(a));e.forEach(function(t){for(var a in t)if(!r[a]){var o={title:a,dataIndex:a,key:a};c.setRender(o,e),n.push(o),r[a]=!0}}),e.forEach(function(e,t){var a={};n.forEach(function(t){a[t.key]=e[t.key]}),a.key=t,o.push(a)}),a.setState({columns:n,data:o})},a.rowDoubleClick=function(e,t,n){"codeExample"!==e.name&&"doc"!==e.name||a.setState({view:{enabled:!0,content:e.value}})},a.disablePreview=function(){a.setState({view:{enabled:!1}})},a.tableStyle=e.style||{},a.state={columns:[],rows:[],view:{enabled:!1}},a.config={},a.workshop=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{style:this.tableStyle},n.createElement(ct.a,{size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement(it.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(vr,{source:this.state.view.content||""})))}}]),t}(n.Component),Er=a(1132),Or=(Be.a.Option,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).show=function(e){a.setState({func:e})},a.funcValue=function(){return n.createElement(Er.b.Item,{key:"Func"},n.createElement(Er.b.Item.Meta,{title:"Func",description:a.state.func.funcValue.extra.zhDoc}))},a.returnValue=function(){return n.createElement(Er.b.Item,{key:"Return value"},n.createElement(Er.b.Item.Meta,{title:"Return value",description:a.state.func.returnValue.extra.zhDoc}))},a.parameters=function(){return a.state.func.params.map(function(e){return n.createElement(Er.b.Item,{key:e.name},n.createElement(Er.b.Item.Meta,{title:e.name,description:e.extra.zhDoc}))})},a.state=Object(k.a)({},e),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return this.state.func?n.createElement(Er.b,{size:"large",header:n.createElement("div",null,"Function [".concat(this.state.func.value,"] Info")),footer:n.createElement("div",null),bordered:!0},this.funcValue(),this.returnValue(),this.parameters()):n.createElement("div",null)}}]),t}(n.Component)),kr=Be.a.Option,jr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).handleSearch=function(){var e=Object(u.a)(l.a.mark(function e(t){var n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,We.showFunctions();case 3:n=e.sent,r=n.content.map(function(e){return{value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)}}),a.setState({data:r}),e.next=9;break;case 8:a.setState({data:[]});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleChange=function(e){var t=a.state.data.filter(function(t){return t.value===e})[0];a.setState({currentFunc:t}),a.funcDescRef.show(t)},a.handleOperateInput=function(e){a.manuallyTransform=e.target.value},a.isAggChecked=function(e){a.manuallyIsAgg=e},a.handleNewName=function(e){a.newFuncName=e.target.value},a.handleField=function(e){var t=e.target.getAttribute("name");a.funcParams[t]=e.target.value},a.showColumn=function(e){return a.funcParams[e.name]=a.operateField,"yes"===e.extra.column?a.operateField:""},a.getTransform=function(){if(a.manuallyTransform)return{field:a.operateField,isAgg:a.manuallyIsAgg,transformCode:a.manuallyTransform,columnName:a.newFuncName};var e=[];return a.state.currentFunc.params.forEach(function(t){var n=a.funcParams[t.name];n&&("yes"===t.extra.column?e.push(ua.getField(n)):"number"==t.dataType||"boolean"==t.dataType?e.push(n):e.push('"'.concat(n,'"')))}),{field:a.operateField,isAgg:"yes"===a.state.currentFunc.funcValue.extra.agg,transformCode:"".concat(a.state.currentFunc.value,"(").concat(e.join(","),")"),columnName:a.newFuncName}},a.reload=function(){a.setState({key:Math.random(),data:[],value:void 0,funcPopUp:!1,currentFunc:void 0}),a.collect={}},a.parent=e.parent,a.operateField=e.operateField,a.funcParams={},a.state={data:[],value:void 0,funcPopUp:!1,func:{},key:Math.random()},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this,t=this.state.data.map(function(e){return n.createElement(kr,{key:e.value},e.text)});return n.createElement(Y.a,{className:"login-form",key:this.state.key},n.createElement(Y.a.Item,null,n.createElement(Be.a,{showSearch:!0,value:this.state.value,placeholder:"Search function",defaultActiveFirstOption:!1,showArrow:!1,style:{width:"200px"},filterOption:!1,onSearch:this.handleSearch,onChange:this.handleChange,notFoundContent:"type function name"},t)),n.createElement(Y.a.Item,null,n.createElement(Or,{ref:function(t){return e.funcDescRef=t}})),this.state.currentFunc?this.state.currentFunc.params.map(function(t){return n.createElement(Y.a.Item,{key:t.name},n.createElement(X.a,{name:t.name,onChange:e.handleField,addonBefore:t.name,defaultValue:e.showColumn(t)}))}):n.createElement("div",null),n.createElement(Y.a.Item,null,n.createElement(X.a,{addonBefore:"Mannual Transform",onChange:this.handleOperateInput,placeholder:""})),n.createElement(Y.a.Item,{label:"Is Agg Function"},n.createElement(ar.a,{onChange:this.isAggChecked})),n.createElement(Y.a.Item,null,n.createElement(X.a,{addonBefore:"New fieldName",onChange:this.handleNewName,placeholder:""})))}}]),t}(n.Component),wr=(I.a.SubMenu,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).showAggFuncsAndApply=function(e){a.operateField=e.field,a.setState({funcPopUp:!0})},a.reload=function(){var e=a.workshop.currentTable.schema.fields.map(function(e){return{field:e.name,groupby:"",agg:""}}),t={render:{groupby:function(e,t){return n.createElement(ar.a,{onChange:function(e){return a.enableGroupByField(e,t)},dataref:t})},agg:function(e,t){return n.createElement($.a,{dataref:t,onClick:function(){a.showAggFuncsAndApply(t)}},"Choose function")}}};a.columnsRef.update(e,t)},a.handleFunc=function(){var e=a.applyFuncToFieldRef.getTransform(),t=(e.field,e.transformCode),n=e.columnName;a.generateProjectField(t,n),a.setState({funcPopUp:!1}),a.applyFuncToFieldRef.reload()},a.workshop=e.parent.workshop,a.state={funcPopUp:!1},a.groupByFields=[],a.aggFields=[],a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.reload()}},{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement("div",null,n.createElement(it.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:function(){e.setState({funcPopUp:!1}),e.applyFuncToFieldRef.setState({key:Math.random()})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(jr,{parent:this,ref:function(t){return e.applyFuncToFieldRef=t},operateField:this.operateField})),n.createElement("div",{className:"station-menu"},n.createElement(nr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}}))),n.createElement("div",null,n.createElement(yr,{parent:this,ref:function(t){return e.columnsRef=t}})))}}]),t}(Un(n.Component).with(rr,function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).enableGroupByField=function(e,t){var n=t.field;e?a.groupByFields.push(n):a.groupByFields=a.groupByFields.filter(function(e){return e.name!==n})},a.generateProjectField=function(e,t){a.aggFields.push({name:e,newName:t})},a.onApply=Object(u.a)(l.a.mark(function e(){var t,n,r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.ApplyOrSaveRef.enter(),t=ua.getTempTableName(),n=a.aggFields.map(function(e){return"".concat(e.name," as `").concat(e.newName,"`")}),r="",0!==a.groupByFields.length&&(r="group by ".concat(a.groupByFields.map(function(e){return"`".concat(e,"`")}).join(",")),n=a.groupByFields.map(function(e){return"`".concat(e,"`")}).concat(n)),o="select ".concat(n.join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," ").concat(r," as ").concat(t,";"),e.next=8,a.workshop.apply({tableName:t,sql:o});case 8:c=e.sent,a.ApplyOrSaveRef.exit(),200===c&&a.workshop.refreshOperateStation();case 11:case"end":return e.stop()}},e)})),a}return Object(Oe.a)(t,e),t}(e)}))),Sr=(a(451),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).getSelectFields=function(){return a.formRef.getFieldValue()},a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"wow",value:function(e){return{data:e.schemaFields.map(function(e){return{title:e.name,key:e.name}}),targetKeys:[]}}},{key:"componentDidUpdate",value:function(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(k.a)({},this.wow(this.props)))}},{key:"render",value:function(){var e=this;return n.createElement(Y.a,{labelCol:{span:6},ref:function(t){e.formRef=t}},this.state.data.map(function(e){return n.createElement(Y.a.Item,{key:e.key,name:e.key,label:e.key,value:e.key},n.createElement(X.a,{placeholder:"input the new name here"}))}))}}]),t}(n.Component)),xr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).wow=function(e){return{funcPopUp:!1,data:e.schemaFields.map(function(e){return{field:e.name,func:"",transformCode:"",columnName:""}}),config:{render:{func:function(e,t){return n.createElement($.a,{dataref:t,onClick:function(){a.showAggFuncsAndApply(t)}},"Choose function")},transformCode:function(e,t){return e},columnName:function(e,t){return e}}}}},a.showAggFuncsAndApply=function(e){a.operateField=e.field,a.setState({funcPopUp:!0})},a.reload=function(){a.columnsRef.update(a.state.data,a.state.config)},a.handleFunc=function(){var e=a.applyFuncToFieldRef.getTransform(),t=e.field,n=e.transformCode,r=e.columnName,o=e.isAgg;if(r){var c=a.state.data.map(function(e){return e.field===t?{field:t,func:"",transformCode:n,columnName:r,isAgg:o}:e});a.setState({funcPopUp:!1,data:c,error:void 0},function(){a.reload()}),a.applyFuncToFieldRef.reload()}else a.setState({error:"New fieldName is required."})},a.getSelectFields=function(){return a.state.data},a.render=function(){return n.createElement("div",null,n.createElement(it.a,{title:"Apply function to [".concat(a.operateField,"]"),visible:a.state.funcPopUp,onCancel:function(){a.applyFuncToFieldRef.reload(),a.setState({funcPopUp:!1,error:void 0})},onOk:a.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},a.state.error&&n.createElement(de,{message:a.state.error}),n.createElement(jr,{parent:Object(ke.a)(Object(ke.a)(a)),ref:function(e){return a.applyFuncToFieldRef=e},operateField:a.operateField})),n.createElement(yr,{ref:function(e){return a.columnsRef=e}}))},a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.schemaFields!==e.schemaFields&&this.setState(Object(k.a)({},this.wow(this.props)),function(){t.reload()})}},{key:"componentDidMount",value:function(){this.reload()}}]),t}(n.Component),Cr=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields,n=t.__state.operateFileds.filter(function(e){return a!==e.field}),e.abrupt("return",{data:{operateFileds:n}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Tr=Cr.handler,Nr=Cr.action,Rr=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields.map(function(e){return{field:e}}),e.abrupt("return",{data:{operateFileds:a}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Dr=Rr.handler,Ar=Rr.action,Ir=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"apply",value:function(){var e=Object(u.a)(l.a.mark(function e(t,a,n){var r,o,c,i,s,u,p,d;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,o=r.workshop,c=r.values,i=t.__state.applySaveRollbackDispacher,!(s=a(c))){e.next=6;break}return i({type:"setState",data:{loading:!1}}),e.abrupt("return",{data:Object(k.a)({},t.data,{error:s,loading:!1})});case 6:return u=n(o,c),p=u.tableName,d=u.sql,e.next=9,o.apply({tableName:p,sql:d});case 9:return 200===e.sent&&o.refreshOperateStation(),i({type:"setState",data:{loading:!1}}),e.abrupt("return",{data:Object(k.a)({},t.data,{loading:!1})});case 13:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()}]),e}(),Fr=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ir.apply(t,function(e){if(0===Object.keys(e).length)return"Please configure cast fields then click apply"},function(e,t){var a=ua.getTempTableName(),n=Object.keys(t).map(function(e){return"cast(".concat(ua.getField(e)," as ").concat(t[e],") as ").concat(ua.getField(e))}),r=Object.keys(t),o=e.currentTable.schema.fields.filter(function(e){return!r.includes(e.name)}).map(function(e){return ua.getField(e.name)}),c=n.concat(o).join(",");return{tableName:a,sql:"select ".concat(c," from ").concat(e.getLastApplyTable().tableName,"            \n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Pr=Fr.handler,Lr=Fr.action,_r=function e(){Object(f.a)(this,e)};_r.ADD_FIELD="addField",_r.REMOVE_FIELD="removeField";var Mr=Object(k.a)({},ln,(mr={},Object(m.a)(mr,_r.ADD_FIELD,Dr),Object(m.a)(mr,_r.REMOVE_FIELD,Tr),Object(m.a)(mr,"apply",Pr),mr)),qr=Object(k.a)({},un,(fr={},Object(m.a)(fr,_r.ADD_FIELD,Ar),Object(m.a)(fr,_r.REMOVE_FIELD,Nr),Object(m.a)(fr,"apply",Lr),fr));function Vr(e,t){return qr[t.type](e,t.data)}var Gr=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.workshop,e.next=3,a.rollback();case 3:return e.abrupt("return",{data:t.data});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Br=Gr.handler,Ur=Gr.action,Jr=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data.workshop,n=t.__state,r=n.saveTablePersisted,o=n.saveTableName){e.next=4;break}return e.abrupt("return",{data:{error:"table name is required"}});case 4:return e.next=6,a.save(o,r);case 6:return a.refreshTableWorkshop(),e.abrupt("return",{data:Object(k.a)({},t.data,{loading:!1})});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Kr=Jr.handler,Hr=Jr.action,Wr={setState:N.SetStateActionHandler,rollback:Br,save:Kr};function zr(e,t){switch(t.type){case"setState":return Object(N.SetStateAction)(e,t.data);case"rollback":return Ur(e,t.data);case"save":return Hr(e,t.data);default:return e}}var Qr={saveDiagram:!1,saveTablePersisted:!1,loading:!1,saveTableName:void 0,error:void 0},Yr=r.a.createContext();function Xr(e){var t=e.workshop,a=Object(n.useContext)(e.context).dispacher,o=Object(d.useReducerAsync)(zr,Qr,Wr),c=Object(p.a)(o,2),i=c[0],s=c[1],l=i.saveDiagram,u=(i.saveTablePersisted,i.loading),m=i.error;return r.a.createElement(Yr.Provider,{value:{dispacher:s}},m&&r.a.createElement(de,{message:m}),r.a.createElement(it.a,{title:"View",visible:l,onCancel:function(){s({type:"setState",data:{saveDiagram:!1}})},onOk:function(){s({type:"save",data:{saveDiagram:!1,workshop:t}})},cancelText:"Cancel",width:"50%",OkText:"Ok"},r.a.createElement(Y.a,{className:"login-form"},r.a.createElement(Y.a.Item,null,r.a.createElement(X.a,{addonBefore:"tableName",onChange:function(e){s({type:"setState",data:{saveTableName:e.target.value}})},placeholder:""})),r.a.createElement(Y.a.Item,{label:"Persist table(take more space):"},r.a.createElement(ar.a,{onChange:function(e){s({type:"setState",data:{saveTablePersisted:e}})}})))),r.a.createElement($.a,{loading:u,type:"primary",onClick:function(){s({type:"setState",data:{loading:!0}}),a({type:"setState",data:{applySaveRollbackDispacher:s,applyToken:ua.getJobName()}})}},"Apply"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{disabled:u,onClick:function(){s({type:"setState",data:{saveDiagram:!0}})}},"Save As"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{disabled:u,onClick:function(){s({type:"setState",data:{loading:!0}}),s({type:"rollback",data:{workshop:t,loading:!1}})}},"Rollback"))}var $r,Zr,eo=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ir.apply(t,function(e){if(0===Object.keys(e).length)return"Please configure order fields then click apply"},function(e,t){var a=ua.getTempTableName(),n=Object.keys(t).map(function(e){return" ".concat(ua.getField(e)," ").concat(t[e]," ")}).join(",");return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            order by  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),to=eo.handler,ao=eo.action,no=function e(){Object(f.a)(this,e)};no.ADD_FIELD="addField",no.REMOVE_FIELD="removeField";var ro=($r={},Object(m.a)($r,no.ADD_FIELD,Dr),Object(m.a)($r,no.REMOVE_FIELD,Tr),Object(m.a)($r,"setState",N.SetStateActionHandler),Object(m.a)($r,"apply",to),$r),oo=(Zr={},Object(m.a)(Zr,no.ADD_FIELD,Ar),Object(m.a)(Zr,no.REMOVE_FIELD,Nr),Object(m.a)(Zr,"setState",N.SetStateAction),Object(m.a)(Zr,"apply",ao),Zr);function co(e,t){return oo[t.type](e,t.data)}var io=Be.a.Option,so={error:void 0,applySaveRollbackDispacher:void 0,operateFileds:[]},lo=r.a.createContext();function uo(e){var t=e.workshop,a=Y.a.useForm(),o=Object(p.a)(a,1)[0],c=t.currentTable.schema.fields,i=Object(d.useReducerAsync)(Vr,so,Mr),s=Object(p.a)(i,2),l=s[0],u=s[1],m=l.operateFileds,f=l.error,h=l.applySaveRollbackDispacher,b=c.map(function(e){return r.a.createElement(io,{key:e.name},e.name)});return Object(n.useEffect)(function(){h&&o.submit()},[h]),r.a.createElement(lo.Provider,{value:{dispacher:u}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},f&&r.a.createElement(de,{message:f}),r.a.createElement(Y.a,{form:o,onFinish:function(e){u({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(Y.a.Item,null,r.a.createElement(Xr,{context:lo,workshop:t})),r.a.createElement(Y.a.Item,{label:"Choose fields"},r.a.createElement(Be.a,{mode:"multiple",onDeselect:function(e){u({type:_r.REMOVE_FIELD,data:{fields:e}})},onChange:function(e){u({type:_r.ADD_FIELD,data:{fields:e}})}},b)),m.map(function(e){return r.a.createElement(Y.a.Item,{key:e.field,label:"Cast ".concat(e.field," to"),name:e.field},r.a.createElement(Be.a,null,r.a.createElement(Be.a.Option,{value:"int"},"int"),r.a.createElement(Be.a.Option,{value:"long"},"long"),r.a.createElement(Be.a.Option,{value:"double"},"double"),r.a.createElement(Be.a.Option,{value:"string"},"string")))}))))}var po=pt.a.TabPane,mo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).workshop=e.parent.workshop,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement("div",{className:"station-menu"},n.createElement(pt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(po,{tab:"Select Columns",key:"1"},n.createElement(nr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onSelectApply,style:{marginBottom:"30px"}}),n.createElement(sr,{schemaFields:this.workshop.currentTable.schema.fields,ref:function(t){return e.selectFieldsRef=t},parent:this})),n.createElement(po,{tab:"Rename Columns",key:"2"},n.createElement(nr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onRenameApply,style:{marginBottom:"30px"}}),n.createElement(Sr,{schemaFields:this.workshop.currentTable.schema.fields,ref:function(t){return e.renameFieldsRef=t},parent:this})),n.createElement(po,{tab:"Transform Columns",key:"3"},n.createElement(nr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onFuncApply,style:{marginBottom:"30px"}}),n.createElement(xr,{schemaFields:this.workshop.currentTable.schema.fields,ref:function(t){return e.functionFieldRef=t},parent:this})),n.createElement(po,{tab:"Cast Column Type",key:"4"},n.createElement(uo,{workshop:this.workshop})))),n.createElement("div",null))}}]),t}(Un(n.Component).with(rr,function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).onSelectApply=Object(u.a)(l.a.mark(function e(){var t,n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.ApplyOrSaveRef.enter(),0!==(t=a.selectFieldsRef.getSelectFields().map(function(e){return"`".concat(e,"`")})).length){e.next=6;break}return a.workshop.showInfo("No fields are selected."),a.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=ua.getTempTableName(),r="select ".concat(t.join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," as ").concat(n,";"),e.next=10,a.workshop.apply({tableName:n,sql:r});case 10:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 12:case"end":return e.stop()}},e)})),a.onFuncApply=Object(u.a)(l.a.mark(function e(){var t,n,r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.ApplyOrSaveRef.enter(),0!==(t=a.functionFieldRef.getSelectFields()).length){e.next=6;break}return a.workshop.toggleMessage("No fields are renamed."),a.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=t.filter(function(e){return e.isAgg}).length>0,r=[],r=n?t.filter(function(e){return e.isAgg}).map(function(e){return"".concat(e.transformCode," as `").concat(e.columnName,"`")}):t.map(function(e){return e.transformCode?"".concat(e.transformCode," as `").concat(e.columnName,"`"):"`".concat(e.field,"` as `").concat(e.field,"`")}),o=ua.getTempTableName(),c="select ".concat(r.join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," as ").concat(o,";"),e.next=13,a.workshop.apply({tableName:o,sql:c});case 13:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 15:case"end":return e.stop()}},e)})),a.onRenameApply=Object(u.a)(l.a.mark(function e(){var t,n,r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.ApplyOrSaveRef.enter(),t=a.renameFieldsRef.getSelectFields(),n=a.workshop.currentTable.schema.fields.map(function(e){return"`".concat(e.name,"`")}),0!==t.length){e.next=7;break}return a.workshop.toggleMessage("No fields are renamed."),a.ApplyOrSaveRef.exit(),e.abrupt("return");case 7:return r=Object.keys(t).map(function(e){return"`".concat(e,"` as `").concat(t[e],"`")}),o=ua.getTempTableName(),c="select ".concat(n.concat(r).join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," as ").concat(o,";"),e.next=12,a.workshop.apply({tableName:o,sql:c});case 12:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 14:case"end":return e.stop()}},e)})),a}return Object(Oe.a)(t,e),t}(e)})),fo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).reload=function(e){a.setState(Object(k.a)({},a.wow(e)))},a.compareInput=function(e,t){var n=a.params.filter(function(e){return e.field===t.field});1==n.length?n[0].compare=e:a.params.push(Object(k.a)({},t,{compare:e}))},a.conditionInput=function(e,t){var n=a.params.filter(function(e){return e.field===t.field});1===n.length?n[0].condition=e:a.params.push(Object(k.a)({},t,{condition:e}))},a.wow=function(e){return{funcPopUp:!1,data:e.map(function(e){return{key:e.name,field:e.name,dataType:e.type,compare:"=",condition:"",command:""}}),columns:[{title:"field",dataIndex:"field"},{title:"dataType",dataIndex:"dataType",render:function(e,t){switch(typeof e){case"object":return n.createElement("span",null,e.type);default:return n.createElement("span",null,e)}}},{title:"compare",dataIndex:"compare",render:function(e,t){return n.createElement(Be.a,{key:t.field,defaultValue:e,onChange:function(e){a.compareInput(e,t)},style:{width:100}},n.createElement(Be.a.Option,{value:"="},"="),n.createElement(Be.a.Option,{value:"<"},"<"),n.createElement(Be.a.Option,{value:">"},">"),n.createElement(Be.a.Option,{value:">="},">="),n.createElement(Be.a.Option,{value:"<="},"<="),n.createElement(Be.a.Option,{value:"!="},"!="),n.createElement(Be.a.Option,{value:"like"},"like"),n.createElement(Be.a.Option,{value:"in"},"in"))}},{title:"condition",dataIndex:"condition",render:function(e,t){return n.createElement(X.a,{onChange:function(e){a.conditionInput(e.target.value,t)},key:t.field,defaultValue:e})}}]}},a.addGroup=function(e){var t=e.groupName,n=e.groupType;if(t&&n){var r=a.params.filter(function(e){return a.selectedRowKeys.includes(e.field)});a.fitlerStation.conGroups[t]={groupName:t,groupType:n,tp:"basic",data:r},a.fitlerStation.applyGroup&&a.fitlerStation.applyGroup.reload({data:a.fitlerStation.conGroups}),a.fitlerStation.groupGroup&&a.fitlerStation.groupGroup.reload({data:a.fitlerStation.conGroups}),a.params=[],a.workshop.showInfo("Add successfully")}else a.workshop.showInfo("Error: groupName and groupType is required.")},a.render=function(){var e={onChange:function(e,t){a.selectedRowKeys=e},getCheckboxProps:function(e){return{name:e.field}}};return n.createElement("div",null,n.createElement(Y.a,{onFinish:a.addGroup},n.createElement(Y.a.Item,{name:"groupName",label:"Group Name"},n.createElement(X.a,null)),n.createElement(Y.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(Be.a,null,n.createElement(Be.a.Option,{value:"and"},"and"),n.createElement(Be.a.Option,{value:"or"},"or"))),n.createElement(Y.a.Item,null,n.createElement($.a,{type:"primary",htmlType:"submit"},"Add selected conditions to group"))),n.createElement(P.a,null),n.createElement(nr,{parent:Object(ke.a)(Object(ke.a)(a)),onRollback:a.fitlerStation.onRollback,handlePersit:a.fitlerStation.handlePersit,handleTableInput:a.fitlerStation.handleTableInput,ref:function(e){return a.fitlerStation.ApplyOrSaveRef=e},onSave:a.fitlerStation.onSave,onApply:function(){var e=a.params.filter(function(e){return a.selectedRowKeys.includes(e.field)});a.fitlerStation.onNonGroupFilterApply(e)},style:{marginBottom:"30px"}}),n.createElement(ct.a,{rowSelection:Object(k.a)({type:"checkbox"},e),columns:a.state.columns,dataSource:a.state.data}))},a.fitlerStation=e.parent,a.workshop=e.parent.workshop,a.state=a.wow(e.schemaFields),a.params=[],a}return Object(Oe.a)(t,e),t}(n.Component),ho=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).reload=function(e){a.setState(Object(k.a)({},a.wow(e)))},a.wow=function(e){return{funcPopUp:!1,data:Object.keys(e.data).map(function(e){return{groupName:e}}).map(function(e){return{key:e.groupName,groupName:e.groupName}}),columns:[{title:"groupName",dataIndex:"groupName"}]}},a.addGroup=function(e){var t=e.groupName,n=e.groupType;if(t&&n){var r=a.selectedRowKeys.map(function(e){return a.fitlerStation.conGroups[e]});a.fitlerStation.conGroups[t]={groupName:t,groupType:n,tp:"group",data:r},a.fitlerStation.applyGroup&&a.fitlerStation.applyGroup.reload({data:a.fitlerStation.conGroups}),a.fitlerStation.groupGroup&&a.fitlerStation.groupGroup.reload({data:a.fitlerStation.conGroups}),a.workshop.showInfo("Add successfully")}else a.workshop.showInfo("Error: groupName and groupType is required.")},a.render=function(){var e={onChange:function(e,t){a.selectedRowKeys=e},getCheckboxProps:function(e){return{name:e.title}}};return n.createElement("div",null,n.createElement(Y.a,{onFinish:a.addGroup},n.createElement(Y.a.Item,{name:"groupName",label:"Group Name"},n.createElement(X.a,null)),n.createElement(Y.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(Be.a,null,n.createElement(Be.a.Option,{value:"and"},"and"),n.createElement(Be.a.Option,{value:"or"},"or"))),n.createElement(Y.a.Item,null,n.createElement($.a,{type:"primary",htmlType:"submit"},"Add selected"))),n.createElement(ct.a,{rowSelection:Object(k.a)({type:"checkbox"},e),columns:a.state.columns,dataSource:a.state.data}))},a.fitlerStation=e.parent,a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(Oe.a)(t,e),t}(n.Component),bo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).reload=function(e){a.setState(Object(k.a)({},a.wow(e)))},a.wow=function(e){return{data:Object.keys(e.data).map(function(e){return{groupName:e}}).map(function(e){return{key:e.groupName,groupName:e.groupName}}),refresh:Math.random()}},a.onChange=function(e){a.groupName=e},a.render=function(){return n.createElement("div",null,n.createElement(Y.a,{key:a.state.refresh},n.createElement(Y.a.Item,{label:"Select group name to apply:"},n.createElement(Be.a,{onChange:a.onChange},a.state.data.map(function(e){return n.createElement(Be.a.Option,{key:e.key,value:e.groupName},e.groupName)})))))},a.fitlerStation=e.parent,a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(Oe.a)(t,e),t}(n.Component),go=pt.a.TabPane,vo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).onNonGroupFilterApply=function(){var e=Object(u.a)(l.a.mark(function e(t){var n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){var t="";switch(e.dataType){case"string":t='"'.concat(e.condition,'"');break;default:t=e.condition}return"".concat(ua.getField(e.field)," ").concat(e.compare," ").concat(t)}).join(" and "),a.ApplyOrSaveRef.enter(),r=ua.getTempTableName(),o="select * from ".concat(a.workshop.getLastApplyTable().tableName," \n        where ").concat(n,"\n        as ").concat(r,";"),e.next=6,a.workshop.apply({tableName:r,sql:o});case 6:a.ApplyOrSaveRef.exit();case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onFilterApply=Object(u.a)(l.a.mark(function e(){var t,n,r,o,c,i,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(e){if("basic"===e.tp)return"and"===e.groupType?"(".concat(r(e.data).join(" and "),")"):"(".concat(r(e.data).join(" or "),")");if("and"===e.groupType){var t=e.data.flatMap(function(e){return o(e)}).join(" and ");return"(".concat(t,")")}var a=e.data.flatMap(function(e){return o(e)});return"(".concat(a.join(" or "),")")},r=function(e){return e.map(function(e){var t="";switch(e.dataType){case"string":t='"'.concat(ua.escapeQuote(e.condition),'"');break;default:t=e.condition}return"".concat(ua.getField(e.field)," ").concat(e.compare," ").concat(t)})},t=a.applyGroup.groupName){e.next=6;break}return a.workshop.showInfo("Choose the group name to apply."),e.abrupt("return");case 6:return n=a.conGroups[t],c=o(n),a.ApplyOrSaveRef.enter(),i=ua.getTempTableName(),s="select * from ".concat(a.workshop.getLastApplyTable().tableName," \n        where ").concat(c,"\n        as ").concat(i,";"),e.next=13,a.workshop.apply({tableName:i,sql:s});case 13:a.ApplyOrSaveRef.exit();case 14:case"end":return e.stop()}},e)})),a.workshop=e.parent.workshop,a.conGroups={},a.currentConditions={},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement("div",{className:"station-menu"},n.createElement(pt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(go,{tab:"Add Conditions to Group",key:"1"},n.createElement(fo,{ref:function(t){return e.compare=t},parent:this,schemaFields:this.workshop.currentTable.schema.fields})),n.createElement(go,{tab:"Apply Group",key:"2"},n.createElement(nr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onFilterApply,style:{marginBottom:"30px"}}),n.createElement(P.a,null),n.createElement(bo,{ref:function(t){return e.applyGroup=t},parent:this,data:this.conGroups})),n.createElement(go,{tab:"Add Groups to Group",key:"3"},n.createElement(ho,{ref:function(t){return e.groupGroup=t},parent:this,data:this.conGroups})))),n.createElement("div",null))}}]),t}(Un(n.Component).with(rr)),yo={operateFileds:[],error:void 0,applySaveRollbackDispacher:void 0},Eo=r.a.createContext(),Oo=Be.a.Option;function ko(e){var t=e.parent.workshop,a=t.currentTable.schema.fields,o=Object(d.useReducerAsync)(co,yo,ro),c=Object(p.a)(o,2),i=c[0],s=c[1],l=i.operateFileds,u=i.error,m=i.applySaveRollbackDispacher,f=Y.a.useForm(),h=Object(p.a)(f,1)[0],b=a.map(function(e){return r.a.createElement(Oo,{key:e.name},e.name)});return Object(n.useEffect)(function(){m&&h.submit()},[m]),r.a.createElement(Eo.Provider,{value:{dispacher:s}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},u&&r.a.createElement(de,{message:u}),r.a.createElement(Y.a,{form:h,onFinish:function(e){s({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(Y.a.Item,null,r.a.createElement(Xr,{context:Eo,workshop:t})),r.a.createElement(Y.a.Item,{label:"Choose fields"},r.a.createElement(Be.a,{mode:"multiple",onDeselect:function(e){s({type:no.REMOVE_FIELD,data:{fields:e}})},onChange:function(e){s({type:no.ADD_FIELD,data:{fields:e}})}},b)),l.map(function(e){return r.a.createElement(Y.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(Be.a,null,r.a.createElement(Be.a.Option,{value:"desc"},"desc"),r.a.createElement(Be.a.Option,{value:"asc"},"asc")))}))))}var jo=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ir.apply(t,function(e){return 0==Object.keys(e).length?"Please configure limit size then click apply.":e.limitSize?void 0:"Please configure limit size then click apply."},function(e,t){var a=ua.getTempTableName(),n=t.limitSize;return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            limit  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),wo=jo.handler,So=jo.action,xo=Object(k.a)({},ln,{apply:wo}),Co=Object(k.a)({},un,{apply:So});function To(e,t){return Co[t.type](e,t.data)}var No={limitSize:void 0,error:void 0,applySaveRollbackDispacher:void 0},Ro=r.a.createContext();function Do(e){var t=e.parent.workshop,a=Object(d.useReducerAsync)(To,No,xo),o=Object(p.a)(a,2),c=o[0],i=o[1],s=(c.limitSize,c.error),l=c.applySaveRollbackDispacher,u=Y.a.useForm(),m=Object(p.a)(u,1)[0];return Object(n.useEffect)(function(){l&&m.submit()},[l]),r.a.createElement(Ro.Provider,{value:{dispacher:i}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},s&&r.a.createElement(de,{message:s}),r.a.createElement(Y.a,{form:m,onFinish:function(e){i({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(Y.a.Item,null,r.a.createElement(Xr,{context:Ro,workshop:t})),r.a.createElement(Y.a.Item,{name:"limitSize"},r.a.createElement(X.a,null)))))}var Ao,Io,Fo=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).groupFields=t.data.groupFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Po=Fo.handler,Lo=Fo.action,_o=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).orderFields=t.data.orderFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Mo=_o.handler,qo=_o.action,Vo=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).rowWindows=t.data.rowWindows,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Go=Vo.handler,Bo=Vo.action,Uo=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c,i,s,u,p,d,m,f,h,b,g,v,y,E,O,k;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.result,n=a.groupFields,r=a.orderFields,o=a.rowWindows,c=t.data,i=c.workshop,s=c.functions,u=n.map(function(e){return ua.getField(e.field)}).join(","),p=r.map(function(e){return"".concat(ua.getField(e.field)," ").concat(e.value)}),d="",p.length>0&&(d="order by ".concat(p.join(","))),m=o.windowType,f=o.preceding,h=o.following,b="",g=f&&"".concat(f," PRECEDING")||"UNBOUNDED PRECEDING",v=h&&"".concat(h," FOLLOWING")||"UNBOUNDED FOLLOWING","UNBOUNDED PRECEDING"===g&&"UNBOUNDED FOLLOWING"===v&&(v="CURRENT ROW"),!m){e.next=19;break}e.t0=m,e.next="row window"===e.t0?15:"range window"===e.t0?17:19;break;case 15:return b="ROWS BETWEEN ".concat(g,"  and ").concat(v," "),e.abrupt("break",19);case 17:return b="RANGE BETWEEN ".concat(g,"  and ").concat(v," "),e.abrupt("break",19);case 19:return y=s.map(function(e){e.field,e.isAgg;var t=e.transformCode,a=e.columnName;return"".concat(t," over w as ").concat(a)}).join(","),E=i.currentTable.schema.fields.map(function(e){return ua.getField(e.name)}).join(","),O=ua.getTempTableName(),k="\n     select ".concat(E,",").concat(y,"\n     from ").concat(i.getLastApplyTable().tableName," \n     window w as (\n         partition by ").concat(u," ").concat(d," ").concat(b,"\n     ) as ").concat(O,";\n    "),e.next=25,i.apply({tableName:O,sql:k});case 25:return i.refreshOperateStation(),e.abrupt("return",{data:{}});case 27:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Jo=Uo.handler,Ko=Uo.action,Ho=function e(){Object(f.a)(this,e)};Ho.buildGroup="buildGroup",Ho.buildOrder="buildOrder",Ho.buildRowWindows="buildRowWindows",Ho.apply="apply";var Wo=Object(k.a)({},ln,(Ao={},Object(m.a)(Ao,Ho.buildGroup,Po),Object(m.a)(Ao,Ho.buildOrder,Mo),Object(m.a)(Ao,Ho.buildRowWindows,Go),Object(m.a)(Ao,"apply",Jo),Ao)),zo=Object(k.a)({},un,(Io={},Object(m.a)(Io,Ho.buildGroup,Lo),Object(m.a)(Io,Ho.buildOrder,qo),Object(m.a)(Io,Ho.buildRowWindows,Bo),Object(m.a)(Io,"apply",Ko),Io));function Qo(e,t){return zo[t.type](e,t.data)}var Yo=Be.a.Option;var Xo=function(e){var t=e.workshop,a=(e.dispacher,e.context),o=e.enableApply,c=void 0!==o&&o,i=e.fieldWrapper,s=e.submit,l=e.selectFields,u=e.selectFieldsLabel,d=void 0===u?"Choose fields":u,m=e.selectFieldsMode,f=void 0===m?"multiple":m,h=l||t.currentTable.schema.fields,b=Object(n.useState)([]),g=Object(p.a)(b,2),v=g[0],y=g[1],E=Object(n.useState)(void 0),O=Object(p.a)(E,2),k=O[0],j=O[1],w=Y.a.useForm(),S=Object(p.a)(w,1)[0],x=h.map(function(e){return r.a.createElement(Yo,{key:e.name},e.name)});return{ui:function(e){return r.a.createElement(Y.a,{form:S,className:"login-form",onFinish:s},k&&r.a.createElement(de,{onClose:function(){j(void 0)},message:k}),c&&r.a.createElement(Y.a.Item,null,r.a.createElement(Xr,{context:a,workshop:t})),r.a.createElement(Y.a.Item,{label:d,name:"selectFieldsName"},r.a.createElement(Be.a,{style:{minWidth:"200px"},mode:f,onDeselect:function(e){y(v.filter(function(t){return e!==t.field}))},onChange:function(e){y("multiple"===f?e.map(function(e){return{field:e}}):[{field:e}])}},x)),v.map(function(e){return i(e)}),e)},operateFields:v,form:S,setError:j}};function $o(e){var t=Object(n.useContext)(ic).dispacher,a=Xo({workshop:e.workshop,fieldWrapper:function(e){return r.a.createElement(r.a.Fragment,null)}}),o=a.ui,c=a.operateFields,i=a.setError;return o([r.a.createElement(Y.a.Item,{key:"button"},r.a.createElement($.a,{type:"primary",onClick:function(){0!==c.length?t({type:Ho.buildGroup,data:{groupFields:c}}):i("Fields are required.")}},"Next"))])}function Zo(e){var t=Object(n.useContext)(ic).dispacher,a=Xo({workshop:e.workshop,fieldWrapper:function(e){return r.a.createElement(Y.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(Be.a,null,r.a.createElement(Be.a.Option,{value:"desc"},"desc"),r.a.createElement(Be.a.Option,{value:"asc"},"asc")))}}),o=a.ui,c=a.operateFields,i=(a.setError,a.form);return o([r.a.createElement(Y.a.Item,null,r.a.createElement($.a,{type:"primary",onClick:function(){var e=i.getFieldValue(),a=c.map(function(t){return{field:t.field,value:e[t.field]}});t({type:Ho.buildOrder,data:{orderFields:a}})}},"Next"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{onClick:function(){t({type:"setState",data:{current:0}})}},"Previous"))])}function ec(e){var t=Object(n.useContext)(ic).dispacher,a=Xo({workshop:e.workshop,fieldWrapper:function(e){switch(e.field){case"row window":case"range window":return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a.Item,{label:"Preceding",name:"preceding"},r.a.createElement(X.a,{placeholder:"number"})),r.a.createElement(Y.a.Item,{label:"Following",name:"following"},r.a.createElement(X.a,{placeholder:"number"})))}},selectFields:[{name:"row window"},{name:"range window"}],selectFieldsLabel:"Window Type",selectFieldsMode:"single"}),o=a.ui,c=(a.operateFields,a.setError,a.form);return o([r.a.createElement(Y.a.Item,null,r.a.createElement($.a,{type:"primary",onClick:function(){var e=c.getFieldValue().selectFieldsName,a=Object(k.a)({},c.getFieldValue(),{windowType:e});t({type:Ho.buildRowWindows,data:{rowWindows:a}})}},"Next"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{onClick:function(){t({type:"setState",data:{current:1}})}},"Previous"))])}var tc=ut.a.Panel;var ac=a(1123);ut.a.Panel;function nc(e){var t=e.workshop,a=Object(n.useContext)(ic).dispacher,o=function(e){var t=e.operateField,a=Object(n.useState)([]),o=Object(p.a)(a,2),c=o[0],i=o[1],s=Object(n.useState)(void 0),d=Object(p.a)(s,2),m=d[0],f=d[1],h=Y.a.useForm(),b=Object(p.a)(h,1)[0],g=Object(n.useState)(void 0),v=Object(p.a)(g,2),y=v[0],E=v[1],O=function(){var e=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.showFunctions();case 2:t=e.sent,a=t.content.map(function(e){return{value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)}}),i(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(function(){O()},[]);var k=Object(n.useCallback)(function(){var e=Object(u.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=c.filter(function(e){return e.value===t})[0],f(a);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[c]),j=function(e){return"yes"===e.extra.column?t:""};return{ui:function(e,t){return r.a.createElement(Y.a,{form:b,className:"login-form"},y&&r.a.createElement(de,{onClose:function(){E(void 0)},message:y}),r.a.createElement(Y.a.Item,{label:"Search function"},r.a.createElement(Be.a,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!0,style:{width:"200px"},filterOption:!0,onChange:k,notFoundContent:"type function name"},c.map(function(e){return r.a.createElement(Be.a.Option,{key:e.value},e.text)}))),m&&r.a.createElement(Y.a.Item,{key:m.value},r.a.createElement(Or,{func:m})),m&&m.params.map(function(e){return r.a.createElement(Y.a.Item,{initialValue:j(e),key:e.name,name:e.name,label:e.name},r.a.createElement(X.a,null))}),r.a.createElement(Y.a.Item,null,r.a.createElement(ut.a,null,r.a.createElement(tc,{header:"Mannually Apply Function"},r.a.createElement(P.a,{type:"horizontal"}),r.a.createElement(Y.a.Item,{name:"mannualTransform",label:"Mannual Transform"},r.a.createElement(X.a,null)),r.a.createElement(Y.a.Item,{name:"isMannualAgg",label:"Is Agg Function"},r.a.createElement(ar.a,null))))),t,r.a.createElement(Y.a.Item,{name:"newFieldName",label:"New Field Name",required:!0},r.a.createElement(X.a,null)),e)},form:b,getTransform:function(){var e=b.getFieldValue(),a=e.mannualTransform,n=e.isMannualAgg,r=e.newFieldName;if(a)return{field:t,isAgg:n||!1,transformCode:a,columnName:r};if(!m)return E("Operate is required."),{};var o=[];return m.params.forEach(function(e){var a=b.getFieldValue()[e.name];a||"yes"!==e.extra.column||(a=t),a&&("yes"===e.extra.column?o.push(ua.getField(a)):"number"==e.dataType||"boolean"==e.dataType?o.push(a):o.push('"'.concat(a,'"')))}),{field:t,isAgg:"yes"===m.funcValue.extra.agg,transformCode:"".concat(m.value,"(").concat(o.join(","),")"),columnName:r}},setError:E}}({operateField:""}),c=o.ui,i=o.form,s=o.getTransform,d=o.setError,m=Object(n.useState)(!1),f=Object(p.a)(m,2),h=f[0],b=f[1],g=Object(n.useState)([]),v=Object(p.a)(g,2),y=v[0],E=v[1];return r.a.createElement(r.a.Fragment,null,c([r.a.createElement(Y.a.Item,null,r.a.createElement($.a,{type:"primary",loading:h,onClick:function(){var e=[];if(0===y.length){var n=s(),r=n.field,o=n.isAgg,c=n.transformCode,i=n.columnName;if(e.push({field:r,isAgg:o,transformCode:c,columnName:i}),!i)return void d("New Field Name is required.")}else e=y;b(!0),a({type:Ho.apply,data:{setLoading:b,workshop:t,functions:e}})}},"Apply"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{loading:h,onClick:function(){var e=s(),t=e.field,a=e.isAgg,n=e.transformCode,r=e.columnName;r?(E(y.concat([{field:t,isAgg:a,transformCode:n,columnName:r}])),i.resetFields()):d("New Field Name is required.")}},"Add"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{onClick:function(){a({type:"setState",data:{current:2}})}},"Previous"))]),y.length>0&&r.a.createElement(Er.b,{style:{width:"500px"},header:r.a.createElement("div",null,"Added Functions"),bordered:!0,dataSource:y.map(function(e){return"".concat(e.transformCode," as ").concat(e.columnName)}),renderItem:function(e){return r.a.createElement(Er.b.Item,null,r.a.createElement(ac.a.Text,{mark:!0},"Func")," ",e)}}))}function rc(){var e=Object(se.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\npadding: 30px 30px;\nwidth: 100%;\ndisplay:flex;\nalign-items:center;\njustify-content:center;\nflex-direction: column;\n"]);return rc=function(){return e},e}var oc=tr.a.Step,cc=le.a.div(rc()),ic=r.a.createContext();function sc(e){var t=e.parent.workshop,a={steps:[r.a.createElement($o,{workshop:t}),r.a.createElement(Zo,{workshop:t}),r.a.createElement(ec,{workshop:t}),r.a.createElement(nc,{workshop:t})],current:0,result:{groupFields:[],orderFields:[],rowWindows:[]}},n=Object(d.useReducerAsync)(Qo,a,Wo),o=Object(p.a)(n,2),c=o[0],i=o[1],s=c.steps,l=c.current;return r.a.createElement(ic.Provider,{value:{dispacher:i}},r.a.createElement("div",{className:"join-app"},r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(tr.a,{current:l},r.a.createElement(oc,{key:0,title:"Build Group",description:"Choose fields to group data"}),r.a.createElement(oc,{key:1,title:"Setup Group Row Order",description:"Choose fields to order the data in group"}),r.a.createElement(oc,{key:2,title:"Build Window",description:"Build window on every row of every group"}),r.a.createElement(oc,{key:3,title:"Apply Function",description:"Apply functions to all windows we have created"}))),r.a.createElement("div",{className:"join-app-form"},r.a.createElement(cc,null,s[l]," "))))}var lc=Object(k.a)({},ln),uc=Object(k.a)({},un);function pc(e,t){return uc[t.type](e,t.data)}a(1058);var dc=a(526),mc=a.n(dc);a(1062);var fc={applySaveRollbackDispacher:void 0,scriptContent:void 0,applyToken:ua.getJobName()},hc=r.a.createContext();function bc(e){var t=e.parent.workshop,a=Object(d.useReducerAsync)(pc,fc,lc),o=Object(p.a)(a,2),c=o[0],i=o[1],s=function(e){var t=e.parent.workshop.currentTable.schema.fields.map(function(e){return e.name}),a=Y.a.useForm(),o=Object(p.a)(a,1)[0],c=Object(n.useState)(),i=Object(p.a)(c,2),s=i[0],l=i[1],u=Object(n.useState)([]),d=Object(p.a)(u,2),m=d[0],f=d[1],h=t.map(function(e){return r.a.createElement(Be.a.Option,{value:e},e)}),b=Object(n.useCallback)(function(e){e.forEach(function(e){"vType"===e.name[0]&&l(e.value)})},[]);return{ui:function(){return r.a.createElement(Q.a,{title:"Generic"},r.a.createElement(Y.a,{form:o,onFieldsChange:b},r.a.createElement(Y.a.Item,{label:"Visulizaiton Plugin",name:"vType"},r.a.createElement(Be.a,null,m.map(function(e){return r.a.createElement(Be.a.Option,{value:e},e)}))),r.a.createElement(Y.a.Item,{label:"X Column",name:"xColumn"},r.a.createElement(Be.a,null,h)),r.a.createElement(Y.a.Item,{label:"Y Column",name:"yColumn"},r.a.createElement(Be.a,null,h))))},form:o,vType:s,setPlugins:f}}(e),m=s.ui,f=s.form,h=s.vType,v=s.setPlugins,y=function(e){var t=Y.a.useForm(),a=Object(p.a)(t,1)[0],o=Object(n.useState)([]),c=Object(p.a)(o,2),i=c[0],s=c[1],l=Object(n.useState)(),u=Object(p.a)(l,2),d=u[0],m=u[1];return{ui:function(){return r.a.createElement(Q.a,{title:"Plugin Parameters"},d&&r.a.createElement("div",{className:"image-wrapper",style:{width:"400px"}},r.a.createElement(mc.a,{src:d})),r.a.createElement(Y.a,{form:a},i.map(function(e){return r.a.createElement(Y.a.Item,{key:e.key,name:e.key,label:e.option.label||e.key,initialValue:ua.unQuote(e.command)},r.a.createElement(X.a,null))})))},form:a,setPluginConfigs:s,pluginConfigs:i,setImagePreview:m}}(),E=y.ui,O=y.form,k=y.setPluginConfigs,j=y.setImagePreview,w=new b.ActionProxy,S=c.applySaveRollbackDispacher,x=c.scriptContent,C=c.applyToken,T=function(){var e=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.get(g.default.PLUGIN_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=t.content.map(function(e){return e.name}),v(a);case 7:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(u.a)(l.a.mark(function e(){var t,a,n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!h){e.next=14;break}return e.next=3,w.get(g.default.PLUGIN_GET,{pluginName:h});case 3:return t=e.sent,a=t.content.content,e.next=7,w.runScript(a,ua.getJobName(),{executeMode:"analyze"});case 7:if(200===(n=e.sent).status){e.next=10;break}return e.abrupt("return");case 10:r=n.content.filter(function(e){return e.mode&&"defaultParam"===e.mode}),i({type:"setState",data:{scriptContent:a}}),j(t.content.image),k(r);case 14:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(function(){N()},[h]),Object(n.useEffect)(function(){T()},[]);var R=function(){var e=Object(u.a)(l.a.mark(function e(){var a,n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!S){e.next=8;break}return a=f.getFieldValue(),n=O.getFieldValue(),r=n.tableName||ua.getTempTableName(),o="\n             select ".concat(ua.getField(a.xColumn)," as x,").concat(ua.getField(a.yColumn)," as y \n             from ").concat(t.getLastApplyTable().tableName," as ").concat(r,";\n             ").concat(x,"\n            "),e.next=7,t.apply({tableName:r,sql:o});case 7:S({type:"setState",data:{loading:!1}});case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(function(){R()},[C]),r.a.createElement(hc.Provider,{value:{dispacher:i}},r.a.createElement(Xr,{workshop:t,context:hc}),r.a.createElement("div",{className:"dash-station"},r.a.createElement("div",{className:"dash-station-data-page"},m()),r.a.createElement(P.a,{type:"vertical",style:{height:"300px"}}),r.a.createElement("div",{className:"dash-station-dash-page"},E())))}var gc=pt.a.TabPane,vc=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).reload=function(){a.setState({key:Math.random()})},a.workshop=e.parent,a.state={key:Math.random()},a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{className:"os-pane"},n.createElement("div",{className:"os-tabs"},n.createElement(pt.a,{defaultActiveKey:"1",tabPosition:"left",key:this.state.key},n.createElement(gc,{tab:"Project",key:1},n.createElement(mo,{parent:this})),n.createElement(gc,{tab:"Filter",key:2},n.createElement(vo,{parent:this})),n.createElement(gc,{tab:"Join",key:3},n.createElement(gr,{parent:this})),n.createElement(gc,{tab:"Agg",key:4},n.createElement(wr,{parent:this})),n.createElement(gc,{tab:"Order",key:5},n.createElement(ko,{parent:this})),n.createElement(gc,{tab:"Limit",key:6},n.createElement(Do,{parent:this})),n.createElement(gc,{tab:"Window",key:7},n.createElement(sc,{parent:this})),n.createElement(gc,{tab:"Dash",key:8},n.createElement(bc,{parent:this})))))}}]),t}(n.Component),yc=a(1117),Ec=a(527),Oc=a.n(Ec),kc=a(481),jc=a(171),wc=a(466),Sc=a(208),xc=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).getDefaultRender=function(e){e.name;switch(e.type){case"string":return function(e,t){return e};case"array":case"map":return function(e,t){return JSON.stringify(e)};default:return function(e,t){return e}}},a.getDefaultSearch=function(e){var t=e.name;switch(e.type){case"string":return a.getColumnSearchProps(t);case"array":case"map":default:return{}}},a.getDefaultTitleRender=function(e){return a.dropdown(e)},a.update=function(e,t){var n=!1;t[0]&&"html"===t[0].name&&t[1]&&"dash"===t[1].name&&(n=!0);var r=t.map(function(e){return Object(k.a)({},e,{dataIndex:e.name,title:a.getDefaultTitleRender(e),render:a.getDefaultRender(e)},a.getDefaultSearch(e))});a.setState({columns:r,data:e,isDash:n})},a.disablePreview=function(){a.setState({view:{enabled:!1}})},a.tableStyle=e.style||{},a.state={columns:[],rows:[],view:{enabled:!1},searchText:"",searchedColumn:"",loading:!1,isDash:!1},a.config={},a.workshop=e.parent,a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return this.state.isDash?At.render(this.state.data):n.createElement("div",{style:this.tableStyle},n.createElement(ct.a,{loading:this.state.loading,size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement(it.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(Sc,{source:this.state.view.content||""})))}}]),t}(Un(n.Component).with(function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(o)))).getColumnSearchProps=function(e){return{filterDropdown:function(t){var r=t.setSelectedKeys,o=t.selectedKeys,c=t.confirm,i=t.clearFilters;return n.createElement("div",{style:{padding:8}},n.createElement(X.a,{ref:function(e){a.searchInput=e},placeholder:"Search ".concat(e),value:o[0],onChange:function(e){return r(e.target.value?[e.target.value]:[])},onPressEnter:function(){return a.handleSearch(o,c,e)},style:{width:188,marginBottom:8,display:"block"}}),n.createElement(yc.a,null,n.createElement($.a,{type:"primary",onClick:function(){return a.handleSearch(o,c,e)},icon:n.createElement(kc.a,null),size:"small",style:{width:90}},"Search"),n.createElement($.a,{onClick:function(){return a.handleReset(i)},size:"small",style:{width:90}},"Reset")))},filterIcon:function(e){return n.createElement(kc.a,{style:{color:e?"#1890ff":void 0}})},onFilter:function(e,t){return!0},onFilterDropdownVisibleChange:function(e){e&&setTimeout(function(){return a.searchInput.select()})},render:function(t){return a.state.searchedColumn===e?n.createElement(Oc.a,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[a.state.searchText],autoEscape:!0,textToHighlight:t?t.toString():""}):t}}},a.handleSearch=function(){var e=Object(u.a)(l.a.mark(function e(t,n,r){var o,c,i,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=ua.getTempTableName(),c=t[0],i=ua.getField(r),s={tableName:o,sql:"select * from ".concat(a.workshop.getLastApplyTable().tableName," \n            where ").concat(i," like '%").concat(c,"%' as ").concat(o,";")},n(),a.setState({loading:!0}),e.next=8,a.workshop.apply(s);case 8:a.setState({loading:!1,searchText:t[0],searchedColumn:r});case 9:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.handleReset=function(e){e(),a.setState({searchText:""})},a}return Object(Oe.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(o)))).dropdownStat=function(){var e=Object(u.a)(l.a.mark(function e(t,n){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({loading:!0}),r=ua.getTempTableName(),e.t0=t,e.next="count"===e.t0?5:"count(distinct)"===e.t0?9:13;break;case 5:return e.next=7,a.workshop.apply({tableName:r,sql:"select count(".concat(ua.getField(n),") \n                    from ").concat(a.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 7:return a.setState({loading:!1}),e.abrupt("return");case 9:return e.next=11,a.workshop.apply({tableName:r,sql:"select count(distinct ".concat(ua.getField(n),") \n                    from ").concat(a.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 11:return a.setState({loading:!1}),e.abrupt("return");case 13:a.setState({loading:!1});case 14:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.dropdown=function(e){var t=n.createElement(I.a,{onClick:function(t){a.dropdownStat(t.key,e.name)}},n.createElement(I.a.Item,{key:"count",icon:n.createElement(wc.a,null)},"Count"),n.createElement(I.a.Item,{key:"count(distinct)",icon:n.createElement(wc.a,null)},"Count&distinct"));return n.createElement(jc.a,{overlay:t},n.createElement("span",null,e.name,n.createElement(P.a,{type:"vertical"}),n.createElement(cn.a,null)))},a}return Object(Oe.a)(t,e),t}(e)}));var Cc=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(ye.a)(this,Object(Ee.a)(t).call(this,e))).client=new b.ActionProxy,a.state={tableLoading:!1},a.sqls=[],t.workshop=Object(ke.a)(Object(ke.a)(a)),a}return Object(Oe.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"operateStationView",value:function(){var e=this;return this.state.loadingTable?n.createElement(An,null):this.sessionId?n.createElement(vc,{ref:function(t){return e.stationRef=t},parent:this}):n.createElement(Gn.a,{style:{width:"100%"},title:"No Aanalysis Session Is Opened",subTitle:"Right click the table in the left panel(DeltaLake/FileSystem) to begin your analysis"})}},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"ws-app"},n.createElement("div",{className:"ws-left-pane"},n.createElement(Ue.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},n.createElement(er,{ref:function(t){return e.leftTreePaneRef=t},parent:this}))),n.createElement("div",{className:"ws-right-pane"},n.createElement(it.a,{title:"Message",visible:this.state.showMessage||!1,onCancel:this.toggleMessage,onOk:this.toggleMessage,cancelText:"Cancel",width:"60%",OkText:"Ok"},n.createElement(we.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.consoleMessage||""})),n.createElement(it.a,{title:"Message",visible:this.state.showInfoMessage||!1,onCancel:function(){e.setState({showInfoMessage:!1})},onOk:function(){e.setState({showInfoMessage:!1})},cancelText:"Cancel",OkText:"Ok"},this.state.infoMessage),n.createElement("div",{className:"ws-operate-pane"},this.operateStationView()),n.createElement(P.a,null),n.createElement("div",{className:"ws-table-pane"},n.createElement(xc,{style:{width:"90%"},ref:function(t){return e.displayRef=t},parent:this}))))}}]),t}(Un(n.Component).with(function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).newSession=function(){var e=Object(u.a)(l.a.mark(function e(t,n,r,o){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.showTable(t,n,r,o),e.abrupt("return",Object(ke.a)(Object(ke.a)(a)));case 2:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),a.showTable=function(){var e=Object(u.a)(l.a.mark(function e(t,n,r,o){var c,i,s,u,p,d,m,f,h,b;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=ua.getTempTableName(),i="".concat(n,"."),n||(i=""),s="select * from ".concat(i).concat(r," as ").concat(c,";"),"delta"===t&&(s="load delta.`".concat(n,".").concat(r,"` as ").concat(c,";")),"temp"!==t){e.next=11;break}return e.next=8,We.tableInfo(r);case 8:u=e.sent,p=u.content,s=2===p.status?"load parquet.`/__persisted__/".concat(p.tableName,"`  as ").concat(p.tableName,";\n                select * from ").concat(p.tableName," as ").concat(c,";"):"".concat(p.content," \n                select * from ").concat(p.tableName," as ").concat(c,";");case 11:return"file"===t&&(d="where ",o?d+=Object.keys(o).map(function(e){var t=o[e];return"".concat(e.replace(/\[group\]/g,"0"),"='''").concat(t,"'''")}).join(" and "):d="",s="load ".concat(n,".`").concat(r,"` ").concat(d,"  as ").concat(c,";")),a.sqls.push({tableName:c,sql:s}),a.setState({loadingTable:!0}),e.next=16,a.client.runScript(s,ua.getJobName(),ua.robotFetchParam());case 16:if(m=e.sent,a.setState({loadingTable:!1}),200===m.status){e.next=21;break}return a.toggleMessage("Fail to load ".concat(c,": ").concat(m.content)),e.abrupt("return");case 21:f=m.content,h=f.schema,b=f.data,a.setCurrentTable("","",c,h,b),a.sessionId=ua.getJobName(),a.setState({sessionId:a.sessionId});case 25:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),a.setCurrentTable=function(e,t,n,r,o){a.currentTable={prefix:e,db:t,table:n,schema:r,data:o},a.updateDisplay(o,r)},a}return Object(Oe.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).getLastApplyTable=function(){return a.sqls[a.sqls.length-1]},a.rollback=function(){var e=Object(u.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a.sqls.length<2)){e.next=3;break}return a.toggleMessage("No apply to rollback."),e.abrupt("return");case 3:return a.sqls.pop(),n=a.sqls.pop(),e.next=7,a.apply(n);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.apply=function(){var e=Object(u.a)(l.a.mark(function e(t){var n,r,o,c,i,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.tableName,t.sql,a.sqls.push(t),r=a.sqls.map(function(e){return e.sql}).join(""),e.prev=3,e.next=6,a.client.runScript(r,ua.getJobName(),ua.robotFetchParam());case 6:if(200===(o=e.sent).status){e.next=11;break}return a.sqls.pop(),a.toggleMessage(o.content),e.abrupt("return",500);case 11:return c=o.content,i=c.data,s=c.schema,a.setCurrentTable("","",n,s,i),e.abrupt("return",200);case 16:return e.prev=16,e.t0=e.catch(3),a.toggleMessage("Execute job fail;(Job is killed)"),e.abrupt("return",500);case 20:case"end":return e.stop()}},e,null,[[3,16]])}));return function(t){return e.apply(this,arguments)}}(),a.save=function(){var e=Object(u.a)(l.a.mark(function e(t,n){var r,o,c,i,s,u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.sqls.length){e.next=3;break}return a.toggleMessage("Sorry, current session have no applies."),e.abrupt("return",500);case 3:if(r="select * from ".concat(a.getLastApplyTable().tableName," as ").concat(t,";"),a.sqls.push({tableName:t,sql:r}),o=a.sqls.map(function(e){return e.sql}).join("\n"),c=ua.getJobName(),i={status:5},!n){e.next=13;break}return s="".concat(o,"\n         save overwrite ").concat(t," as parquet.`/__persisted__/").concat(t,"`;"),e.next=12,a.client.runScript(s,c,{persistJobName:c,async:!0});case 12:i={jobName:c,status:1};case 13:return e.next=15,a.client.post(g.default.ANALYSIS_SAVE,Object.assign({tableName:t,sql:o,sessionId:a.sessionId,schema:JSON.stringify(a.currentTable.schema)},i));case 15:return u=e.sent,e.abrupt("return",u.status);case 17:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a}return Object(Oe.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).toggleMessage=function(e){a.state.showMessage?a.setState({showMessage:!a.state.showMessage}):a.setState({showMessage:!a.state.showMessage,consoleMessage:e})},a.showInfo=function(e){a.setState({showInfoMessage:!0,infoMessage:e})},a}return Object(Oe.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(ye.a)(this,(e=Object(Ee.a)(t)).call.apply(e,[this].concat(r)))).updateDisplay=function(){var e=Object(u.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({tableLoading:!0}),a.displayRef.update(t,n.fields),a.setState({tableLoading:!1});case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.refreshOperateStation=function(){a.stationRef.setState({key:Math.random()})},a.refreshTableWorkshop=function(){a.leftTreePaneRef.workshopTableTreeRef.reload()},a}return Object(Oe.a)(t,e),t}(e)}));Cc.workshop=void 0;var Tc,Nc=Cc,Rc=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c,i,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.enableRegister,r=void 0!==n&&n,o=a.enableLogin,c=void 0!==o&&o,i=new b.ActionProxy,e.next=4,i.post(g.default.APP_SAVE,{login:c,register:r});case 4:if(200!==(s=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{applySuccess:!0}});case 7:return e.abrupt("return",{data:{error:s.content}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Dc=Rc.handler,Ac=Rc.action,Ic=function e(){Object(f.a)(this,e)};Ic.LR_CONTROL="lrControl",Ic.SET_STATE="setState";var Fc=(Tc={},Object(m.a)(Tc,Ic.LR_CONTROL,Dc),Object(m.a)(Tc,Ic.SET_STATE,N.SetStateActionHandler),Tc);function Pc(e,t){switch(t.type){case Ic.LR_CONTROL:return Ac(e,t.data);case Ic.SET_STATE:return Object(N.SetStateAction)(e,t.data);default:return e}}a(452);var Lc=a(473),_c={enableLogin:!1,enableRegister:!1,applySuccess:!1,error:void 0,loading:!0},Mc=r.a.createContext();function qc(){var e=Object(d.useReducerAsync)(Pc,_c,Fc),t=Object(p.a)(e,2),a=t[0],o=t[1],c=S.formLayout1(),i=c.formItemLayout,s=c.tailLayout,f=a.enableLogin,v=a.enableRegister,y=a.applySuccess,E=a.error,O=a.loading;function k(){return(k=Object(u.a)(l.a.mark(function e(){var t,a,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.ActionProxy,e.next=3,t.get(g.default.APP_INFO,{});case 3:200===(a=e.sent).status&&o({type:Ic.SET_STATE,data:(n={enableLogin:Boolean(a.content.login)},Object(m.a)(n,"enableLogin",Boolean(a.content.register)),Object(m.a)(n,"loading",!1),n)});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}return Object(n.useEffect)(function(){!function(){k.apply(this,arguments)}()},[y,E]),r.a.createElement(Mc.Provider,{value:{dispacher:o}},y&&r.a.createElement(F.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),E&&r.a.createElement(F.a,{closable:!0,message:"Fail",description:E,type:"error",showIcon:!0}),O&&r.a.createElement(An,null),!O&&r.a.createElement(Q.a,{title:"Control Website Register/Login"},r.a.createElement(Y.a,Object.assign({},i,{className:"login-form",onFinish:function(e){o(h.a.buildEvent(Ic.LR_CONTROL,e))}}),r.a.createElement(Y.a.Item,{label:"Allow Register New User",name:"enableRegister"},r.a.createElement(ar.a,{defaultChecked:v,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(Y.a.Item,{label:"Allow User Login",name:"enableLogin"},r.a.createElement(ar.a,{defaultChecked:f,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(Y.a.Item,s,r.a.createElement($.a,{type:"primary",htmlType:"submit"},"Apply")))))}var Vc=a(533),Gc=a(539);function Bc(e){var t=e.renderConfig,a=e.createInitRow,o=e.submit,c=Y.a.useForm(),i=Object(p.a)(c,1)[0],s=Object(n.useState)([]),d=Object(p.a)(s,2),m=d[0],f=d[1],h=Object(n.useState)([]),b=Object(p.a)(h,2),g=b[0],v=b[1],y=Object(n.useState)({}),E=Object(p.a)(y,2),O=E[0],k=E[1],j=Object(n.useState)(!1),w=Object(p.a)(j,2),S=w[0],x=w[1],C=Object(n.useState)(!1),T=Object(p.a)(C,2),N=T[0],R=T[1],D=Object(n.useState)(void 0),A=Object(p.a)(D,2),I=A[0],F=A[1],P=Object(Vc.c)(g),L=P.list,_=P.remove,M=P.getKey,q=P.move,V=P.push,G=(P.sortForm,P.resetList),B=i.getFieldsValue;Object(n.useEffect)(function(){G(g)},[g]);var U=m.filter(function(e){return"id"!==e}).map(function(e){return t&&t[e]?t[e]({getKey:M}):{title:e,dataIndex:e,key:e,render:function(t,a,n){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a.Item,{name:"params[".concat(M(n),"].").concat(e),initialValue:t},r.a.createElement(X.a,{style:{width:120,marginRight:16}})))}}}).concat([{key:"operate",title:"",dataIndex:"operate",render:function(e,t,a){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a.Item,{name:"params[".concat(M(a),"].operate")},r.a.createElement($.a.Group,null,r.a.createElement($.a,{type:"danger",onClick:function(){return _(a)}},"Delete"))))}}]),J=Object(n.useCallback)(function(e){k(e);var t=/params\[(\d+)\]\.(\D+)/;(function(){var a=Object(u.a)(l.a.mark(function a(){var n;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n=[],Object.entries(e).map(function(e){var a=Object(p.a)(e,2),r=a[0],o=a[1],c=t.exec(r),i=Number(c[1]),s=c[2];n[i]||(n[i]={}),o&&(n[i][s]=o)}),o&&o({params:n,setLoading:x});case 3:case"end":return a.stop()}},a)}));return function(){return a.apply(this,arguments)}})()()},[x]);return{ui:function(){if(!N){var t=U.map(function(e){return e.render=function(e,t,a){return r.a.createElement("span",null,e)},e});return r.a.createElement(ct.a,{columns:t,dataSource:g,pagination:!1})}return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{form:i},r.a.createElement(Gc.a,{onDragEnd:function(e,t){return q(e,t)},handleSelector:'i[aria-label="icon: drag"]'},I&&r.a.createElement(de,{message:I}),r.a.createElement(ct.a,{columns:U,dataSource:L,rowKey:function(e,t){return M(t).toString()},pagination:!1})),r.a.createElement($.a,{style:{marginTop:8},block:!0,type:"dashed",onClick:function(){return V(function(){if(a)return a(U);var e={};return U.map(function(t){e[t]=""}),e}())}},"+ Add Row"),r.a.createElement($.a,{type:"primary",style:{marginTop:16},loading:S,onClick:function(){J(B())}},"Submit"),e.debug&&r.a.createElement("div",{style:{whiteSpace:"pre"}},O&&"content: ".concat(JSON.stringify(O,null,2)))))},data:g,schema:m,setData:v,setSchema:f,setLoading:x,setEditorMode:R,setError:F}}function Uc(e){var t=Object(n.useState)(void 0),a=Object(p.a)(t,2),o=a[0],c=a[1],i=new b.ActionProxy,s=Bc({submit:function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t.params,(n=t.setLoading)(!0),v(void 0),r=0;case 4:if(!(r<a.length)){e.next=15;break}return e.next=7,i.post(g.default.ENGINE_ADD,a[r]);case 7:if(200===(o=e.sent).status){e.next=12;break}return n(!1),v(o.content),e.abrupt("return");case 12:r++,e.next=4;break;case 15:c(ua.getJobName()),n(!1);case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),renderConfig:{skipAuth:function(e){var t=e.getKey;return{title:"skipAuth",dataIndex:"skipAuth",key:"skipAuth",render:function(e,a,n){var o=!0;return 2===e&&(o=!1),r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a.Item,{name:"params[".concat(t(n),"].skipAuth"),initialValue:String(o)},r.a.createElement(Be.a,null,r.a.createElement(Be.a.Option,{value:"true"},"true"),r.a.createElement(Be.a.Option,{value:"false"},"false"))))}}}}}),d=s.ui,m=s.setData,f=s.setSchema,h=s.setEditorMode,v=s.setError;return Object(n.useEffect)(function(){(function(){var e=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.get(g.default.ENGINE_LIST,{});case 2:200===(t=e.sent).status&&(f(t.content.schema),m(t.content.data));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[o]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(ar.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:function(e){h(e)}}),r.a.createElement(P.a,{type:"horizontal"}),d())}var Jc=I.a.SubMenu,Kc={currentPage:"lr-settings"},Hc=r.a.createContext();function Wc(){var e=Object(d.useReducerAsync)(Pc,Kc,Fc),t=Object(p.a)(e,2),a=t[0],n=t[1],o=a.currentPage;return r.a.createElement(Hc.Provider,{value:{dispacher:n}},r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(I.a,{style:{width:256},defaultSelectedKeys:["lr-settings"],defaultOpenKeys:["console-settings"],mode:"inline"},r.a.createElement(Jc,{key:"console-settings",title:r.a.createElement("span",null,r.a.createElement(Lc.a,null),r.a.createElement("span",null,"Console Settings"))},r.a.createElement(I.a.Item,{key:"lr-settings",onClick:function(){n({type:"setState",data:{currentPage:"lr-settings"}})}},"Login/Register Control")),r.a.createElement(Jc,{key:"engine-settings",title:r.a.createElement("span",null,r.a.createElement(Lc.a,null),r.a.createElement("span",null,"Engine Settings"))},r.a.createElement(I.a.Item,{onClick:function(){n({type:"setState",data:{currentPage:"engines"}})},key:"engines"},"Engines")))),r.a.createElement("div",{className:"app-admin-main"},"lr-settings"===o&&r.a.createElement(qc,null),"engines"===o&&r.a.createElement(Uc,null))))}function zc(e){var t=Object(n.useState)(void 0),a=Object(p.a)(t,2),o=a[0],c=a[1];return Object(n.useEffect)(function(){o&&function(){var e=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.ActionProxy,e.next=3,t.post(g.default.USER_EXTRA,{backend:o});case 3:a=e.sent,S.updateUser(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()},[o]),r.a.createElement("div",{className:"common-margin common-child-center"},r.a.createElement(Q.a,{title:"Default Backend",style:{width:"50%"}},r.a.createElement(Y.a,null,r.a.createElement(Y.a.Item,{label:"currentValue"},S.extraOption().backend||"Not Set Yet"),r.a.createElement(Y.a.Item,{label:"Set default engine"},r.a.createElement(et,{useEngine:function(e){c(e)}})))))}var Qc=I.a.SubMenu;function Yc(){var e=Object(n.useState)("default-backend"),t=Object(p.a)(e,2),a=t[0];t[1];return r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(I.a,{style:{width:256},defaultSelectedKeys:["default-backend"],defaultOpenKeys:["analysis-workshop"],mode:"inline"},r.a.createElement(Qc,{key:"analysis-workshop",title:r.a.createElement("span",null,r.a.createElement(Lc.a,null),r.a.createElement("span",null,"Analysis Workshop"))},r.a.createElement(I.a.Item,{key:"default-backend",onClick:function(){}},"Default Backend")))),r.a.createElement("div",{className:"app-admin-main"},"default-backend"===a&&r.a.createElement(zc,null)))}var Xc={currentPage:"login",logined:!1},$c=r.a.createContext();function Zc(){var e=Object(d.useReducerAsync)(A,Xc,D),t=Object(p.a)(e,2),a=t[0],o=t[1],c=a.currentPage,i=a.logined;return Object(n.useEffect)(function(){o(h.a.buildEvent(R.CHECK_LOGINED,{}))},[]),r.a.createElement($c.Provider,{value:{dispacher:o}},r.a.createElement("div",{className:"app-console"},r.a.createElement("div",{className:"app-console-header"},r.a.createElement(W,{userLogined:i,isUserAdmin:S.isAdmin(),currentPage:c})),r.a.createElement("div",{className:"app-console-main"},"register"===c&&r.a.createElement(he,null),"register"!==c&&!i&&r.a.createElement(ve,null),"console"===c&&i&&r.a.createElement(Vn,null),"workshop"===c&&i&&r.a.createElement(Nc,null),"admin"===c&&i&&S.isAdmin()&&r.a.createElement(Wc,null),"settings"===c&&i&&r.a.createElement(Yc,null)),r.a.createElement("div",{className:"app-console-footer"},r.a.createElement("div",{style:{bottom:"100px",textAlign:"center",width:"100%"}},"MLSQL Licensed under the Apache License, Version 2.0. @",r.a.createElement("a",{className:"copyright",href:"http://www.miitbeian.gov.cn/"},"\u6d59ICP\u590718052520\u53f7"),r.a.createElement("div",null,"@",r.a.createElement("a",{target:"_blank",href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010802009683"},r.a.createElement("img",{src:""}),"\u6d59\u516c\u7f51\u5b89\u5907 33010802009683\u53f7"))))))}var ei,ti=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){var a,n,r,o,c;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.ActionProxy,n=t.data,r=n.name,o=n.url,e.next=4,a.post(g.default.ENGINE_ADD,{name:r,url:o});case 4:if(200===(c=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{error:JSON.parse(c.content).msg}});case 7:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),ai=ti.handler,ni=ti.action,ri=h.a.buildHandler(function(){var e=Object(u.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),oi=ri.handler,ci=ri.action,ii=function e(){Object(f.a)(this,e)};ii.registerAdmin="registerAdmin",ii.addEngine="addEngine",ii.skipAddEngine="skipAddEngine";var si=(ei={},Object(m.a)(ei,ii.registerAdmin,ee),Object(m.a)(ei,ii.addEngine,ai),Object(m.a)(ei,ii.skipAddEngine,oi),ei);function li(e,t){switch(t.type){case ii.registerAdmin:return te(e,t.data);case ii.addEngine:return ni(e,t.data);case ii.skipAddEngine:return ci(e,t.data);default:return e}}var ui=a(1128);var pi=function(){var e=Object(n.useContext)(Pi).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout;return r.a.createElement(Y.a,Object.assign({},a,{className:"login-form",onFinish:function(t){e({type:ii.registerAdmin,data:t})}}),r.a.createElement(Y.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(X.a,null)),r.a.createElement(Y.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(X.a.Password,null)),r.a.createElement(Y.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(X.a.Password,null)),r.a.createElement(Y.a.Item,o,r.a.createElement($.a,{type:"primary",htmlType:"submit"},"Go")))};var di,mi=function(){var e=Object(n.useContext)(Pi).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout,c={required:!0,message:"required"};return r.a.createElement(Y.a,Object.assign({},a,{className:"login-form",onFinish:function(t){e({type:ii.addEngine,data:t})}}),r.a.createElement(Y.a.Item,{label:"Engine Name",name:"name",rules:[c]},r.a.createElement(X.a,null)),r.a.createElement(Y.a.Item,{label:"Engine Url",name:"url",rules:[c]},r.a.createElement(X.a,null)),r.a.createElement(Y.a.Item,o,r.a.createElement($.a,{type:"primary",htmlType:"submit"},"Go"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{onClick:function(t){t.preventDefault(),e({type:ii.skipAddEngine,data:{}})},htmlType:"submit"},"Skip")))},fi=h.a.buildHandler(function(e){return{data:e.data}}),hi=fi.handler,bi=fi.action,gi=h.a.buildHandler(function(e){return{data:{appConfigured:!0}}}),vi=gi.handler,yi=gi.action,Ei=h.a.buildHandler(function(e){return{data:{appConfigured:!0}}}),Oi=Ei.handler,ki=Ei.action,ji=function e(){Object(f.a)(this,e)};ji.GO_CONSOLE="goConsole",ji.GO_ADMIN="goAdmin",ji.appConfigured="appConfigured";var wi=(di={},Object(m.a)(di,ji.GO_ADMIN,vi),Object(m.a)(di,ji.GO_CONSOLE,Oi),Object(m.a)(di,ji.appConfigured,hi),di);function Si(e,t){switch(t.type){case ji.GO_ADMIN:return yi(e,t.data);case ji.GO_CONSOLE:return ki(e,t.data);case ji.appConfigured:return bi(e,t.data);default:return e}}var xi=function(){var e=Object(n.useContext)(Mi).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout;return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,{message:"Congratuation!",description:"You have finished the setup of MLSQL Console.",type:"success"}),r.a.createElement(P.a,null),r.a.createElement(Y.a,a,r.a.createElement(Y.a.Item,o,r.a.createElement($.a,{type:"primary",onClick:function(){e({type:ji.GO_ADMIN,data:{}})}},"Go to Admin Page"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement($.a,{onClick:function(){e({type:ji.GO_CONSOLE,data:{}})}},"Go to Console Page"))))};function Ci(){var e=Object(se.a)(["\n width:100%;\n display:flex;\n max-width: 800px;\n flex-direction: column;\n"]);return Ci=function(){return e},e}function Ti(){var e=Object(se.a)(["\n  width:100%;\n  margin-top:6px;\n"]);return Ti=function(){return e},e}function Ni(){var e=Object(se.a)(["\ndisplay: flex;\nflex-direction: column;\nwidth:100%;\njustify-content:center;\n align-items:  center;\n"]);return Ni=function(){return e},e}var Ri=tr.a.Step,Di=le.a.div(Ni()),Ai=le.a.div(Ti()),Ii=le.a.div(Ci()),Fi={error:void 0,current:0},Pi=r.a.createContext();var Li=function(){var e=Object(d.useReducerAsync)(li,Fi,si),t=Object(p.a)(e,2),a=t[0],n=t[1],o=a.error,c=a.current;return r.a.createElement(Pi.Provider,{value:{dispacher:n}},r.a.createElement(Di,null,r.a.createElement(Ai,null,r.a.createElement(ui.a,{title:"Setup MLSQL Console in 2 Steps"})),r.a.createElement(P.a,null),r.a.createElement(Ii,null,r.a.createElement(tr.a,{current:c},r.a.createElement(Ri,{title:"Admin User/Password",description:"Setup Admin accout"}),r.a.createElement(Ri,{title:"Add Engines",description:"Add default MLSQL Engine"}),r.a.createElement(Ri,{title:"Done",description:"Congratuation"})),r.a.createElement(P.a,null),o&&r.a.createElement(F.a,{message:"Message",description:o,type:"error",closable:!0}),0===c&&r.a.createElement(Q.a,null,r.a.createElement(pi,null)),1===c&&r.a.createElement(Q.a,null,r.a.createElement(mi,null)),2===c&&r.a.createElement(Q.a,null,r.a.createElement(xi,null)))))},_i={appConfigured:!1,loading:!0},Mi=r.a.createContext();var qi=function(){var e=Object(d.useReducerAsync)(Si,_i,wi),t=Object(p.a)(e,2),a=t[0],o=t[1],c=a.appConfigured,i=a.loading;function s(){return(s=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.ActionProxy,e.next=3,t.get(g.default.APP_INFO,{});case 3:200===(a=e.sent).status&&o({type:ji.appConfigured,data:{appConfigured:a.content.configured,loading:!1}});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}return Object(n.useEffect)(function(){!function(){s.apply(this,arguments)}()},[]),r.a.createElement(Mi.Provider,{value:{dispacher:o}},i&&r.a.createElement(An,null),!i&&!c&&r.a.createElement(Li,null),!i&&c&&r.a.createElement(Zc,null))};c.a.render(r.a.createElement(qi,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},25:function(e,t,a){"use strict";var n=a(5),r=a.n(n),o=a(20),c=a(8),i=a(7),s=a(12),l=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,null,[{key:"buildHandler",value:function(e){return{handler:function(t){var a=t.dispatch,n=t.getState,i=(t.signal,a);return function(){var t=Object(c.a)(r.a.mark(function t(a){var c;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(Object(o.a)({},a,{__state:n()}));case 2:c=t.sent,i(Object(o.a)({type:a.type},c));case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},action:function(e,t){return Object(o.a)({},e,t)}}}},{key:"buildEvent",value:function(e,t){return{type:e,data:t}}}]),e}();t.a=l},31:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return r});var n=a(7),r=function e(){Object(n.a)(this,e)};r.RUN="/api_v1/run/script",r.USER_NAME="/api_v1/user/userName",r.JOB_LIST="/api_v1/job/list",r.JOB_DETAIL="/api_v1/job",r.JOB_KILL="/api_v1/job/kill",r.SAVE_SCRIPT_FILE="/api_v1/script_file",r.ANALYSIS_TABLES="/api_v1/analysis/tables",r.ANALYSIS_TABLE_INFO="/api_v1/analysis/table/get",r.ANALYSIS_SAVE="/api_v1/analysis/tables/save",r.APP_INFO="/api_v1/app",r.APP_SAVE="/api_v1/app/save",r.REGISTER="/api_v1/user/register",r.LOGIN="/api_v1/user/login",r.LOGOUT="/api_v1/user/logout",r.ENGINE_ADD="/api_v1/engine/add",r.ENGINE_LIST="/api_v1/engine/list",r.SCRIPT_FILE_LIST="/api_v1/script_file",r.SCRIPT_FILE_GET="/api_v1/script_file/get",r.SCRIPT_FILE_REMOVE="/api_v1/script_file/remove",r.PLUGIN_LIST="/api_v1/plugin/list",r.PLUGIN_GET="/api_v1/plugin/get",r.USER_EXTRA="/api_v1/user/extra/update"},32:function(e,t,a){"use strict";a.r(t);var n=a(5),r=a.n(n),o=a(8),c=a(7),i=a(12),s=a(20),l=a(83),u=function e(){Object(c.a)(this,e)};u.USER_NAME="userName",u.USER_ID="userId",u.ADMIN_TOKEN="admin_token",u.LOGIN_TOKEN="access-token";var p=function e(t,a,n){Object(c.a)(this,e),this.status=t,this.content=a,this.resp=n},d=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(c.a)(this,e),this.url=t,this.url||(this.url=l.b),this.fetch_config=a}return Object(i.a)(e,[{key:"request",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a){var n,o,c,i,d,m,f,h,b,g,v,y,E=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i in n=(n=E.length>2&&void 0!==E[2]?E[2]:"GET").toUpperCase(),(o=sessionStorage.getItem(u.USER_NAME))&&(a[u.USER_NAME]=o),c=[],a)d=encodeURIComponent(i),m=encodeURIComponent(a[i]),c.push(d+"="+m);return f=this.url+t,c.length>0&&(f+="?"),"GET"===n?(f+=c.join("&"),c=void 0):c=c.join("&"),h={method:n,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(l.a)||""},body:c},b=Object(s.a)({},h,this.fetch_config),e.prev=11,e.next=14,fetch(f,b);case 14:if((g=e.sent).ok){e.next=20;break}return e.next=18,g.text();case 18:return v=e.sent,e.abrupt("return",new p(g.status,v));case 20:return e.next=22,g.json();case 22:return y=e.sent,e.abrupt("return",new p(200,y,g));case 26:return e.prev=26,e.t0=e.catch(11),e.abrupt("return",new p(500,e.t0,void 0));case 29:case"end":return e.stop()}},e,this,[[11,26]])}));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),m=a(31);a.d(t,"ActionProxy",function(){return f});var f=function(){function e(){Object(c.a)(this,e),this.backend=new d}return Object(i.a)(e,[{key:"userName",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(m.default.USER_NAME,{});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"runScript",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a,n){var o,c,i,s,l,u;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userName();case 2:if(200===(o=e.sent).status){e.next=5;break}return e.abrupt("return",o);case 5:return c=o.content,i=c.userName,s=c.backendTags,l={sql:t,owner:i,jobName:a,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:s||""},Object.assign(l,n),e.next=10,this.post(m.default.RUN,l);case 10:return u=e.sent,e.abrupt("return",u);case 12:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.backend.request(t,a,l.c.GET);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.backend.request(t,a,l.c.POST);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}]),e}();f.client=new f},377:function(e,t,a){},392:function(e,t,a){},448:function(e,t,a){},449:function(e,t,a){},450:function(e,t,a){},451:function(e,t,a){},452:function(e,t,a){},561:function(e,t,a){e.exports=a(1112)},567:function(e,t,a){},568:function(e,t,a){},571:function(e,t,a){},572:function(e,t,a){},757:function(e,t,a){},76:function(e,t,a){"use strict";a.r(t),a.d(t,"SetStateActionHandler",function(){return s}),a.d(t,"SetStateAction",function(){return l});var n=a(5),r=a.n(n),o=a(20),c=a(8),i=a(25).a.buildHandler(function(){var e=Object(c.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:Object(o.a)({},t.data)});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),s=i.handler,l=i.action},760:function(e,t,a){},83:function(e,t,a){"use strict";a.d(t,"b",function(){return r}),a.d(t,"c",function(){return o}),a.d(t,"a",function(){return c});var n=a(7),r="",o=function e(){Object(n.a)(this,e)};o.GET="get",o.POST="post",o.PUT="put",o.DELETE="delete";var c={name:"access-token"}}},[[561,1,2]]]);
//# sourceMappingURL=main.529ef6f3.chunk.js.map