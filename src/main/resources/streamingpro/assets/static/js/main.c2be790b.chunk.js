(this["webpackJsonpmlsql-web-console"]=this["webpackJsonpmlsql-web-console"]||[]).push([[0],{105:function(e,t,a){"use strict";a.r(t),a.d(t,"SetStateActionHandler",(function(){return l})),a.d(t,"SetStateAction",(function(){return i}));var n=a(3),r=a.n(n),s=a(9),o=a(7);const c=a(13).a.buildHandler(function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:Object(s.a)({},t.data)});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l=c.handler,i=c.action},1067:function(e,t,a){},1068:function(e,t,a){},1078:function(e,t,a){},1082:function(e,t,a){},1083:function(e,t,a){},1085:function(e,t,a){},11:function(e,t,a){"use strict";a.r(t),a.d(t,"ActionProxy",(function(){return m}));var n=a(3),r=a.n(n),s=a(7),o=a(9),c=a(84);class l{}l.USER_NAME="userName",l.USER_ID="userId",l.ADMIN_TOKEN="admin_token",l.LOGIN_TOKEN="access-token";class i{constructor(e,t,a){this.status=e,this.content=t,this.resp=a}}class u{constructor(e,t={}){this.url=e,this.url||(this.url=c.b),this.fetch_config=t}request(e,t,a="GET"){var n=this;return Object(s.a)(r.a.mark((function s(){var u,p,m,d,h,b,f,E,g,y,v;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(m in a=a.toUpperCase(),(u=sessionStorage.getItem(l.USER_NAME))&&(t[l.USER_NAME]=u),p=[],t)d=encodeURIComponent(m),h=encodeURIComponent(t[m]),p.push(d+"="+h);return b=n.url+e,p.length>0&&(b+="?"),"GET"===a?(b+=p.join("&"),p=void 0):p=p.join("&"),f={method:a,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(c.a)||""},body:p},E=Object(o.a)(Object(o.a)({},f),n.fetch_config),r.prev=10,r.next=13,fetch(b,E);case 13:if((g=r.sent).ok){r.next=19;break}return r.next=17,g.text();case 17:return y=r.sent,r.abrupt("return",new i(g.status,y));case 19:return r.next=21,g.json();case 21:return v=r.sent,r.abrupt("return",new i(200,v,g));case 25:return r.prev=25,r.t0=r.catch(10),r.abrupt("return",new i(500,r.t0,void 0));case 28:case"end":return r.stop()}}),s,null,[[10,25]])})))()}}var p=a(12);class m{constructor(){this.backend=new u}userName(){var e=this;return Object(s.a)(r.a.mark((function t(){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(p.default.USER_NAME,{});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()}runScript(e,t,a){var n=this;return Object(s.a)(r.a.mark((function s(){var o,c,l,i,u,m;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.userName();case 2:if(200===(o=r.sent).status){r.next=5;break}return r.abrupt("return",o);case 5:return c=o.content,l=c.userName,i=c.backendTags,u={sql:e,owner:l,jobName:t,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:i||""},Object.assign(u,a),r.next=10,n.post(p.default.RUN,u);case 10:return m=r.sent,r.abrupt("return",m);case 12:case"end":return r.stop()}}),s)})))()}get(e,t){var a=this;return Object(s.a)(r.a.mark((function n(){var s;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.backend.request(e,t,c.c.GET);case 2:return s=n.sent,n.abrupt("return",s);case 4:case"end":return n.stop()}}),n)})))()}post(e,t){var a=this;return Object(s.a)(r.a.mark((function n(){var s;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.backend.request(e,t,c.c.POST);case 2:return s=n.sent,n.abrupt("return",s);case 4:case"end":return n.stop()}}),n)})))()}}m.client=new m},1138:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(20),o=a.n(s);a(585),a(586),a(587);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=a(3),l=a.n(c),i=a(7),u=a(8),p=(a(589),a(29)),m=a(13),d=a(11),h=a(12),b=a(84);const f=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("logout"!==t.data.currentPage){e.next=7;break}return a=new d.ActionProxy,e.next=4,a.post(h.default.LOGOUT,{});case 4:return sessionStorage.removeItem(b.a.name),sessionStorage.removeItem("user"),e.abrupt("return",{data:{currentPage:"admin",logined:!1}});case 7:return e.abrupt("return",{data:{currentPage:t.data.currentPage}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),E=f.handler,g=f.action;var y=a(9),v=a(278);var w=class{static setupLogin(e){const t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags},a=e.resp.headers.get(b.a.name);sessionStorage.setItem(b.a.name,a),sessionStorage.setItem("user",JSON.stringify(t));(new v.a).set(b.a.name,a,{path:"/"})}static updateUser(e){const t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags};sessionStorage.setItem("user",JSON.stringify(t))}static extraOption(){const e=sessionStorage.getItem("user");if(!e)return{};try{return JSON.parse(JSON.parse(e).extraOption)||{}}catch(t){return{}}}static isAdmin(){const e=sessionStorage.getItem("user");if(!e)return!1;return"admin"===JSON.parse(e).role}static logined(){return!!sessionStorage.getItem(b.a.name)}static formLayout2(){return{formItemLayout:{labelCol:{xs:{span:4},sm:{span:8}},wrapperCol:{xs:{span:4},sm:{span:8}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}static formLayout1(){return{formItemLayout:{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}};const k=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="indexer_manager","register"!==t.__state.currentPage||w.logined()||(a="register"),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{logined:w.logined(),currentPage:a})});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),x=k.handler,S=k.action;var O=a(105);class j{}j.SWITCH="switch",j.CHECK_LOGINED="checkLogined";const T={[j.SWITCH]:E,[j.CHECK_LOGINED]:x,setState:O.SetStateActionHandler};function N(e,t){switch(t.type){case j.SWITCH:return g(e,t.data);case j.CHECK_LOGINED:return S(e,t.data);case"setState":return Object(O.SetStateAction)(e,t.data);default:return e}}a(590);var C=a(63),_=a(1156),I=a(1142),P=a(478),A=a(479),D=a(500),R=a(480),F=a(481),L=a(482),M=a(483),q=a(167),V=a.n(q),B=a(1143);const G=C.a.SubMenu,U=r.a.createContext();function J(e){const t=e.currentPage,a=e.userLogined,s=e.isUserAdmin,o=e.appInfo,c=Object(n.useContext)(Di).dispacher,l=Object(n.useState)(t),i=Object(u.a)(l,2),p=i[0],d=i[1],h=Object(n.useState)(a),b=Object(u.a)(h,2),f=b[0],E=b[1],g=Object(n.useState)(s),y=Object(u.a)(g,2),v=y[0],w=y[1],k=Object(n.useState)(void 0),x=Object(u.a)(k,2),S=x[0],O=x[1],T=Object(n.useState)(!1),N=Object(u.a)(T,2),q=(N[0],N[1],Object(n.useRef)());return Object(n.useEffect)(()=>{const t=e.currentPage,a=e.userLogined,n=e.isUserAdmin;d(t),E(a),w(n)},[e]),r.a.createElement(U.Provider,null,r.a.createElement(V.a,{title:"Confirm",visible:S||!1,onCancel:()=>{O(void 0)},onOk:()=>{O(void 0),d(q.current),c(m.a.buildEvent(j.SWITCH,{currentPage:q.current}))},cancelText:"Cancel",okText:"Leave"},r.a.createElement(_.a,{description:S,type:"info"})),r.a.createElement(C.a,{onClick:e=>{if("home"===e.key)return e.domEvent.preventDefault(),void e.domEvent.stopPropagation();f&&"workshop"===p&&"workshop"!==e.key?(q.current=e.key,O("Do you wanna leave workshop? Please make sure you have saved your work before you leave.")):(d(e.key),c(m.a.buildEvent(j.SWITCH,{currentPage:e.key})))},selectedKeys:[p],mode:"horizontal"},r.a.createElement(C.a.Item,{key:"home"},r.a.createElement("span",{style:{fontSize:32}},"MLSQL Web Console"),r.a.createElement("span",{style:{fontSize:11}},"(Build 20201224.122811)")),r.a.createElement(I.a,{type:"vertical"}),!f&&r.a.createElement(C.a.Item,{key:"login",icon:r.a.createElement(P.a,null)},r.a.createElement(B.a,{id:"login"})),!f&&r.a.createElement(C.a.Item,{key:"register",icon:r.a.createElement(A.a,null)},r.a.createElement(B.a,{id:"register"})),f&&o.enableConsole&&r.a.createElement(C.a.Item,{key:"console",icon:r.a.createElement(D.a,null)},r.a.createElement(B.a,{id:"console"})),f&&r.a.createElement(C.a.Item,{key:"workshop",icon:r.a.createElement(R.a,null)},r.a.createElement(B.a,{id:"analysis_workshop"})),f&&r.a.createElement(C.a.Item,{key:"indexer_manager",icon:r.a.createElement(R.a,null)},r.a.createElement(B.a,{id:"indexer_manager"})),f&&r.a.createElement(C.a.Item,{key:"settings",icon:r.a.createElement(F.a,null)},r.a.createElement(B.a,{id:"settings"})),f&&v&&r.a.createElement(C.a.Item,{key:"admin",icon:r.a.createElement(F.a,null)},r.a.createElement(B.a,{id:"admin"})),f&&r.a.createElement(G,{icon:r.a.createElement(L.a,null),title:r.a.createElement(B.a,{id:"more"})},r.a.createElement(C.a.Item,{key:"doc"},"\u4e2d\u6587\u6587\u6863"),r.a.createElement(C.a.Item,{key:"engine"},"Engine"),r.a.createElement(C.a.Item,{key:"logout",icon:r.a.createElement(M.a,null)},"Logout"))))}var K=a(1161),H=a(1150),Q=a(554),W=a(55);a(386);const z=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,n=a.userName,r=a.password,s=a.password2,r===s){e.next=3;break}return e.abrupt("return",{data:{error:"Passwords are not matched"}});case 3:return o=new d.ActionProxy,e.next=6,o.post(h.default.REGISTER,{userName:n,password:r});case 6:return c=e.sent,i={},200!==c.status?i={error:JSON.parse(c.content).msg}:(w.setupLogin(c),i={error:void 0,logined:!0,current:t.__state.current+1}),e.abrupt("return",{data:i});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Y=z.handler,X=z.action,$=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.post(h.default.LOGIN,t.data);case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",{data:{logined:!1,error:JSON.parse(n.content).msg}});case 6:return w.setupLogin(n),e.abrupt("return",{data:{logined:!0}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Z=$.handler,ee=$.action;class te{}te.REGISTER="register",te.LOGIN="login";const ae={[te.REGISTER]:Y,[te.LOGIN]:Z};function ne(e,t){switch(t.type){case te.REGISTER:return X(e,t.data);case te.LOGIN:return ee(e,t.data);default:return e}}var re=a(77),se=a(73);function oe(){const e=Object(re.a)(["\n  width: 100%;    \n  margin: 0px 10px 10px 0px;\n"]);return oe=function(){return e},e}const ce=se.a.div(oe());var le=function(e){return r.a.createElement(ce,null,r.a.createElement(_.a,Object.assign({},e,{closable:!0,type:e.type||"error",message:e.title||"Message",description:e.message})))};const ie=r.a.createContext(),ue={logined:!1,error:void 0};function pe(){const e=Object(n.useContext)(Di).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout,o=Object(p.useReducerAsync)(ne,ue,ae),c=Object(u.a)(o,2),l=c[0],i=c[1],m=l.logined,d=l.error;return Object(n.useEffect)(()=>{e({type:j.CHECK_LOGINED,data:{}})},[m]),r.a.createElement(ie.Provider,{value:{}},r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(K.a,{title:"Register"},d&&r.a.createElement(le,{type:"error",message:d}),r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:e=>{i({type:te.REGISTER,data:e})}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,s,r.a.createElement(W.a,{type:"primary",htmlType:"submit"},"Go"))))))}const me={logined:!1,error:void 0},de=r.a.createContext();function he(){const e=w.formLayout1(),t=e.formItemLayout,a=e.tailLayout,s=Object(n.useContext)(Di).dispacher,o=Object(p.useReducerAsync)(ne,me,ae),c=Object(u.a)(o,2),l=c[0],i=c[1],d=l.logined,h=l.error;return Object(n.useEffect)(()=>{s({type:j.CHECK_LOGINED,data:{logined:d}})},[d]),r.a.createElement(de.Provider,null,r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(K.a,{title:"Login"},h&&r.a.createElement(le,{type:"error",message:h}),r.a.createElement(H.a,Object.assign({},t,{className:"login-form",onFinish:e=>{i(m.a.buildEvent(te.LOGIN,e))}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,a,r.a.createElement(W.a,{type:"primary",htmlType:"submit"},"Go"))))))}a(191),a(301);var be=a(61),fe=a.n(be);a(400),a(302),a(303);const Ee=a(11).ActionProxy,ge=a(12).default;class ye{static getSuggestList(e,t,a){return Object(i.a)(l.a.mark((function n(){var r,s,o;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new Ee,n.next=3,r.post(ge.RUN,{executeMode:"autoSuggest",sql:e,lineNum:t+1,columnNum:a,isDebug:!1,queryType:"robot"});case 3:if(!(s=n.sent)||200!==s.status){n.next=9;break}return o=s.content,n.abrupt("return",o);case 9:return n.abrupt("return",[]);case 10:case"end":return n.stop()}}),n)})))()}}a(401);var ve=a(1152);const we="get",ke="post",xe=401,Se="access-token",Oe="/api_v1/run/script";class je{isLogin(){return null!==sessionStorage.getItem(Se)}userName(e){new _e("/api_v1/user/userName").request(we,{},t=>{t.status===xe?sessionStorage.removeItem(Se):t.content.then(t=>{e(JSON.parse(t).userName)}).catch(e=>{})},e=>{console.log(e)})}user(e){new _e("/api_v1/user/userName").request2({},t=>{e(t)},e=>{})}login(e,t,a,n){this.registerOrLogin("/api_v1/user/login",e,t,a,n)}logout(){sessionStorage.removeItem(Se)}register(e,t,a,n){this.registerOrLogin("/api_v1/user/register",e,t,a,n)}registerOrLogin(e,t,a,n,r){const s={userName:t,password:a};new _e(e).request(ke,s,e=>{if(e.accessToken){sessionStorage.setItem(Se,e.accessToken);(new v.a).set(Se,e.accessToken,{path:"/"})}n(e)},e=>{r(e)})}}const Te=a(107);class Ne{constructor(e){this.value=e}}class Ce{constructor(e,t,a){this.json=(e,t)=>{this.content.then(a=>{try{const t=JSON.parse(a);e(t)}catch(n){console.log(n),t(a)}})},this.status=e,this.content=t,this.accessToken=a}}class _e{constructor(e){this.url=e}request2(e,t,a){this.request(ke,e,e=>{e.json(e=>{t(e)},e=>{a(e)})},e=>{try{e.value().content(e=>{let t=e;try{t=JSON.parse(e).msg}catch(n){}a(t)})}catch(t){a(e?e.toString():"result is null")}})}runScript(e,t,a,n){const r=new je,s=Te(),o=this;r.user(r=>{const c=r.userName,l=r.backendTags,i={sql:t,owner:c,jobName:s,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""};Object.assign(i,e);(e.background||!1)&&Object.assign(i,{async:!0,callback:""}),o.request(ke,i,e=>{if(200===e.status)e.json(e=>{a(e)},e=>{n(e)});else try{e.content.then(t=>{let a=t;try{a=JSON.parse(t).msg}catch(r){}n("backend status:"+e.status+"\n"+a)})}catch(t){n("backend status:"+e.status)}},e=>{try{e.value().content(e=>{let t=e;try{t=JSON.parse(e).msg}catch(a){}n(t)})}catch(t){n(e?e.toString():"result is null")}})})}request(e,t,a,n){e=e.toUpperCase();let r=[];for(let o in t){let e=encodeURIComponent(o),a=encodeURIComponent(t[o]);r.push(e+"="+a)}let s=this.url;return"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&"),fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(Se)||""},body:r}).then(e=>{a(new Ce(e.status,e.text(),e.headers.get(Se)))}).catch(e=>{n(new Ne(e))})}newRunScript(e,t,a,n){const r=new je,s=Te(),o=this;r.user(r=>{const c=r.userName,l=r.backendTags;if(!l)return void n("\n                \n                ---------------Warning--------------------\n                \n                Please make sure you have backend configured. \n                If not, please contact admin;\n                \n                ------------------------------------------\n                ");const i={sql:t,owner:c,jobName:s,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""};Object.assign(i,e);(e.background||!1)&&Object.assign(i,{async:!0,callback:""}),o.new_request(ke,i,a,n)})}new_request(e,t,a,n){e=e.toUpperCase();let r=[];for(let c in t){let e=encodeURIComponent(c),a=encodeURIComponent(t[c]);r.push(e+"="+a)}let s=this.url;"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&");let o=0;return fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(Se)||""},body:r}).then(e=>(o=e.status,200===o&&e.json().then(e=>{a(e)}),e)).then(e=>{const t=()=>{e.text().then(e=>{try{n(JSON.parse(e).msg)}catch(t){n(e)}})};switch(o){case 201:break;case 400:case 500:t();break;default:console.log("unhandled")}}).catch(e=>{n(e.message)})}}class Ie{constructor(){this.makeSQL=e=>"JobList"===e?"load _mlsql_.`jobs` as output;":"ConnectMySQL"===e?'connect jdbc where\n url="jdbc:mysql://127.0.0.1:3306/wow?characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false"\n and driver="com.mysql.jdbc.Driver"\n and user=""\n and password=""\n as db_1;':"ShowResource"===e?"load _mlsql_.`resource` as output;":""}}var Pe=a(204),Ae=a(80);class De extends class{constructor(e){this.inner=e,this.session=this.inner.editor.session,this.editor=this.inner.editor}setText(e){return this.editor.setValue(e),this}append(e){return this.session.insert({row:this.session.getLength(),column:0},"\n"+e),this}insertAfterCursor(e){const t=this.editor.getCursorPosition();return this.session.insert(t,e),this.editor.focus(),this}}{constructor(e){super(e)}getText(){return this.editor.getValue()}getSelection(){let e=this.editor.getSelectionRange();return this.session.getTextRange(e)}}const Re=a(107),Fe=new d.ActionProxy;class Le{static ls(e){return Object(i.a)(l.a.mark((function t(){var a,n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new d.ActionProxy,t.next=3,a.runScript("!hdfs -ls -F ".concat(e,";"),Re(),{queryType:"robot"});case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()}static killJob(e){return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.runScript("!kill "+e+";",Re(),{queryType:"robot"});case 2:return a=t.sent,t.next=5,Fe.get(h.default.JOB_KILL,{jobName:e});case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))()}static runJob(e,t=!1){return Object(i.a)(l.a.mark((function a(){var n;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Fe.runScript(e,Re(),{async:t});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}}),a)})))()}static showFunctions(){return Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe.runScript("",Re(),{executeMode:"sqlFunctions"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}static jobs(){return Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Re(),e.next=3,Fe.runScript("load _mlsql_.`jobs` as wow;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",{jobName:t,res:a});case 5:case"end":return e.stop()}}),e)})))()}static tablesInDeltaLake(){return Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Re(),e.next=3,Fe.runScript("!delta show tables;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))()}static tablesInWorkshop(){return Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe.get(h.default.ANALYSIS_TABLES,{});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}static tableInfo(e){return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.get(h.default.ANALYSIS_TABLE_INFO,{tableName:e});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()}static jobProgress(e){return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.runScript("load _mlsql_.`jobs/get/".concat(e,"` as wow;"),Re(),{queryType:"robot"});case 2:if(a=t.sent,n={currentJobIndex:0,totalJobs:1},200!==a.status){t.next=17;break}if(r=a.content[0]){t.next=8;break}return t.abrupt("return",n);case 8:if(s=r.progress.currentJobIndex,1!==(o=r.progress.totalJob)){t.next=16;break}return t.next=13,Fe.runScript("load _mlsql_.`jobs/".concat(e,"` as wow;"),Re(),{queryType:"robot"});case 13:c=t.sent,s=c.content[0].completedJobsNum,o=c.content[0].activeJobsNum+s;case 16:return t.abrupt("return",{currentJobIndex:s,totalJobs:o});case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}}),t)})))()}static currentSQL(e){return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.runScript("load _mlsql_.`jobs/get/".concat(e,"` as wow;"),Re(),{queryType:"robot"});case 2:if(a=t.sent,n={currentJobIndex:0,totalJobs:1,script:"",isFinish:!0},200!==a.status){t.next=14;break}if(r=a.content[0]){t.next=8;break}return t.abrupt("return",n);case 8:return s=r.progress.currentJobIndex,o=r.progress.totalJob,c=r.progress.script,t.abrupt("return",{currentJobIndex:s,totalJobs:o,script:c,isFinish:!1});case 14:return t.abrupt("return",n);case 15:case"end":return t.stop()}}),t)})))()}static jobProgress2(e){return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.runScript("load _mlsql_.`jobs/v2/".concat(e,"` as wow;"),Re(),{queryType:"robot"});case 2:return a=t.sent,t.abrupt("return",a.content[0]);case 4:case"end":return t.stop()}}),t)})))()}static resourceInfo(){return Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe.runScript("load _mlsql_.`resource` as output;",Re(),{queryType:"robot"});case 2:return t=e.sent,a=t.content[0].totalCores,n=t.content[0].activeTasks,e.abrupt("return",{activeTasks:n,totalCores:a});case 6:case"end":return e.stop()}}),e)})))()}}const Me=a(107);class qe{constructor(e){this.enterLoading=()=>{this.commandGroupRef.setState({loading:!0})},this.exitLoading=()=>{this.commandGroupRef.setState({loading:!1})},this.queryPanel=e,this.client=new d.ActionProxy,this.jobName=Me(),this.editorOp=this.queryPanel.getEditorOp(),this.consoleOp=this.queryPanel.getConsoleOp();const t=this.editorOp.getSelection();this.sql=t||this.editorOp.getText(),this.commandGroupRef=this.queryPanel.commandGroup.current,this.jobProgressRef=this.queryPanel.jobProgressRef,this.taskProgressRef=this.queryPanel.taskProgressRef.current,this.displayRef=this.queryPanel.queryApp.display.current,this.dashRef=this.queryPanel.queryApp.dash.current,this.timeout=this.commandGroupRef.state.timeout,this.logInfo={},this.closed=!1}log(e){return this.consoleOp.append(e),this}prepare(){this.enterLoading(),this.consoleOp.setText(""),this.displayRef.update(JSON.parse("[]"))}measureTime(e){this.exitLoading();return(new Date).getTime()-e}saveFile(e){var t=this;return Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.queryPanel.state.scriptId){e.next=4;break}return t.log("No file are opened, cannot execute save action"),e.abrupt("return");case 4:return e.next=6,t.client.post(h.default.SAVE_SCRIPT_FILE,{id:a,content:t.editorOp.getText()});case 6:return 200!==(n=e.sent).status&&t.log(n.content),200===n.status&&t.log("File[".concat(a,"] have been saved.")),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))()}run(e){var t=this;return Object(i.a)(l.a.mark((function a(){var n,r;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.prepare(),n=(new Date).getTime(),a.next=4,t.client.runScript(t.sql,t.jobName,Object.assign(e,{jobName:t.jobName,async:!0,timeout:t.timeout,engineName:t.queryPanel.engineName}));case 4:if(200===(r=a.sent).status){a.next=8;break}return t.log("Fail to submit job\nTime cost:"+t.measureTime(n)+"ms"),a.abrupt("return",[]);case 8:return t.intervalTimer=setInterval(Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.monitorJob();case 2:return e.next=4,t.monitorLog();case 4:case"end":return e.stop()}}),e)}))),1e3),t.dashRef.queryHistory&&t.dashRef.queryHistory.reload(),t.jobProgressRef.enter(),a.abrupt("return",r);case 12:case"end":return a.stop()}}),a)})))()}cancelMonitor(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.intervalTimer&&(clearInterval(e.intervalTimer),e.intervalTimer=null),e.jobProgressRef.exit();case 2:case"end":return t.stop()}}),t)})))()}monitorJob(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.client.get(h.default.JOB_DETAIL,{jobName:e.jobName});case 2:a=t.sent,3===(n=a.content).status&&(e.closed=!0,e.cancelMonitor(),e.exitLoading(),e.jobProgressRef.exit(),e.log(n.reason)),2===n.status&&(e.closed=!0,e.cancelMonitor(),e.exitLoading(),e.jobProgressRef.exit(),r=JSON.parse(n.response),e.displayRef.update(r),e.queryPanel.queryApp.setData(r));case 6:case"end":return t.stop()}}),t)})))()}monitorLog(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Me(),t.next=3,e.client.runScript("load _mlsql_.`log/".concat(e.logInfo.offset||-1,'` where filePath="engine_log" as output;'),a,{queryType:"robot"});case 3:if(200===(n=t.sent).status){t.next=6;break}return t.abrupt("return");case 6:(r=n.content[0]).value&&r.value.length>0&&e.log(r.value.map(e=>e.split("__MMMMMM__")[1]).join("\n")),e.logInfo.offset=r.offset;case 9:case"end":return t.stop()}}),t)})))()}killJob(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.jobName){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Le.killJob(e.jobName);case 4:a=t.sent;try{e.log(a.content[0].description)}catch(n){e.log(a.content)}e.closed=!0,e.jobName=null,e.cancelMonitor(),e.exitLoading();case 10:case"end":return t.stop()}}),t)})))()}}var Ve=a(285),Be=a.n(Ve),Ge=a(1151),Ue=a(1147);class Je extends n.Component{constructor(e){var t;super(e),t=this,this.enter=e=>{this.setState({loading:!0,jobs:{},dataSource:[],currentSQL:{},totalTime:"0s",currentJobGroup:""}),this.intervalTimer=setInterval(Object(i.a)(l.a.mark((function e(){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.queryPanel.executor.jobName,e.next=3,Le.currentSQL(t.state.currentJobGroup||a);case 3:return n=e.sent,e.next=6,Le.jobProgress2(t.state.currentJobGroup||a);case 6:(r=e.sent).activeJobs&&0!==r.activeJobs.length&&(t.state.currentJobGroup||t.setState({currentJobGroup:r.groupId}),t.makeProgress(r,n));case 8:case"end":return e.stop()}}),e)}))),1e3)},this.exit=()=>{this.intervalTimer&&(setTimeout(()=>{clearInterval(this.intervalTimer),this.intervalTimer=null},3e3),this.finalTime=this.state.totalTime,this.setState({loading:!1}))},this.makeProgress=(e,t)=>{if(e.activeJobs){const a=e.activeJobs.map(e=>({jobId:e.jobId,duration:e.duration,total:e.numTasks-e.numSkippedTasks,numKilledTasks:e.numKilledTasks,skipped:e.numSkippedTasks,failed:e.numFailedTasks,completed:e.numCompletedIndices,started:e.numActiveTasks})).map(t=>{const a=parseInt(t.completed/t.total*100+"");let n="";0===t.failed&&0===t.skipped&&t.started>0&&(n+="(".concat(t.started," running)")),t.failed>0&&(n+="(".concat(t.failed," failed)")),t.skipped>0&&(n+="(".concat(t.skipped," skipped)")),t.numKilledTasks>0&&(n+="(".concat(t.numKilledTasks," killed)"));let r=t.duration+" ms";return t.duration>1e3&&(r=parseInt(t.duration/1e3+"")+" s"),{title:"".concat(t.jobId,"(").concat(e.groupId,")"),duration:r,tasks:"".concat(t.completed,"/").concat(t.total).concat(n),progress:a}});let n=t;if(t.isFinish&&(n=this.state.currentSQL,n.currentJobIndex=n.totalJobs),this.timer){const e=(this.timer.getTime()/1e3).toFixed(2)+"s";return void this.setState({dataSource:a,currentSQL:n,totalTime:e})}this.setState({dataSource:a,currentSQL:n})}},this.showSQL=()=>this.state.currentSQL.currentJobIndex&&n.createElement("h3",null,"sql: [",this.state.currentSQL.currentJobIndex,"/",this.state.currentSQL.totalJobs,": ",this.state.currentSQL.script,"]"),this.queryPanel=e.parent,this.state={loading:!1,jobs:{},dataSource:[],currentSQL:{},totalTime:"0s",currentJobGroup:""},this.columns=[{title:"Job Id(Job Group)",dataIndex:"title",key:"title"},{title:"Duration",dataIndex:"duration",key:"duration"},{title:"Tasks(for all stages)\uff1a Succeeded/Total",dataIndex:"tasks",key:"tasks",render:(e,t,a)=>{const r=2*t.progress;return n.createElement("div",null,n.createElement("div",{style:{position:"relative",width:"200px",height:"30px",backgroundColor:"yellow"}},n.createElement("div",{style:{position:"relative",top:"0px",right:"0px",width:r+"px",height:"100%",backgroundColor:"rgba(27,163,232,100)"}}),n.createElement("div",{style:{position:"absolute",top:"4px",textAlign:"center",width:"100%"}},e)))}}]}render(){return this.state.loading?n.createElement("div",null,n.createElement(W.a,{type:"primary",style:{margin:"0px 0px 20px 0px"}},"Time Cost:",n.createElement(Be.a,{ref:e=>this.timer=e},n.createElement(Be.a.Minutes,{formatValue:e=>"".concat(e," m. ")}),n.createElement(Be.a.Seconds,{formatValue:e=>"".concat(e," s. ")}))),n.createElement("div",null,n.createElement(Ge.a,{defaultActiveKey:["1"]},n.createElement(Ge.a.Panel,{header:this.showSQL(),key:"1"},n.createElement(Ue.a,{dataSource:this.state.dataSource,columns:this.columns}))))):this.finalTime?n.createElement("div",null,n.createElement(W.a,{type:"primary",style:{margin:"0px 0px 20px 0px"}},"Time Cost: ",this.finalTime),n.createElement("div",null,n.createElement(Ge.a,{defaultActiveKey:["1"]},n.createElement(Ge.a.Panel,{header:this.showSQL(),key:"1"},n.createElement(Ue.a,{dataSource:this.state.dataSource,columns:this.columns}))))):n.createElement("div",null)}}a(790);class Ke extends n.Component{constructor(e){super(e),this.enter=e=>{},this.exit=()=>{},this.queryPanel=e.parent,this.state={percent:0}}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Le.resourceInfo();case 2:return a=t.sent,n=a.activeTasks,r=a.totalCores,t.next=7,Le.jobs();case 7:s=t.sent,o=s.jobName,c=s.res,i=c.content.filter(e=>e.jobName!==o).length,e.setState({percent:n/r*100,totalCores:r,activeTasks:n,jobNum:i});case 12:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"rp-main"},n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"CPU Usage(total cores:",this.state.totalCores,"): "),n.createElement(ve.a,{percent:this.state.percent,style:{maxWidth:"300px"}})),n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"Jobs Running: ",n.createElement("span",null,this.state.jobNum))))}}function He(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=(a[0],a[1],Object(n.useState)([])),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)(!1),b=Object(u.a)(m,2),f=(b[0],b[1]),E=Object(n.useState)(void 0),g=Object(u.a)(E,2),y=g[0],v=g[1];Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),t=new d.ActionProxy,e.next=4,t.get(h.default.ENGINE_LIST,{});case 4:a=e.sent,p(a.content.data),n=w.extraOption().backend,a.content.data.length>0&&!n&&v(a.content.data[0].name),f(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(()=>{e.useEngine(y)},[y,e]);return r.a.createElement(Pe.a,{onChange:e=>{v(e)},style:{width:"120px"}},c.map(e=>r.a.createElement(Pe.a.Option,{value:e.name},e.name)))}const Qe=Pe.a.Option;a(107);class We extends n.Component{constructor(e){var t;super(e),t=this,this.text=(e,t)=>{this.setState({value:e,scriptId:t},()=>{this.aceEditorRef.current.editor.setValue(e,1)})},this.executeSave=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new qe(t),e.next=3,a.saveFile({});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))),this.getAllText=()=>this.getAceEditor().getValue(),this.getSelection=()=>this.getEditorOp().getSelection(),this.appendToEditor=e=>this.getEditorOp().insertAfterCursor(e),this.getEditorOp=()=>new De(this.aceEditorRef.current),this.getConsoleOp=()=>new De(this.queryApp.messageBox.current),this.getAceEditor=()=>this.getEditorOp().editor,this.getMessageBoxAceEditor=()=>this.getConsoleOp().editor,this.appendLog=e=>this.getConsoleOp().append(e),this.getDashBoard=()=>this.queryApp.dash.current,this.getDisplay=()=>this.queryApp.display.current,this.enterLoading=e=>{this.commandGroup.current.setState({loading:!0}),this.resourceProgressRef.current.enter({jobName:e}),this.jobProgressRef.enter({jobName:e})},this.exitLoading=()=>{this.commandGroup.current.setState({loading:!1}),this.jobProgressRef.exit(),this.resourceProgressRef.current.exit()},this.etOver=e=>{const t=this.queryApp.etRef.current,a=t.getData("eventName"),n=t.getData("popName"),r=t.getData("processType"),s=t.getData("pathAlias"),o=t.getData("tableHidden"),c=t.getData("pathHidden"),l=t.getData("outputTableHidden"),i=t.getData("outputTableAlias"),u=t.getData("tableAlias");"direct"===r?this.appendToEditor((new Ie).makeSQL(a)):t.setState({etPop:!0,eventName:a,popName:n,processType:r,pathAlias:s,tableHidden:o,pathHidden:c,outputTableHidden:l,outputTableAlias:i,tableAlias:u})},this.language=this.props.language||"sql",this.queryApp=this.props.parent,this.aceEditorRef=n.createRef(),this.commandGroup=n.createRef(),this.taskProgressRef=n.createRef(),this.cancelQuery=this.cancelQuery.bind(this),this.executeQuery=this.executeQuery.bind(this),this.state={value:"",loading:!1}}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this);var e={getCompletions:function(){var e=Object(i.a)(l.a.mark((function e(t,a,n,r,s){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye.getSuggestList(t.getValue(),n.row,n.column);case 2:o=e.sent,s(null,o.map((function(e){let t="";return"desc"in e.extra&&(t=e.extra.desc),{caption:e.name,value:e.name,meta:t}})));case 4:case"end":return e.stop()}}),e)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()};this.getAceEditor().completers=[e]}onChange(e){}executeQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.executor||e.executor.closed){t.next=4;break}return e.log("Job ".concat(e.jobName," is still running.")),e.log("Try to kill this job or wait it to finish"),t.abrupt("return");case 4:return e.executor=new qe(e),t.next=7,e.executor.run({});case 7:return a=t.sent,e.executor.closed||(e.executor.closed=!0),t.abrupt("return",a);case 10:case"end":return t.stop()}}),t)})))()}cancelQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.executor&&e.executor.killJob();case 1:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:e=>e.preventDefault(),onDrop:this.etOver},n.createElement(Ae.Resizable,{defaultSize:{height:"500px"},onResize:()=>{this.aceEditorRef.current.editor.resize()}},n.createElement(fe.a,{ref:this.aceEditorRef,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(ze,{ref:this.commandGroup,parent:this}),n.createElement(Je,{ref:e=>{this.jobProgressRef=e},parent:this}),n.createElement(Ye,{ref:this.taskProgressRef,parent:this}))}}class ze extends n.Component{constructor(e){super(e),this.onChange=e=>{this.setState({timeout:e})},this.state={loading:!1,timeout:"-1"},this.parent=e.parent}render(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(W.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(W.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(W.a,{onClick:this.parent.executeSave},"Save"),"Job Timeout:",n.createElement(Pe.a,{onChange:this.onChange,style:{width:"120px"}},n.createElement(Qe,{value:"10000"},"10s"),n.createElement(Qe,{value:"30000"},"30s"),n.createElement(Qe,{value:"60000"},"60s"),n.createElement(Qe,{value:"1800000"},"30m"),n.createElement(Qe,{value:"7200000"},"2h"),n.createElement(Qe,{value:"28800000"},"8h"),n.createElement(Qe,{value:"-1"},"unlimited")),n.createElement(I.a,{type:"vertical"}),"Engine:",n.createElement(He,{useEngine:e=>{this.parent.engineName=e}}))}}class Ye extends n.Component{constructor(e){super(e),this.enter=e=>{const t=this;this.setState({mark:!0}),setTimeout(()=>{t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(()=>{if("loading"===t.taskCompute)return;t.taskCompute="loading";const a=new _e(Oe);((e,t)=>{if(!e){if(t=t||"Assertion failed","undefined"!==typeof Error)throw new Error(t);throw t}})(e.hasOwnProperty("jobName"),"jobName is required");const n=e.jobName;a.runScript({},"load _mlsql_.`jobs/".concat(n,"` as output;"),e=>{t.taskCompute="loaded";const a=e[0],n={numTasks:0,numActiveTasks:0,numCompletedTasks:0};a.activeJobs.forEach(e=>{n.numTasks+=e.numTasks,n.numActiveTasks+=e.numActiveTasks,n.numCompletedTasks+=e.numCompletedTasks}),t.setState({percent:n.numActiveTasks/n.numTasks*100,successPercent:n.numCompletedTasks/n.numTasks*100,title:"Tasks (for all stages): Succeeded/Total:\n".concat(n.numCompletedTasks,"/").concat(n.numTasks,"(").concat(n.numActiveTasks," running)")})},e=>{t.taskCompute="loaded";try{t.parent.appendLog(e)}catch(a){console.log(a)}})},1e3))},1e3)},this.exit=()=>{this.taskCompute="loaded",this.resourceCompute="loaded",this.setState({loading:!1,percent:0,successPercent:0,mark:!1}),this.intervalTimer&&clearInterval(this.intervalTimer)},this.state={loading:!1,percent:0,successPercent:0,mark:!1},this.parent=e.parent}render(){return this.state.loading?n.createElement("div",null,this.state.title,n.createElement(ve.a,{percent:this.state.percent,successPercent:this.state.successPercent})):n.createElement("div",null)}}var Xe=We,$e=(a(791),a(1154));const Ze=a(212);class et extends n.Component{constructor(e){super(e),this.setRender=(e,t)=>{const a=t[0][e.key];if(this.config&&this.config.render){const t=this.config.render[e.key];t&&(e.render=t)}else{try{if(n.Component.isPrototypeOf(a.type))return void(e.render=e=>n.createElement("span",null,e))}catch(r){}"html"!=e.key?"object"!==typeof a?"array"!==typeof a?"boolean"!==typeof a?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300)):e.render=e=>n.createElement("pre",null,e.substring(0,300))}},this.update=(e,t)=>{this.config=t;let a=[],n={},r=[];const s=this;e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),this.setState({columns:a,data:r})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1}},this.config={}}render(){const e=this;return n.createElement("div",{style:this.tableStyle},n.createElement(Ue.a,{onRow:(t,a)=>({onDoubleClick:n=>{e.rowDoubleClick(t,a,n)}}),columns:this.state.columns,dataSource:this.state.data}),n.createElement($e.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(Ze,{source:this.state.view.content||""})))}}var tt=a(363),at=a(558),nt=a(555),rt=a(520),st=a.n(rt);const ot={width:200,height:200,borderWidth:2,borderColor:"#666",borderStyle:"dashed",borderRadius:5},ct={borderStyle:"solid",borderColor:"#6c6",backgroundColor:"#eee"},lt={borderStyle:"solid",borderColor:"#c66",backgroundColor:"#eee"},it={display:"flex"};class ut extends r.a.Component{constructor(){super(),this.onDrop=e=>{this.setState({files:e});const t=st.a.post("/api_v1/file/upload");t.set("Access-Token",sessionStorage.getItem(Se)||""),e.forEach(e=>{t.attach(e.path,e)}),t.end((t,a)=>{this.setState({files:[]}),t?(console.log(t),this.setState({msg:t.toString()+"\n Sometimes this caused by your upload space is not enough or backend fails"})):a.ok&&this.setState({msg:"total files:"+e.length+" are uploaded. \n You can check the files with command: !hdfs -ls /tmp/upload; "})})},this.state={files:[]}}render(){const e=this.state.files.map(e=>r.a.createElement("li",{key:e.name},e.path," - ",e.size," bytes"));return r.a.createElement("section",{style:it},r.a.createElement("div",null,r.a.createElement(at.a,{onDrop:this.onDrop,getDataTransferItems:e=>Object(nt.a)(e)},({getRootProps:e,getInputProps:t,isDragActive:a,isDragAccept:n,isDragReject:s,acceptedFiles:o,rejectedFiles:c})=>{let l=Object(y.a)({},ot);return l=a?Object(y.a)(Object(y.a)({},l),ct):l,l=s?Object(y.a)(Object(y.a)({},l),lt):l,r.a.createElement("div",Object.assign({},e(),{style:l}),r.a.createElement("input",t()),r.a.createElement("div",null,n?"Drop":"Drag"," files here..."),s&&r.a.createElement("div",null,"Unsupported file type..."))})),r.a.createElement("aside",null,r.a.createElement("h4",null,0===e.length?"":"Files"),r.a.createElement("ul",null,e)),r.a.createElement("div",null,this.state.msg?this.state.msg:""))}}var pt=a(34);const mt=a(455),dt=()=>{let e=mt();return"#000000"===e&&(e="#8884d8"),e};class ht{static render(e){let t=e[0].hasOwnProperty("z");e.hasOwnProperty("dataType")||e.forEach(e=>{e.dataType="default",t||(e.z=0)});const a=e.reduce((e,t)=>{t.x,t.y,t.z;const a=t.dataType,n=e.get(a);return n?n.push(t):e.set(a,[t]),e},new Map),n=e[0]._dash_config||{},s=[...a.keys()].map(e=>{const t=Object.assign({fill:dt(),shape:"triangle"},n[e]||{});return r.a.createElement(pt.g,Object.assign({key:e,name:e,data:a.get(e)},t))}),o=Object.assign({type:"number",dataKey:"x"},n.x||{}),c=Object.assign({type:"number",dataKey:"y"},n.y||{}),l=Object.assign({type:"number",dataKey:"z"},n.z||{});return r.a.createElement(pt.h,{width:400,height:400,margin:{top:20,right:20,bottom:20,left:20}},r.a.createElement(pt.c,null),r.a.createElement(pt.j,o),r.a.createElement(pt.k,c),t?r.a.createElement(pt.l,l):"",r.a.createElement(pt.i,{cursor:{strokeDasharray:"3 3"}}),r.a.createElement(pt.d,null),s)}}ht.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},ht.isShouldRender=e=>ht.basicCheck(e,e=>e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&(e.hasOwnProperty("_dash_config")||e.hasOwnProperty("dash"))&&("scatter"===e.dash||"scatter"===(e._dash_config||{}).dash));const bt=a(455),ft=()=>{let e=bt();return"#000000"===e&&(e="#8884d8"),e};class Et{static render(e){const t=e[0],a=[],n=t._dash_config||{};return"line"===t.dash||"line"===n.dash?(Object.keys(t).forEach(e=>{if("number"===typeof t[e]){const t=Object.assign({stroke:ft()},n[e]||{});a.push(r.a.createElement(pt.e,Object.assign({key:e,type:"monotone",dataKey:e},t)))}}),r.a.createElement(pt.f,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(pt.c,{strokeDasharray:"3 3"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.i,null),r.a.createElement(pt.d,null),a)):"bar"===t.dash||"bar"===n.dash?(Object.keys(t).forEach(e=>{if("number"===typeof t[e]){const t=Object.assign({fill:ft()},n[e]||{});a.push(r.a.createElement(pt.a,Object.assign({key:e,dataKey:e},t)))}}),r.a.createElement(pt.b,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(pt.c,{strokeDasharray:"3 3"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.i,null),r.a.createElement(pt.d,null),a)):void 0}}Et.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},Et.isShouldRender=e=>Et.basicCheck(e,e=>e.hasOwnProperty("x")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config")));var gt=a(265),yt=a.n(gt);class vt extends n.Component{constructor(e){super(e),this.renderStream=()=>{const e=this.state.data,t=[],a=[];e.forEach(e=>{const n=JSON.parse(e.value),r=yt.a.utc(n.timestamp).format("DD,h:mm:ss");t.push({x:r,inputRowsPerSecond:n.inputRowsPerSecond,processedRowsPerSecond:n.processedRowsPerSecond}),a.push({x:r,numInputRows:n.numInputRows})}),this.setState({dataForRender:t,dataForRender2:a})},this.queryApp=e.parent.parent,this.state={data:e.data,dataForRender:[],titleMap:{}}}componentDidMount(){this.renderStream()}render(){return 0===this.state.dataForRender.length?null:r.a.createElement("div",null,r.a.createElement(pt.f,{width:800,height:300,data:this.state.dataForRender},r.a.createElement(pt.e,{type:"monotone",dataKey:"inputRowsPerSecond",stroke:"#8884d8"}),r.a.createElement(pt.e,{type:"monotone",dataKey:"processedRowsPerSecond",stroke:"#82ca9d"}),r.a.createElement(pt.c,{stroke:"#ccc"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.d,null)),r.a.createElement(pt.f,{width:800,height:300,data:this.state.dataForRender2},r.a.createElement(pt.e,{type:"monotone",dataKey:"numInputRows",stroke:"#8884d8"}),r.a.createElement(pt.c,{stroke:"#ccc"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.d,null)))}}vt.isStream=e=>{if(e.length<1)return!1;try{if(!JSON.parse(e[0].value).runId)return!1}catch(t){return!1}return!0},vt.isShouldRender=e=>vt.isStream(e),vt.renderRawData=e=>{if(!vt.isShouldRender(e))return"";const t=[];return e.forEach(e=>{const a=JSON.parse(e.value);t.push(JSON.stringify(a,null,2))}),t.join("\n")};class wt{static render(e){const t=e[0];return r.a.createElement(kt,{data:t})}}wt.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},wt.isShouldRender=e=>wt.basicCheck(e,e=>e.hasOwnProperty("html")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config")));class kt extends r.a.Component{constructor(e){super(e),this.refresh=e=>{this.setState({data:e})},this.state={data:this.props.data}}render(){return r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Ae.Resizable,{defaultSize:{height:"500px"}},r.a.createElement("iframe",{sandbox:"allow-scripts",style:{width:"100%",height:"100%"},srcDoc:this.state.data.html,frameBorder:"0",scrolling:"yes",ref:e=>{this.ifr=e}})))}}class xt extends r.a.Component{constructor(e){var t;super(e),t=this,this.toggleDetail=()=>{this.setState({showDetail:!this.state.showDetail})},this.toggleResponse=()=>{this.setState({showResponse:!this.state.showResponse})},this.cleanSQL=e=>{try{return e.split("\n").filter(e=>!e.includes("password")).join("\n")}catch(t){return e}},this.queryApp=e.parent.queryApp,this.client=new d.ActionProxy,this.state={showDetail:!1,executeAgainStatus:{}};let a=(e,a)=>r.a.createElement(W.a,{type:"link",onClick:function(){var e=Object(i.a)(l.a.mark((function e(n){var r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.target.parentNode,s=r.parentNode.cellIndex,o="",e.t0=s,e.next=2===e.t0?6:4===e.t0?8:7===e.t0?10:12;break;case 6:return o="content",e.abrupt("break",12);case 8:return o="reason",e.abrupt("break",12);case 10:return o="response",e.abrupt("break",12);case 12:return console.log(s),e.next=15,t.showDetail(a.name,o);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e));this.renderConfig={render:{content:a,response:(e,a)=>r.a.createElement(W.a,{type:"link",onClick:function(){var e=Object(i.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.showResponse(a.name);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e)),reason:a,status:e=>{let t="",a={};switch(e){case"fail":case"killed":t="danger";break;case"success":t="primary",a={backgroundColor:"green"};break;case"running":t="primary"}return r.a.createElement(W.a,{type:t,style:a},e)},__command__:(e,a)=>{const n=a.name;return"running"!==a.status?r.a.createElement(W.a,{type:"primary",key:n,loading:this.state.executeAgainStatus[n],onClick:function(){var e=Object(i.a)(l.a.mark((function e(r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state.executeAgainStatus[n]=!0,t.setState(t.state.executeAgainStatus),e.next=4,Le.runJob(a.content);case 4:t.reload();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Execute again"):r.a.createElement(W.a,{key:n,onClick:function(){var e=Object(i.a)(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.killJob(n);case 2:e.sent,t.reload();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Kill")}}}}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({executeAgainStatus:{}}),t.next=3,e.client.get(h.default.JOB_LIST,{});case 3:200==(a=t.sent).status&&e.display&&e.display.update(e.processData(a.content),e.renderConfig);case 5:case"end":return t.stop()}}),t)})))()}processData(e){return e.map(e=>{const t="running"===e.status?e.jobName:"";return Object.assign(e,{__command__:t})})}showDetail(e,t){var a=this;return Object(i.a)(l.a.mark((function n(){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.client.get(h.default.JOB_DETAIL,{jobName:e});case 2:r=n.sent,a.setState({showDetail:!0,detailConsoleMessage:r.content[t]});case 4:case"end":return n.stop()}}),n)})))()}showResponse(e){var t=this;return Object(i.a)(l.a.mark((function a(){var n;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.client.get(h.default.JOB_DETAIL,{jobName:e});case 2:n=a.sent,t.setState({showResponse:!0}),t.respDisplay&&t.respDisplay.update(JSON.parse(n.content.response));case 5:case"end":return a.stop()}}),a)})))()}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement($e.a,{title:"View",visible:this.state.showDetail,onCancel:this.toggleDetail,onOk:this.toggleDetail,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(fe.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.cleanSQL(this.state.detailConsoleMessage)||""})),r.a.createElement($e.a,{title:"View",visible:this.state.showResponse,onCancel:this.toggleResponse,onOk:this.toggleResponse,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(et,{style:{overflow:"scroll"},ref:e=>{this.respDisplay=e},parent:this})),r.a.createElement("div",{style:{marginBottom:16}},r.a.createElement(W.a,{type:"primary",onClick:()=>{this.reload()}},"Reload")),r.a.createElement(et,{ref:e=>{this.display=e},parent:this}))}}const St=Ge.a.Panel,Ot=tt.a.TabPane;function jt(e){}class Tt extends n.PureComponent{constructor(e){super(e),this.isNormalXY=e=>Tt.basicCheck(e,e=>e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&"number"===typeof e.y),this.xYRender=e=>r.a.createElement(pt.a,{height:200,title:"Bar",data:e}),this.renderDash=()=>{const e=this.state.data;return vt.isShouldRender(e)?r.a.createElement(vt,{data:e,parent:this}):ht.isShouldRender(e)?ht.render(e):this.isNormalXY(e)?this.xYRender(e):Et.isShouldRender(e)?Et.render(e):wt.isShouldRender(e)?wt.render(e):r.a.createElement("div",null)},this.queryApp=e.parent,this.state={data:[],dataForRender:[],titleMap:{}}}refresh(){try{const e=this.queryApp.queryResData||[];this.setState({data:e})}catch(e){}}render(){return r.a.createElement(Ge.a,{onChange:jt},r.a.createElement(St,{header:"Tools/Dashboard",key:"0"},r.a.createElement(tt.a,{defaultActiveKey:"0",onChange:jt,onTabClick:e=>{"0"===e&&this.resourceProgressRef.reload()}},r.a.createElement(Ot,{tab:"Cluster Info",key:"0"},r.a.createElement(Ke,{ref:e=>this.resourceProgressRef=e,parent:this})),r.a.createElement(Ot,{tab:"Upload",key:"1"},r.a.createElement(ut,null)),r.a.createElement(Ot,{tab:"Dashboard",key:"2"},this.renderDash()),r.a.createElement(Ot,{tab:"RawData",key:"3"},r.a.createElement("pre",null,vt.renderRawData(this.state.data))),r.a.createElement(Ot,{tab:"History",key:"4"},r.a.createElement(xt,{ref:e=>this.queryHistory=e,parent:this})))))}}Tt.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0};class Nt extends r.a.Component{constructor(e){super(e),this.originalEditor=()=>this.editor.editor}componentDidMount(){this.originalEditor().container.style.lineHeight=3}render(){return r.a.createElement(fe.a,{maxLines:1/0,width:"100%",ref:e=>{this.editor=e},value:this.props.initialCode,mode:"sql",theme:"github"})}}var Ct=a(1146);class _t extends r.a.Component{constructor(e){super(e),this.evtExecute=()=>{this.setState({isExecute:!0}),this.state.executeUnit.execute()},this.cancelExecute=()=>{this.setState({isExecute:!1})},this.state={isExecute:!1,executeUnit:e.executeUnit}}render(){return r.a.createElement("div",null,this.state.isExecute?r.a.createElement("span",{onClick:this.cancelExecute},r.a.createElement(Ct.a,{type:"sync",spin:!0})):r.a.createElement("span",{onClick:this.evtExecute},r.a.createElement(Ct.a,{type:"caret-right"})))}}const It=a(107);class Pt{constructor(e){this.run=(e,t,a)=>{const n=It();new _e(Oe).newRunScript({jobName:n,timeout:this.timeout},e,t,a)},this.saveFile=(e,t,a)=>{new _e("/api_v1/script_file").request(ke,{id:t,content:e},e=>{200!=e.status?e.json(e=>{a(e.msg)},e=>{a(e)}):a("saved")},e=>{a(e)})},this.timeout=e}}const At=a(212);class Dt extends n.Component{constructor(e){super(e),this.setRender=(e,t,a)=>{const r=t[0][e.key];if(a&&a.render){const t=this.state.config.render[e.key];t&&(e.render=t)}else{try{if(n.Component.isPrototypeOf(r.type))return void(e.render=e=>n.createElement("span",null,e))}catch(s){}"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300))}},this.parseData=(e,t)=>{let a=[],n={},r=[];const s=this;return e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),[a,r]},this.refresh=(e,t)=>{const a=this.parseData(e,t),n=Object(u.a)(a,2),r=n[0],s=n[1];this.setState({columns:r,rows:s,config:t})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})};const t=this.parseData(e.data||[],e.config||{}),a=Object(u.a)(t,2),r=a[0],s=a[1];this.state={columns:r,rows:s,view:{enabled:!1}}}render(){const e=this;return n.createElement("div",null,n.createElement(Ue.a,{onRow:(t,a)=>({onDoubleClick:n=>{e.rowDoubleClick(t,a,n)}}),columns:e.state.columns,dataSource:e.state.rows}),n.createElement($e.a,{title:"View",visible:e.state.view.enabled,onCancel:e.disablePreview,onOk:e.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(At,{source:e.state.view.content||""})))}}class Rt extends r.a.Component{constructor(e){super(e),this.refresh=e=>{if(this.setState({displayData:e,errorMsg:""}),this.displayTableRef&&this.displayTableRef.refresh(this.state.displayData,{}),this.displayDashRef){const e=this.state.displayData[0];this.displayDashRef.refresh(e)}},this.fail=e=>{this.setState({errorMsg:e}),this.editor&&this.editor.editor.setValue(e)},this.displayDash=()=>{if(this.state.displayData&&wt.isShouldRender(this.state.displayData)){const e=this.state.displayData[0];return r.a.createElement(kt,{data:e,ref:e=>this.displayDashRef=e})}return r.a.createElement("div",null)},this.displayError=()=>this.state.errorMsg?r.a.createElement("div",null,r.a.createElement(fe.a,{maxLines:1/0,width:"100%",ref:e=>{this.editor=e},value:this.state.errorMsg,mode:"text",theme:"ace/theme/textmate"})):r.a.createElement("div",null),this.displayTable=()=>this.state.displayData?r.a.createElement(Dt,{data:this.state.displayData,ref:e=>this.displayTableRef=e}):r.a.createElement("div",null),this.state={errorMsg:""}}render(){return r.a.createElement("div",null,this.displayError(),this.displayTable(),this.displayDash())}}class Ft extends r.a.Component{constructor(e){super(e),this.execute=()=>{const e=this.codeBlock.originalEditor().getValue();new Pt(3e5).run(e,e=>{this.displayGroup.refresh(e),this.commandGroup.setState({isExecute:!1}),this.notebook.nextExecuteUnit()},e=>{this.displayGroup.fail(e),this.commandGroup.setState({isExecute:!1})})},this.codeBlockIsEmpty=()=>""===this.getCodeStr(),this.getCodeStr=()=>this.codeBlock.originalEditor().getValue(),this.notebook=e.parent}render(){return r.a.createElement("div",null,r.a.createElement(Nt,{initialCode:this.props.initialCode,ref:e=>{this.codeBlock=e},executeUnit:this}),r.a.createElement(_t,{ref:e=>{this.commandGroup=e},executeUnit:this}),r.a.createElement(Rt,{ref:e=>this.displayGroup=e}))}}const Lt="set notebooksplitter='notebooksplitter';";class Mt extends r.a.Component{constructor(e){super(e),this.createNewExecuteUnit=e=>r.a.createElement(Ft,{parent:this,initialCode:e,ref:e=>this.addRef(e)}),this.addRef=e=>{e&&this.executeUnitRefs.push(e)},this.nextExecuteUnit=()=>{(()=>this.executeUnitRefs.slice(-1)[0].codeBlockIsEmpty())()||(this.executeUnits.push(this.createNewExecuteUnit()),this.setState({executeUnits:this.executeUnits})),this.saveNoteBook()},this.saveNoteBook=()=>{const e=this.executeUnitRefs.map(e=>e.getCodeStr()).join(Lt);this.engine.saveFile(e,this.scriptId,e=>{})},this.text=(e,t)=>{this.scriptId=t,this.initialCode=e,e&&"undefined"!==e&&(this.executeUnitRefs=[],this.executeUnits=this.initialCode.split(Lt).map(e=>this.createNewExecuteUnit(e)),this.setState({executeUnits:this.executeUnits}))},this.executeUnitRefs=[],this.executeUnits=[this.createNewExecuteUnit("")],this.state={executeUnits:this.executeUnits},this.engine=new Pt(3e5)}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}render(){return r.a.createElement("div",null,this.state.executeUnits)}}const qt=a(107);class Vt{constructor(e){this.appendLog=e,this.log={}}cancelQueryLog(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.intervalTimer&&(clearInterval(e.intervalTimer),e.intervalTimer=null);case 1:case"end":return t.stop()}}),t)})))()}queryLog(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.cancelQueryLog(),e.intervalTimer=setInterval(Object(i.a)(l.a.mark((function t(){var a,n,r,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=qt(),n=new d.ActionProxy,t.next=4,n.runScript("load _mlsql_.`log/".concat(e.log.offset||-1,'` where filePath="engine_log" as output;'),a,{});case 4:r=t.sent,(s=r.content[0]).value.length>0&&e.appendLog(s.value.map(e=>e.split("__MMMMMM__")[1]).join("\n")),e.log.offset=s.offset;case 8:case"end":return t.stop()}}),t)}))),2e3);case 2:case"end":return t.stop()}}),t)})))()}}Pe.a.Option;const Bt=a(107);class Gt extends n.Component{constructor(e){super(e),this.text=(e,t)=>{this.setState({value:e,scriptId:t},()=>{this.aceEditorRef.editor.setValue(e,1)})},this.executeSave=()=>{const e=new _e("/api_v1/script_file"),t=this,a=this.getMessageBoxAceEditor();t.state.scriptId?e.request(ke,{id:t.state.scriptId,content:t.getAceEditor().getValue()},e=>{200!=e.status?e.json(e=>{t.appendLog(e.msg)},e=>{t.appendLog(e)}):t.appendLog("saved")},e=>{t.appendLog(e)}):a.setValue("no file are opened, cannot executeSave")},this.getAllText=()=>this.getAceEditor().getValue(),this.getSelection=()=>{let e=this.getAceEditor().getSelectionRange();return this.getAceEditor().session.getTextRange(e)},this.appendToEditor=e=>{const t=this.getAceEditor(),a=t.getCursorPosition();t.session.insert(a,e),t.focus()},this.getAceEditor=()=>this.aceEditorRef.editor,this.getMessageBoxAceEditor=()=>this.queryApp.messageBox.current.editor,this.appendLog=e=>{const t=this.getMessageBoxAceEditor().session;t.insert({row:t.getLength(),column:0},"\n"+e)},this.getDashBoard=()=>this.queryApp.dash.current,this.getDisplay=()=>this.queryApp.display.current,this.language=this.props.language||"sql",this.queryApp=this.props.parent.queryApp,this.state={value:"",loading:!1},this.executeQuery=this.executeQuery.bind(this),this.cancelQuery=this.cancelQuery.bind(this),this.logMonitor=new Vt(this.appendLog),this.log={}}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}onChange(e){}executeQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r,s,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.commandGroup.setState({loading:!0}),e.jobName=Bt(),a=new d.ActionProxy,(n=e).getMessageBoxAceEditor().setValue(""),n.getDisplay().update(JSON.parse("[]")),r=n.getSelection(),s=n.getAllText(),""!==r&&(s=r),o=n.state.scriptId,e.logMonitor.queryLog(),t.next=13,a.runScript(s,e.jobName,{scriptId:o,runMode:"python",executeMode:"python"});case 13:if(200===(c=t.sent).status){t.next=19;break}return e.logMonitor.cancelQueryLog(),e.appendLog(c.content),e.commandGroup.setState({loading:!1}),t.abrupt("return");case 19:try{e.appendLog(c.content.join("\n"))}catch(l){e.appendLog(c.content.msg)}e.logMonitor.cancelQueryLog(),e.commandGroup.setState({loading:!1});case 22:case"end":return t.stop()}}),t)})))()}cancelQuery(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.jobName){t.next=2;break}return t.abrupt("return");case 2:return a=Bt(),n=new d.ActionProxy,t.next=6,n.runScript("!kill "+e.jobName+";",a,{});case 6:r=t.sent;try{e.appendLog(r.content[0].description)}catch(s){e.appendLog(r.content)}e.jobName=null,e.logMonitor.cancelQueryLog();case 10:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:e=>e.preventDefault(),onDrop:this.etOver},n.createElement(Ae.Resizable,{defaultSize:{height:"500px"},onResize:()=>{this.aceEditorRef.current.editor.resize()}},n.createElement(fe.a,{ref:e=>this.aceEditorRef=e,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(Ut,{ref:e=>this.commandGroup=e,parent:this}))}}class Ut extends n.Component{constructor(e){super(e),this.onChange=e=>{this.setState({timeout:e})},this.state={loading:!1,timeout:"-1"},this.parent=e.parent}render(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(W.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(W.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(W.a,{onClick:this.parent.executeSave},"Save"))}}var Jt=Gt;class Kt extends r.a.Component{constructor(e){super(e),this.addRef=e=>{e&&(this.editor=e)},this.text=(e,t)=>{this.editor.text(e,t)},this.queryApp=this.props.parent}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}render(){return r.a.createElement("div",null,r.a.createElement(Jt,{parent:this,ref:e=>this.addRef(e),language:"python"}))}}const Ht=tt.a.TabPane;class Qt extends n.Component{constructor(e){super(e),this.pushRef=e=>{this.myRefs.push(e)},this.getCurrentEditor=()=>{const e=this.state.activeKey;let t=null;return this.myRefs.forEach(a=>{a.activeKey===e&&(t=a)}),t},this.onChange=e=>{let t=null;this.state.panes.forEach(a=>{a.key===e&&(t=a)}),t&&!t.title.endsWith(".mlsql")?this.parent.setState({displayEditor:"normal"}):t&&!t.title.endsWith(".nb")?this.parent.setState({displayEditor:"notebook"}):this.parent.setState({displayEditor:"pythoneditor"}),this.setState({activeKey:e})},this.onEdit=(e,t)=>{this[t](e)},this.addFull=(e,t)=>{const a=this.state.panes,r="newTab".concat(this.newTabIndex++);a.push({title:e||"MLSQL "+this.newTabIndex,content:(a=>e.endsWith(".mlsql")?n.createElement(Xe,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:a}),t&&t({ref:e,activeKey:a})},activeKey:a}):e.endsWith(".nb")?n.createElement(Mt,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:a}),t&&t({ref:e,activeKey:a})},activeKey:a}):e.endsWith(".py")?n.createElement(Kt,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:a}),t&&t({ref:e,activeKey:a})},activeKey:a}):void 0)(r),key:r}),this.setState({panes:a,activeKey:r})},this.add=()=>{this.addFull("MLSQL "+(this.newTabIndex+1),e=>{})},this.getPaneIndexByActiveKey=e=>{let t;return this.state.panes.forEach((a,n)=>{a.key===e&&(t=n-1)}),t},this.remove=e=>{let t=this.state.activeKey,a=this.getPaneIndexByActiveKey(e);const n=this.state.panes.filter(t=>t.key!==e);n.length&&t===e&&(t=a>=0?n[a].key:n[0].key);const r=this.myRefs.filter(t=>t.activeKey===e);this.myRefs=this.myRefs.filter(t=>t.activeKey!==e),this.parent.closeEditor(r[0]),this.setState({panes:n,activeKey:t})},this.parent=e.parent,this.myRefs=[],this.newTabIndex=0;const t=[{title:"MLSQL 1",content:n.createElement(Xe,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:"newTab0"})},activeKey:"newTab0"}),key:"newTab0"}];this.state={activeKey:t[0].key,panes:t},this.newTabIndex++}render(){return n.createElement(tt.a,{onChange:this.onChange,activeKey:this.state.activeKey,type:"editable-card",onEdit:this.onEdit},this.state.panes.map(e=>n.createElement(Ht,{tab:e.title,key:e.key,closable:e.closable},e.content)))}}var Wt=a(187),zt=a(100);const Yt=Q.a.Group;class Xt extends n.Component{constructor(e){super(e),this.etPopLoad=e.parent,this.state={}}render(){return n.createElement("div",null,n.createElement("span",null,"parameters:"),n.createElement(Yt,{compact:!0},this.state.dataForRender))}}const $t=a(107);class Zt{static keyPath(e,t,a){let n=e;a(n),"object"===typeof t&&Object.keys(t).forEach(e=>{Zt.keyPath("".concat(n,"['").concat(e,"']"),t[e],a)})}}Zt.getTempTableName=()=>($t()+"").replace(/-/g,""),Zt.getJobName=()=>$t()+"",Zt.escapeQuote=e=>e?e.replace(/[\""]/g,'\\"'):e,Zt.quote=e=>e?'"'.concat(Zt.escapeQuote(e),'"'):e,Zt.unQuote=e=>"string"!==typeof e?e:e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,e.length-1):e.startsWith("'''")&&e.endsWith("'''")?e.slice(3,e.length-3):e,Zt.visitDown=(e,t)=>{t(e),e.children&&e.children.map(e=>{Zt.visitDown(e,t)})},Zt.visitUp=(e,t)=>{e.children&&e.children.map(e=>{Zt.visitUp(e,t)}),t(e)},Zt.robotFetchParam=()=>({queryType:"robot",fetchType:"take",includeSchema:!0,outputSize:200}),Zt.robotFetchParamWithCollect=()=>({queryType:"robot",includeSchema:!0}),Zt.getField=e=>e.startsWith("`")&&e.endsWith("`")?e:"`".concat(e,"`"),Zt.distinct=(e,t)=>{if(!t)return[...new Set(e)];const a={};return e.filter(e=>!(e[t]in a)&&(a[e[t]]=e[t],!0))},Zt.fastCompareObject=(e,t)=>JSON.stringify(e)===JSON.stringify(t),Zt.deepCompareObject=(e,t)=>function e(t,a){var n;if(isNaN(t)&&isNaN(a)&&"number"===typeof t&&"number"===typeof a)return!0;if(t===a)return!0;if("function"===typeof t&&"function"===typeof a||t instanceof Date&&a instanceof Date||t instanceof RegExp&&a instanceof RegExp||t instanceof String&&a instanceof String||t instanceof Number&&a instanceof Number)return t.toString()===a.toString();if(!(t instanceof Object&&a instanceof Object))return!1;if(t.isPrototypeOf(a)||a.isPrototypeOf(t))return!1;if(t.constructor!==a.constructor)return!1;if(t.prototype!==a.prototype)return!1;if((void 0).indexOf(t)>-1||(void 0).indexOf(a)>-1)return!1;for(n in a){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof a[n]!==typeof t[n])return!1}for(n in t){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof a[n]!==typeof t[n])return!1;switch(typeof t[n]){case"object":case"function":if((void 0).push(t),(void 0).push(a),!e(t[n],a[n]))return!1;(void 0).pop(),(void 0).pop();break;default:if(t[n]!==a[n])return!1}}return!0}(e,t);const ea=Q.a.Group,ta=Pe.a.Option;class aa extends n.Component{constructor(e){var t;super(e),t=this,this.componentDidMount=Object(i.a)(l.a.mark((function e(){var a,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t,a=new d.ActionProxy,e.next=4,a.runScript("load _mlsql_.`datasources` as output;",Zt.getJobName(),Zt.robotFetchParamWithCollect());case 4:r=e.sent,s=Zt.distinct(r.content.data,"name"),o=[],s.forEach(e=>{o.push(n.createElement(ta,{key:e.name,value:e.name},e.name))}),t.setState({datasourcesRender:o});case 9:case"end":return e.stop()}}),e)}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.sourceType=(e,t)=>{this.data.sourceTypeV=e;const a=this;new _e(Oe).runScript({},"load _mlsql_.`datasources/params/".concat(e,"` as output;"),e=>{const t=[];e.forEach(e=>{t.push(n.createElement(Wt.a,{key:"row-".concat(e.param)},n.createElement(zt.a,null,n.createElement(Q.a,{key:"input-".concat(e.param),style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",addonBefore:e.param,placeholder:e.description}))))}),a.loadParamsRef.current.setState({dataForRender:t})},e=>{})},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.makeMLSQL=()=>{let e=[];for(let a in this.data.params){let t=this.data.params[a];if(t){let n='"'+t+'"';"code"!==a&&"fitParam.[group].code"!==a||(n="'''"+t+"'''"),e.push(a.replace(/\[group\]/g,"0")+"="+n)}}let t="";return e.length>0&&(t="where"),"load ".concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` ").concat(t," ").concat(e.join("and\\n ")," as ").concat(this.data.tableNameV,";")},this.etpop=e.parent,this.data={params:{}},this.state={datasourcesRender:[]},this.loadParamsRef=n.createRef()}render(){return n.createElement("div",null,n.createElement(ea,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,"soureType:",n.createElement(Pe.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.datasourcesRender)))),n.createElement("br",null),this.props.ignorePath?n.createElement("div",null):n.createElement(ea,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{onChange:this.path,type:"text",label:"Path",addonBefore:"Path",placeholder:"File path or tableName"})))),n.createElement("br",null),this.props.ignoreTableName?n.createElement("div",null):n.createElement(ea,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"tableName"})))),n.createElement("br",null),n.createElement(Xt,{parent:this,ref:this.loadParamsRef}))}}const na=Q.a.Group,ra=(Pe.a.Option,Q.a.TextArea);class sa extends n.Component{constructor(e){super(e),this.renderParam=e=>"keepVersion"===e.param&&"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(Wt.a,null,n.createElement(zt.a,null,e.param,":",n.createElement(ra,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",rows:10}))):n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",addonBefore:e.param,placeholder:e.description}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.makeMLSQL=()=>{let e=[];for(let t in this.data.params){let a=this.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+a+'"')}return 0==e.length&&e.push('keepVersion="true"'),"train ".concat(this.data.tableNameV," as ").concat(this.name,".`").concat(this.data.pathV,"` where \n").concat(e.join(" and\n "),";")},this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[]}}componentDidMount(){const e=this;new _e(Oe).runScript({},"load modelParams.`".concat(e.name,"` as output;"),t=>{const a=[];t.forEach(e=>{const t=this.renderParam(e);null!==t&&(a.push(t),a.push(n.createElement("br",null)))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement("span",null,"Training data and model path:"),n.createElement(na,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:"tableName",placeholder:"the table of training data"})))),n.createElement("br",null),n.createElement(na,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{onChange:this.path,type:"text",size:"large",addonBefore:"Model save path",placeholder:"the location you save you model"})))),n.createElement("br",null),n.createElement("span",null,"Algorithm parameters:"),n.createElement(na,{compact:!0},this.state.dataForRender))}}const oa=Q.a.Group,ca=Pe.a.Option;class la extends n.Component{constructor(e){super(e),this.sourceType=(e,t)=>{this.data.sourceTypeV=e},this.saveMode=(e,t)=>{this.data.saveModeV=e},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.partitionBy=e=>{this.data.partitionByV=e.target.value},this.fileNum=e=>{this.data.fileNumV=e.target.value},this.makeMLSQL=()=>{let e="";this.data.partitionByV&&(e="partitionBy "+this.data.partitionByV);let t='key="value"';return this.data.fileNumV&&(t='fileNum="'.concat(this.data.fileNumV,'"')),"save ".concat(this.data.saveModeV," ").concat(this.data.tableNameV," as ").concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` \n where ").concat(t," ").concat(e,";")},this.etpop=e.parent,this.data={},this.state={datasourcesRender:[]}}componentDidMount(){const e=this;new _e(Oe).runScript({},"load _mlsql_.`datasources` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(ca,{key:e.name,value:e.name},e.name))}),e.setState({datasourcesRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(oa,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,"soureType:",n.createElement(Pe.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.datasourcesRender)))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,"SaveMode:",n.createElement(Pe.a,{onChange:this.saveMode,showSearch:!0,style:{width:200},placeholder:"Choose save mode type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ca,{key:"overwrite",value:"overwrite"},"overwrite"),n.createElement(ca,{key:"append",value:"append"},"append"),n.createElement(ca,{key:"errorIfExists",value:"errorIfExists"},"errorIfExists"),n.createElement(ca,{key:"ignore",value:"ignore"},"ignore"))))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"the tableName will be saved"})))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{onChange:this.path,type:"text",addonBefore:"Target Path",placeholder:"File path or tableName"})))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{type:"text",onChange:this.partitionBy,addonBefore:"partitionBy",placeholder:"partitionBy"})))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{type:"text",onChange:this.fileNum,addonBefore:"fileNum",placeholder:"fileNum"})))),n.createElement("br",null))}}const ia=Q.a.Group,ua=(Pe.a.Option,Q.a.TextArea);class pa extends n.Component{constructor(e){super(e),this.renderParam=e=>"keepVersion"===e.param||"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(Wt.a,null,n.createElement(zt.a,null,e.param,":",n.createElement(ua,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",rows:10}))):n.createElement(Wt.a,{key:e.param},n.createElement(zt.a,null,n.createElement(Q.a,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",addonBefore:e.param,placeholder:e.description}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.outputTableName=e=>{this.data.outputTableNameV=e.target.value},this.showTableName=()=>"true"!==this.state.tableHidden?n.createElement(ia,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:this.state.tableAlias?this.state.tableAlias:"Input table",placeholder:""})))):null,this.showOutputTableName=()=>"true"!==this.state.outputTableHidden?n.createElement(ia,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{type:"text",onChange:this.outputTableName,size:"large",addonBefore:this.state.outputTableAlias?this.state.outputTableAlias:"Output table",placeholder:""})))):null,this.pathNameForRender=()=>this.state.pathAlias?this.state.pathAlias:"Save path",this.showPathName=()=>"true"!==this.state.pathHidden?n.createElement(ia,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{onChange:this.path,type:"text",size:"large",addonBefore:this.pathNameForRender(),placeholder:""})))):"",this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden,outputTableHidden:e.outputTableHidden,outputTableAlias:e.outputTableAlias,tableAlias:e.tableAlias}}componentDidMount(){const e=this;new _e(Oe).runScript({},"load modelParams.`".concat(e.name,"` as output;"),t=>{const a=[];t.forEach(e=>{const t=this.renderParam(e);null!==t&&(a.push(t),a.push(n.createElement("br",null)))}),e.setState({dataForRender:a})},e=>{})}_makeMLSQL(){let e=[];for(let n in this.data.params){let t=this.data.params[n],a='"'+t+'"';"code"!==n&&"fitParam.[group].code"!==n||(a="'''"+t+"'''"),e.push(n.replace(/\[group\]/g,"0")+"="+a)}let t="";e.length>0&&(t="where");let a="";return this.data.outputTableNameV&&(a="as ".concat(this.data.outputTableNameV)),"run ".concat(this.data.tableNameV||"command"," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(t," ").concat(e.join("and\n ")," ").concat(a,";")}_render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(ia,{compact:!0},this.state.dataForRender))}}class ma extends pa{constructor(e){super(e),this.makeMLSQL=()=>super._makeMLSQL()}render(){return super._render()}}const da=Q.a.Group;Pe.a.Option;class ha extends ma{constructor(...e){super(...e),this.makeMLSQL=()=>{let e=[];for(let t in this.data.params){let a=this.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+a+'"')}return 0==e.length&&e.push('keepVersion="true"'),"run command as ".concat(this.name,".`` where \n").concat(e.join(" and\n "),";")}}render(){return n.createElement("div",null,n.createElement(da,{compact:!0},this.state.dataForRender))}}a(1048),a(1049),a(1050);var ba=a(532),fa=a.n(ba);const Ea=Pe.a.Option,ga=Q.a.TextArea;class ya extends n.Component{constructor(e){super(e),this.udfName=e=>{this.data.udfNameV=e.target.value},this.dataType=e=>{this.data.dataTypeV=e.target.value},this.udfType=e=>{this.udfTypeV=e},this.code=e=>{this.codeV=e},this.langSelect=e=>{this.lang=e,this.codeCheckRef.current.checked=!1,this.setState({dataType:!1}),"python"===this.lang&&this.setState({dataType:!0}),this.setState({codeLang:e})},this.setCodeExample=e=>{e?this.codeRef.current.editor.setValue(this.codeExample()):this.codeRef.current.editor.setValue("")},this.codeExample=()=>{const e=this.state.codeLang||"scala";return"scala"===e?"def apply(a:Double,b:Double)={\n   a + b\n}":"python"===e?"def apply(self,m):\n    return m":"java"===e?"import java.util.HashMap;\nimport java.util.Map;\npublic class UDF {\n  public Map<String, Integer[]> apply(String s) {\n    Map<String, Integer[]> m = new HashMap<>();\n    Integer[] arr = {1};\n    m.put(s, arr);\n    return m;\n  }\n}":null},this.showDataType=()=>this.state.dataType?n.createElement(Wt.a,null,n.createElement(zt.a,null,"dataType:",n.createElement(ga,{style:{marginBottom:"10px"},name:"dataType",rows:10,onChange:this.dataType,type:"text",addonBefore:"dataType",placeholder:"This is not required when lang is scala\nAs we know python is not strongly typed language, so\nwe should manually spcify the return type.\nmap(string,string) means a map with key is string type,value also is string type.\narray(string) means a array with string type element.\nnested is support e.g. array(array(map(string,array(string))))\n\n"}))):null,this.showCode=()=>n.createElement("div",null,n.createElement(Wt.a,null,n.createElement(zt.a,null,"code:",n.createElement(fe.a,{ref:this.codeRef,mode:this.state.codeLang||"scala",theme:"github",width:"400px",height:"300px",name:"code",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,onChange:this.code,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}}))),n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(zt.a,{span:8},"Show CodeExample:",n.createElement(fa.a,{ref:this.codeCheckRef,onChange:this.setCodeExample}))))),this.makeMLSQL=()=>{let e=[];return e.push('lang="'.concat(this.lang,'"')),e.push("code='''".concat(this.codeV,"'''")),e.push('udfType="'.concat(this.udfTypeV,'"')),this.dataTypeV&&e.push("dataType='''".concat(this.dataTypeV,"'''")),"register ScriptUDF.`` as ".concat(this.data.udfNameV," where \n").concat(e.join("\nand "),";")},this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[]},this.codeRef=n.createRef(),this.codeCheckRef=n.createRef()}componentDidMount(){}render(){return n.createElement("div",null,n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{onChange:this.udfName,type:"text",size:"large",addonBefore:"UDF Name",placeholder:"the name of udf"}))),n.createElement("br",null),n.createElement(Wt.a,null,n.createElement(zt.a,{span:4},n.createElement("span",null,"udfType:")),n.createElement(zt.a,{span:20},n.createElement(Pe.a,{showSearch:!0,onChange:this.udfType,style:{width:200},placeholder:"Select udf type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(Ea,{value:"udf"},"udf"),n.createElement(Ea,{value:"udaf"},"udaf")))),n.createElement("br",null),n.createElement(Wt.a,null,n.createElement(zt.a,{span:4},n.createElement("span",null,"Lang:")),n.createElement(zt.a,{span:20},n.createElement(Pe.a,{showSearch:!0,style:{width:200},placeholder:"Select language type",optionFilterProp:"children",onChange:this.langSelect,filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(Ea,{value:"java"},"java"),n.createElement(Ea,{value:"scala"},"scala"),n.createElement(Ea,{value:"python"},"python")))),n.createElement("br",null),this.showDataType(),n.createElement("br",null),this.showCode(),n.createElement("br",null),n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{style:{marginBottom:"10px"},name:"methodName",onChange:this.params,type:"text",addonBefore:"methodName",placeholder:"methodName"}))))}}Q.a.Group;const va=Pe.a.Option;class wa extends n.Component{constructor(e){super(e),this.etName=e=>{this.etName=e},this.makeMLSQL=()=>"load modelExample.`".concat(this.etName,"` as output;"),this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden}}componentDidMount(){const e=this;new _e(Oe).runScript({},"load model.`list` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(va,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(Wt.a,null,n.createElement(zt.a,null,"ET:",n.createElement(Pe.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}Q.a.Group;const ka=Pe.a.Option;class xa extends ma{constructor(...e){super(...e),this.makeMLSQL=()=>"register ".concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` as ").concat(this.data.outputTableNameV,";"),this.etName=e=>{this.data.sourceTypeV=e}}componentDidMount(){const e=this;new _e(Oe).runScript({},"load model.`list` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(ka,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(Wt.a,null,n.createElement(zt.a,null,"ET:",n.createElement(Pe.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}const Sa=Q.a.Group;class Oa extends pa{constructor(e){super(e),this.makeMLSQL=()=>{let e="";this.data.outputTableNameV&&(e="as ".concat(this.data.outputTableNameV));const t=super._makeMLSQL().replace(e,""),a="predict ".concat(this.data.tableNameV," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(e,";");return"".concat(t,"\n        ").concat(a,"\n        register ").concat(this.name,".`").concat(this.data.pathV||"","` as ").concat(this.data.functionNameV,"; \n        ").stripMargin()},this.functionName=e=>{this.data.functionNameV=e.target.value}}render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(Sa,{compact:!0},n.createElement(Wt.a,null,n.createElement(zt.a,null,n.createElement(Q.a,{onChange:this.functionName,type:"text",size:"large",addonBefore:"functionName",placeholder:"A function you can use to convert String to number or number to String"})))),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(Sa,{compact:!0},this.state.dataForRender))}}class ja extends pa{constructor(e){super(e),this.makeMLSQL=()=>{const e="/api_v1/public/file/download?fileName=".concat(encodeURIComponent(this.data.pathV)),t=document.createElement("a");return t.href=e,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),""}}componentDidMount(){}render(){return super._render()}}Q.a.Group;const Ta=Pe.a.Option;class Na extends n.Component{constructor(e){super(e),this.etName=e=>{this.etName=e},this.makeMLSQL=()=>"load _mlsql_.`progress/".concat(this.etName,"` as output;"),this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden}}componentDidMount(){const e=this;new _e(Oe).runScript({},"load _mlsql_.`jobs` as output;",t=>{const a=t.filter(e=>"stream"===e.jobType).map(e=>n.createElement(Ta,{key:e.jobName,value:e.jobName},e.jobName));e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(Wt.a,null,n.createElement(zt.a,null,"Stream Jobs:",n.createElement(Pe.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose Stream Name",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}class Ca extends n.Component{constructor(e){super(e),this.disableEtModalVisible=()=>{this.et.setState({etPop:!1,etModalVisible:!1})},this.enableEtModalVisible=()=>{const e=this.popChild.current.makeMLSQL();this.et.makeMLSQL(e),this.et.setState({etPop:!1,etModalVisible:!1})},this.renderContent=()=>"load"===this.et.state.eventName?n.createElement(aa,{parent:this,ref:this.popChild}):"save"===this.et.state.eventName?n.createElement(la,{name:this.et.state.eventName,ref:this.popChild}):"DownloadExt"===this.et.state.eventName?n.createElement(ha,{name:this.et.state.eventName,ref:this.popChild}):"StringIndex"===this.et.state.eventName?n.createElement(Oa,{name:this.et.state.eventName,ref:this.popChild}):"DownloadFile"===this.et.state.eventName?n.createElement(ja,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):"ETExample"===this.et.state.eventName?n.createElement(wa,{name:this.et.state.eventName,ref:this.popChild}):"ETStreamProgress"===this.et.state.eventName?n.createElement(Na,{name:this.et.state.eventName,ref:this.popChild}):"ScriptUDF"===this.et.state.eventName?n.createElement(ya,{name:this.et.state.eventName,ref:this.popChild}):"register"===this.et.state.eventName?n.createElement(xa,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):"tool"===this.et.state.processType?n.createElement(ma,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):n.createElement(sa,{name:this.et.state.eventName,ref:this.popChild}),this.et=e.parent,this.popChild=n.createRef(),this.state={etModalVisible:!0,title:e.title},this.data={}}render(){return n.createElement("div",null,n.createElement(V.a,{title:this.state.title,visible:this.state.etModalVisible,onCancel:this.disableEtModalVisible,onOk:this.enableEtModalVisible,okText:"Ok",cancelText:"Cancel"},this.renderContent()))}}var _a=a(44),Ia=a.n(_a);const Pa=Ge.a.Panel;tt.a.TabPane;class Aa extends n.Component{constructor(e){super(e),this.setData=(e,t)=>{this.itemData[e]=t},this.getData=e=>this.itemData[e],this.onDragStart=e=>{const t=e.target.getAttribute("processtype");this.setData("eventName",e.target.getAttribute("name")),this.setData("popName",e.target.getAttribute("help")),this.setData("processType",t),this.setData("pathAlias",e.target.getAttribute("pathalias")||""),this.setData("outputTableAlias",e.target.getAttribute("outputtablealias")||""),this.setData("tableAlias",e.target.getAttribute("tablealias")||""),this.setData("tableHidden",e.target.getAttribute("tablehidden")||!1),this.setData("pathHidden",e.target.getAttribute("pathhidden")||!1),this.setData("outputTableHidden",e.target.getAttribute("outputtablehidden")||!1)},this.makeMLSQL=e=>{this.queryApp.getCurrentEditor().ref.appendToEditor(e)},this.renderPop=()=>this.state.etPop?n.createElement(Ca,{parent:this,title:this.state.popName}):null,this.etDoubleClick=e=>{this.onDragStart(e),this.queryApp.getCurrentEditor().ref.etOver(e)},this.queryApp=e.parent,this.state={},this.itemData={}}componentDidMount(){}render(){return n.createElement("div",null,n.createElement(Ge.a,{style:{margin:"0px 0px",padding:"0px 0px"}},n.createElement(Pa,{header:"Quick Menu",key:"1"},n.createElement(Wt.a,{gutter:16},n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Load/Save Data"},n.createElement(Ia.a,{tyle:{marginBottom:"10px"},title:"Load/Save Data",onDragStart:this.onDragStart,name:"load",help:"Load file/db as table",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Load data"),n.createElement(Ia.a,{tyle:{marginBottom:"10px"},title:"Save Data",onDragStart:this.onDragStart,name:"save",help:"Save table into file/db ",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Save data"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Algorithms"},n.createElement(Ia.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"TfIdfInPlace",help:"Use TfIdfInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"TfIdf"),n.createElement(Ia.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Word2VecInPlace",help:"Use Word2VecInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Word2vec"),n.createElement(Ia.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RandomForest",help:"Use RandomForest to train a model",draggable:!0,color:"magenta"},"RandomForest"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonAlg",help:"Run python lib to train",draggable:!0,color:"magenta"},"Python Algorithm"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"BigDLClassifyExt",help:"Use BigDL to develop deep learning algorithm",draggable:!0,color:"magenta"},"Deep Learning"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"NaiveBayes",help:"Use NaiveBayes",draggable:!0,color:"magenta"},"NaiveBayes"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Python"},n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonEnvExt",processtype:"tool",help:"Create Python Env",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Create Python Env"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonParallelExt",processtype:"tool",help:"Run python project",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Run python project")))),n.createElement("br",null),n.createElement(Wt.a,{gutter:16},n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Register model as Function"},n.createElement(Ia.a,{onDragStart:this.onDragStart,name:"ScriptUDF",processtype:"tool",onDoubleClick:this.etDoubleClick,help:"Use ScriptUDF create udf",draggable:!0,color:"magenta"},"Create UDF"),n.createElement(Ia.a,{onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"register",help:"Register model to function ",pathalias:"Model saved path",outputtablealias:"Function name",tablealias:"Function name",tablehidden:"true",pathhidden:"false",outputtablehidden:"false",draggable:!0,color:"magenta"},"Register Model As Function"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Jobs"},n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"JobList",onDoubleClick:this.etDoubleClick,processtype:"direct",draggable:!0,color:"magenta"},"Show jobs"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Kill",onDoubleClick:this.etDoubleClick,processtype:"tool",pathalias:"groupId or jobName",tablehidden:"true",help:"Kill your job",draggable:!0,color:"magenta"},"Kill job"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETStreamProgress",processtype:"",help:"Show Progress of Stream",draggable:!0,color:"magenta"},"Show Stream Job Progress"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Tools"},n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadExt",processtype:"tool",help:"Use DownloadExt to download files you have uploaded",draggable:!0,color:"magenta"},"Download uploaded file"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ImageLoaderExt",processtype:"tool",help:"Use ImageLoaderExt to load images",pathalias:"",tablehidden:"true",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Load images"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ConnectMySQL",processtype:"direct",help:"",draggable:!0,color:"magenta"},"Connect MySQL"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"JDBC",processtype:"tool",pathalias:"DB name in connect",tablehidden:"false",help:"Run DLL on MySQL",draggable:!0,color:"magenta"},"MySQL DDL"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"TreeBuildExt",processtype:"tool",pathalias:"",tablehidden:"false",pathhidden:"true",help:"Build tree from parent-child",draggable:!0,color:"magenta"},"Parent-Child"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETExample",processtype:"",help:"Show Example of ET",draggable:!0,color:"magenta"},"Show ET Example"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RepartitionExt",processtype:"tool",help:"Change Table Partition Num",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Repartition table"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"SendMessage",processtype:"tool",help:"Send email",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Send Mail"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"CacheExt",processtype:"tool",help:"Cache table",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Cache Table"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"StringIndex",processtype:"tool",help:"Convert String to number",pathalias:"Mapping path",tablehidden:"false",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Convert String to number"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadFile",processtype:"tool",help:"Download File",pathalias:"Target file",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Download File to computer"),n.createElement(Ia.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ShowResource",processtype:"direct",draggable:!0,color:"magenta"},"Cluster Resource")))))),this.renderPop())}}var Da=a(1159),Ra=a(260),Fa=a(499);const La=Da.a.TreeNode,Ma=Da.a.DirectoryTree;class qa extends n.Component{constructor(e){super(e),this.state={dbs:{},loading:!1}}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a,n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.next=3,Le.tablesInDeltaLake();case 3:200===(a=t.sent).status&&(n={},a.content.forEach(e=>{n[e.database]?n[e.database].push(e.table):n[e.database]=[e.table]}),e.setState({dbs:n})),e.setState({loading:!1});case 6:case"end":return t.stop()}}),t)})))()}show(){return Object.entries(this.state.dbs).map(([e,t])=>n.createElement(La,{title:e,key:e},t.map(t=>n.createElement(La,{icon:n.createElement(Fa.a,null),title:t,key:"".concat(e,".").concat(t),isLeaf:!0}))))}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return n.createElement(Ra.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Ma,null,this.show()))}}const Va=Da.a.TreeNode,Ba=Da.a.DirectoryTree;class Ga extends n.Component{constructor(e){var t;super(e),t=this,this.getFileList=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.ls(a);case 2:if(200!==(n=e.sent).status||n.content[0]._corrupt_record){e.next=6;break}return r=n.content.map(e=>(e.is_dir=t.isDir(e),e.key=e.path,e.title=e.path.split("/").slice(-1)[0],e.isLeaf=!e.is_dir,e)),e.abrupt("return",r);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isDir=e=>e.permission.startsWith("d"),this.onLoadData=function(){var e=Object(i.a)(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getFileList(a.props.dataRef.path);case 2:a.props.dataRef.children=e.sent,t.setState({root:[...t.state.root]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.renderTreeNodes=e=>e.map(e=>e.children?n.createElement(Va,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e},this.renderTreeNodes(e.children)):n.createElement(Va,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e})),this.state={root:[],loading:!1}}reload(){var e=this;return Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.next=3,e.getFileList("/");case 3:a=t.sent,e.setState({loading:!1,root:a});case 5:case"end":return t.stop()}}),t)})))()}componentDidMount(){var e=this;return Object(i.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",null,n.createElement(Ra.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Ba,{loadData:this.onLoadData},this.renderTreeNodes(this.state.root))))}}a(457);var Ua=a(490),Ja=a(498),Ka=a(488),Ha=a(487),Qa=a(477);const Wa=a(105),za={setState:Wa.SetStateActionHandler},Ya={setState:Wa.SetStateAction},Xa=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new d.ActionProxy,n=t.data,r=n.node,s=n.consoleApp,r.isDir){e.next=10;break}return e.next=5,a.get(h.default.SCRIPT_FILE_GET,{id:r.id});case 5:if(200===(o=e.sent).status){e.next=8;break}return e.abrupt("return",{data:{error:"Fail to get file ".concat(r.label,". Reason: ").concat(o.content)}});case 8:c=o.content,s.openExistsOrNewEditor({id:r.id,content:c.content,name:c.name});case 10:return e.abrupt("return",{data:{}});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),$a=Xa.handler,Za=Xa.action,en=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,u,p,m,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new d.ActionProxy,n=t.data,r=n.createType,n.consoleApp,s=n.form,o=n.scriptContent,c=void 0===o?"":o,i=s.getFieldValue(),u=i.fileName){e.next=5;break}return e.abrupt("return",{data:{createFileError:"Please input the file name"}});case 5:p=t.__state.node,m=!1,e.t0=r,e.next="file"===e.t0?10:"folder"===e.t0?14:16;break;case 10:if(m=!1,u.endsWith(".mlsql")||u.endsWith(".nb")||u.endsWith(".py")){e.next=13;break}return e.abrupt("return",{data:{createFileError:"fileName should end with .mlsql or .nb or .py"}});case 13:return e.abrupt("break",16);case 14:return m=!0,e.abrupt("break",16);case 16:return b={fileName:u,isDir:m,content:c,parentId:p.id},e.next=19,a.post(h.default.SAVE_SCRIPT_FILE,b);case 19:return e.sent,e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{reloading:Zt.getJobName()})});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),tn=en.handler,an=en.action,nn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.expandedKeys,n=t.__state.expandedKeys,r=a.filter(e=>!n.includes(e)),s=n.filter(e=>!a.includes(e)),o=new d.ActionProxy,console.log(r,s),r.forEach(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.forEach(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!1});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",{data:{expandedKeys:a}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),rn=nn.handler,sn=nn.action,on=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.node,e.next=3,d.ActionProxy.client.post(h.default.SCRIPT_FILE_REMOVE,{id:a.id});case 3:return e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{reloading:Zt.getTempTableName()})});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),cn=on.handler,ln=on.action,un=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new d.ActionProxy,n=t.data,r=n.node,n.consoleApp,r.isDir){e.next=8;break}return e.next=5,a.post(h.default.ANALYSIS_PLUGIN_PUBLISH,{id:r.id});case 5:if(200===(s=e.sent).status){e.next=8;break}return e.abrupt("return",{data:{error:"Fail to publish file ".concat(r.label,". Reason: ").concat(s.content)}});case 8:return e.abrupt("return",{data:{}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),pn=un.handler,mn=un.action,dn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,n=t.data,r=n.node,n._,e.next=4,a.post(h.default.SCRIPT_SHARE_PUBLIC,{id:r.id});case 4:if(200===(s=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{error:"Fail to share ".concat(r.label,". Reason: ").concat(s.content)}});case 7:return e.abrupt("return",{data:{}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),hn=dn.handler,bn=dn.action;class fn{}fn.openScriptFile="openScriptFile",fn.createScriptFile="createScriptFile",fn.deleteScriptFile="deleteScriptFile",fn.publishPlugin="publishPlugin",fn.sharePublic="publishPlugin",fn.expand="expand";const En=Object(y.a)(Object(y.a)({},za),{},{[fn.openScriptFile]:$a,[fn.createScriptFile]:tn,[fn.expand]:rn,[fn.deleteScriptFile]:cn,[fn.publishPlugin]:pn,[fn.sharePublic]:hn}),gn=Object(y.a)(Object(y.a)({},Ya),{},{[fn.openScriptFile]:Za,[fn.createScriptFile]:an,[fn.expand]:sn,[fn.deleteScriptFile]:ln,[fn.publishPlugin]:mn,[fn.sharePublic]:bn});function yn(e,t){return gn[t.type](e,t.data)}var vn=a(492),wn=a(489);a(1139);var kn=class{constructor(){this.build=e=>{let t,a,n={},r=[];for(a=0;a<e.length;a+=1)n[e[a].id]=a,e[a].childNodes=[];for(a=0;a<e.length;a+=1)if(t=e[a],0!==t.parentId)try{e[n[t.parentId]].childNodes.push(t)}catch(s){console.log(t),console.log(n[t.parentId])}else r.push(t);return r},this.convert=e=>(e.childNodes&&e.childNodes.length>0&&(e.children=e.childNodes,e.children.map(e=>this.convert(e))),e.id=String(e.id),e.key=e.id,e.title=r.a.createElement("span",null,e.label),e.isLeaf=!e.isDir,e.isExpand=!e.isExpanded,e.isDir?e.icon=r.a.createElement(vn.a,null):e.icon=r.a.createElement(wn.a,null),e)}};function xn(){const e=Object(re.a)(["\n  width: 100%; \n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 30px 30px;\n"]);return xn=function(){return e},e}const Sn=se.a.div(xn());var On=function(){return r.a.createElement(Sn,null,r.a.createElement(Ra.a,{tip:"Loading...."}))};const jn=({contextMenuRef:e,dispacher:t,onRender:a})=>{const s=Object(n.useState)(void 0),o=Object(u.a)(s,2),c=o[0],l=o[1];return{onRightClick:Object(n.useCallback)(t=>{const a=t.event,n=t.node;let r=a.clientX,s=a.clientY;const o=t=>{if(!e.current)return;!e.current.contains(t.target)&&l(void 0)};document.addEventListener("click",o);const c=()=>{l(void 0)};return document.addEventListener("scroll",c),l({pageX:r,pageY:s,id:n.id||n.key}),()=>{document.removeEventListener("click",o),document.removeEventListener("scroll",c)}},[l]),ui:Object(n.useCallback)(()=>{if(!c)return;const n=Object(y.a)({},c),s=n.pageX,o=n.pageY,i=(n.id,{zIndex:1e4,position:"fixed",left:"".concat(s,"px"),top:"".concat(o,"px"),borderRadius:"3px",boxShadow:"0 0 0 1px rgba(16, 22, 26, 0.1), 0 2px 4px rgba(16, 22, 26, 0.2), 0 8px 24px rgba(16, 22, 26, 0.2)"});return r.a.createElement("div",{ref:e,style:i},a({rightClickNodeTreeItem:c,setRightClickNodeTreeItem:l,dispacher:t}))},[c])}},Tn=Da.a.DirectoryTree,Nn={nodes:[],error:void 0,createFileError:void 0,createType:void 0,createTitle:void 0,operateModal:!1,reloading:void 0,loading:!0,expandedKeys:[]},Cn=r.a.createContext();function _n(e){const t=e.consoleApp,a=Object(p.useReducerAsync)(yn,Nn,En),s=Object(u.a)(a,2),o=s[0],c=s[1],m=o.loading,b=o.nodes,f=o.error,E=o.createFileError,g=o.createType,y=o.operateModal,v=o.createTitle,w=o.reloading,k=o.expandedKeys,x=new d.ActionProxy,S=Object(n.useRef)(),O=H.a.useForm(),j=Object(u.a)(O,1)[0];Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get(h.default.SCRIPT_SHARE_PUBLIC,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,x.get(h.default.SCRIPT_FILE_LIST,{});case 7:if(200===(a=e.sent).status){e.next=10;break}return e.abrupt("return");case 10:n=new kn,s=n.build(a.content).sort((e,t)=>t.id-e.id),t.content.map(e=>{e[0].parentId=0,e[0].label=r.a.createElement("span",{style:{color:"green"}},e[0].label+"(shared by others)");const t=n.build(e);return s[0].childNodes=s[0].childNodes.concat(t[0]),e}),o=s.map(e=>n.convert(e)),Zt.visitDown(o[0],e=>{e.isExpanded&&k.push(e.id)}),c({type:"setState",data:{nodes:o,loading:!1,expandedKeys:k}});case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[w]);const T=jn({contextMenuRef:S,dispacher:c,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;let s=void 0;return Zt.visitDown(b[0],e=>{e.id===n&&(s=e)}),n===b[0].id?r.a.createElement(C.a,null,r.a.createElement(C.a.Item,{icon:r.a.createElement(Ua.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"folder",createTitle:"Create Project",operateModal:!0}})}},"Create Project")):s.isDir?r.a.createElement(C.a,null,s.parentId==b[0].id&&r.a.createElement(C.a.Item,{icon:r.a.createElement(Ja.a,null),onClick:()=>{a({type:fn.sharePublic,data:{node:s}}),t(void 0)},key:0},"Share Public"),r.a.createElement(C.a.Item,{icon:r.a.createElement(Ka.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"file",createTitle:"Create File",operateModal:!0}}),t(void 0)},key:1},"Create Script"),r.a.createElement(C.a.Item,{icon:r.a.createElement(Ua.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"folder",createTitle:"Create Folder",operateModal:!0}}),t(void 0)},key:2},"Create Folder"),r.a.createElement(C.a.Item,{icon:r.a.createElement(Ha.a,null),onClick:()=>{a({type:fn.deleteScriptFile,data:{node:s}}),t(void 0)},key:3},"Delete")):r.a.createElement(C.a,null,r.a.createElement(C.a.Item,{onClick:()=>{a({type:fn.publishPlugin,data:{node:s}}),t(void 0)},key:0},"Publish As Plugin To Analysis"),r.a.createElement(C.a.Item,{onClick:()=>{a({type:fn.deleteScriptFile,data:{node:s}}),t(void 0)},key:1},"Delete"))}}),N=T.onRightClick,_=T.ui;return r.a.createElement(Cn.Provider,{value:{dispacher:c}},_(),r.a.createElement($e.a,{title:v,visible:y,onCancel:()=>{c({type:"setState",data:{operateModal:!1}})},onOk:()=>{c({type:fn.createScriptFile,data:{operateModal:!1,consoleApp:t,createType:g,form:j}})},cancelText:"Cancel",OkText:"Ok"},E&&r.a.createElement(le,{message:E}),r.a.createElement(H.a,{form:j},r.a.createElement(H.a.Item,{name:"fileName",label:"File Name"},r.a.createElement(Q.a,null)))),f&&r.a.createElement(le,{message:f}),m&&r.a.createElement(On,null),!m&&r.a.createElement(Tn,{height:700,onExpand:e=>{c({type:fn.expand,data:{expandedKeys:e}})},onDoubleClick:(e,a)=>{c({type:fn.openScriptFile,data:{consoleApp:t,node:a}})},defaultExpandedKeys:k,expandAction:"click",onRightClick:N,switcherIcon:r.a.createElement(Qa.a,null),treeData:b}))}const In=tt.a.TabPane;class Pn extends n.Component{constructor(e){super(e),this.queryApp=e.parent}render(){return n.createElement(tt.a,{defaultActiveKey:"1",style:{maxWidth:"350px"},onTabClick:e=>{"2"===e&&this.deltaLakeTreeRef&&this.deltaLakeTreeRef.reload()}},n.createElement(In,{tab:"Script",key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(_n,{consoleApp:this.queryApp}))),n.createElement(In,{tab:"DeltaLake",key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(qa,{ref:e=>this.deltaLakeTreeRef=e}))),n.createElement(In,{tab:"FileSystem",key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Ga,{ref:e=>this.fileSystemTreeRef=e}))))}}a(458);class An extends n.Component{constructor(e){super(e),this.openExistsOrNewEditor=e=>{const t=this;if(this.fileToEditorMap.hasOwnProperty(e.id)){const t=this.fileToEditorMap[e.id];t.ref.text(e.content,e.id),this.editorGroup.current.onChange(t.activeKey)}else this.editorGroup.current.addFull(e.name,a=>{a.ref.text(e.content,e.id),t.fileToEditorMap[e.id]=a});e.name.endsWith(".nb")?t.setState({displayEditor:"notebook"}):e.name.endsWith(".py")?t.setState({displayEditor:"pythoneditor"}):t.setState({displayEditor:"normal"})},this.closeEditor=e=>{const t=Object.keys(this.fileToEditorMap).filter(t=>this.fileToEditorMap[t].activeKey!==e.activeKey).reduce((e,t)=>(e[t]=this.fileToEditorMap[t],e),{});this.fileToEditorMap=t},this.getCurrentEditor=()=>this.editorGroup.current.getCurrentEditor(),this.setData=e=>{this.queryResData=e,this.dash.current.refresh()},this.tableAndDash=()=>{if("notebook"!==this.state.displayEditor||"pythoneditor"!==this.state.displayEditor)return r.a.createElement("div",null,r.a.createElement(Ae.Resizable,{defaultSize:{height:"300px"},onResize:()=>{this.messageBox.current.editor.resize()}},r.a.createElement(fe.a,{height:"100%",width:"100%",ref:this.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",null,r.a.createElement(Tt,{ref:this.dash,parent:this})),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(et,{ref:this.display,parent:this})))},this.state={sqlContent:"",displayEditor:"normal"},this.editorGroup=r.a.createRef(),this.messageBox=r.a.createRef(),this.display=r.a.createRef(),this.dash=r.a.createRef(),this.etRef=r.a.createRef(),this.fileToEditorMap={}}render(){return r.a.createElement("div",{className:"ws-app"},r.a.createElement("div",{className:"ws-left-pane"},r.a.createElement(Ae.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},r.a.createElement(Pn,{ref:e=>this.leftTreePaneRef=e,parent:this}))),r.a.createElement("div",{className:"ws-right-pane"},r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(Aa,{ref:this.etRef,parent:this})),r.a.createElement(Qt,{ref:this.editorGroup,parent:this}),this.tableAndDash()))}}var Dn=An,Rn=a(1160);class Fn{constructor(e){this.superclass=e}with(...e){return e.reduce((e,t)=>t(e),this.superclass)}}var Ln=e=>new Fn(e);const Mn=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.toggleNewSession=()=>{this.setState({showNewSession:!this.state.showNewSession})},this.showNewSession=e=>{if(!e.node.props.table)return;const t={table:e.node.props.table,db:e.node.props.db};this.setState({showNewSession:!0,currentTable:t})},this.currentTableName=()=>this.state.currentTable?this.state.currentTable.db+"."+this.state.currentTable.table:"",this.showTable=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({showNewSession:!1}),n=t.state.currentTable,r=n.db,s=n.table,t.workshop.newSession(a,r,s);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},qn=(Da.a.TreeNode,Da.a.DirectoryTree);class Vn extends(Ln(Ga).with(Mn)){constructor(e){var t;super(e),t=this,this.showNewSession=e=>{const t={table:e.node.props.dataRef.path,db:""};this.setState({showNewSession:!0,currentTable:t})},this.showTable=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({showNewSession:!1}),s=t.state.currentTable,s.db,o=s.table,t.workshop.newSession(a,n,o,r);case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.render=()=>n.createElement("div",null,n.createElement($e.a,{title:"Open Table: [".concat(this.currentTableName(),"]?"),visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:()=>{this.showTable("file",this.loadPopRef.data.sourceTypeV,this.loadPopRef.data.params)},cancelText:"Cancel",OkText:"Ok"},n.createElement(aa,{key:this.currentTableName(),ignorePath:!0,ignoreTableName:!0,ref:e=>this.loadPopRef=e,parent:this})),n.createElement(Ra.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(qn,{height:700,loadData:this.onLoadData,expandAction:"doubleClick",onRightClick:this.showNewSession},this.renderTreeNodes(this.state.root)))),this.workshop=e.parent.workshop}}const Bn=Da.a.TreeNode,Gn=Da.a.DirectoryTree;class Un extends(Ln(qa).with(Mn)){constructor(e){super(e),this.tableClick=e=>{this.setState({rightClickNodeTreeItem:{pageX:e.event.pageX,pageY:e.event.pageY,table:e.node.props.table,db:e.node.props.db}})},this.workshop=e.parent.workshop}show(){return Object.entries(this.state.dbs).map(([e,t])=>n.createElement(Bn,{title:e,key:e},t.map(t=>n.createElement(Bn,{icon:n.createElement(Fa.a,null),title:t,table:t,db:e,key:"".concat(e,".").concat(t),isLeaf:!0}))))}render(){return n.createElement("div",null,n.createElement($e.a,{title:"Open Table",visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:()=>{this.showTable("delta")},cancelText:"Cancel",OkText:"Ok"},"Open  ".concat(this.currentTableName(),"]?")),n.createElement(Ra.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Gn,{onRightClick:this.showNewSession},this.show())))}}const Jn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.tablesInWorkshop();case 2:if(200!==(a=e.sent).status){e.next=7;break}return n={},a.content.forEach(e=>{n[e.sessionId]?n[e.sessionId].push(e.tableName):n[e.sessionId]=[e.tableName]}),e.abrupt("return",{data:Object(y.a)({dbs:n},t.data)});case 7:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Kn=Jn.handler,Hn=Jn.action,Qn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.openTable,a.workshop.newSession("temp","",n),e.abrupt("return",{data:{}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Wn=Qn.handler,zn=Qn.action,Yn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.id,n=new d.ActionProxy,e.next=4,n.get(h.default.ANALYSIS_TABLE_DELETE,{tableName:a});case 4:return e.abrupt("return",{data:{reloading:Zt.getJobName()}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Xn=Yn.handler,$n=Yn.action,Zn=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,u,p,m,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.targetPath,r=a.workshop,s=t.__state.exportTable,o=s.name,c=s.type,e.next=5,r.buildLoadSQL("temp","",o);case 5:i=e.sent,u=i.sql,p=i.tableName,m=e=>{h.runScript("\n             ".concat(u,"\n             save ignore ").concat(p," as ").concat(e,".`").concat(n,"`;\n            "),Zt.getJobName(),{async:!0})},h=new d.ActionProxy,e.t0=c,e.next="hive"===e.t0?13:"file"===e.t0?15:"delta"===e.t0?17:19;break;case 13:return m("hive"),e.abrupt("break",19);case 15:return m("parquet"),e.abrupt("break",19);case 17:return m("delta"),e.abrupt("break",19);case 19:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),er=Zn.handler,tr=Zn.action;class ar{}ar.LOAD="load",ar.OPEN="open",ar.DELETE="delete",ar.EXPORT_TO="exportTo";const nr=Object(y.a)(Object(y.a)({},za),{},{[ar.LOAD]:Kn,[ar.OPEN]:Wn,[ar.DELETE]:Xn,[ar.EXPORT_TO]:er}),rr=Object(y.a)(Object(y.a)({},Ya),{},{[ar.LOAD]:Hn,[ar.OPEN]:zn,[ar.DELETE]:$n,[ar.EXPORT_TO]:tr});function sr(e,t){return rr[t.type](e,t.data)}var or=a(491),cr=a(486),lr=a(485);const ir=Da.a.TreeNode,ur=Da.a.DirectoryTree,pr=C.a.SubMenu,mr={dbs:{},loading:!1,openTable:void 0,confirm:!1,reloading:void 0,exportTo:!1,exportTable:{name:void 0,type:void 0}},dr=r.a.createContext();function hr(e){const t=e.workshop,a=e.reload,s=Object(p.useReducerAsync)(sr,mr,nr),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.dbs,m=c.loading,d=c.openTable,h=c.confirm,b=c.reloading,f=c.exportTo,E=c.exportTable,g=Object(n.useRef)(),y=H.a.useForm(),v=Object(u.a)(y,1)[0],w=jn({contextMenuRef:g,dispacher:l,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:a,dispacher:n})=>{const s=e.id;return r.a.createElement(C.a,null,r.a.createElement(C.a.Item,{icon:r.a.createElement(or.a,null),onClick:()=>{n({type:ar.OPEN,data:{openTable:s,workshop:t}}),n({type:"setState",data:{confirm:!1}}),a(void 0)},key:1},"Open Table"),r.a.createElement(pr,{icon:r.a.createElement(cr.a,null),title:"Export"},r.a.createElement(C.a.Item,{icon:r.a.createElement(lr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"hive"},exportTo:!0,workshop:t}}),a(void 0)},key:1.1},"to Hive"),r.a.createElement(C.a.Item,{icon:r.a.createElement(lr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"delta"},exportTo:!0}}),a(void 0)},key:1.2},"to Delta"),r.a.createElement(C.a.Item,{icon:r.a.createElement(lr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"file"},exportTo:!0}}),a(void 0)},key:1.3},"to FileSystem")),r.a.createElement(C.a.Item,{onClick:()=>{n({type:ar.DELETE,data:{id:s}}),a(void 0)},key:2,icon:r.a.createElement(Ha.a,null)},"Delete"))}}),k=w.onRightClick,x=w.ui;return Object(n.useEffect)(()=>{l({type:"setState",data:{loading:!0}}),l({type:ar.LOAD,data:{loading:!1}})},[b,a]),r.a.createElement(dr.Provider,{value:{dispacher:l}},r.a.createElement($e.a,{title:"Export to ".concat(E.type),visible:f,onCancel:()=>{l({type:"setState",data:{exportTo:!1}})},onOk:()=>{const e=v.getFieldsValue().targetPath;v.resetFields(),l({type:ar.EXPORT_TO,data:{exportTo:!1,targetPath:e,workshop:t}})},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(H.a,{form:v},r.a.createElement(H.a.Item,{rules:[{required:!0,message:"Target is required."}],label:"Target",name:"targetPath"},r.a.createElement(Q.a,null)))),r.a.createElement($e.a,{title:"Open Table",visible:h,onCancel:()=>{l({type:"setState",data:{confirm:!1}})},onOk:()=>{l({type:"dispatch",data:{openTable:d}})},cancelText:"Cancel",OkText:"Ok"},"Open ".concat(d,"?")),r.a.createElement(Ra.a,{tip:"Loading...",spinning:m},x(),r.a.createElement(ur,{height:700,onDoubleClick:(e,a)=>{l({type:ar.OPEN,data:{openTable:a.id,workshop:t}}),l({type:"setState",data:{confirm:!1}})},onRightClick:k},Object.entries(i).flatMap(([e,t])=>t.map(t=>r.a.createElement(ir,{icon:r.a.createElement(Fa.a,null),id:t,table:t,db:e,title:t,key:t,isLeaf:!0}))))))}const br=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,r,s,o,c,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,r=a.dbName,a.node,s=new d.ActionProxy,r){e.next=9;break}return e.next=5,s.runScript('!profiler sql "show databases";',Zt.getJobName(),Zt.robotFetchParam());case 5:if(200!==(o=e.sent).status){e.next=9;break}return c=o.content.data.map(e=>(e.key=e.databaseName||e.namespace,e.title=e.key,e.isLeaf=!1,e.children=[],e)),e.abrupt("return",{data:Object(y.a)({dbs:c},t.data)});case 9:if(!r){e.next=20;break}return e.next=12,s.runScript('!profiler sql "use '.concat(r,'";'),Zt.getJobName(),Zt.robotFetchParam());case 12:return e.next=14,s.runScript('!profiler sql "show tables";',Zt.getJobName(),Zt.robotFetchParam());case 14:if(200!==(o=e.sent).status){e.next=20;break}return i=o.content.data.filter(e=>(e.database||e.namespace)===r).map(e=>(e.key="".concat(r,".").concat(e.tableName),e.title=e.tableName,e.isLeaf=!0,e.icon=n.createElement(Fa.a,null),e)),c=t.__state.dbs,u=c.map(e=>(e.key===r&&(e.children=i),e)),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{dbs:u})});case 20:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),fr=br.handler,Er=br.action,gr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,p,m,d,h,b,f,E,g;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.openTable,r=a.workshop,s=a.partitionValues,o=a.partitionColumn,c=n.split("."),i=Object(u.a)(c,2),p=i[0],m=i[1],d=s.tableRandom,h=s.tableStart,b=s.tableEnd,f=o&&Zt.getField(o),o&&d?(E=f+" in ("+d.map(e=>'"'.concat(Zt.escapeQuote(e),'"')).join(",")+")",r.newSession("hive",p,m,{__where__:E})):o&&h&&b?(g="".concat(f," >= ").concat(Zt.quote(h)," and ").concat(Zt.quote(b)," >= ").concat(f,"  "),r.newSession("hive",p,m,{__where__:g})):r.newSession("hive",p,m),e.abrupt("return",{data:{}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),yr=gr.handler,vr=gr.action,wr=(e,t)=>e.map(e=>{const a=e.title.indexOf(t),n=e.title.substr(0,a),s=e.title.substr(a+t.length),o=a>-1?r.a.createElement("span",null,n,r.a.createElement("span",{className:"site-tree-search-value"},t),s):r.a.createElement("span",null,e.title);return e.children?Object(y.a)(Object(y.a)({},e),{},{title:o,children:wr(e.children,t)}):Object(y.a)(Object(y.a)({},e),{},{title:o})}),kr=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.dbs,n=t.data.searchValue){e.next=4;break}return e.abrupt("return",{data:{expandedKeys:[],search_dbs:a}});case 4:return r=[],s=a.flatMap(e=>{var t;const a=(null===(t=e.children)||void 0===t?void 0:t.map(t=>t.title.indexOf(n)>-1?e.key:null).filter(e=>e))||[];return e.title.indexOf(n)>-1&&r.push(e.key),a}),s=Zt.distinct(s),o=wr(a,n).filter(e=>s.includes(e.key)||r.includes(e.key)),e.abrupt("return",{data:{expandedKeys:s,search_dbs:o}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),xr=kr.handler,Sr=kr.action;class Or{}Or.LOAD="load",Or.OPEN="open",Or.SEARCH="search";const jr=Object(y.a)(Object(y.a)({},za),{},{[Or.LOAD]:fr,[Or.OPEN]:yr,[Or.SEARCH]:xr}),Tr=Object(y.a)(Object(y.a)({},Ya),{},{[Or.LOAD]:Er,[Or.OPEN]:vr,[Or.SEARCH]:Sr});function Nr(e,t){return Tr[t.type](e,t.data)}Da.a.TreeNode;const Cr=Da.a.DirectoryTree,_r={dbs:[],loading:!1,openTable:void 0,confirm:!1,reloading:void 0,expandedKeys:[]},Ir=r.a.createContext();function Pr(e){const t=ql.workshop,a=e.reload,s=Object(p.useReducerAsync)(Nr,_r,jr),o=Object(u.a)(s,2),c=o[0],m=o[1],h=c.dbs,b=c.loading,f=c.openTable,E=c.confirm,g=c.reloading,y=c.search_dbs,v=c.expandedKeys,w=function(){const e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(!1),c=Object(u.a)(o,2),p=c[0],m=c[1],h=Object(n.useState)([]),b=Object(u.a)(h,2),f=b[0],E=b[1],g=Object(n.useState)(void 0),y=Object(u.a)(g,2),v=y[0],w=y[1],k=Object(n.useState)(void 0),x=Object(u.a)(k,2),S=x[0],O=x[1],j=Object(n.useState)(!1),T=Object(u.a)(j,2),N=T[0],C=T[1],P=H.a.useForm(),A=Object(u.a)(P,1)[0],D=new d.ActionProxy;Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return t=a.split("."),n=Object(u.a)(t,2),r=n[0],s=n[1],m(!0),e.next=6,D.runScript("!profiler sql 'show partitions ".concat(r,".").concat(s,"';"),Zt.getJobName(),Zt.robotFetchParam());case 6:200===(o=e.sent).status?(c=o.content.data.map(e=>{const t=e.partition.split("/")[0].split("="),a=Object(u.a)(t,2),n=a[0],r=a[1];return S||O(n),{column:n,value:r}}),E(c),C(!1),0===c.length&&C(!0)):(E([]),C(!0)),m(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[a]);const R=f.reverse().map(e=>r.a.createElement(Pe.a.Option,{value:e.value},e.value));return{ui:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(Ra.a,{spinning:p},v&&r.a.createElement(_.a,{style:{marginBottom:"30px"},type:"error",message:v}),N&&r.a.createElement(B.a,{id:"no_partition_msg"}),!N&&r.a.createElement(H.a,{form:A},r.a.createElement(H.a.Item,{name:"tableStart",label:r.a.createElement(B.a,{id:"table_start"})},r.a.createElement(Pe.a,{showSearch:!0},R)),r.a.createElement(H.a.Item,{name:"tableEnd",label:r.a.createElement(B.a,{id:"table_end"})},r.a.createElement(Pe.a,{showSearch:!0},R)),r.a.createElement(I.a,null),r.a.createElement(H.a.Item,{name:"tableRandom",label:r.a.createElement(B.a,{id:"table_random"})},r.a.createElement(Pe.a,{mode:"tags"},R))))),form:A,setOpenTable:s,setError:w,partitionColumn:S,noPartition:N}}(),k=w.ui,x=w.form,S=w.setOpenTable,O=w.setError,j=w.partitionColumn,T=w.noPartition,N=Object(n.useRef)(),P=jn({contextMenuRef:N,dispacher:m,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;return console.log(n),r.a.createElement(C.a,null,r.a.createElement(C.a.Item,{icon:r.a.createElement(or.a,null),onClick:()=>{a({type:"setState",data:{confirm:!0,openTable:n}}),t(void 0)},key:1},"Open Table"))}}),A=P.onRightClick,D=P.ui;return Object(n.useEffect)(()=>{m({type:"setState",data:{loading:!0}}),m({type:Or.LOAD,data:{loading:!1}})},[g,a]),Object(n.useEffect)(()=>{S(f)},[S,f]),r.a.createElement(Ir.Provider,{value:{dispacher:m}},r.a.createElement($e.a,{title:r.a.createElement(B.a,{id:"analysis_range"}),visible:E,onCancel:()=>{m({type:"setState",data:{confirm:!1}}),x.resetFields()},onOk:()=>{const e=x.getFieldsValue();T||e.tableRandom||e.tableStart&&e.tableEnd?(m({type:Or.OPEN,data:{openTable:f,workshop:t,partitionValues:e,partitionColumn:j}}),m({type:"setState",data:{confirm:!1}}),x.resetFields()):O("Partitions is required.")},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(k,null)),r.a.createElement(Ra.a,{tip:"Loading...",spinning:b},D(),r.a.createElement(Q.a,{style:{marginBottom:8},placeholder:"Search",onChange:e=>{m({type:Or.SEARCH,data:{searchValue:e.target.value}})}}),r.a.createElement(Cr,{height:700,expandedKeys:v,treeData:y||h,loadData:function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m({type:"setState",data:{loading:!0}}),m({type:Or.LOAD,data:{dbName:t.key,node:t,loading:!1}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),expandAction:"click",onExpand:e=>{m({type:"setState",data:{expandedKeys:e}})},onDoubleClick:(e,t)=>{t.isLeaf&&m({type:"setState",data:{confirm:!0,openTable:t.key}})},onRightClick:({event:e,node:t})=>{t.isLeaf&&A({event:e,node:t})}})))}const Ar=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,p,m,b,f,E,g,v,w,k,x;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.partitionValues,r=a.openTable,s=a.partitionNumValue,o=a.workshop,c=r.split("."),i=Object(u.a)(c,2),p=i[0],m=i[1],b=n.partitionColumn,f=n.lowerBound,E=n.upperBound,g=new d.ActionProxy,e.next=6,g.get(h.default.DS_MYSQL_CONNECT,{name:p});case 6:return v=e.sent,w=Zt.getTempTableName(),k="",b&&(k='where partitionColumn="'.concat(b,'" \n        and lowerBound="').concat(f,'" \n        and upperBound="').concat(E,'"\n        and numPartitions="').concat(s,'"\n        ')),x="\n      ".concat(v.content.connect,"\n      load jdbc.`").concat(r,"` ").concat(k," as ").concat(w,";    \n    "),o.newSession("jdbc",p,m,{__sql__:x,__tableName__:w}),e.abrupt("return",{data:Object(y.a)({},t.data)});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Dr=Ar.handler,Rr=Ar.action;class Fr{}Fr.OPEN="open";const Lr=Object(y.a)(Object(y.a)({},za),{},{[Fr.OPEN]:Dr}),Mr=Object(y.a)(Object(y.a)({},Ya),{},{[Fr.OPEN]:Rr});function qr(e,t){return Mr[t.type](e,t.data)}var Vr=a(1148),Br=a(1163);function Gr(e){const t=Object(n.useState)(e.initialValue||10),a=Object(u.a)(t,2),s=a[0],o=a[1];return{ui:()=>r.a.createElement(Wt.a,null,r.a.createElement(zt.a,{span:12},r.a.createElement(Vr.a,{min:e.min||10,max:e.max||300,onChange:e=>{o(e)},value:s})),r.a.createElement(zt.a,{span:4},r.a.createElement(Br.a,{min:e.min||10,max:e.max||300,style:{margin:"0 16px"},value:s,onChange:e=>{o(e)}}))),value:s}}function Ur(){const e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(!1),c=Object(u.a)(o,2),p=c[0],m=(c[1],Object(n.useState)([])),b=Object(u.a)(m,2),f=b[0],E=b[1],g=Object(n.useState)(""),v=Object(u.a)(g,2),w=v[0],k=v[1],x=Object(n.useState)(""),S=Object(u.a)(x,2),O=S[0],j=S[1],T=H.a.useForm(),N=Object(u.a)(T,1)[0],C=new d.ActionProxy,P=Gr({initialValue:10,min:2,max:100}),A=P.ui,D=P.value;Object(n.useEffect)(()=>{if(a){const e=a.split("."),t=Object(u.a)(e,2),n=t[0],r=(t[1],Zt.getTempTableName());(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.runScript("                \n                load jdbc.`".concat(a,"` as ").concat(r,";\n                !desc ").concat(r,";\n               "),Zt.getJobName(),Object(y.a)(Object(y.a)({},Zt.robotFetchParam()),{},{__connect__:n}));case 2:200===(t=e.sent).status?E(t.content.data):E([]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}},[a]),Object(n.useEffect)(()=>{if(O){(function(){var e=Object(i.a)(l.a.mark((function e(){var t,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.split("."),n=Object(u.a)(t,2),r=n[0],s=n[1],e.next=3,C.get(h.default.DS_MYSQL_COLUMN_INFO,{dbName:r,tableName:s,columnName:O});case 3:200===(o=e.sent).status&&N.setFieldsValue({lowerBound:o.content.min,upperBound:o.content.max});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}},[O,a]);const R=f.filter(e=>"string"!==e.data_type).map(e=>r.a.createElement(Pe.a.Option,{value:e.col_name},e.col_name));return{ui:()=>0===R.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,{id:"no_mysql_parallel"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(Ra.a,{spinning:p},w&&r.a.createElement(_.a,{style:{marginBottom:"30px"},type:"error",message:w}),r.a.createElement(H.a,{form:N},r.a.createElement(H.a.Item,{name:"partitionColumn",label:r.a.createElement(B.a,{id:"partitionColumn"})},r.a.createElement(Pe.a,{onChange:e=>{j(e)}},R)),r.a.createElement(H.a.Item,{name:"lowerBound",label:r.a.createElement(B.a,{id:"lowerBound"})},r.a.createElement(Q.a,null)),r.a.createElement(I.a,null),r.a.createElement(H.a.Item,{name:"upperBound",label:r.a.createElement(B.a,{id:"upperBound"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"numPartitions",label:r.a.createElement(B.a,{id:"numPartitions"})},A())))),form:N,setOpenTable:s,setError:k,partitionNumValue:D}}const Jr=Da.a.DirectoryTree,Kr={dbs:[],loading:!1,confirm:!1,openTable:void 0,error:void 0},Hr=r.a.createContext();function Qr(){const e=ql.workshop,t=Object(p.useReducerAsync)(qr,Kr,Lr),a=Object(u.a)(t,2),s=a[0],o=a[1],c=s.dbs,m=s.loading,b=s.confirm,f=s.openTable,E=(s.error,Ur()),g=E.ui,y=E.form,v=E.setOpenTable,w=E.setError,k=E.partitionNumValue,x=Object(n.useRef)(),S=jn({contextMenuRef:x,dispacher:o,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;return r.a.createElement(C.a,null,r.a.createElement(C.a.Item,{icon:r.a.createElement(or.a,null),onClick:()=>{a({type:"setState",data:{confirm:!0,openTable:n}}),t(void 0)},key:1},"Open Table"))}}),O=S.onRightClick,j=S.ui;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o({type:"setState",data:{loading:!0}}),t=new d.ActionProxy,e.next=4,t.get(h.default.DS_MYSQL_DBS,{});case 4:200===(a=e.sent).status&&(n=a.content.data.map(e=>(e.key=e.name,e.title=e.name,e.isLeaf=!1,e.children=e.tables.map(t=>({id:"".concat(e.name,".").concat(t.name),key:"".concat(e.name,".").concat(t.name),title:t.name+(t.options.indexer?"(\u5df2\u88ab\u7d22\u5f15)":""),isLeaf:!0,icon:r.a.createElement(Fa.a,null)})),e)),o({type:"setState",data:{dbs:n}})),o({type:"setState",data:{loading:!1}});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(()=>{v(f)},[f,v]),r.a.createElement("div",{className:"leftview-box"},r.a.createElement(Hr.Provider,{value:{dispacher:o}},r.a.createElement($e.a,{title:r.a.createElement(B.a,{id:"mysql_parallel"}),visible:b,onCancel:()=>{o({type:"setState",data:{confirm:!1}}),y.resetFields()},onOk:()=>{const t=y.getFieldsValue(),a=t.partitionColumn,n=t.lowerBound,r=t.upperBound;!a||n&&(r||!k)?(o({type:Fr.OPEN,data:{openTable:f,workshop:e,partitionValues:t,partitionNumValue:k}}),o({type:"setState",data:{confirm:!1}}),y.resetFields()):w("lowerBound/upperBound/partitionNumValue should not be empty.")},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(g,null)),r.a.createElement(Ra.a,{tip:"Loading...",spinning:m},j(),r.a.createElement(Jr,{height:700,treeData:c,expandAction:"click",onDoubleClick:(e,t)=>{t.isLeaf&&o({type:"setState",data:{confirm:!0,openTable:t.key}})},onRightClick:({event:e,node:t})=>{t.isLeaf&&O({event:e,node:t})}}))))}const Wr=tt.a.TabPane;class zr extends n.Component{constructor(e){super(e),this.workshop=e.parent,this.state={reloaWorkshop:void 0}}render(){return n.createElement(tt.a,{defaultActiveKey:"1",onTabClick:e=>{"3"===e&&this.deltaLakeTreeRef&&this.deltaLakeTreeRef.reload(),"4"===e&&this.fileSystemTreeRef&&this.fileSystemTreeRef.reload()}},n.createElement(Wr,{tab:n.createElement(B.a,{id:"table_workshop"}),key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(hr,{reload:this.state.reloaWorkshop,workshop:this.workshop}))),n.createElement(Wr,{tab:n.createElement(B.a,{id:"hive"}),key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(Pr,null))),n.createElement(Wr,{tab:n.createElement(B.a,{id:"delta_lake"}),key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Un,{ref:e=>this.deltaLakeTreeRef=e,parent:this}))),n.createElement(Wr,{tab:n.createElement(B.a,{id:"file_system"}),key:"4"},n.createElement("div",{className:"leftview-box"},n.createElement(Vn,{ref:e=>this.fileSystemTreeRef=e,parent:this}))),n.createElement(Wr,{tab:n.createElement(B.a,{id:"mysql"}),key:"5"},n.createElement(Qr,null)))}}a(107);const Yr=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.newSession=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r,s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.showTable(a,n,r,s),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.buildLoadSQL=function(){var e=Object(i.a)(l.a.mark((function e(t,a,n,r){var s,o,c,i,u,p,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=Zt.getTempTableName(),"".concat(a,"."),a||"",o="where ",r?"where "===(o+=Object.keys(r).filter(e=>"__where__"!==e&&"__sql__"!==e&&"__tableName__"!==e).map(e=>{const t=r[e];return"".concat(e.replace(/\[group\]/g,"0"),"='''").concat(t,"'''")}).join(" and "))&&(o=""):o="",c="load ".concat(t,".`").concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";"),"delta"===t&&(c="load delta.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";")),"jdbc"===t&&(c=r.__sql__||"load jdbc.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";"),s=r.__tableName__||s),"temp"!==t){e.next=14;break}return e.next=11,Le.tableInfo(n);case 11:i=e.sent,u=i.content,c=200===u.status?"load parquet.`/__persisted__/".concat(u.tableName,"`  as ").concat(Zt.getField(u.tableName),";\n                select * from ").concat(Zt.getField(u.tableName)," as ").concat(s,";"):"".concat(u.content," \n                select * from ").concat(Zt.getField(u.tableName)," as ").concat(s,";");case 14:return"file"===t&&(c="load ".concat(a,".`").concat(n,"` ").concat(o,"  as ").concat(s,";")),"hive"===t&&(p="where ",r&&r.__where__?p+=r.__where__:p="",m=Zt.getTempTableName(),c="load hive.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(m,";"),c+="select * from ".concat(m," ").concat(p," as ").concat(s,";")),e.abrupt("return",{sql:c,tableName:s});case 17:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.showTable=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r,s){var o,c,i,u,p,m,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.sqls=[],e.next=3,t.buildLoadSQL(a,n,r,s);case 3:return o=e.sent,c=o.tableName,i=o.sql,t.sqls.push({tableName:c,sql:i}),t.setState({loadingTable:!0}),e.next=10,t.client.runScript(i,Zt.getJobName(),Zt.robotFetchParam());case 10:if(u=e.sent,t.setState({loadingTable:!1}),200===u.status){e.next=15;break}return t.toggleMessage("Fail to load ".concat(c,": ").concat(u.content)),e.abrupt("return");case 15:p=u.content,m=p.schema,d=p.data,t.setCurrentTable("","",c,m,d),t.sessionId=Zt.getJobName(),t.setState({sessionId:t.sessionId});case 19:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.setCurrentTable=(e,t,a,n,r)=>{this.currentTable={prefix:e,db:t,table:a,schema:n,data:r},this.updateDisplay(r,n)}}},Xr=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.getLastApplyTable=()=>this.sqls[this.sqls.length-1],this.rollback=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.sqls.length<2)){e.next=3;break}return t.toggleMessage("No apply to rollback."),e.abrupt("return");case 3:return t.sqls.pop(),n=t.sqls.pop(),e.next=7,t.client.get(h.default.APPLY_GET,{name:n.tableName});case 7:if(200!==(r=e.sent).status){e.next=14;break}return s=JSON.parse(r.content.response),o=s.data,c=s.schema,e.next=12,t.apply(Object(y.a)(Object(y.a)({},n),{},{_data:o,_schema:c}));case 12:e.next=16;break;case 14:return e.next=16,t.apply(n);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.runSQLAtCurrentTable=function(){var e=Object(i.a)(l.a.mark((function e(a,n){var r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sqls.map(e=>e.sql).join(""),e.next=3,t.client.runScript("".concat(r,"\n          ").concat(a),Zt.getJobName(),Object(y.a)(Object(y.a)({},Zt.robotFetchParam()),n));case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.apply=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s,o,c,i,u,p,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.tableName,r=a.sql,s=a._data,o=a._schema,t.sqls.push({tableName:n,sql:r}),!s||!o){e.next=5;break}return t.setCurrentTable("","",n,o,s),e.abrupt("return",200);case 5:return c=t.sqls.map(e=>e.sql).join(""),e.prev=6,e.next=9,t.client.runScript(c,Zt.getJobName(),Object(y.a)(Object(y.a)({},Zt.robotFetchParam()),{},{queryType:"analysis_workshop_apply_action",analysis_workshop_table_name:n,analysis_workshop_sql:JSON.stringify(t.sqls)}));case 9:if(200===(i=e.sent).status){e.next=14;break}return t.sqls.pop(),t.toggleMessage(i.content),e.abrupt("return",500);case 14:return u=i.content,p=u.data,m=u.schema,t.setCurrentTable("","",n,m,p),e.abrupt("return",200);case 19:return e.prev=19,e.t0=e.catch(6),t.toggleMessage("Execute job fail;(Job is killed)"),e.abrupt("return",500);case 23:case"end":return e.stop()}}),e,null,[[6,19]])})));return function(t){return e.apply(this,arguments)}}(),this.save=function(){var e=Object(i.a)(l.a.mark((function e(a,n){var r,s,o,c,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.sqls.length){e.next=3;break}return t.toggleMessage("Sorry, current session have no applies."),e.abrupt("return",500);case 3:if(r="select * from ".concat(Zt.getField(t.getLastApplyTable().tableName)," as ").concat(Zt.getField(a),";"),t.sqls.push({tableName:a,sql:r}),s=t.sqls.map(e=>e.sql).join("\n"),o=Zt.getJobName(),c={status:5},!n){e.next=13;break}return i="".concat(s,"\n         save overwrite ").concat(a," as parquet.`/__persisted__/").concat(a,"`;"),e.next=12,t.client.runScript(i,o,{persistJobName:o,async:!0});case 12:c={jobName:o,status:1};case 13:return e.next=15,t.client.post(h.default.ANALYSIS_SAVE,Object.assign({tableName:a,sql:s,sessionId:t.sessionId,schema:JSON.stringify(t.currentTable.schema)},c));case 15:return u=e.sent,e.abrupt("return",u.status);case 17:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}};a(1067);var $r=a(1149),Zr=a(1144);a(1068);C.a.SubMenu;class es extends n.Component{constructor(e){super(e),this.enter=()=>{this.setState({applyLoading:!0}),this.workshop.setState({tableLoading:!0})},this.exit=()=>{this.setState({applyLoading:!1}),this.workshop.setState({tableLoading:!1})},this.showSaveDiagram=()=>{this.toggle()},this.toggle=()=>{this.setState({saveDiagram:!this.state.saveDiagram})},this.handleTableInput=()=>{},this.handlePersit=()=>{},this.props=e,this.state={applyLoading:!1,saveDiagram:!1},this.workshop=e.parent.workshop}render(){return n.createElement("div",{style:this.props.style,className:this.props.className||"aos-box"},n.createElement($e.a,{title:"View",visible:this.state.saveDiagram,onCancel:this.toggle,onOk:this.props.onSave,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(H.a,{className:"login-form"},n.createElement(H.a.Item,null,n.createElement(Q.a,{addonBefore:"tableName",onChange:this.props.handleTableInput||this.handleTableInput,placeholder:""})),n.createElement(H.a.Item,{label:"Persist table(take more space):"},n.createElement(Zr.a,{onChange:this.props.handlePersit||this.handlePersit})))),n.createElement("div",{className:"aos-button"},n.createElement(W.a,{loading:this.state.applyLoading,onClick:this.props.onApply,type:"primary"},"Apply")),n.createElement("div",{className:"aos-button"},n.createElement(W.a,{disabled:this.state.applyLoading,onClick:this.toggle,type:"primary"},"Save As")),n.createElement("div",{className:"aos-button"},n.createElement(W.a,{disabled:this.state.applyLoading,onClick:this.props.onRollback},"Rollback")))}}const ts=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.onSave=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.workshop.save(t.tableNameForSave,t.persistForSave);case 2:200===e.sent&&(t.workshop.refreshOperateStation(),t.workshop.refreshTableWorkshop());case 4:case"end":return e.stop()}}),e)}))),this.onRollback=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ApplyOrSaveRef.enter(),e.next=3,t.workshop.rollback();case 3:200===e.sent&&(t.workshop.refreshOperateStation(),t.workshop.refreshTableWorkshop()),t.ApplyOrSaveRef.exit();case 6:case"end":return e.stop()}}),e)}))),this.handleTableInput=e=>{this.tableNameForSave=e.target.value},this.handlePersit=e=>{this.persistForSave=e}}};a(459);const as=Pe.a.Option;class ns extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.joinStation.joinInfo.currentTable.schema,e.next=3,Le.tableInfo(t.joinTable);case 3:200===(n=e.sent).status&&t.setState({currentTableFields:a.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.next=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,e),this.joinStation.next()},this.render=()=>n.createElement(H.a,{className:"login-form",onFinish:this.next},n.createElement(H.a.Item,{name:"leftField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(Pe.a,{label:"Current Table",showSearch:!0,style:{width:200},placeholder:this.currentTable,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.currentTableFields.map(e=>n.createElement(as,{key:e.name,value:e.name},e.name)))),n.createElement(H.a.Item,{name:"rightField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(Pe.a,{label:"Join Table",showSearch:!0,style:{width:200},placeholder:this.joinTable,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.joinTableFields.map(e=>n.createElement(as,{key:e.name,value:e.name},e.name)))),n.createElement(H.a.Item,null,n.createElement(W.a,{type:"primary",htmlType:"submit"},"Next"))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.currentTable=this.joinStation.joinInfo.currentTable.table,this.joinTable=this.joinStation.joinInfo.joinTable,this.state={currentTableFields:[],joinTableFields:[]}}}var rs=a(1158);class ss extends n.Component{constructor(e){super(e),this.filterOption=(e,t)=>t.title.indexOf(e)>-1,this.handleChange=e=>{this.setState({targetKeys:e}),this.props.handleChange&&this.props.handleChange({targetKeys:e})},this.getSelectFields=()=>this.state.targetKeys||[],this.workshop=e.parent.workshop,this.state=this.wow(e)}wow(e){return{data:e.schemaFields.map(e=>({title:e.name,key:e.name})),targetKeys:[]}}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)))}render(){return n.createElement("div",{style:{marginBottom:"30px"}},n.createElement(rs.a,{listStyle:{width:400,height:300},dataSource:this.state.data,showSearch:!0,filterOption:this.filterOption,targetKeys:this.state.targetKeys,onChange:this.handleChange,render:e=>e.title}))}}class os extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.joinStation.joinInfo.currentTable.schema,e.next=3,Le.tableInfo(t.joinTable);case 3:200===(n=e.sent).status&&t.setState({currentTableFields:a.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.handleLeft=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,{leftProjectFields:e.targetKeys})},this.handleRight=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,{rightProjectFields:e.targetKeys})},this.reset=()=>{this.joinStation.parent.reload()},this.render=()=>n.createElement(H.a,{labelCol:{span:6}},n.createElement(H.a.Item,{name:"leftProjectFields",label:"currentTable"},n.createElement(ss,{handleChange:this.handleLeft,schemaFields:this.state.currentTableFields,ref:e=>this.leftProjectFields=e,parent:this})),n.createElement(H.a.Item,{name:"rightProjectFields",label:this.joinTable+""},n.createElement(ss,{handleChange:this.handleRight,schemaFields:this.state.joinTableFields,ref:e=>this.rightProjectFields=e,parent:this})),n.createElement(H.a.Item,null,n.createElement(H.a.Item,null," ",n.createElement(W.a,{danger:!0},"Reset")))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.currentTable=this.joinStation.joinInfo.currentTable.table,this.joinTable=this.joinStation.joinInfo.joinTable,this.state={currentTableFields:[],joinTableFields:[]}}}const cs=Pe.a.Option;class ls extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.tablesInWorkshop();case 2:a=e.sent,n=[],200===a.status&&(n=a.content.map(e=>({name:e.tableName,value:e.tableName}))),t.setState({tables:n});case 6:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.next=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,e),this.joinStation.next()},this.render=()=>n.createElement(H.a,{className:"login-form",onFinish:this.next},n.createElement(H.a.Item,{name:"joinType",rules:[{required:!0,message:"Please select join type!"}]},n.createElement(Pe.a,{showSearch:!0,style:{width:200},placeholder:"Select Join Type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(cs,{key:"inner",value:"inner join"},"Inner Join"),n.createElement(cs,{key:"left",value:"left join"},"Left Join"),n.createElement(cs,{key:"right",value:"right join"},"Right Join"),n.createElement(cs,{key:"full",value:"full join"},"Full Join"))),n.createElement(H.a.Item,{name:"joinTable",rules:[{required:!0,message:"Please select join table!"}]},n.createElement(Pe.a,{showSearch:!0,style:{width:200},placeholder:"Choose Join Table",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.tables.map(e=>n.createElement(cs,{key:e.name,value:e.value},e.name)))),n.createElement(H.a.Item,null,n.createElement(W.a,{type:"primary",htmlType:"submit"},"Next"))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.state={tables:[]}}}function is(){const e=Object(re.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\ntext-align: center;\npadding-top: 80px;\nwidth: 100%;\n"]);return is=function(){return e},e}const us=$r.a.Step,ps=se.a.div(is());class ms extends(Ln(n.Component).with(ts)){constructor(e){var t;super(e),t=this,this.onApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o,c,i,u,p,m,d,h,b,f,E,g,y,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.workshop.currentTable.table,n=t.joinInfo,r=n.joinTable,s=n.joinType,o=n.leftField,c=n.rightField,i=n.leftProjectFields,u=n.rightProjectFields,i||u){e.next=5;break}return t.workshop.toggleMessage("Fields are not selected."),e.abrupt("return");case 5:return t.ApplyOrSaveRef.enter(),e.next=8,Le.tableInfo(r);case 8:return p=e.sent,m=p.content,d=i&&i.map(e=>"".concat(a,".`").concat(e,"`")).join(","),h=u&&u.map(e=>"".concat(r,".`").concat(e,"`")).join(","),b="".concat(a,".`").concat(o,"`"),f="".concat(r,".`").concat(c,"`"),E="".concat(s," ").concat(r," on ").concat(b," = ").concat(f),g="",d&&h&&(g=d+","+h),d&&!h&&(g=d),!d&&h&&(g=h),y=Zt.getTempTableName(),v="".concat(m.content," \n select ").concat(g," from ").concat(a," ").concat(E," as ").concat(y,";"),console.log(v),e.next=24,t.workshop.apply({tableName:y,sql:v});case 24:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 26:case"end":return e.stop()}}),e)}))),this.next=()=>{this.setState({currentStep:this.state.currentStep+1})},this.preview=()=>{this.setState({currentStep:this.state.currentStep-1})},this.workshop=e.parent.workshop,this.joinInfo={currentTable:this.workshop.currentTable},this.state={currentStep:0,steps:[n.createElement(ls,{parent:this}),n.createElement(ns,{parent:this}),n.createElement(os,{parent:this})]}}render(){return n.createElement("div",{className:"join-app"},n.createElement("div",{className:"station-menu"},n.createElement(es,{parent:this,onRollback:this.onRollback,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}})),n.createElement("div",null,n.createElement($r.a,{current:this.state.currentStep},n.createElement(us,{key:0,title:"Table",description:"Choose the table you wanna join from workshop"}),n.createElement(us,{key:1,title:"Join Condition ",description:"Choose the join condition in both tables"}),n.createElement(us,{key:2,title:"Fields",description:"Choose the fields you want from both tables"}))),n.createElement("div",{className:"join-app-form"}," ",n.createElement(ps,null,this.state.steps[this.state.currentStep])))}}var ds=ms;const hs=a(212);class bs extends n.Component{constructor(e){super(e),this.setRender=(e,t)=>{const a=t[0][e.key];if(this.config&&this.config.render)Object.keys(this.config).map(t=>{const a=this.config[t][e.key];a&&(e[t]=a)});else{try{if(n.Component.isPrototypeOf(a.type))return void(e.render=e=>n.createElement("span",null,e))}catch(r){}"html"!=e.key?"object"!==typeof a?"array"!==typeof a?"boolean"!==typeof a?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300)):e.render=e=>n.createElement("pre",null,e.substring(0,300))}},this.update=(e,t)=>{this.config=t;let a=[],n={},r=[];const s=this;e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),this.setState({columns:a,data:r})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1}},this.config={},this.workshop=e.parent}render(){return n.createElement("div",{style:this.tableStyle},n.createElement(Ue.a,{pagination:{pageSize:6},size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement($e.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(hs,{source:this.state.view.content||""})))}}const fs=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.enableGroupByField=(e,t)=>{const a=t.field;e?this.groupByFields.push(a):this.groupByFields=this.groupByFields.filter(e=>e.name!==a)},this.generateProjectField=(e,t)=>{this.aggFields.push({name:e,newName:t})},this.onApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ApplyOrSaveRef.enter(),a=Zt.getTempTableName(),n=t.aggFields.map(e=>"".concat(e.name," as `").concat(e.newName,"`")),r="",0!==t.groupByFields.length&&(r="group by ".concat(t.groupByFields.map(e=>"`".concat(e,"`")).join(",")),n=t.groupByFields.map(e=>"`".concat(e,"`")).concat(n)),s="select ".concat(n.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," ").concat(r," as ").concat(a,";"),e.next=8,t.workshop.apply({tableName:a,sql:s});case 8:o=e.sent,t.ApplyOrSaveRef.exit(),200===o&&t.workshop.refreshOperateStation();case 11:case"end":return e.stop()}}),e)})))}};var Es=a(1164);Pe.a.Option;class gs extends n.Component{constructor(e){super(e),this.show=e=>{this.setState({func:e})},this.funcValue=()=>n.createElement(Es.b.Item,{key:"Func"},n.createElement(Es.b.Item.Meta,{title:"Func",description:this.state.func.funcValue.extra.zhDoc})),this.returnValue=()=>n.createElement(Es.b.Item,{key:"Return value"},n.createElement(Es.b.Item.Meta,{title:"Return value",description:this.state.func.returnValue.extra.zhDoc})),this.parameters=()=>this.state.func.params.map(e=>n.createElement(Es.b.Item,{key:e.name},n.createElement(Es.b.Item.Meta,{title:e.name,description:e.extra.zhDoc}))),this.state=Object(y.a)({},e)}render(){return this.state.func?n.createElement(Es.b,{size:"large",header:n.createElement("div",null,"Function [".concat(this.state.func.value,"] Info")),footer:n.createElement("div",null),bordered:!0},this.funcValue(),this.returnValue(),this.parameters()):n.createElement("div",null)}}const ys=Pe.a.Option;class vs extends n.Component{constructor(e){var t;super(e),t=this,this.handleSearch=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=8;break}return e.next=3,Le.showFunctions();case 3:n=e.sent,r=n.content.map(e=>({value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)})),t.setState({data:r}),e.next=9;break;case 8:t.setState({data:[]});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleChange=e=>{const t=this.state.data.filter(t=>t.value===e)[0];this.setState({currentFunc:t}),this.funcDescRef.show(t)},this.handleOperateInput=e=>{this.manuallyTransform=e.target.value},this.isAggChecked=e=>{this.manuallyIsAgg=e},this.handleNewName=e=>{this.newFuncName=e.target.value},this.handleField=e=>{const t=e.target.getAttribute("name");this.funcParams[t]=e.target.value},this.showColumn=e=>(this.funcParams[e.name]=this.operateField,"yes"===e.extra.column?this.operateField:""),this.getTransform=()=>{if(this.manuallyTransform)return{field:this.operateField,isAgg:this.manuallyIsAgg,transformCode:this.manuallyTransform,columnName:this.newFuncName};const e=[];this.state.currentFunc.params.forEach(t=>{const a=this.funcParams[t.name];a&&("yes"===t.extra.column?e.push(Zt.getField(a)):"number"==t.dataType||"boolean"==t.dataType?e.push(a):e.push('"'.concat(a,'"')))});return{field:this.operateField,isAgg:"yes"===this.state.currentFunc.funcValue.extra.agg,transformCode:"".concat(this.state.currentFunc.value,"(").concat(e.join(","),")"),columnName:this.newFuncName}},this.reload=()=>{this.setState({key:Math.random(),data:[],value:void 0,funcPopUp:!1,currentFunc:void 0}),this.collect={}},this.parent=e.parent,this.operateField=e.operateField,this.funcParams={},this.state={data:[],value:void 0,funcPopUp:!1,func:{},key:Math.random()}}render(){const e=this.state.data.map(e=>n.createElement(ys,{key:e.value},e.text));return n.createElement(H.a,{className:"login-form",key:this.state.key},n.createElement(H.a.Item,null,n.createElement(Pe.a,{showSearch:!0,value:this.state.value,placeholder:"Search function",defaultActiveFirstOption:!1,showArrow:!1,style:{width:"200px"},filterOption:!1,onSearch:this.handleSearch,onChange:this.handleChange,notFoundContent:"type function name"},e)),n.createElement(H.a.Item,null,n.createElement(gs,{ref:e=>this.funcDescRef=e})),this.state.currentFunc?this.state.currentFunc.params.map(e=>n.createElement(H.a.Item,{key:e.name},n.createElement(Q.a,{name:e.name,onChange:this.handleField,addonBefore:e.name,defaultValue:this.showColumn(e)}))):n.createElement("div",null),n.createElement(H.a.Item,null,n.createElement(Q.a,{addonBefore:"Mannual Transform",onChange:this.handleOperateInput,placeholder:""})),n.createElement(H.a.Item,{label:"Is Agg Function"},n.createElement(Zr.a,{onChange:this.isAggChecked})),n.createElement(H.a.Item,null,n.createElement(Q.a,{addonBefore:"New fieldName",onChange:this.handleNewName,placeholder:""})))}}C.a.SubMenu;class ws extends(Ln(n.Component).with(ts,fs)){constructor(e){super(e),this.showAggFuncsAndApply=e=>{this.operateField=e.field,this.setState({funcPopUp:!0})},this.reload=()=>{const e=this.workshop.currentTable.schema.fields.map(e=>({field:e.name,groupby:"",agg:""})),t={render:{groupby:(e,t)=>n.createElement(Zr.a,{key:t.field,defaultChecked:t._groupBy,onChange:e=>{this.enableGroupByField(e,t),t._groupBy=e},dataref:t}),agg:(e,t)=>n.createElement(n.Fragment,null,n.createElement(W.a,{key:t.field,style:{marginRight:"30px"},dataref:t,onClick:()=>{this.showAggFuncsAndApply(t)}},"Choose function"),n.createElement("span",null,t._agg&&"(".concat(t._agg,")")||""))}};this.columnsRef.update(e,t)},this.handleFunc=()=>{this.applyFuncToFieldRef.operateField=this.operateField;const e=this.applyFuncToFieldRef.getTransform(),t=e.field,a=e.transformCode,n=e.columnName;this.columnsRef.state.data.filter(e=>e.field===t)[0]._agg="".concat(a," as ").concat(n),this.generateProjectField(a,n),this.setState({funcPopUp:!1}),this.applyFuncToFieldRef.reload()},this.workshop=e.parent.workshop,this.state={funcPopUp:!1},this.groupByFields=[],this.aggFields=[]}componentDidMount(){this.reload()}render(){return n.createElement("div",null,n.createElement("div",null,n.createElement($e.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:()=>{this.setState({funcPopUp:!1}),this.applyFuncToFieldRef.setState({key:Math.random()})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(vs,{parent:this,ref:e=>this.applyFuncToFieldRef=e,operateField:this.operateField})),n.createElement("div",{className:"station-menu"},n.createElement(es,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}}))),n.createElement("div",null,n.createElement(bs,{parent:this,ref:e=>this.columnsRef=e})))}}a(460);class ks extends n.Component{constructor(e){super(e),this.getSelectFields=()=>this.formRef.getFieldValue(),this.workshop=e.parent.workshop,this.state=this.wow(e)}wow(e){return{data:e.schemaFields.map(e=>({title:e.name,key:e.name})),targetKeys:[]}}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)))}render(){return n.createElement(H.a,{labelCol:{span:6},ref:e=>{this.formRef=e}},this.state.data.map(e=>n.createElement(H.a.Item,{key:e.key,name:e.key,label:e.key,value:e.key},n.createElement(Q.a,{placeholder:"input the new name here"}))))}}class xs extends n.Component{constructor(e){super(e),this.wow=e=>({funcPopUp:!1,data:e.schemaFields.map(e=>({field:e.name,func:"",transformCode:"",columnName:""})),config:{render:{func:(e,t)=>n.createElement(W.a,{key:t.field,dataref:t,onClick:()=>{this.showAggFuncsAndApply(t)}},"Choose function"),transformCode:(e,t)=>e,columnName:(e,t)=>e}}}),this.showAggFuncsAndApply=e=>{this.operateField=e.field,this.setState({funcPopUp:!0})},this.reload=()=>{this.columnsRef.update(this.state.data,this.state.config)},this.handleFunc=()=>{this.applyFuncToFieldRef.operateField=this.operateField;const e=this.applyFuncToFieldRef.getTransform(),t=e.field,a=e.transformCode,n=e.columnName,r=e.isAgg;if(!n)return void this.setState({error:"New fieldName is required."});const s=this.state.data.map(e=>e.field===t?{field:t,func:"",transformCode:a,columnName:n,isAgg:r}:e);this.setState({funcPopUp:!1,data:s,error:void 0},()=>{this.reload()}),this.applyFuncToFieldRef.reload()},this.getSelectFields=()=>this.state.data,this.render=()=>n.createElement("div",null,n.createElement($e.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:()=>{this.applyFuncToFieldRef.reload(),this.setState({funcPopUp:!1,error:void 0})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},this.state.error&&n.createElement(le,{message:this.state.error}),n.createElement(vs,{parent:this,ref:e=>this.applyFuncToFieldRef=e,operateField:this.operateField})),n.createElement(bs,{ref:e=>this.columnsRef=e})),this.workshop=e.parent.workshop,this.state=this.wow(e)}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)),()=>{this.reload()})}componentDidMount(){this.reload()}}const Ss=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.onSelectApply=Object(i.a)(l.a.mark((function e(){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),0!==(a=t.selectFieldsRef.getSelectFields().map(e=>"`".concat(e,"`"))).length){e.next=6;break}return t.workshop.showInfo("No fields are selected."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=Zt.getTempTableName(),r="select ".concat(a.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(n,";"),e.next=10,t.workshop.apply({tableName:n,sql:r});case 10:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 12:case"end":return e.stop()}}),e)}))),this.onFuncApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),0!==(a=t.functionFieldRef.getSelectFields()).length){e.next=6;break}return t.workshop.toggleMessage("No fields are renamed."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=a.filter(e=>e.isAgg).length>0,r=[],r=n?a.filter(e=>e.isAgg).map(e=>"".concat(e.transformCode," as `").concat(e.columnName,"`")):a.map(e=>e.transformCode?"".concat(e.transformCode," as `").concat(e.columnName,"`"):"`".concat(e.field,"` as `").concat(e.field,"`")),s=Zt.getTempTableName(),o="select ".concat(r.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(s,";"),e.next=13,t.workshop.apply({tableName:s,sql:o});case 13:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 15:case"end":return e.stop()}}),e)}))),this.onRenameApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),a=t.renameFieldsRef.getSelectFields(),n=t.workshop.currentTable.schema.fields.map(e=>"`".concat(e.name,"`")),0!==a.length){e.next=7;break}return t.workshop.toggleMessage("No fields are renamed."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 7:return r=Object.keys(a).filter(e=>e!==a[e]).map(e=>"`".concat(e,"` as `").concat(a[e],"`")),s=Zt.getTempTableName(),o="select ".concat(n.concat(r).join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(s,";"),e.next=12,t.workshop.apply({tableName:s,sql:o});case 12:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 14:case"end":return e.stop()}}),e)})))}},Os=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields,n=t.__state.operateFileds.filter(e=>a!==e.field),e.abrupt("return",{data:{operateFileds:n}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),js=Os.handler,Ts=Os.action,Ns=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields.map(e=>({field:e})),e.abrupt("return",{data:{operateFileds:a}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Cs=Ns.handler,_s=Ns.action;var Is=class{static apply(e,t,a){return Object(i.a)(l.a.mark((function n(){var r,s,o,c,i,u,p,m;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.data,s=r.workshop,o=r.values,c=e.__state.applySaveRollbackDispacher,!(i=t(o))){n.next=6;break}return c({type:"setState",data:{loading:!1}}),n.abrupt("return",{data:Object(y.a)(Object(y.a)({},e.data),{},{error:i,loading:!1})});case 6:return u=a(s,o),p=u.tableName,m=u.sql,n.next=9,s.apply({tableName:p,sql:m});case 9:return 200===n.sent&&s.refreshOperateStation(),c({type:"setState",data:{loading:!1}}),n.abrupt("return",{data:Object(y.a)(Object(y.a)({},e.data),{},{loading:!1})});case 13:case"end":return n.stop()}}),n)})))()}};const Ps=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Is.apply(t,e=>{if(0===Object.keys(e).length)return"Please configure cast fields then click apply"},(e,t)=>{const a=Zt.getTempTableName(),n=Object.keys(t).map(e=>"cast(".concat(Zt.getField(e)," as ").concat(t[e],") as ").concat(Zt.getField(e))),r=Object.keys(t),s=e.currentTable.schema.fields.filter(e=>!r.includes(e.name)).map(e=>Zt.getField(e.name)),o=n.concat(s).join(",");return{tableName:a,sql:"select ".concat(o," from ").concat(e.getLastApplyTable().tableName,"            \n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),As=Ps.handler,Ds=Ps.action;class Rs{}Rs.ADD_FIELD="addField",Rs.REMOVE_FIELD="removeField";const Fs=Object(y.a)(Object(y.a)({},za),{},{[Rs.ADD_FIELD]:Cs,[Rs.REMOVE_FIELD]:js,apply:As}),Ls=Object(y.a)(Object(y.a)({},Ya),{},{[Rs.ADD_FIELD]:_s,[Rs.REMOVE_FIELD]:Ts,apply:Ds});function Ms(e,t){return Ls[t.type](e,t.data)}const qs=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.workshop,e.next=3,a.rollback();case 3:return e.abrupt("return",{data:t.data});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Vs=qs.handler,Bs=qs.action,Gs=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data.workshop,n=t.__state,r=n.saveTablePersisted,s=n.saveTableName){e.next=4;break}return e.abrupt("return",{data:{error:"table name is required"}});case 4:return e.next=6,a.save(s,r);case 6:return a.refreshTableWorkshop(),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{loading:!1})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Us=Gs.handler,Js=Gs.action;const Ks={setState:O.SetStateActionHandler,rollback:Vs,save:Us};function Hs(e,t){switch(t.type){case"setState":return Object(O.SetStateAction)(e,t.data);case"rollback":return Bs(e,t.data);case"save":return Js(e,t.data);default:return e}}const Qs={saveDiagram:!1,saveTablePersisted:!1,loading:!1,saveTableName:void 0,error:void 0},Ws=r.a.createContext();function zs(e){const t=e.workshop||ql.workshop,a=Object(n.useContext)(e.context).dispacher,s=Object(p.useReducerAsync)(Hs,Qs,Ks),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.saveDiagram,m=(c.saveTablePersisted,c.loading),d=c.error;return r.a.createElement(Ws.Provider,{value:{dispacher:l}},d&&r.a.createElement(le,{message:d}),r.a.createElement($e.a,{title:"View",visible:i,onCancel:()=>{l({type:"setState",data:{saveDiagram:!1}})},onOk:()=>{l({type:"save",data:{saveDiagram:!1,workshop:t}})},cancelText:"Cancel",width:"50%",OkText:"Ok"},r.a.createElement(H.a,{className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{addonBefore:"tableName",onChange:e=>{l({type:"setState",data:{saveTableName:e.target.value}})},placeholder:""})),r.a.createElement(H.a.Item,{label:"Persist table(take more space):"},r.a.createElement(Zr.a,{onChange:e=>{l({type:"setState",data:{saveTablePersisted:e}})}})))),r.a.createElement(W.a,{loading:m,type:"primary",onClick:()=>{l({type:"setState",data:{loading:!0}}),a({type:"setState",data:{applySaveRollbackDispacher:l,applyToken:Zt.getJobName()}})}},"Apply"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{disabled:m,onClick:()=>{l({type:"setState",data:{saveDiagram:!0}})}},"Save As"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{disabled:m,onClick:()=>{l({type:"setState",data:{loading:!0}}),l({type:"rollback",data:{workshop:t,loading:!1}})}},"Rollback"))}const Ys=Pe.a.Option,Xs={error:void 0,applySaveRollbackDispacher:void 0,operateFileds:[]},$s=r.a.createContext();function Zs(e){const t=e.workshop,a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=t.currentTable.schema.fields,c=Object(p.useReducerAsync)(Ms,Xs,Fs),l=Object(u.a)(c,2),i=l[0],m=l[1],d=i.operateFileds,h=i.error,b=i.applySaveRollbackDispacher,f=o.map(e=>r.a.createElement(Ys,{key:e.name},e.name));return Object(n.useEffect)(()=>{b&&s.submit()},[b]),r.a.createElement($s.Provider,{value:{dispacher:m}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},h&&r.a.createElement(le,{message:h}),r.a.createElement(H.a,{form:s,onFinish:e=>{m({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(zs,{context:$s,workshop:t})),r.a.createElement(H.a.Item,{label:"Choose fields"},r.a.createElement(Pe.a,{mode:"multiple",onDeselect:e=>{m({type:Rs.REMOVE_FIELD,data:{fields:e}})},onChange:e=>{m({type:Rs.ADD_FIELD,data:{fields:e}})}},f)),d.map(e=>r.a.createElement(H.a.Item,{key:e.field,label:"Cast ".concat(e.field," to"),name:e.field},r.a.createElement(Pe.a,null,r.a.createElement(Pe.a.Option,{value:"int"},"int"),r.a.createElement(Pe.a.Option,{value:"long"},"long"),r.a.createElement(Pe.a.Option,{value:"double"},"double"),r.a.createElement(Pe.a.Option,{value:"string"},"string")))))))}class eo{}eo.ADD_FIELD="addField",eo.REMOVE_FIELD="removeField",eo.APPLY="apply",eo.setState="setState";var to=a(495);const ao=Pe.a.Option;function no(e){const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=e.context,o=e.keyPaths,c=Object(n.useContext)(s).dispacher;return Object(n.useEffect)(()=>{e.forms.push(a)},[]),r.a.createElement(H.a,{layout:"inline",form:a,style:{marginBottom:"30px"}},r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{danger:!0,icon:r.a.createElement(to.a,null),onClick:()=>{c({type:eo.REMOVE_FIELD,data:{form:a}})}})),r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"add"}),name:"path",style:{width:"300px"}},r.a.createElement(Pe.a,null,o.map(e=>r.a.createElement(ao,{key:e},e)))),r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"as"}),name:"column",style:{width:"100px"}},r.a.createElement(Q.a,null)))}const ro=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.__state,n=a.subFields,s=a.keyPaths,o=a.forms,n.push(r.a.createElement(no,{key:Zt.getJobName(),context:vo,keyPaths:s,forms:o})),e.abrupt("return",{data:{subFields:n}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),so=ro.handler,oo=ro.action,co=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.form,n=t.__state,r=n.forms,s=n.subFields,o=r.indexOf(a),r.splice(o,1),s.splice(o,1),e.abrupt("return",{data:{forms:r,subFields:s}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),lo=co.handler,io=co.action,uo=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Is.apply(t,e=>{const t=e.formValues;if(!e.operateFiled||0===t.length)return"Please configure fields then click apply"},(e,t)=>{const a=Zt.getTempTableName(),n=t.formValues,r=t.operateFiled,s=n.map(e=>"get_json_object(".concat(Zt.getField(r),',"').concat(e.path,'") as ').concat(Zt.getField(e.column))).join(",");return{tableName:a,sql:"select *,".concat(s," from ").concat(e.getLastApplyTable().tableName,"            \n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),po=uo.handler,mo=uo.action;const ho=Object(y.a)(Object(y.a)({},za),{},{[eo.ADD_FIELD]:so,[eo.REMOVE_FIELD]:lo,[eo.APPLY]:po}),bo=Object(y.a)(Object(y.a)({},Ya),{},{[eo.ADD_FIELD]:oo,[eo.REMOVE_FIELD]:io,[eo.APPLY]:mo});function fo(e,t){return bo[t.type](e,t.data)}var Eo=a(496);const go=Pe.a.Option,yo={error:void 0,applySaveRollbackDispacher:void 0,operateFiled:void 0,keyPaths:[],forms:[],subFields:[]},vo=r.a.createContext();function wo(e){const t=ql.workshop,a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=t.currentTable.schema.fields,c=t.currentTable.data.slice(0,10),l=Object(p.useReducerAsync)(fo,yo,ho),i=Object(u.a)(l,2),m=i[0],d=i[1],h=m.operateFiled,b=(m.keyPaths,m.error),f=m.applySaveRollbackDispacher,E=m.forms,g=m.subFields,y=o.map(e=>r.a.createElement(go,{key:e.name},e.name));Object(n.useEffect)(()=>{if(h){d({type:eo.setState,data:{subFields:[],forms:[]}});const e=new Set,t=c.map(e=>{try{return JSON.parse(e[h])}catch(t){return}}).filter(e=>void 0!==e&&("object"===typeof e||"array"===typeof e));console.log(t),t.forEach(t=>{Zt.keyPath("$",t,t=>{e.add(t)})}),d({type:eo.setState,data:{keyPaths:[...e]}})}},[h]),Object(n.useEffect)(()=>{f&&s.submit()},[f]);Object(n.useCallback)(({workshop:e,values:t,forms:a})=>{console.log(t),console.log(a.map(e=>e.getFieldsValue())),f.dispacher({type:"setState",data:{loading:!1}})},[f]);return r.a.createElement(vo.Provider,{value:{dispacher:d}},r.a.createElement("div",{style:{marginTop:"10px",width:"600px"}},b&&r.a.createElement(le,{message:b}),r.a.createElement(H.a,{form:s,onFinish:e=>{const a=E.map(e=>e.getFieldsValue());d({type:"apply",data:{workshop:t,values:{formValues:a,operateFiled:h}}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(zs,{context:vo,workshop:t})),r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"choose_json_field"}),style:{width:"300px"}},r.a.createElement(Pe.a,{onChange:e=>{d({type:eo.setState,data:{operateFiled:e}})}},y))),h&&r.a.createElement(K.a,{title:r.a.createElement(W.a,{icon:r.a.createElement(Eo.a,null),onClick:()=>{d({type:eo.ADD_FIELD,data:{}})}})},g)))}const ko=tt.a.TabPane;class xo extends(Ln(n.Component).with(ts,Ss)){constructor(e){super(e),this.workshop=e.parent.workshop}render(){return n.createElement("div",{className:"station-menu"},n.createElement(tt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(ko,{tab:n.createElement(B.a,{id:"select_columns"}),key:"1"},n.createElement(es,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onSelectApply,style:{marginBottom:"30px"}}),n.createElement(ss,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.selectFieldsRef=e,parent:this})),n.createElement(ko,{tab:n.createElement(B.a,{id:"rename_columns"}),key:"2"},n.createElement(es,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onRenameApply,style:{marginBottom:"30px"}}),n.createElement(ks,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.renameFieldsRef=e,parent:this})),n.createElement(ko,{tab:n.createElement(B.a,{id:"transform_columns"}),key:"3"},n.createElement(es,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onFuncApply,style:{marginBottom:"30px"}}),n.createElement(xs,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.functionFieldRef=e,parent:this})),n.createElement(ko,{tab:n.createElement(B.a,{id:"cast_columns_type"}),key:"4"},n.createElement(Zs,{workshop:this.workshop})),n.createElement(ko,{tab:n.createElement(B.a,{id:"json_fields"}),key:"5"},n.createElement(wo,null))))}}const So={EQUAL:"=",NON_EQUAL:"!=",IN:"in",CONTAINS:"contains",STARTS_WITH:"startsWith",ENDS_WITH:"endsWith",LIKE:"like",IS_NULL:"is null",IS_NOT_NULL:"is not null",IS_EMPTY:"is empty",IS_NOT_EMPTY:"is not empty"};function Oo(e){const t=e.record,a=e.workshop,s=Object(n.useState)(void 0),o=Object(u.a)(s,2),c=o[0],p=o[1],m=(t.dataType,t.field),d=Object(n.useState)([]),h=Object(u.a)(d,2),b=h[0],f=h[1],E=Object(n.useState)(!1),g=Object(u.a)(E,2),y=g[0],v=g[1],w=H.a.useForm(),k=Object(u.a)(w,1)[0];e.forms[m]=k;const x=function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==b.length||"in"!==c){e.next=7;break}return v(!0),e.next=4,a.runSQLAtCurrentTable("select distinct(".concat(Zt.getField(m),") as name \n            from ").concat(a.getLastApplyTable().tableName," \n            as ").concat(Zt.getTempTableName(),";"),{outputSize:5e3,timeout:1e4});case 4:200===(t=e.sent).status&&f(t.content.data),v(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{x()},[c]);return r.a.createElement(H.a,{form:k,layout:"inline"},r.a.createElement(H.a.Item,{name:"compare",initialValue:t.compare},r.a.createElement(Pe.a,{initialValue:"=",onChange:e=>{p(e),t.compare=e},placeholder:"compare",style:{width:"100px"}},r.a.createElement(Pe.a.Option,{value:"="},"="),r.a.createElement(Pe.a.Option,{value:"<"},"<"),r.a.createElement(Pe.a.Option,{value:">"},">"),r.a.createElement(Pe.a.Option,{value:">="},">="),r.a.createElement(Pe.a.Option,{value:"<="},"<="),r.a.createElement(Pe.a.Option,{value:"!="},"!="),r.a.createElement(Pe.a.Option,{value:So.LIKE},"like"),r.a.createElement(Pe.a.Option,{value:So.STARTS_WITH},"startsWith"),r.a.createElement(Pe.a.Option,{value:So.ENDS_WITH},"endsWith"),r.a.createElement(Pe.a.Option,{value:So.IN},"in"),r.a.createElement(Pe.a.Option,{value:So.IS_NULL},"is null"),r.a.createElement(Pe.a.Option,{value:So.IS_NOT_NULL},"is not null"),r.a.createElement(Pe.a.Option,{value:So.IS_EMPTY},"is empty"),r.a.createElement(Pe.a.Option,{value:So.IS_NOT_EMPTY},"is not empty"))),r.a.createElement(H.a.Item,{name:"condition",initialValue:t.condition,onChange:e=>{t.condition="string"!==typeof e?e.target.value:e}},(()=>{switch(c){case So.IS_NULL:case So.IS_NOT_NULL:return r.a.createElement(r.a.Fragment,null);case So.IN:return r.a.createElement(Pe.a,{loading:y,mode:"tags",style:{width:"300px"}},b.map(e=>r.a.createElement(Pe.a.Option,{key:e.name,value:e.name},e.name)));case So.LIKE:return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{style:{width:"100px"}}),r.a.createElement("span",null,"LIKE 'a%o' means Finds any values that start with 'a' and ends with 'o' "));default:return r.a.createElement(Q.a,{style:{width:"100px"}})}})()))}class jo extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({funcPopUp:!1,data:e.map(e=>({key:e.name,field:e.name,dataType:e.type,compare:"=",condition:"",command:""})),columns:[{title:"field",dataIndex:"field"},{title:"dataType",dataIndex:"dataType",render:(e,t)=>{switch(typeof e){case"object":return n.createElement("span",null,e.type);default:return n.createElement("span",null,e)}}},{title:"",dataIndex:"compare",render:(e,t)=>n.createElement(Oo,{forms:this.forms,record:t,workshop:this.workshop})}]}),this.buildSelectedRows=()=>{const e={};this.state.data.forEach(t=>{e[t.field]=t.dataType});const t=Object.entries(this.forms).map(([t,a])=>{const n=a.getFieldsValue(),r=n.compare,s=n.condition;return r?{field:t,compare:r,condition:s,dataType:e[t]}:{}});return this.selectedRowKeys?t.filter(e=>this.selectedRowKeys.includes(e.field)):[]},this.addGroup=e=>{const t=e.groupName,a=e.groupType;if(!t||!a)return void this.workshop.showInfo("Error: groupName and groupType is required.");if(!this.selectedRowKeys)return void this.workshop.showInfo("Please select fields");const n=this.buildSelectedRows();this.fitlerStation.conGroups[t]={groupName:t,groupType:a,tp:"basic",data:n},this.fitlerStation.applyGroup&&this.fitlerStation.applyGroup.reload({data:this.fitlerStation.conGroups}),this.fitlerStation.groupGroup&&this.fitlerStation.groupGroup.reload({data:this.fitlerStation.conGroups}),this.workshop.showInfo("Add successfully")},this.render=()=>{const e={onChange:(e,t)=>{this.selectedRowKeys=e},getCheckboxProps:e=>({name:e.field})};return n.createElement("div",{className:"common-one-hundred-percent-width common-column-layout"},n.createElement("div",{style:{marginRight:"30px",width:"80%"}},n.createElement(es,{parent:this,onRollback:this.fitlerStation.onRollback,handlePersit:this.fitlerStation.handlePersit,handleTableInput:this.fitlerStation.handleTableInput,ref:e=>this.fitlerStation.ApplyOrSaveRef=e,onSave:this.fitlerStation.onSave,onApply:()=>{const e=this.buildSelectedRows();this.fitlerStation.onNonGroupFilterApply(e)},style:{marginBottom:"30px"}}),n.createElement(Ue.a,{pagination:{pageSize:5,hideOnSinglePage:!0},rowSelection:Object(y.a)({type:"checkbox"},e),columns:this.state.columns,dataSource:this.state.data})),n.createElement(H.a,{onFinish:this.addGroup},n.createElement(H.a.Item,{name:"groupName",label:"Group Name"},n.createElement(Q.a,null)),n.createElement(H.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(Pe.a,null,n.createElement(Pe.a.Option,{value:"and"},"and"),n.createElement(Pe.a.Option,{value:"or"},"or"))),n.createElement(H.a.Item,null,n.createElement(W.a,{type:"primary",htmlType:"submit"},"Add selected conditions to group"))))},this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e.schemaFields),this.forms={}}}class To extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({funcPopUp:!1,data:Object.keys(e.data).map(e=>({groupName:e})).map(e=>({key:e.groupName,groupName:e.groupName})),columns:[{title:"groupName",dataIndex:"groupName"}]}),this.addGroup=e=>{const t=e.groupName,a=e.groupType;if(!t||!a)return void this.workshop.showInfo("Error: groupName and groupType is required.");const n=this.selectedRowKeys.map(e=>this.fitlerStation.conGroups[e]);this.fitlerStation.conGroups[t]={groupName:t,groupType:a,tp:"group",data:n},this.fitlerStation.applyGroup&&this.fitlerStation.applyGroup.reload({data:this.fitlerStation.conGroups}),this.fitlerStation.groupGroup&&this.fitlerStation.groupGroup.reload({data:this.fitlerStation.conGroups}),this.workshop.showInfo("Add successfully")},this.render=()=>{const e={onChange:(e,t)=>{this.selectedRowKeys=e},getCheckboxProps:e=>({name:e.title})};return n.createElement("div",null,n.createElement(H.a,{onFinish:this.addGroup},n.createElement(H.a.Item,{name:"groupName",label:"Group Name"},n.createElement(Q.a,null)),n.createElement(H.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(Pe.a,null,n.createElement(Pe.a.Option,{value:"and"},"and"),n.createElement(Pe.a.Option,{value:"or"},"or"))),n.createElement(H.a.Item,null,n.createElement(W.a,{type:"primary",htmlType:"submit"},"Add selected"))),n.createElement(Ue.a,{rowSelection:Object(y.a)({type:"checkbox"},e),columns:this.state.columns,dataSource:this.state.data}))},this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e)}}class No extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({data:Object.keys(e.data).map(e=>({groupName:e})).map(e=>({key:e.groupName,groupName:e.groupName})),refresh:Math.random()}),this.onChange=e=>{this.groupName=e},this.render=()=>n.createElement("div",null,n.createElement(H.a,{key:this.state.refresh},n.createElement(H.a.Item,{label:"Select group name to apply:"},n.createElement(Pe.a,{onChange:this.onChange},this.state.data.map(e=>n.createElement(Pe.a.Option,{key:e.key,value:e.groupName},e.groupName)))))),this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e)}}const Co=tt.a.TabPane;class _o extends(Ln(n.Component).with(ts)){constructor(e){var t;super(e),t=this,this.onNonGroupFilterApply=function(){var e=Object(i.a)(l.a.mark((function e(a){var n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.length){e.next=3;break}return t.workshop.showInfo("Please select fields"),e.abrupt("return");case 3:return n=a.flatMap(e=>_o.buildCondition([e])).join(" and "),t.ApplyOrSaveRef.enter(),r=Zt.getTempTableName(),s="select * from ".concat(t.workshop.getLastApplyTable().tableName," \n        where ").concat(n,"\n        as ").concat(r,";"),e.next=9,t.workshop.apply({tableName:r,sql:s});case 9:t.ApplyOrSaveRef.exit();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onFilterApply=Object(i.a)(l.a.mark((function e(){var a,n,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e){if("basic"===e.tp)return"and"===e.groupType?"(".concat(_o.buildCondition(e.data).join(" and "),")"):"(".concat(_o.buildCondition(e.data).join(" or "),")");if("and"===e.groupType){const t=e.data.flatMap(e=>r(e)).join(" and ");return"(".concat(t,")")}{const t=e.data.flatMap(e=>r(e));return"(".concat(t.join(" or "),")")}},a=t.applyGroup.groupName){e.next=5;break}return t.workshop.showInfo("Choose the group name to apply."),e.abrupt("return");case 5:return n=t.conGroups[a],s=r(n),t.ApplyOrSaveRef.enter(),o=Zt.getTempTableName(),c="select * from ".concat(t.workshop.getLastApplyTable().tableName," \n        where ").concat(s,"\n        as ").concat(o,";"),e.next=12,t.workshop.apply({tableName:o,sql:c});case 12:t.ApplyOrSaveRef.exit();case 13:case"end":return e.stop()}}),e)}))),this.workshop=e.parent.workshop,this.conGroups={},this.currentConditions={}}render(){return n.createElement("div",null,n.createElement("div",{className:"station-menu"},n.createElement(tt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(Co,{tab:"Add Conditions to Group",key:"1"},n.createElement(jo,{ref:e=>this.compare=e,parent:this,schemaFields:this.workshop.currentTable.schema.fields})),n.createElement(Co,{tab:"Apply Group",key:"2"},n.createElement(es,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onFilterApply,style:{marginBottom:"30px"}}),n.createElement(I.a,null),n.createElement(No,{ref:e=>this.applyGroup=e,parent:this,data:this.conGroups})),n.createElement(Co,{tab:"Add Groups to Group",key:"3"},n.createElement(To,{ref:e=>this.groupGroup=e,parent:this,data:this.conGroups})))),n.createElement("div",null))}}_o.buildCondition=e=>e.map(e=>(e=>{const t=e.field,a=e.dataType,n=e.compare,r=e.condition;if(n===So.IN){let e="";switch(a){case"integer":case"long":case"float":case"double":e=r.map(e=>e).join(",");break;default:e=r.map(e=>'"'.concat(Zt.escapeQuote(e),'"')).join(",")}const s="(".concat(e,")");return"".concat(Zt.getField(t)," ").concat(n," ").concat(s)}if(n===So.IS_NOT_NULL||n===So.IS_NULL)return"".concat(Zt.getField(t)," ").concat(n);if(n===So.IS_EMPTY)return"".concat(Zt.getField(t),' = ""');if(n===So.IS_NOT_EMPT)return"".concat(Zt.getField(t),' != ""');if(n===So.LIKE)return"".concat(Zt.getField(t),' like "').concat(Zt.escapeQuote(r),'"');if(n===So.STARTS_WITH)return"".concat(Zt.getField(t),' like "').concat(Zt.escapeQuote(r),'%"');if(n===So.ENDS_WITH)return"".concat(Zt.getField(t),' like "%').concat(Zt.escapeQuote(r),'"');let s="";switch(a){case"string":s='"'.concat(Zt.escapeQuote(r),'"');break;default:s=r}return"".concat(Zt.getField(t)," ").concat(n," ").concat(s)})(e));const Io=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Is.apply(t,e=>{if(0===Object.keys(e).length)return"Please configure order fields then click apply"},(e,t)=>{const a=Zt.getTempTableName(),n=Object.keys(t).map(e=>" ".concat(Zt.getField(e)," ").concat(t[e]," ")).join(",");return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            order by  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Po=Io.handler,Ao=Io.action;class Do{}Do.ADD_FIELD="addField",Do.REMOVE_FIELD="removeField";const Ro={[Do.ADD_FIELD]:Cs,[Do.REMOVE_FIELD]:js,setState:O.SetStateActionHandler,apply:Po},Fo={[Do.ADD_FIELD]:_s,[Do.REMOVE_FIELD]:Ts,setState:O.SetStateAction,apply:Ao};function Lo(e,t){return Fo[t.type](e,t.data)}const Mo={operateFileds:[],error:void 0,applySaveRollbackDispacher:void 0},qo=r.a.createContext(),Vo=Pe.a.Option;function Bo(e){const t=e.parent.workshop,a=t.currentTable.schema.fields,s=Object(p.useReducerAsync)(Lo,Mo,Ro),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.operateFileds,m=c.error,d=c.applySaveRollbackDispacher,h=H.a.useForm(),b=Object(u.a)(h,1)[0],f=a.map(e=>r.a.createElement(Vo,{key:e.name},e.name));return Object(n.useEffect)(()=>{d&&b.submit()},[d]),r.a.createElement(qo.Provider,{value:{dispacher:l}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},m&&r.a.createElement(le,{message:m}),r.a.createElement(H.a,{form:b,onFinish:e=>{l({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(zs,{context:qo,workshop:t})),r.a.createElement(H.a.Item,{label:"Choose fields"},r.a.createElement(Pe.a,{mode:"multiple",onDeselect:e=>{l({type:Do.REMOVE_FIELD,data:{fields:e}})},onChange:e=>{l({type:Do.ADD_FIELD,data:{fields:e}})}},f)),i.map(e=>r.a.createElement(H.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(Pe.a,null,r.a.createElement(Pe.a.Option,{value:"desc"},"desc"),r.a.createElement(Pe.a.Option,{value:"asc"},"asc")))))))}const Go=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Is.apply(t,e=>0==Object.keys(e).length?"Please configure limit size then click apply.":e.limitSize?void 0:"Please configure limit size then click apply.",(e,t)=>{const a=Zt.getTempTableName(),n=t.limitSize;return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            limit  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Uo=Go.handler,Jo=Go.action;const Ko=Object(y.a)(Object(y.a)({},za),{},{apply:Uo}),Ho=Object(y.a)(Object(y.a)({},Ya),{},{apply:Jo});function Qo(e,t){return Ho[t.type](e,t.data)}const Wo={limitSize:void 0,error:void 0,applySaveRollbackDispacher:void 0},zo=r.a.createContext();function Yo(e){const t=e.parent.workshop,a=Object(p.useReducerAsync)(Qo,Wo,Ko),s=Object(u.a)(a,2),o=s[0],c=s[1],l=(o.limitSize,o.error),i=o.applySaveRollbackDispacher,m=H.a.useForm(),d=Object(u.a)(m,1)[0];return Object(n.useEffect)(()=>{i&&d.submit()},[i]),r.a.createElement(zo.Provider,{value:{dispacher:c}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},l&&r.a.createElement(le,{message:l}),r.a.createElement(H.a,{form:d,onFinish:e=>{c({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(zs,{context:zo,workshop:t})),r.a.createElement(H.a.Item,{name:"limitSize"},r.a.createElement(Q.a,null)))))}const Xo=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).groupFields=t.data.groupFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),$o=Xo.handler,Zo=Xo.action,ec=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).orderFields=t.data.orderFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),tc=ec.handler,ac=ec.action,nc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).rowWindows=t.data.rowWindows,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),rc=nc.handler,sc=nc.action,oc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i,u,p,m,d,h,b,f,E,g,y,v,w,k;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.result,n=a.groupFields,r=a.orderFields,s=a.rowWindows,o=t.data,c=o.workshop,i=o.functions,u=n.map(e=>Zt.getField(e.field)).join(","),p=r.map(e=>"".concat(Zt.getField(e.field)," ").concat(e.value)),m="",p.length>0&&(m="order by ".concat(p.join(","))),d=s.windowType,h=s.preceding,b=s.following,f="",E=h&&"".concat(h," PRECEDING")||"UNBOUNDED PRECEDING",g=b&&"".concat(b," FOLLOWING")||"UNBOUNDED FOLLOWING","UNBOUNDED PRECEDING"===E&&"UNBOUNDED FOLLOWING"===g&&(g="CURRENT ROW"),!d){e.next=19;break}e.t0=d,e.next="row window"===e.t0?15:"range window"===e.t0?17:19;break;case 15:return f="ROWS BETWEEN ".concat(E,"  and ").concat(g," "),e.abrupt("break",19);case 17:return f="RANGE BETWEEN ".concat(E,"  and ").concat(g," "),e.abrupt("break",19);case 19:return y=i.map(e=>{e.field,e.isAgg;const t=e.transformCode,a=e.columnName;return"".concat(t," over w as ").concat(a)}).join(","),v=c.currentTable.schema.fields.map(e=>Zt.getField(e.name)).join(","),w=Zt.getTempTableName(),k="\n     select ".concat(v,",").concat(y,"\n     from ").concat(c.getLastApplyTable().tableName," \n     window w as (\n         partition by ").concat(u," ").concat(m," ").concat(f,"\n     ) as ").concat(w,";\n    "),e.next=25,c.apply({tableName:w,sql:k});case 25:return c.refreshOperateStation(),e.abrupt("return",{data:{}});case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),cc=oc.handler,lc=oc.action;class ic{}ic.buildGroup="buildGroup",ic.buildOrder="buildOrder",ic.buildRowWindows="buildRowWindows",ic.apply="apply";const uc=Object(y.a)(Object(y.a)({},za),{},{[ic.buildGroup]:$o,[ic.buildOrder]:tc,[ic.buildRowWindows]:rc,apply:cc}),pc=Object(y.a)(Object(y.a)({},Ya),{},{[ic.buildGroup]:Zo,[ic.buildOrder]:ac,[ic.buildRowWindows]:sc,apply:lc});function mc(e,t){return pc[t.type](e,t.data)}const dc=Pe.a.Option;var hc=function(e){const t=e.workshop,a=(e.dispacher,e.context),s=e.enableApply,o=void 0!==s&&s,c=e.fieldWrapper,l=e.submit,i=e.selectFields,p=e.selectFieldsLabel,m=void 0===p?"Choose fields":p,d=e.selectFieldsMode,h=void 0===d?"multiple":d,b=i||t.currentTable.schema.fields,f=Object(n.useState)([]),E=Object(u.a)(f,2),g=E[0],y=E[1],v=Object(n.useState)(void 0),w=Object(u.a)(v,2),k=w[0],x=w[1],S=H.a.useForm(),O=Object(u.a)(S,1)[0],j=b.map(e=>r.a.createElement(dc,{key:e.name},e.name));return{ui:e=>r.a.createElement(H.a,{form:O,className:"login-form",onFinish:l},k&&r.a.createElement(le,{onClose:()=>{x(void 0)},message:k}),o&&r.a.createElement(H.a.Item,null,r.a.createElement(zs,{context:a,workshop:t})),r.a.createElement(H.a.Item,{label:m,name:"selectFieldsName"},r.a.createElement(Pe.a,{style:{minWidth:"200px"},mode:h,onDeselect:e=>{y(g.filter(t=>e!==t.field))},onChange:e=>{y("multiple"===h?e.map(e=>({field:e})):[{field:e}])}},j)),g.map(e=>c(e)),e),operateFields:g,form:O,setError:x}};function bc(e){const t=Object(n.useContext)(Sc).dispacher,a=hc({workshop:e.workshop,fieldWrapper:e=>r.a.createElement(r.a.Fragment,null)}),s=a.ui,o=a.operateFields,c=a.setError;return s([r.a.createElement(H.a.Item,{key:"button"},r.a.createElement(W.a,{type:"primary",onClick:()=>{0!==o.length?t({type:ic.buildGroup,data:{groupFields:o}}):c("Fields are required.")}},"Next"))])}function fc(e){const t=Object(n.useContext)(Sc).dispacher,a=hc({workshop:e.workshop,fieldWrapper:e=>r.a.createElement(H.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(Pe.a,null,r.a.createElement(Pe.a.Option,{value:"desc"},"desc"),r.a.createElement(Pe.a.Option,{value:"asc"},"asc")))}),s=a.ui,o=a.operateFields,c=(a.setError,a.form);return s([r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{type:"primary",onClick:()=>{const e=c.getFieldValue(),a=o.map(t=>({field:t.field,value:e[t.field]}));t({type:ic.buildOrder,data:{orderFields:a}})}},"Next"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{onClick:()=>{t({type:"setState",data:{current:0}})}},"Previous"))])}function Ec(e){const t=Object(n.useContext)(Sc).dispacher,a=hc({workshop:e.workshop,fieldWrapper:e=>{switch(e.field){case"row window":case"range window":return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:"Preceding",name:"preceding"},r.a.createElement(Q.a,{placeholder:"number"})),r.a.createElement(H.a.Item,{label:"Following",name:"following"},r.a.createElement(Q.a,{placeholder:"number"})))}},selectFields:[{name:"row window"},{name:"range window"}],selectFieldsLabel:"Window Type",selectFieldsMode:"single"}),s=a.ui,o=(a.operateFields,a.setError,a.form);return s([r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{type:"primary",onClick:()=>{const e=o.getFieldValue().selectFieldsName,a=Object(y.a)(Object(y.a)({},o.getFieldValue()),{},{windowType:e});t({type:ic.buildRowWindows,data:{rowWindows:a}})}},"Next"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{onClick:()=>{t({type:"setState",data:{current:1}})}},"Previous"))])}const gc=Ge.a.Panel;var yc=a(1153);Ge.a.Panel;function vc(e){const t=e.workshop,a=Object(n.useContext)(Sc).dispacher,s=function(e){const t=e.operateField,a=Object(n.useState)([]),s=Object(u.a)(a,2),o=s[0],c=s[1],p=Object(n.useState)(void 0),m=Object(u.a)(p,2),d=m[0],h=m[1],b=H.a.useForm(),f=Object(u.a)(b,1)[0],E=Object(n.useState)(void 0),g=Object(u.a)(E,2),y=g[0],v=g[1],w=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.showFunctions();case 2:t=e.sent,a=t.content.map(e=>({value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)})),c(a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{w()},[]);const k=Object(n.useCallback)(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=o.filter(e=>e.value===t)[0],h(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[o]),x=e=>"yes"===e.extra.column?t:"";return{ui:(e,t)=>r.a.createElement(H.a,{form:f,className:"login-form"},y&&r.a.createElement(le,{onClose:()=>{v(void 0)},message:y}),r.a.createElement(H.a.Item,{label:"Search function"},r.a.createElement(Pe.a,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!0,style:{width:"200px"},filterOption:!0,onChange:k,notFoundContent:"type function name"},o.map(e=>r.a.createElement(Pe.a.Option,{key:e.value},e.text)))),d&&r.a.createElement(H.a.Item,{key:d.value},r.a.createElement(gs,{func:d})),d&&d.params.map(e=>r.a.createElement(H.a.Item,{initialValue:x(e),key:e.name,name:e.name,label:e.name},r.a.createElement(Q.a,null))),r.a.createElement(H.a.Item,null,r.a.createElement(Ge.a,null,r.a.createElement(gc,{header:"Mannually Apply Function"},r.a.createElement(I.a,{type:"horizontal"}),r.a.createElement(H.a.Item,{name:"mannualTransform",label:"Mannual Transform"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"isMannualAgg",label:"Is Agg Function"},r.a.createElement(Zr.a,null))))),t,r.a.createElement(H.a.Item,{name:"newFieldName",label:"New Field Name",required:!0},r.a.createElement(Q.a,null)),e),form:f,getTransform:()=>{const e=f.getFieldValue(),a=e.mannualTransform,n=e.isMannualAgg,r=e.newFieldName;if(a)return{field:t,isAgg:n||!1,transformCode:a,columnName:r};if(!d)return v("Operate is required."),{};const s=[];d.params.forEach(e=>{let a=f.getFieldValue()[e.name];a||"yes"!==e.extra.column||(a=t),a&&("yes"===e.extra.column?s.push(Zt.getField(a)):"number"==e.dataType||"boolean"==e.dataType?s.push(a):s.push('"'.concat(a,'"')))});return{field:t,isAgg:"yes"===d.funcValue.extra.agg,transformCode:"".concat(d.value,"(").concat(s.join(","),")"),columnName:r}},setError:v}}({operateField:""}),o=s.ui,c=s.form,p=s.getTransform,m=s.setError,d=Object(n.useState)(!1),h=Object(u.a)(d,2),b=h[0],f=h[1],E=Object(n.useState)([]),g=Object(u.a)(E,2),y=g[0],v=g[1];return r.a.createElement(r.a.Fragment,null,o([r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{type:"primary",loading:b,onClick:()=>{let e=[];if(0===y.length){const t=p(),a=t.field,n=t.isAgg,r=t.transformCode,s=t.columnName;if(e.push({field:a,isAgg:n,transformCode:r,columnName:s}),!s)return void m("New Field Name is required.")}else e=y;f(!0),a({type:ic.apply,data:{setLoading:f,workshop:t,functions:e}})}},"Apply"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{loading:b,onClick:()=>{const e=p(),t=e.field,a=e.isAgg,n=e.transformCode,r=e.columnName;r?(v(y.concat([{field:t,isAgg:a,transformCode:n,columnName:r}])),c.resetFields()):m("New Field Name is required.")}},"Add"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{onClick:()=>{a({type:"setState",data:{current:2}})}},"Previous"))]),y.length>0&&r.a.createElement(Es.b,{style:{width:"500px"},header:r.a.createElement("div",null,"Added Functions"),bordered:!0,dataSource:y.map(e=>"".concat(e.transformCode," as ").concat(e.columnName)),renderItem:e=>r.a.createElement(Es.b.Item,null,r.a.createElement(yc.a.Text,{mark:!0},"Func")," ",e)}))}function wc(){const e=Object(re.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\npadding: 30px 30px;\nwidth: 100%;\ndisplay:flex;\nalign-items:center;\njustify-content:center;\nflex-direction: column;\n"]);return wc=function(){return e},e}const kc=$r.a.Step,xc=se.a.div(wc()),Sc=r.a.createContext();function Oc(e){const t=e.parent.workshop,a={steps:[r.a.createElement(bc,{workshop:t}),r.a.createElement(fc,{workshop:t}),r.a.createElement(Ec,{workshop:t}),r.a.createElement(vc,{workshop:t})],current:0,result:{groupFields:[],orderFields:[],rowWindows:[]}},n=Object(p.useReducerAsync)(mc,a,uc),s=Object(u.a)(n,2),o=s[0],c=s[1],l=o.steps,i=o.current;return r.a.createElement(Sc.Provider,{value:{dispacher:c}},r.a.createElement("div",{className:"join-app"},r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement($r.a,{current:i},r.a.createElement(kc,{key:0,title:"Build Group",description:"Choose fields to group data"}),r.a.createElement(kc,{key:1,title:"Setup Group Row Order",description:"Choose fields to order the data in group"}),r.a.createElement(kc,{key:2,title:"Build Window",description:"Build window on every row of every group"}),r.a.createElement(kc,{key:3,title:"Apply Function",description:"Apply functions to all windows we have created"}))),r.a.createElement("div",{className:"join-app-form"},r.a.createElement(xc,null,l[i]," "))))}const jc=Object(y.a)({},za),Tc=Object(y.a)({},Ya);function Nc(e,t){return Tc[t.type](e,t.data)}a(1078);var Cc=a(544),_c=a.n(Cc);a(1082);const Ic={applySaveRollbackDispacher:void 0,scriptContent:void 0,applyToken:Zt.getJobName()},Pc=r.a.createContext();function Ac(e){const t=e.parent.workshop,a=Object(p.useReducerAsync)(Nc,Ic,jc),s=Object(u.a)(a,2),o=s[0],c=s[1],m=function(e){const t=e.parent.workshop.currentTable.schema.fields.map(e=>e.name),a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=Object(n.useState)(),c=Object(u.a)(o,2),l=c[0],i=c[1],p=Object(n.useState)([]),m=Object(u.a)(p,2),d=m[0],h=m[1],b=t.map(e=>r.a.createElement(Pe.a.Option,{value:e},e)),f=Object(n.useCallback)(e=>{e.forEach(e=>{"vType"===e.name[0]&&i(e.value)})},[]);return{ui:()=>r.a.createElement(K.a,{title:"Generic"},r.a.createElement(H.a,{form:s,onFieldsChange:f},r.a.createElement(H.a.Item,{label:"Visulizaiton Plugin",name:"vType"},r.a.createElement(Pe.a,null,d.map(e=>r.a.createElement(Pe.a.Option,{value:e},e)))),r.a.createElement(H.a.Item,{label:"X Column",name:"xColumn"},r.a.createElement(Pe.a,null,b)),r.a.createElement(H.a.Item,{label:"Y Column",name:"yColumn"},r.a.createElement(Pe.a,null,b)))),form:s,vType:l,setPlugins:h}}(e),b=m.ui,f=m.form,E=m.vType,g=m.setPlugins,y=function(e){const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)([]),o=Object(u.a)(s,2),c=o[0],l=o[1],i=Object(n.useState)(),p=Object(u.a)(i,2),m=p[0],d=p[1];return{ui:()=>r.a.createElement(K.a,{title:"Plugin Parameters"},m&&r.a.createElement("div",{className:"image-wrapper",style:{width:"400px"}},r.a.createElement(_c.a,{src:m})),r.a.createElement(H.a,{form:a},c.map(e=>r.a.createElement(H.a.Item,{key:e.key,name:e.key,label:e.option.label||e.key,initialValue:Zt.unQuote(e.command)},r.a.createElement(Q.a,null))))),form:a,setPluginConfigs:l,pluginConfigs:c,setImagePreview:d}}(),v=y.ui,w=y.form,k=y.setPluginConfigs,x=y.setImagePreview,S=new d.ActionProxy,O=o.applySaveRollbackDispacher,j=o.scriptContent,T=o.applyToken,N=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get(h.default.PLUGIN_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=t.content.map(e=>e.name),g(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E){e.next=14;break}return e.next=3,S.get(h.default.PLUGIN_GET,{pluginName:E});case 3:return t=e.sent,a=t.content.content,e.next=7,S.runScript(a,Zt.getJobName(),{executeMode:"analyze"});case 7:if(200===(n=e.sent).status){e.next=10;break}return e.abrupt("return");case 10:r=n.content.filter(e=>e.mode&&"defaultParam"===e.mode),c({type:"setState",data:{scriptContent:a}}),x(t.content.image),k(r);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{C()},[E]),Object(n.useEffect)(()=>{N()},[]);const _=function(){var e=Object(i.a)(l.a.mark((function e(){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O){e.next=8;break}return a=f.getFieldValue(),n=w.getFieldValue(),r=n.tableName||Zt.getTempTableName(),s="\n             select ".concat(Zt.getField(a.xColumn)," as x,").concat(Zt.getField(a.yColumn)," as y \n             from ").concat(t.getLastApplyTable().tableName," as ").concat(r,";\n             ").concat(j,"\n            "),e.next=7,t.apply({tableName:r,sql:s});case 7:O({type:"setState",data:{loading:!1}});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{_()},[T]),r.a.createElement(Pc.Provider,{value:{dispacher:c}},r.a.createElement(zs,{workshop:t,context:Pc}),r.a.createElement("div",{className:"dash-station"},r.a.createElement("div",{className:"dash-station-data-page"},b()),r.a.createElement(I.a,{type:"vertical",style:{height:"300px"}}),r.a.createElement("div",{className:"dash-station-dash-page"},v())))}const Dc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.data.apply)&&a(t.data),e.abrupt("return",{data:Object(y.a)({},t.data)});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Rc=Dc.handler,Fc=Dc.action,Lc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Is.apply(t,e=>{if(!e.unionTable)return"UnionTable is required."},(e,t)=>{const a=Zt.getTempTableName();let n="union";t.duplicate&&(n="UNION ALL");return{tableName:a,sql:"\n            select * from ".concat(e.getLastApplyTable().tableName,"\n            ").concat(n,"\n            select * from ").concat(Zt.getField(t.unionTable),"\n            as ").concat(a,";                         \n            ")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Mc=Lc.handler,qc=Lc.action;class Vc{}Vc.UnionApply="UnionApply";const Bc=Object(y.a)(Object(y.a)({},za),{},{[eo.APPLY]:Rc,[Vc.UnionApply]:Mc}),Gc=Object(y.a)(Object(y.a)({},Ya),{},{[eo.APPLY]:Fc,[Vc.UnionApply]:qc});function Uc(e,t){return Gc[t.type](e,t.data)}const Jc=Pe.a.Option,Kc=()=>{const e=n.useState(Array()),t=Object(u.a)(e,2),a=t[0],r=t[1],s=H.a.useForm(),o=Object(u.a)(s,1)[0];n.useEffect(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.tablesInWorkshop();case 2:200===(t=e.sent).status&&(a=t.content,r(a));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const c=a.map(e=>n.createElement(Jc,{value:e.tableName},e.tableName));return{ui:()=>n.createElement(H.a,{form:o,className:"login-form"},n.createElement(H.a.Item,{label:n.createElement(B.a,{id:"union_table"}),name:"unionTable",rules:[{required:!0,message:"Please select union table!"}]},n.createElement(Pe.a,{showSearch:!0,style:{width:200},placeholder:"Choose Join Table",optionFilterProp:"children"},c)),n.createElement(H.a.Item,{label:n.createElement(B.a,{id:"allow_duplicate"}),name:"duplicate",rules:[{required:!0,message:"Please select!"}]},n.createElement(Pe.a,{style:{width:200}},n.createElement(Jc,{value:"true"},"true"),n.createElement(Jc,{value:"false"},"false")))),form:o}},Hc={applySaveRollbackDispacher:void 0,error:void 0},Qc=r.a.createContext(null),Wc=e=>{const t=Object(p.useReducerAsync)(Uc,Hc,Bc),a=Object(u.a)(t,2),s=a[0],o=a[1],c=s.applySaveRollbackDispacher,l=(s.error,Kc()),i=l.ui,m=l.form;return Object(n.useEffect)(()=>{if(c){const e=m.getFieldsValue(),t=e.unionTable,a=e.duplicate;o({type:eo.setState,data:{error:void 0}});const n={unionTable:t,duplicate:a};o({type:Vc.UnionApply,data:{workshop:ql.workshop,values:n}})}},[c]),r.a.createElement(Qc.Provider,{value:{state:s,dispacher:o}},r.a.createElement("div",{style:{marginBottom:"30px"}},r.a.createElement(zs,{context:Qc,workshop:ql.workshop})),r.a.createElement(i,null))},zc=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Is.apply(t,e=>{var t;return e.columnHeader&&e.columnLeft&&e.columnSum?(null===(t=e.sunFunc)||void 0===t?void 0:t.length)>0?void 0:"Agg funcs are required.":"Three columns are required."},(e,t)=>{const a=Zt.getTempTableName();return{tableName:a,sql:"\n            run ".concat(e.getLastApplyTable().tableName,' as Pivot.`` where \n            columnLeft="').concat(t.columnLeft,'"\n            and columnHeader="').concat(t.columnHeader,'"\n            and columnSum="').concat(t.columnSum,'"\n            and sunFunc="').concat(t.sunFunc.map(e=>"".concat(e,"(").concat(Zt.getField(t.columnSum),")")).join(","),'"\n            as ').concat(a,";                         \n            ")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Yc=zc.handler,Xc=zc.action;class $c{}$c.PivotApply="PivotApply";const Zc=Object(y.a)(Object(y.a)({},za),{},{[eo.APPLY]:Rc,[$c.PivotApply]:Yc}),el=Object(y.a)(Object(y.a)({},Ya),{},{[eo.APPLY]:Fc,[$c.PivotApply]:Xc});function tl(e,t){return el[t.type](e,t.data)}a(1083);var al=a(153),nl=a(115);const rl=["avg","max","min","sum","count"],sl=nl.a.Group,ol={columnLeft:null,columnHeader:null,columnSum:null,applySaveRollbackDispacher:void 0,error:void 0},cl=r.a.createContext(null),ll=e=>{const t=ql.workshop,a=t.currentTable.schema.fields.map(e=>e.name),s=Object(p.useReducerAsync)(tl,ol,Zc),o=Object(u.a)(s,2),c=o[0],l=o[1],i=c.columnLeft,m=c.columnHeader,d=c.columnSum,h=c.applySaveRollbackDispacher,b=c.error,f=Object(n.useState)(null),E=Object(u.a)(f,2),g=(E[0],E[1]),y=Object(al.c)({onDragStart:e=>{g(e)},onDragEnd:()=>{g(null)}}),v=Object(al.d)({onDom:(e,t)=>{l({type:eo.setState,data:{columnHeader:e}})}}),w=Object(u.a)(v,2),k=w[0],x=w[1].isHovering,S=Object(al.d)({onDom:(e,t)=>{l({type:eo.setState,data:{columnLeft:e}})}}),O=Object(u.a)(S,2),j=O[0],T=O[1].isHovering,N=Object(al.d)({onDom:(e,t)=>{l({type:eo.setState,data:{columnSum:e}})}}),C=Object(u.a)(N,2),_=C[0],P=C[1].isHovering,A=(e,t)=>e?r.a.createElement(B.a,{id:"drop_column"}):t||r.a.createElement(B.a,{id:"drag_column"});Object(n.useEffect)(()=>{if(h){l({type:eo.setState,data:{error:void 0}});const e=F.getFieldsValue().aggs,a={columnHeader:m,columnSum:d,columnLeft:i,sunFunc:e};l({type:$c.PivotApply,data:{workshop:t,values:a}})}},[h]);const D=(()=>{const e=H.a.useForm(),t=Object(u.a)(e,1)[0];return{ui:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{form:t},r.a.createElement(H.a.Item,{name:"aggs"},r.a.createElement(sl,{options:rl})))),form:t}})(),R=D.ui,F=D.form;return r.a.createElement(cl.Provider,{value:{state:c,dispacher:l}},b&&r.a.createElement(le,{message:b}),r.a.createElement("div",{className:"pivot-station-commands"},r.a.createElement(zs,{context:cl,workshop:t})),r.a.createElement("div",{className:"pivot-station-app"},r.a.createElement("div",{className:"pivot-station-fields"},r.a.createElement(Es.b,{className:"pivot-station-fields-list",header:r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{placeholder:"search"})),bordered:!0,dataSource:a,renderItem:e=>r.a.createElement(Es.b.Item,null,r.a.createElement("div",y(e),e))})),r.a.createElement("div",{className:"pivot-station-bigbox"},r.a.createElement("div",Object.assign({className:"pivot-station-left"},j),r.a.createElement("span",{className:"pivot-common-font"},r.a.createElement(B.a,{id:"column_left"})," "),r.a.createElement("br",null)," ",A(T,i)),r.a.createElement("div",{className:"pivot-station-body"},r.a.createElement("div",Object.assign({className:"pivot-station-header"},k),r.a.createElement("span",{className:"pivot-common-font"},r.a.createElement(B.a,{id:"column_header"}))," ",r.a.createElement("br",null),A(x,m)),r.a.createElement("div",Object.assign({className:"pivot-station-content"},_),r.a.createElement("span",{className:"pivot-common-font"},r.a.createElement(B.a,{id:"column_sum"}))," ",r.a.createElement("br",null)," ",A(P,d),r.a.createElement(I.a,null),R())))))};const il=Object(y.a)(Object(y.a)({},za),{},{[eo.APPLY]:Rc}),ul=Object(y.a)(Object(y.a)({},Ya),{},{[eo.APPLY]:Fc});function pl(e,t){return ul[t.type](e,t.data)}const ml="input",dl="select";class hl{constructor(e){var t=this;this._sql=void 0,this.sqls=[],this.build=Object(i.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.runScript(t._sql,Zt.getJobName(),{executeMode:"analyze"});case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",t);case 6:return t.sqls=n.content,e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)}))),this.userInputs=()=>this.sqls.filter(e=>"defaultParam"===e.mode).map(e=>e),this.toSql=e=>{const t=Object.keys(e).map(t=>{const a=t,n=e[t];let r="'''".concat(n,"'''");return n||(r='""'),"set ".concat(a,"=").concat(r,";")});return"\n          ".concat(t.join("\n"),"\n          ").concat(this._sql,"\n        ")},this._sql=e}}const bl=e=>{const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)([]),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)({}),b=Object(u.a)(m,2),f=b[0],E=(b[1],Object(n.useState)({})),g=Object(u.a)(E,2),v=g[0],w=g[1],k=Object(n.useRef)(null),x=new d.ActionProxy;Object(n.useEffect)(()=>{(function(){var t=Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.get(h.default.ANALYSIS_PLUGIN_GET,{name:e});case 2:if(200!==(a=t.sent).status){t.next=9;break}return r=a.content,t.next=7,new hl(r.content).build();case 7:k.current=t.sent,p(null===(n=k.current)||void 0===n?void 0:n.userInputs());case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},[]);const S=Object(n.useCallback)(e=>{(function(){var t=Object(i.a)(l.a.mark((function t(){var a,n,r,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(v[e.name]&&Object.keys(v[e.name]).length>0)){t.next=2;break}return t.abrupt("return");case 2:if(!e.optionStr){t.next=5;break}return w({[e.name]:null===(a=e.optionSql)||void 0===a?void 0:a.split(",").map(e=>({name:e,value:e}))}),t.abrupt("return");case 5:if(n=Zt.getTempTableName(),!e.optionTable){t.next=18;break}if("__current_table_fields__"!==e.optionTable){t.next=11;break}return r=ql.workshop.currentTable.schema.fields.map(e=>({name:e.name,value:e.name})),w({[e.name]:r}),t.abrupt("return");case 11:return t.next=13,x.runScript("select * from ".concat(e.optionTable," as ").concat(n),Zt.getJobName(),Zt.robotFetchParam());case 13:return s=t.sent,r=[],200===s.status&&(r=s.content.data),w({[e.name]:r}),t.abrupt("return");case 18:if(!e.optionSql){t.next=26;break}return t.next=21,x.runScript("".concat(e.optionSql),Zt.getJobName(),Zt.robotFetchParam());case 21:return s=t.sent,r=[],200===s.status&&(r=s.content.data),w({[e.name]:r}),t.abrupt("return");case 26:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},[]),O=Object(n.useCallback)(e=>{let t=Object(y.a)(Object(y.a)({},e.option),{},{name:e.key});return{[ml]:()=>r.a.createElement(H.a.Item,{required:t.required,name:t.name,key:t.name,initialValue:Zt.unQuote(e.comamnd),label:t.label||t.name},r.a.createElement(Q.a,null)),[dl]:()=>{var a;return r.a.createElement(H.a.Item,{required:t.required,name:t.name,key:t.name,initialValue:Zt.unQuote(e.comamnd),label:t.label||t.name},r.a.createElement(Pe.a,{showSearch:!0,onFocus:()=>{S(t)},loading:f[t.name]||!1,mode:t.selectMode},console.log(v),null===(a=v[t.name])||void 0===a?void 0:a.map(e=>r.a.createElement(Pe.a.Option,{key:e.value,value:e.value},e.name))))}}[t.formType]()},[v]);return{ui:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{form:a},c.map(e=>O(e)))),form:a,analysisUtils:k}},fl=e=>{const t=bl(e.pluginName),a=t.ui,s=t.form,o=t.analysisUtils;return e.form.current=s,e.analysisUtils.current=o.current,Object(n.useEffect)(()=>{},[]),r.a.createElement(r.a.Fragment,null,a())};a(1085);const El={plugins:[],pluginName:"",applySaveRollbackDispacher:void 0,applyToken:Zt.getJobName()},gl=r.a.createContext(null),yl=e=>{const t=Object(p.useReducerAsync)(pl,El,il),a=Object(u.a)(t,2),s=a[0],o=a[1],c=new d.ActionProxy,m=Object(n.useRef)(null),b=Object(n.useRef)(null),f=s.applySaveRollbackDispacher,E=s.pluginName,g=s.plugins,y=s.applyToken;Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(h.default.ANALYSIS_PLUGIN_LIST,{});case 2:200===(t=e.sent).status&&o({type:eo.setState,data:{plugins:t.content}});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const v=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r,s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=13;break}return a=null===(t=m.current)||void 0===t?void 0:t.getFieldsValue(),n=b.current,r=null===n||void 0===n?void 0:n.toSql(a),s=ql.workshop,o=s.getLastApplyTable().tableName,c=Zt.getTempTableName(),i='\n      set __current_table__="'.concat(o,'";\n      set __new_table__="').concat(c,'";\n      ').concat(r,"\n      "),e.next=10,s.apply({tableName:c,sql:i});case 10:200===e.sent&&s.refreshOperateStation(),f({type:"setState",data:{loading:!1}});case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{v()},[y]),r.a.createElement(gl.Provider,{value:{state:s,dispacher:o}},r.a.createElement(zs,{context:gl}),r.a.createElement("div",{className:"analysis-plugin-select"},r.a.createElement(Pe.a,{showSearch:!0,onChange:e=>{o({type:eo.setState,data:{pluginName:e}})},filterOption:!0,style:{width:"200px"}},g.map(e=>r.a.createElement(Pe.a.Option,{key:e.name,value:e.name},e.name)))),r.a.createElement("div",{className:"analysis-plugin-form"},E&&r.a.createElement(fl,{analysisUtils:b,pluginName:E,form:m})))},vl=tt.a.TabPane;class wl extends n.Component{constructor(e){super(e),this.reload=()=>{this.setState({key:Zt.getJobName()})},this.workshop=ql.workshop,this.state={key:Zt.getJobName()}}render(){return n.createElement("div",{className:"os-pane",style:{backgroundColor:"white"}},n.createElement("div",{className:"os-tabs"},n.createElement(Ae.Resizable,{style:{borderBottom:"solid",width:"100%",overflow:"scroll"}},n.createElement(tt.a,{defaultActiveKey:"1",tabPosition:"left",key:this.state.key},n.createElement(vl,{tab:n.createElement(B.a,{id:"project"}),key:1},n.createElement(xo,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"filter"}),key:2},n.createElement(_o,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"agg"}),key:4},n.createElement(ws,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"order"}),key:5},n.createElement(Bo,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"pivot"}),key:10},n.createElement(ll,null)),n.createElement(vl,{tab:n.createElement(B.a,{id:"more"}),key:100},n.createElement(tt.a,{tabPosition:"left"},n.createElement(vl,{tab:n.createElement(B.a,{id:"join"}),key:3},n.createElement(ds,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"limit"}),key:6},n.createElement(Yo,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"window"}),key:7},n.createElement(Oc,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"union"}),key:9},n.createElement(Wc,null)),n.createElement(vl,{tab:n.createElement(B.a,{id:"dash"}),key:8},n.createElement(Ac,{parent:this})),n.createElement(vl,{tab:n.createElement(B.a,{id:"plugin"}),key:11},n.createElement(yl,null))))))))}}const kl=e=>class extends e{constructor(...e){super(...e),this.toggleMessage=e=>{this.state.showMessage?this.setState({showMessage:!this.state.showMessage}):this.setState({showMessage:!this.state.showMessage,consoleMessage:e})},this.showInfo=e=>{this.setState({showInfoMessage:!0,infoMessage:e})}}},xl=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.updateDisplay=function(){var e=Object(i.a)(l.a.mark((function e(a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({tableLoading:!0}),t.displayRef.update(a,n.fields),t.setState({tableLoading:!1});case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.refreshOperateStation=()=>{this.stationRef.setState({key:Math.random()})},this.refreshTableWorkshop=()=>{this.leftTreePaneRef.setState({reloaWorkshop:Zt.getJobName()})}}};var Sl=a(1145),Ol=a(546),jl=a.n(Ol),Tl=a(497);const Nl=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.getColumnSearchProps=e=>({filterDropdown:({setSelectedKeys:t,selectedKeys:a,confirm:r,clearFilters:s})=>n.createElement("div",{style:{padding:8}},n.createElement(Q.a,{ref:e=>{this.searchInput=e},placeholder:"Search ".concat(e),value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>this.handleSearch(a,r,e),style:{width:188,marginBottom:8,display:"block"}}),n.createElement(Sl.a,null,n.createElement(W.a,{type:"primary",onClick:()=>this.handleSearch(a,r,e),icon:n.createElement(Tl.a,null),size:"small",style:{width:90}},"Search"),n.createElement(W.a,{onClick:()=>this.handleReset(s),size:"small",style:{width:90}},"Reset"))),filterIcon:e=>n.createElement(Tl.a,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>!0,onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>this.searchInput.select())},render:t=>this.state.searchedColumn===e?n.createElement(jl.a,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[this.state.searchText],autoEscape:!0,textToHighlight:t?t.toString():""}):this.wrapper(t)}),this.handleSearch=function(){var e=Object(i.a)(l.a.mark((function e(a,n,r){var s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Zt.getTempTableName(),o=a[0],c=Zt.getField(r),i={tableName:s,sql:"select * from ".concat(t.workshop.getLastApplyTable().tableName," \n            where ").concat(c," like '%").concat(o,"%' as ").concat(s,";")},n(),t.setState({loading:!0}),e.next=8,t.workshop.apply(i);case 8:t.setState({loading:!1,searchText:a[0],searchedColumn:r});case 9:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.handleReset=e=>{e(),this.setState({searchText:""})}}};var Cl=a(171),_l=a(484);const Il=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.dropdownStat=function(){var e=Object(i.a)(l.a.mark((function e(a,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({loading:!0}),r=Zt.getTempTableName(),e.t0=a,e.next="count"===e.t0?5:"count(distinct)"===e.t0?9:13;break;case 5:return e.next=7,t.workshop.apply({tableName:r,sql:"select count(".concat(Zt.getField(n),") \n                    from ").concat(t.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 7:return t.setState({loading:!1}),e.abrupt("return");case 9:return e.next=11,t.workshop.apply({tableName:r,sql:"select count(distinct ".concat(Zt.getField(n),") \n                    from ").concat(t.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 11:return t.setState({loading:!1}),e.abrupt("return");case 13:t.setState({loading:!1});case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.dropdown=e=>{const t=n.createElement(C.a,{onClick:t=>{this.dropdownStat(t.key,e.name)}},n.createElement(C.a.Item,{key:"count",icon:n.createElement(_l.a,null)},"Count"),n.createElement(C.a.Item,{key:"count(distinct)",icon:n.createElement(_l.a,null)},"Count&distinct"));return n.createElement(Cl.a,{overlay:t},n.createElement("span",null,e.name,n.createElement(I.a,{type:"vertical"}),n.createElement(Qa.a,null)))}}};a(212);class Pl extends(Ln(n.Component).with(Nl,Il)){constructor(e){super(e),this.wrapper=e=>n.createElement("div",{onDoubleClick:t=>{t.preventDefault(),t.stopPropagation(),this.setState({view:{enabled:!0,content:e}})}},e),this.getDefaultRender=e=>{e.name;const t=e.type;if("object"===typeof t||"array"===typeof t)return(e,t)=>{const a=JSON.stringify(e);return this.wrapper(a)};switch(t){case"string":return(e,t)=>this.wrapper(e);default:return(e,t)=>String(e)}},this.getDefaultSearch=e=>{const t=e.name;switch(e.type){case"string":return this.getColumnSearchProps(t);case"array":case"map":default:return{}}},this.getDefaultTitleRender=e=>this.dropdown(e),this.update=(e,t)=>{let a=!1;t[0]&&"html"===t[0].name&&t[1]&&"dash"===t[1].name&&(a=!0);const n=t.map(e=>Object(y.a)(Object(y.a)({},e),{},{dataIndex:e.name,title:this.getDefaultTitleRender(e),render:this.getDefaultRender(e),width:200,textWrap:"word-break",ellipsis:{showTitle:!0}},this.getDefaultSearch(e)));this.setState({columns:n,data:e,isDash:a})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1},searchText:"",searchedColumn:"",loading:!1,isDash:!1},this.config={},this.workshop=ql.workshop}render(){return this.state.isDash?wt.render(this.state.data):n.createElement("div",{style:this.tableStyle},n.createElement(Ue.a,{loading:this.state.loading,size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:"max-content"}}),n.createElement($e.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(fe.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.view.content||""})))}}var Al=a(186),Dl=a(493);function Rl(){const e=Object(re.a)(["\n      display:flex;\n      align-items:right;    \n    "]);return Rl=function(){return e},e}function Fl(e){se.a.div(Rl());const t=Object(Al.b)();return r.a.createElement("div",{className:"common-one-hundred-percent-width"},r.a.createElement(Ge.a,{style:{marginBottom:"10px"}},r.a.createElement(Ge.a.Panel,{header:r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,{icon:r.a.createElement(Dl.a,null),onClick:e=>{e.preventDefault(),e.stopPropagation(),t.enter(e)}}),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(B.a,{id:"operate_panel"}))},r.a.createElement(Al.a,{handle:t},r.a.createElement(wl,{ref:e=>ql.workshop.stationRef=e})))))}function Ll(e){const t=Object(Al.b)();return r.a.createElement(Ge.a,{defaultActiveKey:"1",style:{marginBottom:"30px",width:"100%"}},r.a.createElement(Ge.a.Panel,{key:"1",header:r.a.createElement(r.a.Fragment,null,ql.workshop.sessionId&&r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,{icon:r.a.createElement(Dl.a,null),onClick:e=>{e.preventDefault(),e.stopPropagation(),t.enter(e)}}),r.a.createElement(I.a,{type:"vertical"})),r.a.createElement(B.a,{id:"data_panel"}))},r.a.createElement(Al.a,{handle:t},r.a.createElement(Pl,{tableStyle:{width:"90%"},ref:e=>ql.workshop.displayRef=e}))))}class Ml extends(Ln(n.Component).with(Yr,Xr,kl,xl)){constructor(e){super(e),this.client=new d.ActionProxy,this.state={tableLoading:!1},this.sqls=[],Ml.workshop=this}componentDidMount(){}operateStationView(){return this.state.loadingTable?n.createElement(On,null):this.sessionId?n.createElement(Fl,null):n.createElement(Rn.a,{style:{width:"100%"},title:"No Aanalysis Session Is Opened",subTitle:"Right click the table in the left panel(DeltaLake/FileSystem) to begin your analysis"})}render(){return n.createElement("div",{className:"ws-app"},n.createElement("div",{className:"ws-left-pane"},n.createElement(Ae.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},n.createElement(zr,{ref:e=>this.leftTreePaneRef=e,parent:this}))),n.createElement("div",{className:"ws-right-pane"},n.createElement($e.a,{title:"Message",visible:this.state.showMessage||!1,onCancel:this.toggleMessage,onOk:this.toggleMessage,cancelText:"Cancel",width:"60%",OkText:"Ok"},n.createElement(fe.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.consoleMessage||""})),n.createElement($e.a,{title:"Message",visible:this.state.showInfoMessage||!1,onCancel:()=>{this.setState({showInfoMessage:!1})},onOk:()=>{this.setState({showInfoMessage:!1})},cancelText:"Cancel",OkText:"Ok"},this.state.infoMessage),n.createElement("div",{className:"ws-operate-pane"},this.operateStationView()),n.createElement("div",{className:"ws-table-pane"},n.createElement(Ll,null))))}}Ml.workshop=void 0;var ql=Ml;const Vl=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.enableRegister,r=a.enableLogin,s=a.enableConsole,o={},void 0!==n&&(o.register=n),void 0!==r&&(o.login=r),void 0!==s&&(o.console=s),c=new d.ActionProxy,e.next=8,c.post(h.default.APP_SAVE,o);case 8:if(200!==(i=e.sent).status){e.next=11;break}return e.abrupt("return",{data:{applySuccess:!0}});case 11:return e.abrupt("return",{data:{error:i.content}});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Bl=Vl.handler,Gl=Vl.action,Ul=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Jl=Ul.handler,Kl=Ul.action;class Hl{}Hl.LR_CONTROL="lrControl",Hl.SET_STATE="setState";const Ql={[Hl.LR_CONTROL]:Bl,[Hl.SET_STATE]:Jl};function Wl(e,t){switch(t.type){case Hl.LR_CONTROL:return Gl(e,t.data);case Hl.SET_STATE:return Kl(e,t.data);default:return e}}a(461);var zl=a(494);const Yl={enableLogin:!1,enableRegister:!1,enableConsole:!1,applySuccess:!1,error:void 0,loading:!0},Xl=r.a.createContext();function $l(){const e=Object(p.useReducerAsync)(Wl,Yl,Ql),t=Object(u.a)(e,2),a=t[0],s=t[1],o=w.formLayout1(),c=o.formItemLayout,b=o.tailLayout,f=a.enableLogin,E=a.enableRegister,g=a.enableConsole,y=a.applySuccess,v=a.error,k=a.loading;function x(){return(x=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.APP_INFO,{});case 3:200===(a=e.sent).status&&s({type:Hl.SET_STATE,data:{enableLogin:Boolean(a.content.login),enableRegister:Boolean(a.content.register),enableConsole:Boolean(a.content.console),loading:!1}});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)(()=>{!function(){x.apply(this,arguments)}()},[y,v]),r.a.createElement(Xl.Provider,{value:{dispacher:s}},y&&r.a.createElement(_.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),v&&r.a.createElement(_.a,{closable:!0,message:"Fail",description:v,type:"error",showIcon:!0}),k&&r.a.createElement(On,null),!k&&r.a.createElement(K.a,{title:"Control Website Register/Login"},r.a.createElement(H.a,Object.assign({},c,{className:"login-form",onFinish:e=>{s(m.a.buildEvent(Hl.LR_CONTROL,e))}}),r.a.createElement(H.a.Item,{label:"Allow Register New User",name:"enableRegister"},r.a.createElement(Zr.a,{defaultChecked:E,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,{label:"Allow User Login",name:"enableLogin"},r.a.createElement(Zr.a,{defaultChecked:f,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,{label:"Enable Console(SQL)",name:"enableConsole"},r.a.createElement(Zr.a,{defaultChecked:g,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,b,r.a.createElement(W.a,{type:"primary",htmlType:"submit"},"Apply")))))}var Zl=a(557);function ei(e){const t=e.renderConfig,a=e.createInitRow,s=e.submit,o=e.remove,c=H.a.useForm(),p=Object(u.a)(c,1)[0],m=Object(n.useState)([]),d=Object(u.a)(m,2),h=d[0],b=d[1],f=Object(n.useState)([]),E=Object(u.a)(f,2),g=E[0],y=E[1],v=Object(n.useState)({}),w=Object(u.a)(v,2),k=w[0],x=w[1],S=Object(n.useState)(!1),O=Object(u.a)(S,2),j=O[0],T=O[1],N=Object(n.useState)(!1),C=Object(u.a)(N,2),_=C[0],I=C[1],P=Object(n.useState)(void 0),A=Object(u.a)(P,2),D=A[0],R=A[1],F=Object(al.e)(g),L=F.list,M=F.remove,q=F.getKey,V=F.move,B=F.push,G=(F.sortForm,F.resetList),U=p.getFieldsValue;Object(n.useEffect)(()=>{G(g)},[g]);const J=h.filter(e=>"id"!==e).map(e=>t&&t[e]?t[e]({getKey:q}):{title:e,dataIndex:e,key:e,render:(t,a,n)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(q(n),"].").concat(e),initialValue:t},r.a.createElement(Q.a,{style:{width:120,marginRight:16}})))}).concat([{key:"operate",title:"",dataIndex:"operate",render:(e,t,a)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(q(a),"].operate")},r.a.createElement(W.a.Group,null,r.a.createElement(W.a,{type:"danger",onClick:()=>{o&&o({row:t,setLoading:T}),M(a)}},"Delete"))))}]),K=Object(n.useCallback)(e=>{x(e);var t=/params\[(\d+)\]\.(\D+)/;(function(){var a=Object(i.a)(l.a.mark((function a(){var n;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=[],Object.entries(e).map(([e,a])=>{const r=t.exec(e),s=Number(r[1]),o=r[2];n[s]||(n[s]={}),a&&(n[s][o]=a)}),s&&s({params:n,setLoading:T});case 3:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}})()()},[T]);return{ui:()=>{if(!_){const e=J.map(e=>(e.render=(e,t,a)=>r.a.createElement("span",null,e),e));return r.a.createElement(Ue.a,{columns:e,dataSource:g,pagination:!1})}return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{form:p},r.a.createElement(Zl.a,{onDragEnd:(e,t)=>V(e,t),handleSelector:'i[aria-label="icon: drag"]'},D&&r.a.createElement(le,{message:D}),r.a.createElement(Ue.a,{columns:J,dataSource:L,rowKey:(e,t)=>q(t).toString(),pagination:!1})),r.a.createElement(W.a,{style:{marginTop:8},block:!0,type:"dashed",onClick:()=>B((()=>{if(a)return a(J);const e={};return J.map(t=>{e[t]=""}),e})())},"+ Add Row"),r.a.createElement(W.a,{type:"primary",style:{marginTop:16},loading:j,onClick:()=>{K(U())}},"Submit"),e.debug&&r.a.createElement("div",{style:{whiteSpace:"pre"}},k&&"content: ".concat(JSON.stringify(k,null,2)))))},data:g,schema:h,setData:y,setSchema:b,setLoading:T,setEditorMode:I,setError:R}}function ti(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=a[0],o=a[1],c=new d.ActionProxy,p=ei({remove:function(){var e=Object(i.a)(l.a.mark((function e({row:t,setLoading:a}){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),g(void 0),e.next=4,c.post(h.default.ENGINE_REMOVE,{id:t.id});case 4:if(200===(n=e.sent).status){e.next=9;break}return a(!1),g(n.content),e.abrupt("return");case 9:o(Zt.getJobName()),a(!1);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),submit:function(){var e=Object(i.a)(l.a.mark((function e({params:t,setLoading:a}){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(!0),g(void 0),n=0;case 3:if(!(n<t.length)){e.next=14;break}return e.next=6,c.post(h.default.ENGINE_ADD,t[n]);case 6:if(200===(r=e.sent).status){e.next=11;break}return a(!1),g(r.content),e.abrupt("return");case 11:n++,e.next=3;break;case 14:o(Zt.getJobName()),a(!1);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{skipAuth:({getKey:e})=>({title:"skipAuth",dataIndex:"skipAuth",key:"skipAuth",render:(t,a,n)=>{let s=!0;return 2===t&&(s=!1),r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(e(n),"].skipAuth"),initialValue:String(s)},r.a.createElement(Pe.a,null,r.a.createElement(Pe.a.Option,{value:"true"},"true"),r.a.createElement(Pe.a.Option,{value:"false"},"false"))))}})}}),m=p.ui,b=p.setData,f=p.setSchema,E=p.setEditorMode,g=p.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(h.default.ENGINE_LIST,{});case 2:200===(t=e.sent).status&&(f(t.content.schema),b(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[s]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(Zr.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{E(e)}}),r.a.createElement(I.a,{type:"horizontal"}),m())}var ai=function(){const e=Object(n.useState)(void 0),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(void 0),c=Object(u.a)(o,2),p=c[0],m=c[1],b=Object(n.useCallback)(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.password,a=t.newPassword,n=t._newPassword,a===n){e.next=4;break}return s("Two new passwords are not the same"),e.abrupt("return");case 4:r=new d.ActionProxy,r.post(h.default.USER_CHANGE_PASSWORD,t),m("Update password successfully.");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return r.a.createElement(K.a,{className:"common-child-center"},p&&r.a.createElement(_.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),a&&r.a.createElement(_.a,{closable:!0,message:"Fail",description:a,type:"error",showIcon:!0}),r.a.createElement(H.a,{className:"login-form",onFinish:e=>{b(e)}},r.a.createElement(H.a.Item,{label:"Oringinal Password",name:"password",rules:[{required:!0,message:"Please input your oringinal password!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,{label:"New Password",name:"newPassword",rules:[{required:!0,message:"Please input your new password!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,{label:"New Password",name:"_newPassword",rules:[{required:!0,message:"Please input your new password again!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{type:"primary",htmlType:"submit"},"Submit"))))};const ni=C.a.SubMenu,ri={currentPage:"website-settings"},si=r.a.createContext();function oi(){const e=Object(p.useReducerAsync)(Wl,ri,Ql),t=Object(u.a)(e,2),a=t[0],n=t[1],s=a.currentPage;return r.a.createElement(si.Provider,{value:{dispacher:n}},r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(C.a,{style:{width:256},defaultSelectedKeys:["website-settings"],defaultOpenKeys:["console-settings"],mode:"inline"},r.a.createElement(ni,{key:"console-settings",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,"Console Settings"))},r.a.createElement(C.a.Item,{key:"website-settings",onClick:()=>{n({type:"setState",data:{currentPage:"website-settings"}})}},"Website Settings")),r.a.createElement(ni,{key:"engine-settings",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,"Engine Settings"))},r.a.createElement(C.a.Item,{onClick:()=>{n({type:"setState",data:{currentPage:"engines"}})},key:"engines"},"Engines")))),r.a.createElement("div",{className:"app-admin-main"},"website-settings"===s&&r.a.createElement($l,null),"engines"===s&&r.a.createElement(ti,null))))}function ci(e){const t=Object(n.useState)(""),a=Object(u.a)(t,2),s=a[0],o=a[1],c=Object(n.useState)(""),l=Object(u.a)(c,2),i=l[0],p=l[1],m=Object(n.useState)(""),d=Object(u.a)(m,2),h=d[0],b=d[1],f=Object(n.useState)(!1),E=Object(u.a)(f,2),g=E[0],y=E[1],v=H.a.useForm(),w=Object(u.a)(v,1)[0],k={labelCol:{span:6},wrapperCol:{span:14}};return{ui:({formItems:t,title:a,submit:n})=>r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},k),r.a.createElement(K.a,{title:a,style:{width:(null===e||void 0===e?void 0:e.width)||"50%"}},r.a.createElement(H.a,{form:w},s&&r.a.createElement(le,{message:r.a.createElement(B.a,{id:s})}),i&&r.a.createElement(le,{title:r.a.createElement(B.a,{id:"congratulation"}),type:"success",message:r.a.createElement(B.a,{id:i})}),t),r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{type:"primary",loading:g,onClick:n},r.a.createElement(B.a,{id:"apply"}))))),form:w,setError:o,setLoading:y,getParams:()=>w.getFieldsValue(),setCurrent:b,current:h,setSuccess:p}}function li(e){const t=ci(),a=t.ui,s=t.setError,o=t.setSuccess,c=Object(n.useState)(void 0),p=Object(u.a)(c,2),m=p[0],b=p[1],f=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=3;break}return s("set_default_backend_error"),e.abrupt("return");case 3:return t=new d.ActionProxy,e.next=6,t.post(h.default.USER_EXTRA,{backend:m});case 6:if(200!==(a=e.sent).status){e.next=11;break}return w.updateUser(a),o("done"),e.abrupt("return");case 11:s(a.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(B.a,{id:"set_default_backend"}),submit:f,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"curent_value"})},w.extraOption().backend||"Not Set Yet"),r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"choose"})},r.a.createElement(He,{useEngine:e=>{b(e)}})))})}function ii(e){const t=ci(),a=t.ui,n=t.setError,s=t.setSuccess,o=Gr({initialValue:w.extraOption().apply_timeout||10}),c=o.ui,u=o.value,p=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=3;break}return n("set_default_backend_error"),e.abrupt("return");case 3:return t=new d.ActionProxy,e.next=6,t.post(h.default.USER_EXTRA,{apply_timeout:u});case 6:if(200!==(a=e.sent).status){e.next=11;break}return w.updateUser(a),s("done"),e.abrupt("return");case 11:n(a.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(B.a,{id:"set_apply_timeout"}),submit:p,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"curent_value"})},u),r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"choose"})},c()))})}function ui(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=a[0],o=a[1],c=new d.ActionProxy,p=ei({submit:function(){var e=Object(i.a)(l.a.mark((function e({params:t,setLoading:a}){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a(!0),g(void 0),n=0;n<t.length;n++);o(Zt.getJobName()),a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{}}),m=p.ui,b=p.setData,f=p.setSchema,E=p.setEditorMode,g=p.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(h.default.TEMA_LIST,{});case 2:200===(t=e.sent).status&&(f(t.content.schema),b(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[s]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(Zr.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{E(e)}}),r.a.createElement(I.a,{type:"horizontal"}),m())}function pi(){const e=ci(),t=e.ui,a=e.setError,n=e.setSuccess,s=e.form,o=function(){var e=Object(i.a)(l.a.mark((function e(){var t,r,o,c,i,u,p,m,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.getFieldsValue(),r=t.host,o=t.port,c=t.db,i=t.user,u=t.password,(p=t.name)||(p=c),o||(o="3306"),m=new d.ActionProxy,e.next=6,m.post(h.default.DS_ADD,{host:r,port:o,db:c,user:i,password:u,name:p,format:"jdbc",jType:"mysql"});case 6:200===(b=e.sent).status?n("Create Connect Success"):a(b.content);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t({title:r.a.createElement(B.a,{id:"connect_mysql"}),submit:o,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"host",required:!0,label:r.a.createElement(B.a,{id:"host"})},r.a.createElement(Q.a,{placeholder:"127.0.0.1"})),r.a.createElement(H.a.Item,{name:"port",initialValue:"3306",label:r.a.createElement(B.a,{id:"port"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"db",required:!0,label:r.a.createElement(B.a,{id:"db"})},r.a.createElement(Q.a,null)),r.a.createElement(I.a,null),r.a.createElement(H.a.Item,{name:"user",required:!0,label:r.a.createElement(B.a,{id:"user"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"password",required:!0,label:r.a.createElement(B.a,{id:"password"})},r.a.createElement(Q.a,null)),r.a.createElement(I.a,null),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(B.a,{id:"alias"})},r.a.createElement(Q.a,null)))})}function mi(){const e=Object(n.useState)(void 0),t=Object(u.a)(e,2),a=t[0],s=t[1],o=new d.ActionProxy,c=ei({submit:function(){var e=Object(i.a)(l.a.mark((function e({params:t,setLoading:a}){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a(!0),E(void 0),n=0;n<t.length;n++);s(Zt.getJobName()),a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.DS_REMOVE,{id:t.id});case 2:200===(a=e.sent).status&&(b(a.content.schema),m(a.content.data));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{}}),p=c.ui,m=c.setData,b=c.setSchema,f=c.setEditorMode,E=c.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.get(h.default.DS_LIST,{});case 2:200===(t=e.sent).status&&(b(t.content.schema),m(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[a]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(Zr.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{f(e)}}),r.a.createElement(I.a,{type:"horizontal"}),p())}const di=Object(y.a)(Object(y.a)({},za),{},{[eo.APPLY]:Rc}),hi=Object(y.a)(Object(y.a)({},Ya),{},{[eo.APPLY]:Fc});function bi(e,t){return hi[t.type](e,t.data)}const fi=e=>{const t=Object(n.useState)(null),a=Object(u.a)(t,2),s=a[0],o=a[1],c=Object(n.useState)(null),p=Object(u.a)(c,2),m=p[0],b=p[1];return Object(n.useEffect)(()=>{const t=setInterval(function(){var t=Object(i.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new d.ActionProxy,t.next=3,a.get(h.default.CLOUD_ENGINE_STATUS,{owner:e.name});case 3:200===(n=t.sent).status&&(r=n.content,o(r));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),3e3);return b(t),()=>{clearInterval(m)}},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(I.a,{orientation:"left"},r.a.createElement(B.a,{id:"a_4"})),r.a.createElement(Es.b,{bordered:!0,dataSource:null===s||void 0===s?void 0:s.message,renderItem:e=>r.a.createElement(Es.b.Item,null,e)}))},Ei={loadingPage:!1,engineName:""},gi=r.a.createContext(null),yi=e=>{const t=Object(p.useReducerAsync)(bi,Ei,di),a=Object(u.a)(t,2),s=a[0],o=a[1],c=s.loadingPage,m=s.engineName,b=ci({width:"70%"}),f=b.ui,E=b.setError,g=b.getParams,y=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,a=g(),e.next=4,t.post(h.default.CLOUD_CREATE_ENGINE,a);case 4:if(200===(n=e.sent).status)E(""),o({type:eo.setState,data:{loadingPage:!0,engineName:a.owner}});else try{E((null===(r=JSON.parse(n.content))||void 0===r?void 0:r.message)||"Unknown Error")}catch(s){E(s.description)}case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{},[]),r.a.createElement(gi.Provider,{value:{state:s,dispacher:o}},r.a.createElement("div",null,c?r.a.createElement(fi,{name:m}):f({title:r.a.createElement(B.a,{id:"input_message"}),submit:y,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(Rn.a,{status:"warning",title:r.a.createElement(B.a,{id:"a_1"}),extra:r.a.createElement(B.a,{id:"a_2"})}),r.a.createElement(I.a,{orientation:"left"},r.a.createElement(B.a,{id:"aliyun_related"})),r.a.createElement(H.a.Item,{name:"owner",label:r.a.createElement(B.a,{id:"engine_name"}),help:"\u5fc5\u586b"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"OSSBucket",label:r.a.createElement(B.a,{id:"OSSBucket"}),help:"\u9ed8\u8ba4bucket\u540d\u79f0,\u6bd4\u5982\uff1amlsql-release-repo"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"AccessKeyID",label:r.a.createElement(B.a,{id:"access_key_id"}),help:"\u5fc5\u586b"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"AccessKeySecret",label:r.a.createElement(B.a,{id:"access_key_secret"}),help:"\u5fc5\u586b"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"OSSAccessKeyID",label:r.a.createElement(B.a,{id:"oss_access_key_id"}),help:"\u9ed8\u8ba4\u540c AccessKeySecret"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"OSSAccessKeySecret",label:r.a.createElement(B.a,{id:"oss_access_key_secret"}),help:"\u9ed8\u8ba4\u540c AccessKeySecret"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"ReginID",label:r.a.createElement(B.a,{id:"regin_id"}),initialValue:"cn-hangzhou"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{valuePropName:"checked",initialValue:!0,name:"EndpointPublicAccess",label:r.a.createElement(B.a,{id:"endpoint_public_access"})},r.a.createElement(Zr.a,null)),r.a.createElement(I.a,{orientation:"left"},r.a.createElement(B.a,{id:"cluster_related"})),r.a.createElement(H.a.Item,{name:"DriverCoreNum",label:r.a.createElement(B.a,{id:"driver_core_num"}),initialValue:1},r.a.createElement(Vr.a,{min:0,max:8,marks:{1:"1c",2:"2c",4:"4c",8:"8c"}})),r.a.createElement(H.a.Item,{name:"DriverMemory",label:r.a.createElement(B.a,{id:"driver_memory"}),initialValue:2},r.a.createElement(Vr.a,{min:0,max:8,marks:{2:"2g",4:"4g",8:"8g"}})),r.a.createElement(H.a.Item,{name:"ExecutorCoreNum",label:r.a.createElement(B.a,{id:"executor_core_num"}),initialValue:1},r.a.createElement(Vr.a,{min:0,max:8,marks:{1:"1c",2:"2c",4:"4c",8:"8c"}})),r.a.createElement(H.a.Item,{name:"ExecutorMemory",label:r.a.createElement(B.a,{id:"executor_memory"}),initialValue:2},r.a.createElement(Vr.a,{min:0,max:8,marks:{2:"2g",4:"4g",8:"8g"}})),r.a.createElement(H.a.Item,{name:"ExecutorNum",label:r.a.createElement(B.a,{id:"executor_num"}),initialValue:1},r.a.createElement(Vr.a,{min:0,max:8,marks:{1:"1",4:"4",8:"8"}})),r.a.createElement(H.a.Item,{name:"EngineVersion",label:r.a.createElement(B.a,{id:"engine_version"}),initialValue:"2.1.0"},r.a.createElement(Pe.a,null,r.a.createElement(Pe.a.Option,{value:"2.1.0"},"2.1.0"))),r.a.createElement(H.a.Item,{name:"JarEngineVersion",label:r.a.createElement(B.a,{id:"jar_engine_version"}),initialValue:"2.1.0-SNAPSHOT"},r.a.createElement(Pe.a,null,r.a.createElement(Pe.a.Option,{value:"2.1.0-SNAPSHOT"},"2.1.0-SNAPSHOT"))))})))},vi=e=>{const t=Object(n.useState)(""),a=Object(u.a)(t,2),s=a[0],o=a[1],c=Object(n.useState)([]),p=Object(u.a)(c,2),m=p[0],b=p[1],f=Object(n.useState)(""),E=Object(u.a)(f,2),g=E[0],y=E[1];Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.CLOUD_ENGINE_LIST,{});case 3:200===(a=e.sent).status&&(n=a.content,b(n.data));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const v=ci(),w=v.ui,k=v.setError,x=v.setSuccess,S=(v.getParams,v.setLoading),O=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k(""),y(""),S(!0),s){e.next=6;break}return k("a_5"),e.abrupt("return");case 6:return t=new d.ActionProxy,e.next=9,t.post(h.default.CLOUD_DELETE_ENGINE,{owner:s});case 9:200===(a=e.sent).status?x("delete_success"):(k("delete_fail"),y(a.content)),S(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return w({title:r.a.createElement(B.a,{id:"delete_cloud_engine"}),submit:O,formItems:r.a.createElement(r.a.Fragment,null,g&&r.a.createElement(Rn.a,{status:"warning",extra:g}),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(B.a,{id:"a_6"})},r.a.createElement(Pe.a,{onChange:j},m.map(e=>r.a.createElement(Pe.a.Option,{value:e,key:e},e)))))})},wi=e=>{const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)([]),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)([]),b=Object(u.a)(m,2),f=b[0],E=b[1],g={labelCol:{span:6},wrapperCol:{span:14}};Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.CLOUD_ENGINE_LIST,{});case 3:200===(a=e.sent).status&&(n=a.content,p(n.data));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]);const y=function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.get(h.default.CLOUD_ENGINE_STATUS,{owner:t});case 3:200===(n=e.sent).status&&(r=n.content,E(r.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},g),r.a.createElement(K.a,{title:r.a.createElement(B.a,{id:"cloud_engine_log"}),style:{width:"70%"}},r.a.createElement(H.a,{form:a},r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(B.a,{id:"a_3"})},r.a.createElement(Pe.a,{onChange:y},c.map(e=>r.a.createElement(Pe.a.Option,{value:e,key:e},e)))),r.a.createElement(I.a,{orientation:"left"},r.a.createElement(B.a,{id:"a_6"})),r.a.createElement(Es.b,{bordered:!0,dataSource:f,renderItem:e=>r.a.createElement(Es.b.Item,null,e)})))))},ki=e=>{const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)(""),o=Object(u.a)(s,2),c=o[0],p=o[1],m=Object(n.useState)(""),b=Object(u.a)(m,2),f=b[0],E=b[1],g=Object(n.useState)(!1),y=Object(u.a)(g,2),v=y[0];y[1];Object(n.useEffect)(()=>{},[]);const w=function(){var e=Object(i.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(""),E(""),t=new d.ActionProxy,n=a.getFieldsValue(),e.next=6,t.post(h.default.ENGINE_REGISTER,n);case 6:200===(r=e.sent).status?E("success"):p(r.content);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},{labelCol:{span:6},wrapperCol:{span:14}}),r.a.createElement(K.a,{title:r.a.createElement(B.a,{id:"a_8"}),style:{width:"70%"}},r.a.createElement(H.a,{form:a},c&&r.a.createElement(le,{message:r.a.createElement(B.a,{id:c})}),f&&r.a.createElement(le,{title:r.a.createElement(B.a,{id:"congratulation"}),type:"success",message:r.a.createElement(B.a,{id:f})}),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(B.a,{id:"name"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"url",label:r.a.createElement(B.a,{id:"url"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"home",label:r.a.createElement(B.a,{id:"home"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"consoleUrl",label:r.a.createElement(B.a,{id:"consoleUrl"}),initialValue:"http://analysis.mlsql.tech"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"fileServerUrl",label:r.a.createElement(B.a,{id:"fileServerUrl"}),initialValue:"http://analysis.mlsql.tech"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"authServerUrl",label:r.a.createElement(B.a,{id:"authServerUrl"}),initialValue:"http://analysis.mlsql.tech"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{valuePropName:"checked",initialValue:!0,name:"skipAuth",label:r.a.createElement(B.a,{id:"skipAuth"})},r.a.createElement(Zr.a,null)),r.a.createElement(H.a.Item,{name:"extraOpts",label:r.a.createElement(B.a,{id:"extraOpts"}),initialValue:"{}"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"accessToken",label:r.a.createElement(B.a,{id:"accessToken"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{type:"primary",loading:v,onClick:w},r.a.createElement(B.a,{id:"apply"})))))))},xi=C.a.SubMenu;function Si(){const e=Object(n.useState)("default-backend"),t=Object(u.a)(e,2),a=t[0],s=t[1];return r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(C.a,{style:{width:256},defaultSelectedKeys:["default-backend"],defaultOpenKeys:["analysis-workshop"],mode:"inline"},r.a.createElement(xi,{key:"analysis-workshop",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"analysis_workshop"})))},r.a.createElement(C.a.Item,{key:"default-backend",onClick:()=>{s("default-backend")}},r.a.createElement(B.a,{id:"set_engine"})),r.a.createElement(C.a.Item,{key:"set-timeout",onClick:()=>{s("set-timeout")}},r.a.createElement(B.a,{id:"set_timeout"}))),r.a.createElement(xi,{key:"user",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"user_settings"})))},r.a.createElement(C.a.Item,{key:"change-admin-password",onClick:()=>{s("change-admin-password")}},r.a.createElement(B.a,{id:"change_password"}))),r.a.createElement(xi,{key:"team",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"team"})))},r.a.createElement(C.a.Item,{key:"team_manager",onClick:()=>{s("team_manager")}},r.a.createElement(B.a,{id:"team_manager"}))),r.a.createElement(xi,{key:"datasource",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"datasource"})))},r.a.createElement(C.a.Item,{key:"mysql",onClick:()=>{s("mysql")}},r.a.createElement(B.a,{id:"connect_mysql"})),r.a.createElement(C.a.Item,{key:"list_mysql",onClick:()=>{s("list_mysql")}},r.a.createElement(B.a,{id:"list_mysql"}))),r.a.createElement(xi,{key:"aliyun_cloud_engine",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"aliyun_cloud_engine"})))},r.a.createElement(C.a.Item,{key:"create_cloud_engine",onClick:()=>{s("create_cloud_engine")}},r.a.createElement(B.a,{id:"create_cloud_engine"})),r.a.createElement(C.a.Item,{key:"delete_cloud_engine",onClick:()=>{s("delete_cloud_engine")}},r.a.createElement(B.a,{id:"delete_cloud_engine"})),r.a.createElement(C.a.Item,{key:"cloud_engine_log",onClick:()=>{s("cloud_engine_log")}},r.a.createElement(B.a,{id:"cloud_engine_log"}))),r.a.createElement(xi,{key:"a_7",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"a_7"})))},r.a.createElement(C.a.Item,{key:"a_8",onClick:()=>{s("a_8")}},r.a.createElement(B.a,{id:"a_8"}))))),r.a.createElement("div",{className:"app-admin-main"},"default-backend"===a&&r.a.createElement(li,null),"set-timeout"===a&&r.a.createElement(ii,null),"change-admin-password"===a&&r.a.createElement(ai,null),"team_manager"===a&&r.a.createElement(ui,null),"mysql"===a&&r.a.createElement(pi,null),"list_mysql"===a&&r.a.createElement(mi,null),"create_cloud_engine"===a&&r.a.createElement(yi,null),"delete_cloud_engine"===a&&r.a.createElement(vi,null),"cloud_engine_log"===a&&r.a.createElement(wi,null),"a_8"===a&&r.a.createElement(ki,null)))}const Oi=e=>r.a.createElement(r.a.Fragment,null,r.a.createElement("iframe",{sandbox:"allow-scripts",style:{width:"100%",height:"600px"},src:"http://docs.mlsql.tech/mlsql-console/",frameBorder:"0",scrolling:"yes"})),ji=e=>{const t=Object(n.useState)(""),a=Object(u.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)(()=>{(function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.extraOption().backend,a=new d.ActionProxy,e.next=4,a.get(h.default.ENGINE_LIST,{});case 4:n=e.sent,t&&(r=n.content.data,s=r.filter(e=>e.name===t)[0].url,o(s.split(":")[0]+":"+s.split(":")[1]+":4040"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),r.a.createElement(r.a.Fragment,null,s&&r.a.createElement("iframe",{sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",style:{width:"100%",height:"600px"},src:s,frameBorder:"0",scrolling:"yes"}))};var Ti=a(1162);function Ni(){const e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],s=t[1],o=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.post(h.default.INDEXER_LIST,{});case 3:200===(a=e.sent).status&&(n=a.content,s(n));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,e.next=3,a.post(h.default.INDEXER_REMOVE,{name:t});case 3:o();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{o()},[]),r.a.createElement("div",{className:"common-margin common-child-center"},r.a.createElement(Ue.a,{dataSource:a},r.a.createElement(Ue.a.Column,{title:"\u7d22\u5f15\u540d\u79f0",dataIndex:"name",key:"name"}),r.a.createElement(Ue.a.Column,{title:"\u7d22\u5f15\u6a21\u5f0f",dataIndex:"syncInterval",key:"syncInterval",render:(e,t,a)=>-1===e?r.a.createElement(r.a.Fragment,null,"\u6d41\u5f0f"):e>0?r.a.createElement(r.a.Fragment,null,"\u6279\u5f0f"):0===e?r.a.createElement(r.a.Fragment,null,"\u4e00\u6b21\u6027"):r.a.createElement(r.a.Fragment,null)}),r.a.createElement(Ue.a.Column,{title:"\u4e0a\u4e00\u6b21\u7d22\u5f15\u65f6\u95f4",dataIndex:"lastExecuteTime",key:"lastExecuteTime",render:(e,t,a)=>{let n=((new Date).getTime()-e)/1e3,s="("+n+"\u79d2)";n>60&&(s="("+Math.round(n/60)+"\u5206\u524d)"),n>3600&&(s="("+Math.round(n/3600)+"\u65f6\u524d)"),n>86400&&(s="("+Math.round(n/86400)+"\u5929\u524d)");const o=new Date(e);return r.a.createElement(r.a.Fragment,null,yt()(o).format("YYYY-MM-DD hh:mm:ss")+s)}}),r.a.createElement(Ue.a.Column,{title:"\u4e0a\u4e00\u6b21\u7d22\u5f15\u72b6\u6001",dataIndex:"lastStatus",key:"lastStatus",render:(e,t,a)=>0===e?r.a.createElement(r.a.Fragment,null,"\u7d22\u5f15\u5b8c\u6210"):1===e?r.a.createElement(r.a.Fragment,null,"\u7d22\u5f15\u5931\u8d25"):r.a.createElement(r.a.Fragment,null)}),r.a.createElement(Ue.a.Column,{title:"\u4e0a\u4e00\u6b21\u7d22\u5f15\u4fe1\u606f",width:"200",ellipsis:{showTitle:!0},dataIndex:"lastFailMsg",key:"lastFailMsg",render:(e,t,a)=>r.a.createElement(r.a.Fragment,null,e)}),r.a.createElement(Ue.a.Column,{title:"\u64cd\u4f5c",dataIndex:"operate",key:"operate",render:(e,t,a)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(Ti.a,{title:"\u786e\u8ba4\u8981\u5220\u9664\u8be5\u7d22\u5f15\u4e48\uff1f",okText:"Yes",cancelText:"No",onConfirm:()=>{c(t.name)}},r.a.createElement(W.a,null,"\u5220\u9664")))})))}const Ci=Da.a.DirectoryTree;function _i(){const e=H.a.useForm(),t=Object(u.a)(e,1)[0],a=Object(n.useState)(""),s=Object(u.a)(a,2),o=s[0],c=s[1],p=Object(n.useState)(""),m=Object(u.a)(p,2),b=m[0],f=m[1],E=Object(n.useState)(!1),g=Object(u.a)(E,2),y=g[0],v=(g[1],Object(n.useState)(!1)),w=Object(u.a)(v,2),k=w[0],x=w[1],S=Object(n.useState)([]),O=Object(u.a)(S,2),j=O[0],T=O[1],N=Object(n.useState)(null),C=Object(u.a)(N,2),_=C[0],I=C[1],P=Object(n.useState)(null),A=Object(u.a)(P,2),D=A[0],R=A[1],F=Object(n.useState)([]),L=Object(u.a)(F,2),M=L[0],q=L[1],V=Ur(),G=V.ui,U=V.form,J=V.setOpenTable,z=V.setError,Y=V.partitionNumValue,X=Object(n.useState)(!1),$=Object(u.a)(X,2),Z=$[0],ee=$[1],te=function(){var e=Object(i.a)(l.a.mark((function e(){var t,a,n,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.DS_MYSQL_DBS,{});case 3:return a=e.sent,n=a.content.data.map(e=>(e.key=e.name,e.title=e.name,e.isLeaf=!1,e.children=e.tables.map(t=>({id:"".concat(e.name,".").concat(t.name),key:"".concat(e.name,".").concat(t.name),title:t.name,isLeaf:!0,icon:r.a.createElement(Fa.a,null)})),e)),e.next=7,t.get(h.default.ENGINE_LIST,{});case 7:200==(s=e.sent).status&&(o=s.content.data,q(o)),T(n);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{te()},[]);const ae=function(){var e=Object(i.a)(l.a.mark((function e(){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f(""),c(""),a=new d.ActionProxy,"mysql"!==(n=t.getFieldsValue()).syncInterval||n.idCols){e.next=7;break}return c("idCols is required"),e.abrupt("return");case 7:return r=Object.assign(n,D),e.next=10,a.post(h.default.MYSQL_INDEXER_CREATE,r);case 10:200===(s=e.sent).status?f("success"):c(s.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",Object.assign({className:"common-margin common-child-center"},{labelCol:{span:6},wrapperCol:{span:14}}),r.a.createElement(K.a,{title:r.a.createElement(B.a,{id:"create_indexer"}),style:{width:"70%"}},r.a.createElement(H.a,{form:t},r.a.createElement($e.a,{title:r.a.createElement(B.a,{id:"mysql_parallel"}),visible:k,onCancel:()=>{U.resetFields(),x(!1)},onOk:()=>{const e=U.getFieldsValue(),t=e.partitionColumn,a=e.lowerBound,n=e.upperBound;!t||a&&(n||!Y)?(R({partitionColumn:t,lowerBound:a,upperBound:n,partitionNumValue:Y,dbName:(null===_||void 0===_?void 0:_.dbName)||"",tableName:(null===_||void 0===_?void 0:_.tableName)||""}),U.resetFields(),x(!1)):z("lowerBound/upperBound/partitionNumValue should not be empty.")},cancelText:"Cancel",okText:"Ok"},r.a.createElement(G,null)),o&&r.a.createElement(le,{message:r.a.createElement(B.a,{id:o})}),b&&r.a.createElement(le,{title:r.a.createElement(B.a,{id:"congratulation"}),type:"success",message:r.a.createElement(B.a,{id:b})}),r.a.createElement(H.a.Item,{name:"_name"},r.a.createElement(Ra.a,{tip:"Loading...",spinning:y},r.a.createElement(Ci,{height:700,treeData:j,expandAction:"click",onDoubleClick:(e,t)=>{if(!t.isLeaf)return;const a=t.key.split("."),n=Object(u.a)(a,2),r=n[0],s=n[1];I({dbName:r,tableName:s}),J(t.key),x(!0)},onRightClick:({event:e,node:t})=>{}}))),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(B.a,{id:"\u6570\u636e\u5e93\u8868"})},r.a.createElement("span",null,_?_.dbName+"."+_.tableName:"\u672a\u9009\u62e9")),r.a.createElement(H.a.Item,{name:"indexerType",label:r.a.createElement(B.a,{id:"\u7d22\u5f15\u7c7b\u578b"})},r.a.createElement(Pe.a,{onChange:(e,t)=>{"parquet"===e&&ee(!0),"mysql"===e&&ee(!1)}},r.a.createElement(Pe.a.Option,{value:"mysql"},"\u5b9e\u65f6"),r.a.createElement(Pe.a.Option,{value:"parquet"},"\u5b9a\u65f6"))),Z?r.a.createElement(H.a.Item,{name:"syncInterval",label:r.a.createElement(B.a,{id:"\u540c\u6b65\u5468\u671f(d/h/m)"})},r.a.createElement(Q.a,null)):r.a.createElement(r.a.Fragment,null),Z?r.a.createElement(r.a.Fragment,null):r.a.createElement(H.a.Item,{name:"idCols",label:r.a.createElement(B.a,{id:"\u6807\u8bc6\u552f\u4e00\u7ec4\u5408\u952e"})},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{name:"engineName",label:r.a.createElement(B.a,{id:"\u9009\u62e9\u6784\u5efa\u7d22\u5f15\u7684\u5f15\u64ce"})},r.a.createElement(Pe.a,null,M.map(e=>r.a.createElement(Pe.a.Option,{value:e.name},e.name)))),r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{type:"primary",loading:y,onClick:ae},r.a.createElement(B.a,{id:"apply"})))))))}const Ii=C.a.SubMenu;function Pi(){const e=Object(n.useState)("indexer_list"),t=Object(u.a)(e,2),a=t[0],s=t[1];return r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(C.a,{style:{width:256},defaultSelectedKeys:["indexer_list"],defaultOpenKeys:["mysql_indexer_manager"],mode:"inline"},r.a.createElement(Ii,{key:"mysql_indexer_manager",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"mysql_indexer_manager"})))},r.a.createElement(C.a.Item,{key:"indexer_list",onClick:()=>{s("indexer_list")}},r.a.createElement(B.a,{id:"indexer_list"})),r.a.createElement(C.a.Item,{key:"create_indexer",onClick:()=>{s("create_indexer")}},r.a.createElement(B.a,{id:"create_indexer"}))),r.a.createElement(Ii,{key:"other_indexer_manager",title:r.a.createElement("span",null,r.a.createElement(zl.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"other_indexer_manager"})))}))),r.a.createElement("div",{className:"app-admin-main"},"indexer_list"===a&&r.a.createElement(Ni,null),"create_indexer"===a&&r.a.createElement(_i,null)))}const Ai={currentPage:"login",logined:!1},Di=r.a.createContext();function Ri(e){const t=e.appInfo,a=Object(p.useReducerAsync)(N,Ai,T),s=Object(u.a)(a,2),o=s[0],c=s[1],l=o.currentPage,i=o.logined;return Object(n.useEffect)(()=>{c(m.a.buildEvent(j.CHECK_LOGINED,{}))},[]),r.a.createElement(Di.Provider,{value:{dispacher:c}},r.a.createElement("div",{className:"app-console"},r.a.createElement("div",{className:"app-console-header"},r.a.createElement(J,{appInfo:t,userLogined:i,isUserAdmin:w.isAdmin(),currentPage:l})),r.a.createElement("div",{className:"app-console-main"},"register"===l&&r.a.createElement(pe,null),"register"!==l&&!i&&r.a.createElement(he,null),"console"===l&&i&&r.a.createElement(Dn,null),"indexer_manager"===l&&i&&r.a.createElement(Pi,null),"workshop"===l&&i&&r.a.createElement(ql,null),"admin"===l&&i&&w.isAdmin()&&r.a.createElement(oi,null),"settings"===l&&i&&r.a.createElement(Si,null),"doc"===l&&r.a.createElement(Oi,null),"engine"===l&&i&&r.a.createElement(ji,null)),r.a.createElement("div",{className:"app-console-footer"},r.a.createElement("div",{style:{bottom:"100px",textAlign:"center",width:"100%"}},"MLSQL Licensed under the Apache License, Version 2.0. @",r.a.createElement("a",{className:"copyright",href:"http://www.miitbeian.gov.cn/"},"\u6d59ICP\u590718052520\u53f7"),r.a.createElement("div",null,"@",r.a.createElement("a",{target:"_blank",href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010802009683"},r.a.createElement("img",{src:""}),"\u6d59\u516c\u7f51\u5b89\u5907 33010802009683\u53f7"))))))}const Fi=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new d.ActionProxy,n=t.data,r=n.name,s=n.url,e.next=4,a.post(h.default.ENGINE_ADD,{name:r,url:s});case 4:if(200===(o=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{error:JSON.parse(o.content).msg}});case 7:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Li=Fi.handler,Mi=Fi.action,qi=m.a.buildHandler(function(){var e=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Vi=qi.handler,Bi=qi.action;class Gi{}Gi.registerAdmin="registerAdmin",Gi.addEngine="addEngine",Gi.skipAddEngine="skipAddEngine";const Ui={[Gi.registerAdmin]:Y,[Gi.addEngine]:Li,[Gi.skipAddEngine]:Vi};function Ji(e,t){switch(t.type){case Gi.registerAdmin:return X(e,t.data);case Gi.addEngine:return Mi(e,t.data);case Gi.skipAddEngine:return Bi(e,t.data);default:return e}}var Ki=a(1157);var Hi=function(){const e=Object(n.useContext)(bu).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout;return r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:t=>{e({type:Gi.registerAdmin,data:t})}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(Q.a.Password,null)),r.a.createElement(H.a.Item,s,r.a.createElement(W.a,{type:"primary",htmlType:"submit"},"Go")))};var Qi=function(){const e=Object(n.useContext)(bu).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout,o={required:!0,message:"required"};return r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:t=>{e({type:Gi.addEngine,data:t})}}),r.a.createElement(H.a.Item,{label:"Engine Name",name:"name",rules:[o]},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{label:"Engine Url",name:"url",rules:[o]},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,{label:"Access Token",name:"accessToken"},r.a.createElement(Q.a,null)),r.a.createElement(H.a.Item,s,r.a.createElement(W.a,{type:"primary",htmlType:"submit"},"Go"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{onClick:t=>{t.preventDefault(),e({type:Gi.skipAddEngine,data:{}})},htmlType:"submit"},"Skip")))};const Wi=m.a.buildHandler(e=>({data:e.data})),zi=Wi.handler,Yi=Wi.action,Xi=m.a.buildHandler(e=>({data:{appConfigured:!0}})),$i=Xi.handler,Zi=Xi.action,eu=m.a.buildHandler(e=>({data:{appConfigured:!0}})),tu=eu.handler,au=eu.action;class nu{}nu.GO_CONSOLE="goConsole",nu.GO_ADMIN="goAdmin",nu.appConfigured="appConfigured";const ru={[nu.GO_ADMIN]:$i,[nu.GO_CONSOLE]:tu,[nu.appConfigured]:zi};function su(e,t){switch(t.type){case nu.GO_ADMIN:return Zi(e,t.data);case nu.GO_CONSOLE:return au(e,t.data);case nu.appConfigured:return Yi(e,t.data);default:return e}}var ou=function(){const e=Object(n.useContext)(xu).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout;return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{message:"Congratuation!",description:"You have finished the setup of MLSQL Console.",type:"success"}),r.a.createElement(I.a,null),r.a.createElement(H.a,a,r.a.createElement(H.a.Item,s,r.a.createElement(W.a,{type:"primary",onClick:()=>{e({type:nu.GO_ADMIN,data:{}})}},"Go to Admin Page"),r.a.createElement(I.a,{type:"vertical"}),r.a.createElement(W.a,{onClick:()=>{e({type:nu.GO_CONSOLE,data:{}})}},"Go to Console Page"))))};function cu(){const e=Object(re.a)(["\n width:100%;\n display:flex;\n max-width: 800px;\n flex-direction: column;\n"]);return cu=function(){return e},e}function lu(){const e=Object(re.a)(["\n  width:100%;\n  margin-top:6px;\n"]);return lu=function(){return e},e}function iu(){const e=Object(re.a)(["\ndisplay: flex;\nflex-direction: column;\nwidth:100%;\njustify-content:center;\n align-items:  center;\n"]);return iu=function(){return e},e}const uu=$r.a.Step,pu=se.a.div(iu()),mu=se.a.div(lu()),du=se.a.div(cu()),hu={error:void 0,current:0},bu=r.a.createContext();var fu=function(){const e=Object(p.useReducerAsync)(Ji,hu,Ui),t=Object(u.a)(e,2),a=t[0],n=t[1],s=a.error,o=a.current;return r.a.createElement(bu.Provider,{value:{dispacher:n}},r.a.createElement(pu,null,r.a.createElement(mu,null,r.a.createElement(Ki.a,{title:"Setup MLSQL Console in 2 Steps"})),r.a.createElement(I.a,null),r.a.createElement(du,null,r.a.createElement($r.a,{current:o},r.a.createElement(uu,{title:"Admin User/Password",description:"Setup Admin accout"}),r.a.createElement(uu,{title:"Add Engines",description:"Add default MLSQL Engine"}),r.a.createElement(uu,{title:"Done",description:"Congratuation"})),r.a.createElement(I.a,null),s&&r.a.createElement(_.a,{message:"Message",description:s,type:"error",closable:!0}),0===o&&r.a.createElement(K.a,null,r.a.createElement(Hi,null)),1===o&&r.a.createElement(K.a,null,r.a.createElement(Qi,null)),2===o&&r.a.createElement(K.a,null,r.a.createElement(ou,null)))))},Eu=a(19),gu=a(1155);var yu={login:"\u767b\u5f55",register:"\u6ce8\u518c",console:"\u63a7\u5236\u53f0",analysis_workshop:"\u5206\u6790\u5de5\u574a",settings:"\u8bbe\u7f6e",admin:"\u7ba1\u7406\u5458",more:"\u66f4\u591a",apply:"\u5e94\u7528",set_default_backend:"\u8bbe\u7f6e\u9ed8\u8ba4Engine",set_default_backend_error:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u5f15\u64ce\u8fdb\u884c\u8bbe\u7f6e",set_engine:"\u8bbe\u7f6e\u5f15\u64ce",curent_value:"\u5f53\u524d\u503c",choose:"\u9009\u62e9",done:"\u5b8c\u6210",congratulation:"\u606d\u559c",set_timeout:"\u8d85\u65f6\u8bbe\u7f6e",set_apply_timeout:"\u8bbe\u7f6e\u3010\u5e94\u7528\u3011\u8d85\u65f6\uff08\u5355\u4f4d\u79d2\uff09",table_workshop:"\u6682\u5b58\u533a",delta_lake:"\u6570\u636e\u6e56",file_system:"\u6587\u4ef6\u7cfb\u7edf",project:"\u5b57\u6bb5",filter:"\u8fc7\u6ee4",join:"\u5173\u8054",window:"\u7a97\u53e3",dash:"\u53ef\u89c6\u5316",limit:"\u6761\u6570",agg:"\u805a\u5408",order:"\u6392\u5e8f",select_columns:"\u7b5b\u9009\u5b57\u6bb5",rename_columns:"\u91cd\u547d\u540d\u5b57\u6bb5",transform_columns:"\u8f6c\u6362\u5b57\u6bb5",cast_columns_type:"\u4fee\u6539\u5b57\u6bb5\u7c7b\u578b",hive:"\u6570\u4ed3",operate_panel:"\u64cd\u4f5c\u533a",data_panel:"\u6570\u636e\u533a",user_settings:"\u7528\u6237\u8bbe\u7f6e",change_password:"\u4fee\u6539\u5bc6\u7801",team:"\u56e2\u961f",team_manager:"\u56e2\u961f\u7ba1\u7406",datasource:"\u6570\u636e\u6e90",analysis_range:"\u8bf7\u9009\u62e9\u8868\u5206\u6790\u533a\u95f4",table_start:"\u9009\u62e9\u5f00\u59cb\u533a\u95f4[\u5305\u542b]",table_end:"\u9009\u62e9\u7ed3\u675f\u533a\u95f4[\u5305\u542b]",table_random:"\u9009\u62e9\u4efb\u610f\u503c",or:"\u6216\u8005",no_partition_msg:"\u8be5\u8868\u6ca1\u6709\u5206\u533a\u4fe1\u606f\u3002\u8bf7\u76f4\u63a5\u70b9\u51fb\u3010\u786e\u8ba4\u3011",ds_mysql:"MySQL\u7ba1\u7406",host:"\u4e3b\u673a\u540d",port:"\u7aef\u53e3",db:"\u6570\u636e\u5e93\u540d",user:"\u7528\u6237\u540d",password:"\u5bc6\u7801",alias:"\u522b\u540d",connect_mysql:"\u8fde\u63a5 MySQL",list_mysql:"MySQL\u5217\u8868",mysql:"MySQL",partitionColumn:"\u5206\u533a\u5217",lowerBound:"\u6700\u4f4e\u503c",upperBound:"\u6700\u5927\u503c",numPartitions:"\u5206\u533a\u6570",mysql_parallel:"MySQL\u6253\u5f00\u5e76\u884c\u5ea6\u8bbe\u7f6e",no_mysql_parallel:"\u8be5\u8868\u6ca1\u6709\u6570\u5b57\u7c7b\u578b\u7684\u5217\uff0c\u65e0\u6cd5\u8bbe\u7f6e\u5e76\u884c\u5ea6\u3002\u8bf7\u76f4\u63a5\u70b9\u51fb\u3010\u786e\u5b9a\u3011",add:"\u6dfb\u52a0",as:"\u4e3a",choose_json_field:"\u9009\u62e9Json\u5b57\u6bb5",json_fields:"Json\u5b57\u6bb5\u5c55\u5f00",union:"\u5408\u5e76",union_table:"\u5f85\u5408\u5e76\u7684\u8868",pivot:"\u900f\u89c6\u8868",column_left:"\u884c\u5217",column_header:"\u8868\u5934\u5217",column_sum:"\u7edf\u8ba1\u5217",drag_column:"\u62d6\u62fd\u5217\u5230\u8fd9\u91cc",drop_column:"\u5728\u8fd9\u91cc\u91ca\u653e",plugin:"\u63d2\u4ef6",input_message:"\u586b\u5199\u4fe1\u606f",engine_name:"\u5f15\u64ce\u540d\u79f0",access_key_id:"AccessKeyID",access_key_secret:"AccessKeySecret",oss_access_key_id:"OSS AccessKeyID",oss_access_key_secret:"OSS AccessKeySecret",regin_id:"\u963f\u91cc\u4e91\u533a",endpoint_public_access:"\u662f\u5426\u6709\u516c\u7f51IP",k8s_address:"\u963f\u91cc\u4e91ASK\u5730\u5740",driver_core_num:"\u5f15\u64ceDriver CPU\u6570",driver_memory:"\u5f15\u64ceDriver \u5185\u5b58",executor_core_num:"\u5f15\u64ce\u5355Executor CPU\u6570",executor_memory:"\u5f15\u64ce\u5355Executor \u5185\u5b58",executor_num:"\u5f15\u64ce\u5355Executor\u6570\u76ee",engine_version:"\u5f15\u64ce\u7248\u672c",jar_engine_version:"\u5f15\u64ceJar\u5305\u7248\u672c","Name is required":"\u5f15\u64ce\u540d\u79f0\u5fc5\u987b\u586b\u5199","AccessKeyID/AccessKeySecret is required":"AccessKeyID/AccessKeySecret\u5fc5\u987b\u586b\u5199","OSSBucket is required":"OSSBucket \u5b57\u6bb5\u5fc5\u987b\u586b\u5199",delete_cloud_engine:"\u5220\u9664\u4e91\u5f15\u64ce",create_cloud_engine:"\u521b\u5efa\u4e91\u5f15\u64ce",aliyun_cloud_engine:"\u5728\u963f\u91cc\u4e91\u521b\u5efa\u5f15\u64ce",cloud_engine_name:"\u4e91\u5f15\u64ce\u540d\u79f0",delete_fail:"\u5220\u9664\u5931\u8d25",delete_success:"\u5220\u9664\u6210\u529f",aliyun_related:"\u963f\u91cc\u4e91\u76f8\u5173",cluster_related:"\u96c6\u7fa4\u89c4\u6a21\u76f8\u5173",a_1:"\u8be5\u529f\u80fd\u4e3a\u6d4b\u8bd5\u7248",a_2:"\u4f7f\u7528\u8be5\u529f\u80fd\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u5148\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1\u5b8c\u5168\u638c\u63a7\u6743\u9650\u7684\u4e34\u65f6Token\u4ee5\u53ca\u79d8\u94a5\uff0c\n    \u7cfb\u7edf\u4f1a\u81ea\u52a8\u5728\u4f60\u7684\u8d26\u53f7\u4e0b\u521b\u5efa\u4e00\u5957MLSQL Engine\u5b9e\u4f8b\u3002\n    \u8be5\u5b9e\u4f8b\u4f9d\u6258\u963f\u91cc\u4e91 ASK\u670d\u52a1\u3002\u7528\u6237\u53ef\u4ee5\u5728\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1\u63a7\u5236\u53f0\u67e5\u770b\u5230\u7cfb\u7edf\u81ea\u52a8\u521b\u5efa\u7684K8s\u96c6\u7fa4\u4ee5\u53ca\u4e4b\u4e0a\u7684MLSQL Engine\u5b9e\u4f8b\u3002\n    \u521b\u5efa\u5b8c\u5b8c\u6210\u540e\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5b89\u5168\uff0c\u7528\u6237\u53ef\u4ee5\u5220\u9664\u5bf9\u5e94\u7684\u4e34\u65f6Token\u548c\u79d8\u94a5\u3002\u7528\u6237\u53ef\u4ee5\u624b\u52a8\u5728\u963f\u91cc\u4e91\u4e0a\u5220\u9664ASK\u4ee5\u53caMLSQL Engine\u5b9e\u4f8b\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6211\u4eec\u7684\u7ba1\u7406\u670d\u52a1\u6765\u5220\u9664\u3002",cloud_engine_log:"\u67e5\u770b\u7cfb\u7edf\u65e5\u5fd7",a_3:"\u9009\u62e9\u4efb\u52a1\u540d\u79f0",a_4:"\u65e5\u5fd7\u4fe1\u606f(\u81ea\u52a8\u5237\u65b0\u4e2d\uff0c\u7a0d\u5019)",a_5:"\u8bf7\u9009\u62e9\u5f15\u64ce\u540d\u79f0",a_6:"\u65e5\u5fd7\u4fe1\u606f",a_7:"\u5f15\u64ce\u5217\u8868",a_8:"\u65b0\u6ce8\u518c",indexer_manager:"\u7d22\u5f15\u7ba1\u7406",indexer_list:"\u7d22\u5f15\u5217\u8868",create_indexer:"\u521b\u5efa\u7d22\u5f15",mysql_indexer_manager:"MySQL\u6570\u636e\u5e93\u7d22\u5f15\u7ba1\u7406",other_indexer_manager:"\u5176\u4ed6\u6570\u636e\u6e90\u7d22\u5f15\u7ba1\u7406"};var vu=a(551),wu=a.n(vu);const ku={appConfigured:!1,loading:!0,lang:"zh",enableConsole:!1},xu=r.a.createContext();var Su=function(){const e=Object(p.useReducerAsync)(su,ku,ru),t=Object(u.a)(e,2),a=t[0],s=t[1],o=a.appConfigured,c=a.loading,m=a.lang,b=a.enableConsole;function f(){return(f=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new d.ActionProxy,e.next=3,t.get(h.default.APP_INFO,{});case 3:200===(a=e.sent).status&&s({type:nu.appConfigured,data:{appConfigured:a.content.configured,enableConsole:a.content.console||!1,loading:!1}});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)(()=>{!function(){f.apply(this,arguments)}()},[]),r.a.createElement(gu.a,{locale:m,messages:yu},r.a.createElement(Eu.b,{locale:wu.a},r.a.createElement(xu.Provider,{value:{dispacher:s}},c&&r.a.createElement(On,null),!c&&!o&&r.a.createElement(fu,null),!c&&o&&r.a.createElement(Ri,{appInfo:{enableConsole:b}}))))};o.a.render(r.a.createElement(Su,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},12:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return n}));class n{}n.RUN="/api_v1/run/script",n.USER_NAME="/api_v1/user/userName",n.JOB_LIST="/api_v1/job/list",n.JOB_DETAIL="/api_v1/job",n.JOB_KILL="/api_v1/job/kill",n.SAVE_SCRIPT_FILE="/api_v1/script_file",n.ANALYSIS_TABLES="/api_v1/analysis/tables",n.ANALYSIS_TABLE_INFO="/api_v1/analysis/table/get",n.ANALYSIS_SAVE="/api_v1/analysis/tables/save",n.ANALYSIS_TABLE_DELETE="/api_v1/analysis/table/delete",n.APP_INFO="/api_v1/app",n.APP_SAVE="/api_v1/app/save",n.REGISTER="/api_v1/user/register",n.LOGIN="/api_v1/user/login",n.LOGOUT="/api_v1/user/logout",n.ENGINE_ADD="/api_v1/engine/add",n.ENGINE_REGISTER="/api_v1/engine/register",n.ENGINE_LIST="/api_v1/engine/list",n.ENGINE_REMOVE="/api_v1/engine/remove",n.SCRIPT_FILE_LIST="/api_v1/script_file",n.SCRIPT_FILE_GET="/api_v1/script_file/get",n.SCRIPT_FILE_REMOVE="/api_v1/script_file/remove",n.PLUGIN_LIST="/api_v1/plugin/list",n.PLUGIN_GET="/api_v1/plugin/get",n.ANALYSIS_PLUGIN_LIST="/api_v1/script_file/plugins",n.ANALYSIS_PLUGIN_GET="/api_v1/script_file/plugin/get",n.ANALYSIS_PLUGIN_PUBLISH="/api_v1/script_file/plugin/publish",n.SCRIPT_SHARE_PUBLIC="/api_v1/script_file/share",n.USER_EXTRA="/api_v1/user/extra/update",n.USER_CHANGE_PASSWORD="/api_v1/changepassword",n.APPLY_GET="/api_v1/analysis/apply",n.TEMA_LIST="/api_v1/team",n.DS_ADD="/api_v1/ds/add",n.DS_LIST="/api_v1/ds/list",n.DS_REMOVE="/api_v1/ds/remove",n.DS_MYSQL_DBS="/api_v1/ds/mysql/dbs",n.DS_MYSQL_CONNECT="/api_v1/ds/mysql/connect/get",n.DS_MYSQL_COLUMN_INFO="/api_v1/ds/mysql/column",n.CLOUD_CREATE_ENGINE="/api_v1/proxy/api/create_engine",n.CLOUD_DELETE_ENGINE="/api_v1/proxy/api/delete_engine",n.CLOUD_ENGINE_STATUS="/api_v1/proxy/api/status",n.CLOUD_ENGINE_LIST="/api_v1/proxy/api/list",n.INDEXER_LIST="/api_v1/indexer",n.MYSQL_INDEXER_CREATE="/api_v1/indexer/mysql/build",n.INDEXER_REMOVE="/api_v1/indexer/remove"},13:function(e,t,a){"use strict";var n=a(3),r=a.n(n),s=a(9),o=a(7);t.a=class{static buildHandler(e){return{handler:({dispatch:t,getState:a,signal:n})=>{const c=t;return function(){var t=Object(o.a)(r.a.mark((function t(n){var o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(Object(s.a)(Object(s.a)({},n),{},{__state:a()}));case 2:o=t.sent,c(Object(s.a)({type:n.type},o));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},action:(e,t)=>Object(s.a)(Object(s.a)({},e),t)}}static buildEvent(e,t){return{type:e,data:t}}}},386:function(e,t,a){},401:function(e,t,a){},457:function(e,t,a){},458:function(e,t,a){},459:function(e,t,a){},460:function(e,t,a){},461:function(e,t,a){},580:function(e,t,a){e.exports=a(1138)},586:function(e,t,a){},587:function(e,t,a){},589:function(e,t,a){},590:function(e,t,a){},790:function(e,t,a){},791:function(e,t,a){},84:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return s}));const n="";class r{}r.GET="get",r.POST="post",r.PUT="put",r.DELETE="delete";const s={name:"access-token"}}},[[580,1,2]]]);
//# sourceMappingURL=main.c2be790b.chunk.js.map