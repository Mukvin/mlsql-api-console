(this["webpackJsonpmlsql-web-console"]=this["webpackJsonpmlsql-web-console"]||[]).push([[0],{1063:function(e,t,a){},1064:function(e,t,a){},1074:function(e,t,a){},1078:function(e,t,a){},1132:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(19),o=a.n(s);a(581),a(582),a(583);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=a(4),c=a.n(i),l=a(7),u=a(8),p=(a(585),a(39)),d=a(15),m=a(14),h=a(16),f=a(85);const b=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("logout"!==t.data.currentPage){e.next=7;break}return a=new m.ActionProxy,e.next=4,a.post(h.default.LOGOUT,{});case 4:return sessionStorage.removeItem(f.a.name),sessionStorage.removeItem("user"),e.abrupt("return",{data:{currentPage:"admin",logined:!1}});case 7:return e.abrupt("return",{data:{currentPage:t.data.currentPage}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),g=b.handler,E=b.action;var y=a(9),v=a(277);var w=class{static setupLogin(e){const t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags},a=e.resp.headers.get(f.a.name);sessionStorage.setItem(f.a.name,a),sessionStorage.setItem("user",JSON.stringify(t));(new v.a).set(f.a.name,a,{path:"/"})}static updateUser(e){const t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags};sessionStorage.setItem("user",JSON.stringify(t))}static extraOption(){const e=sessionStorage.getItem("user");if(!e)return{};try{return JSON.parse(JSON.parse(e).extraOption)}catch(t){return{}}}static isAdmin(){const e=sessionStorage.getItem("user");if(!e)return!1;return"admin"===JSON.parse(e).role}static logined(){return!!sessionStorage.getItem(f.a.name)}static formLayout2(){return{formItemLayout:{labelCol:{xs:{span:4},sm:{span:8}},wrapperCol:{xs:{span:4},sm:{span:8}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}static formLayout1(){return{formItemLayout:{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}};const k=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="workshop","register"!==t.__state.currentPage||w.logined()||(a="register"),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{logined:w.logined(),currentPage:a})});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),x=k.handler,S=k.action;var O=a(75);class C{}C.SWITCH="switch",C.CHECK_LOGINED="checkLogined";const j={[C.SWITCH]:g,[C.CHECK_LOGINED]:x,setState:O.SetStateActionHandler};function T(e,t){switch(t.type){case C.SWITCH:return E(e,t.data);case C.CHECK_LOGINED:return S(e,t.data);case"setState":return Object(O.SetStateAction)(e,t.data);default:return e}}a(586);var N=a(60),I=a(1150),R=a(1136),_=a(474),D=a(475),A=a(476),P=a(477),F=a(478),L=a(479),M=a(480),q=a(165),V=a.n(q),B=a(1137);const G=N.a.SubMenu,U=r.a.createContext();function J(e){const t=e.currentPage,a=e.userLogined,s=e.isUserAdmin,o=e.appInfo,i=Object(n.useContext)(ec).dispacher,c=Object(n.useState)(t),l=Object(u.a)(c,2),p=l[0],m=l[1],h=Object(n.useState)(a),f=Object(u.a)(h,2),b=f[0],g=f[1],E=Object(n.useState)(s),y=Object(u.a)(E,2),v=y[0],w=y[1],k=Object(n.useState)(void 0),x=Object(u.a)(k,2),S=x[0],O=x[1],j=Object(n.useState)(!1),T=Object(u.a)(j,2),q=(T[0],T[1],Object(n.useRef)());return Object(n.useEffect)(()=>{const t=e.currentPage,a=e.userLogined,n=e.isUserAdmin;m(t),g(a),w(n)},[e]),r.a.createElement(U.Provider,null,r.a.createElement(V.a,{title:"Confirm",visible:S||!1,onCancel:()=>{O(void 0)},onOk:()=>{O(void 0),m(q.current),i(d.a.buildEvent(C.SWITCH,{currentPage:q.current}))},cancelText:"Cancel",okText:"Leave"},r.a.createElement(I.a,{description:S,type:"info"})),r.a.createElement(N.a,{onClick:e=>{if("home"===e.key)return e.domEvent.preventDefault(),void e.domEvent.stopPropagation();b&&"workshop"===p&&"workshop"!==e.key?(q.current=e.key,O("Do you wanna leave workshop? Please make sure you have saved your work before you leave.")):(m(e.key),i(d.a.buildEvent(C.SWITCH,{currentPage:e.key})))},selectedKeys:[p],mode:"horizontal"},r.a.createElement(N.a.Item,{key:"home"},r.a.createElement("span",{style:{fontSize:32}},"MLSQL Web Console"),r.a.createElement("span",{style:{fontSize:11}},"(Build 20200805.150909)")),r.a.createElement(R.a,{type:"vertical"}),!b&&r.a.createElement(N.a.Item,{key:"login",icon:r.a.createElement(_.a,null)},r.a.createElement(B.a,{id:"login"})),!b&&r.a.createElement(N.a.Item,{key:"register",icon:r.a.createElement(D.a,null)},r.a.createElement(B.a,{id:"register"})),b&&o.enableConsole&&r.a.createElement(N.a.Item,{key:"console",icon:r.a.createElement(A.a,null)},r.a.createElement(B.a,{id:"console"})),b&&r.a.createElement(N.a.Item,{key:"workshop",icon:r.a.createElement(P.a,null)},r.a.createElement(B.a,{id:"analysis_workshop"})),b&&r.a.createElement(N.a.Item,{key:"settings",icon:r.a.createElement(F.a,null)},r.a.createElement(B.a,{id:"settings"})),b&&v&&r.a.createElement(N.a.Item,{key:"admin",icon:r.a.createElement(F.a,null)},r.a.createElement(B.a,{id:"admin"})),b&&r.a.createElement(G,{icon:r.a.createElement(L.a,null),title:r.a.createElement(B.a,{id:"more"})},r.a.createElement(N.a.Item,{key:"doc"},"\u4e2d\u6587\u6587\u6863"),r.a.createElement(N.a.Item,{key:"logout",icon:r.a.createElement(M.a,null)},"Logout"))))}var K=a(1155),H=a(1144),W=a(552),Q=a(59);a(383);const z=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,n=a.userName,r=a.password,s=a.password2,r===s){e.next=3;break}return e.abrupt("return",{data:{error:"Passwords are not matched"}});case 3:return o=new m.ActionProxy,e.next=6,o.post(h.default.REGISTER,{userName:n,password:r});case 6:return i=e.sent,l={},200!==i.status?l={error:JSON.parse(i.content).msg}:(w.setupLogin(i),l={error:void 0,logined:!0,current:t.__state.current+1}),e.abrupt("return",{data:l});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Y=z.handler,X=z.action,$=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new m.ActionProxy,e.next=3,a.post(h.default.LOGIN,t.data);case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",{data:{logined:!1,error:JSON.parse(n.content).msg}});case 6:return w.setupLogin(n),e.abrupt("return",{data:{logined:!0}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Z=$.handler,ee=$.action;class te{}te.REGISTER="register",te.LOGIN="login";const ae={[te.REGISTER]:Y,[te.LOGIN]:Z};function ne(e,t){switch(t.type){case te.REGISTER:return X(e,t.data);case te.LOGIN:return ee(e,t.data);default:return e}}var re=a(76),se=a(77);function oe(){const e=Object(re.a)(["\n  width: 100%;    \n  margin: 0px 10px 10px 0px;\n"]);return oe=function(){return e},e}const ie=se.a.div(oe());var ce=function(e){return r.a.createElement(ie,null,r.a.createElement(I.a,Object.assign({},e,{closable:!0,type:e.type||"error",message:e.title||"Message",description:e.message})))};const le=r.a.createContext(),ue={logined:!1,error:void 0};function pe(){const e=Object(n.useContext)(ec).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout,o=Object(p.useReducerAsync)(ne,ue,ae),i=Object(u.a)(o,2),c=i[0],l=i[1],d=c.logined,m=c.error;return Object(n.useEffect)(()=>{e({type:C.CHECK_LOGINED,data:{}})},[d]),r.a.createElement(le.Provider,{value:{}},r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(K.a,{title:"Register"},m&&r.a.createElement(ce,{type:"error",message:m}),r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:e=>{l({type:te.REGISTER,data:e})}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go"))))))}const de={logined:!1,error:void 0},me=r.a.createContext();function he(){const e=w.formLayout1(),t=e.formItemLayout,a=e.tailLayout,s=Object(n.useContext)(ec).dispacher,o=Object(p.useReducerAsync)(ne,de,ae),i=Object(u.a)(o,2),c=i[0],l=i[1],m=c.logined,h=c.error;return Object(n.useEffect)(()=>{s({type:C.CHECK_LOGINED,data:{logined:m}})},[m]),r.a.createElement(me.Provider,null,r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(K.a,{title:"Login"},h&&r.a.createElement(ce,{type:"error",message:h}),r.a.createElement(H.a,Object.assign({},t,{className:"login-form",onFinish:e=>{l(d.a.buildEvent(te.LOGIN,e))}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,a,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go"))))))}a(190),a(298);var fe=a(67),be=a.n(fe);a(397),a(299),a(300);const ge=a(14).ActionProxy,Ee=a(16).default;class ye{static getSuggestList(e,t,a){return Object(l.a)(c.a.mark((function n(){var r,s,o;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new ge,n.next=3,r.post(Ee.RUN,{executeMode:"autoSuggest",sql:e,lineNum:t+1,columnNum:a,isDebug:!1,queryType:"robot"});case 3:if(!(s=n.sent)||200!==s.status){n.next=9;break}return o=s.content,n.abrupt("return",o);case 9:return n.abrupt("return",[]);case 10:case"end":return n.stop()}}),n)})))()}}a(398);var ve=a(1147);const we="get",ke="post",xe=401,Se="access-token",Oe="/api_v1/run/script";class Ce{isLogin(){return null!==sessionStorage.getItem(Se)}userName(e){new Ie("/api_v1/user/userName").request(we,{},t=>{t.status===xe?sessionStorage.removeItem(Se):t.content.then(t=>{e(JSON.parse(t).userName)}).catch(e=>{})},e=>{console.log(e)})}user(e){new Ie("/api_v1/user/userName").request2({},t=>{e(t)},e=>{})}login(e,t,a,n){this.registerOrLogin("/api_v1/user/login",e,t,a,n)}logout(){sessionStorage.removeItem(Se)}register(e,t,a,n){this.registerOrLogin("/api_v1/user/register",e,t,a,n)}registerOrLogin(e,t,a,n,r){const s={userName:t,password:a};new Ie(e).request(ke,s,e=>{if(e.accessToken){sessionStorage.setItem(Se,e.accessToken);(new v.a).set(Se,e.accessToken,{path:"/"})}n(e)},e=>{r(e)})}}const je=a(105);class Te{constructor(e){this.value=e}}class Ne{constructor(e,t,a){this.json=(e,t)=>{this.content.then(a=>{try{const t=JSON.parse(a);e(t)}catch(n){console.log(n),t(a)}})},this.status=e,this.content=t,this.accessToken=a}}class Ie{constructor(e){this.url=e}request2(e,t,a){this.request(ke,e,e=>{e.json(e=>{t(e)},e=>{a(e)})},e=>{try{e.value().content(e=>{let t=e;try{t=JSON.parse(e).msg}catch(n){}a(t)})}catch(t){a(e?e.toString():"result is null")}})}runScript(e,t,a,n){const r=new Ce,s=je(),o=this;r.user(r=>{const i=r.userName,c=r.backendTags,l={sql:t,owner:i,jobName:s,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:c||""};Object.assign(l,e);(e.background||!1)&&Object.assign(l,{async:!0,callback:""}),o.request(ke,l,e=>{if(200===e.status)e.json(e=>{a(e)},e=>{n(e)});else try{e.content.then(t=>{let a=t;try{a=JSON.parse(t).msg}catch(r){}n("backend status:"+e.status+"\n"+a)})}catch(t){n("backend status:"+e.status)}},e=>{try{e.value().content(e=>{let t=e;try{t=JSON.parse(e).msg}catch(a){}n(t)})}catch(t){n(e?e.toString():"result is null")}})})}request(e,t,a,n){e=e.toUpperCase();let r=[];for(let o in t){let e=encodeURIComponent(o),a=encodeURIComponent(t[o]);r.push(e+"="+a)}let s=this.url;return"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&"),fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(Se)||""},body:r}).then(e=>{a(new Ne(e.status,e.text(),e.headers.get(Se)))}).catch(e=>{n(new Te(e))})}newRunScript(e,t,a,n){const r=new Ce,s=je(),o=this;r.user(r=>{const i=r.userName,c=r.backendTags;if(!c)return void n("\n                \n                ---------------Warning--------------------\n                \n                Please make sure you have backend configured. \n                If not, please contact admin;\n                \n                ------------------------------------------\n                ");const l={sql:t,owner:i,jobName:s,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:c||""};Object.assign(l,e);(e.background||!1)&&Object.assign(l,{async:!0,callback:""}),o.new_request(ke,l,a,n)})}new_request(e,t,a,n){e=e.toUpperCase();let r=[];for(let i in t){let e=encodeURIComponent(i),a=encodeURIComponent(t[i]);r.push(e+"="+a)}let s=this.url;"GET"===e?(s=s+"?"+r,r=void 0):r=r.join("&");let o=0;return fetch(s,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(Se)||""},body:r}).then(e=>(o=e.status,200===o&&e.json().then(e=>{a(e)}),e)).then(e=>{const t=()=>{e.text().then(e=>{try{n(JSON.parse(e).msg)}catch(t){n(e)}})};switch(o){case 201:break;case 400:case 500:t();break;default:console.log("unhandled")}}).catch(e=>{n(e.message)})}}class Re{constructor(){this.makeSQL=e=>"JobList"===e?"load _mlsql_.`jobs` as output;":"ConnectMySQL"===e?'connect jdbc where\n url="jdbc:mysql://127.0.0.1:3306/wow?characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false"\n and driver="com.mysql.jdbc.Driver"\n and user=""\n and password=""\n as db_1;':"ShowResource"===e?"load _mlsql_.`resource` as output;":""}}var _e=a(203),De=a(80);class Ae extends class{constructor(e){this.inner=e,this.session=this.inner.editor.session,this.editor=this.inner.editor}setText(e){return this.editor.setValue(e),this}append(e){return this.session.insert({row:this.session.getLength(),column:0},"\n"+e),this}insertAfterCursor(e){const t=this.editor.getCursorPosition();return this.session.insert(t,e),this.editor.focus(),this}}{constructor(e){super(e)}getText(){return this.editor.getValue()}getSelection(){let e=this.editor.getSelectionRange();return this.session.getTextRange(e)}}const Pe=a(105),Fe=new m.ActionProxy;class Le{static ls(e){return Object(l.a)(c.a.mark((function t(){var a,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new m.ActionProxy,t.next=3,a.runScript("!hdfs -ls -F ".concat(e,";"),Pe(),{queryType:"robot"});case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()}static killJob(e){return Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.runScript("!kill "+e+";",Pe(),{queryType:"robot"});case 2:return a=t.sent,t.next=5,Fe.get(h.default.JOB_KILL,{jobName:e});case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))()}static runJob(e,t=!1){return Object(l.a)(c.a.mark((function a(){var n;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Fe.runScript(e,Pe(),{async:t});case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}}),a)})))()}static showFunctions(){return Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe.runScript("",Pe(),{executeMode:"sqlFunctions"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}static jobs(){return Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Pe(),e.next=3,Fe.runScript("load _mlsql_.`jobs` as wow;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",{jobName:t,res:a});case 5:case"end":return e.stop()}}),e)})))()}static tablesInDeltaLake(){return Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Pe(),e.next=3,Fe.runScript("!delta show tables;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))()}static tablesInWorkshop(){return Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe.get(h.default.ANALYSIS_TABLES,{});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}static tableInfo(e){return Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.get(h.default.ANALYSIS_TABLE_INFO,{tableName:e});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()}static jobProgress(e){return Object(l.a)(c.a.mark((function t(){var a,n,r,s,o,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Fe.runScript("load _mlsql_.`jobs/get/".concat(e,"` as wow;"),Pe(),{queryType:"robot"});case 2:if(a=t.sent,n={currentJobIndex:0,totalJobs:1},200!==a.status){t.next=17;break}if(r=a.content[0]){t.next=8;break}return t.abrupt("return",n);case 8:if(s=r.progress.currentJobIndex,1!==(o=r.progress.totalJob)){t.next=16;break}return t.next=13,Fe.runScript("load _mlsql_.`jobs/".concat(e,"` as wow;"),Pe(),{queryType:"robot"});case 13:i=t.sent,s=i.content[0].completedJobsNum,o=i.content[0].activeJobsNum+s;case 16:return t.abrupt("return",{currentJobIndex:s,totalJobs:o});case 17:return t.abrupt("return",n);case 18:case"end":return t.stop()}}),t)})))()}static resourceInfo(){return Object(l.a)(c.a.mark((function e(){var t,a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe.runScript("load _mlsql_.`resource` as output;",Pe(),{queryType:"robot"});case 2:return t=e.sent,a=t.content[0].totalCores,n=t.content[0].activeTasks,e.abrupt("return",{activeTasks:n,totalCores:a});case 6:case"end":return e.stop()}}),e)})))()}}const Me=a(105);class qe{constructor(e){this.enterLoading=()=>{this.commandGroupRef.setState({loading:!0})},this.exitLoading=()=>{this.commandGroupRef.setState({loading:!1})},this.queryPanel=e,this.client=new m.ActionProxy,this.jobName=Me(),this.editorOp=this.queryPanel.getEditorOp(),this.consoleOp=this.queryPanel.getConsoleOp();const t=this.editorOp.getSelection();this.sql=t||this.editorOp.getText(),this.commandGroupRef=this.queryPanel.commandGroup.current,this.jobProgressRef=this.queryPanel.jobProgressRef,this.taskProgressRef=this.queryPanel.taskProgressRef.current,this.displayRef=this.queryPanel.queryApp.display.current,this.dashRef=this.queryPanel.queryApp.dash.current,this.timeout=this.commandGroupRef.state.timeout,this.logInfo={},this.closed=!1}log(e){return this.consoleOp.append(e),this}prepare(){this.enterLoading(),this.consoleOp.setText(""),this.displayRef.update(JSON.parse("[]"))}measureTime(e){this.exitLoading();return(new Date).getTime()-e}saveFile(e){var t=this;return Object(l.a)(c.a.mark((function e(){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.queryPanel.state.scriptId){e.next=4;break}return t.log("No file are opened, cannot execute save action"),e.abrupt("return");case 4:return e.next=6,t.client.post(h.default.SAVE_SCRIPT_FILE,{id:a,content:t.editorOp.getText()});case 6:return 200!==(n=e.sent).status&&t.log(n.content),200===n.status&&t.log("File[".concat(a,"] have been saved.")),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))()}run(e){var t=this;return Object(l.a)(c.a.mark((function a(){var n,r;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.prepare(),n=(new Date).getTime(),a.next=4,t.client.runScript(t.sql,t.jobName,Object.assign(e,{jobName:t.jobName,async:!0,timeout:t.timeout,engineName:t.queryPanel.engineName}));case 4:if(200===(r=a.sent).status){a.next=8;break}return t.log("Fail to submit job\nTime cost:"+t.measureTime(n)+"ms"),a.abrupt("return",[]);case 8:return t.intervalTimer=setInterval(Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.monitorJob();case 2:return e.next=4,t.monitorLog();case 4:case"end":return e.stop()}}),e)}))),1e3),t.dashRef.queryHistory&&t.dashRef.queryHistory.reload(),t.jobProgressRef.enter(),a.abrupt("return",r);case 12:case"end":return a.stop()}}),a)})))()}cancelMonitor(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.intervalTimer&&(clearInterval(e.intervalTimer),e.intervalTimer=null),e.jobProgressRef.exit();case 2:case"end":return t.stop()}}),t)})))()}monitorJob(){var e=this;return Object(l.a)(c.a.mark((function t(){var a,n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.client.get(h.default.JOB_DETAIL,{jobName:e.jobName});case 2:a=t.sent,3===(n=a.content).status&&(e.closed=!0,e.cancelMonitor(),e.exitLoading(),e.jobProgressRef.exit(),e.log(n.reason)),2===n.status&&(e.closed=!0,e.cancelMonitor(),e.exitLoading(),e.jobProgressRef.exit(),r=JSON.parse(n.response),e.displayRef.update(r),e.queryPanel.queryApp.setData(r));case 6:case"end":return t.stop()}}),t)})))()}monitorLog(){var e=this;return Object(l.a)(c.a.mark((function t(){var a,n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Me(),t.next=3,e.client.runScript("load _mlsql_.`log/".concat(e.logInfo.offset||-1,'` where filePath="engine_log" as output;'),a,{queryType:"robot"});case 3:if(200===(n=t.sent).status){t.next=6;break}return t.abrupt("return");case 6:(r=n.content[0]).value&&r.value.length>0&&e.log(r.value.map(e=>e.split("__MMMMMM__")[1]).join("\n")),e.logInfo.offset=r.offset;case 9:case"end":return t.stop()}}),t)})))()}killJob(){var e=this;return Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.jobName){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Le.killJob(e.jobName);case 4:a=t.sent;try{e.log(a.content[0].description)}catch(n){e.log(a.content)}e.closed=!0,e.jobName=null,e.cancelMonitor(),e.exitLoading();case 10:case"end":return t.stop()}}),t)})))()}}var Ve=a(283),Be=a.n(Ve);class Ge extends n.Component{constructor(e){var t;super(e),t=this,this.enter=e=>{this.setState({loading:!0}),this.intervalTimer=setInterval(Object(l.a)(c.a.mark((function e(){var a,n,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.queryPanel.executor.jobName,e.next=3,Le.jobProgress(a);case 3:n=e.sent,r=n.currentJobIndex,s=n.totalJobs,t.setState({progress:r/s*100});case 7:case"end":return e.stop()}}),e)}))),1e3)},this.exit=()=>{this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null,this.finalTime=(this.timer.getTime()/1e3).toFixed(2)+"s",this.setState({loading:!1}))},this.queryPanel=e.parent,this.state={loading:!1,progress:0}}render(){return this.state.loading?n.createElement("div",null,n.createElement(Q.a,{type:"primary",style:{marginRight:"20px"}},"Time Cost:",n.createElement(Be.a,{ref:e=>this.timer=e},n.createElement(Be.a.Minutes,{formatValue:e=>"".concat(e," m. ")}),n.createElement(Be.a.Seconds,{formatValue:e=>"".concat(e," s. ")}))),n.createElement(ve.a,{type:"circle",percent:this.state.progress})):this.finalTime?n.createElement(Q.a,{type:"primary",style:{margin:"0px 0px 20px 0px"}},"Time Cost: ",this.finalTime):n.createElement("div",null)}}a(771);class Ue extends n.Component{constructor(e){super(e),this.enter=e=>{},this.exit=()=>{},this.queryPanel=e.parent,this.state={percent:0}}componentDidMount(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}reload(){var e=this;return Object(l.a)(c.a.mark((function t(){var a,n,r,s,o,i,l;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Le.resourceInfo();case 2:return a=t.sent,n=a.activeTasks,r=a.totalCores,t.next=7,Le.jobs();case 7:s=t.sent,o=s.jobName,i=s.res,l=i.content.filter(e=>e.jobName!==o).length,e.setState({percent:n/r*100,totalCores:r,activeTasks:n,jobNum:l});case 12:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"rp-main"},n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"CPU Usage(total cores:",this.state.totalCores,"): "),n.createElement(ve.a,{percent:this.state.percent,style:{maxWidth:"300px"}})),n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"Jobs Running: ",n.createElement("span",null,this.state.jobNum))))}}function Je(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=(a[0],a[1],Object(n.useState)([])),o=Object(u.a)(s,2),i=o[0],p=o[1],d=Object(n.useState)(!1),f=Object(u.a)(d,2),b=(f[0],f[1]),g=Object(n.useState)(void 0),E=Object(u.a)(g,2),y=E[0],v=E[1];Object(n.useEffect)(()=>{(function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),t=new m.ActionProxy,e.next=4,t.get(h.default.ENGINE_LIST,{});case 4:a=e.sent,p(a.content.data),n=w.extraOption().backend,a.content.data.length>0&&!n&&v(a.content.data[0].name),b(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(()=>{e.useEngine(y)},[y]);return r.a.createElement(_e.a,{onChange:e=>{v(e)},style:{width:"120px"}},i.map(e=>r.a.createElement(_e.a.Option,{value:e.name},e.name)))}const Ke=_e.a.Option;a(105);class He extends n.Component{constructor(e){var t;super(e),t=this,this.text=(e,t)=>{this.setState({value:e,scriptId:t},()=>{this.aceEditorRef.current.editor.setValue(e,1)})},this.executeSave=Object(l.a)(c.a.mark((function e(){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new qe(t),e.next=3,a.saveFile({});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))),this.getAllText=()=>this.getAceEditor().getValue(),this.getSelection=()=>this.getEditorOp().getSelection(),this.appendToEditor=e=>this.getEditorOp().insertAfterCursor(e),this.getEditorOp=()=>new Ae(this.aceEditorRef.current),this.getConsoleOp=()=>new Ae(this.queryApp.messageBox.current),this.getAceEditor=()=>this.getEditorOp().editor,this.getMessageBoxAceEditor=()=>this.getConsoleOp().editor,this.appendLog=e=>this.getConsoleOp().append(e),this.getDashBoard=()=>this.queryApp.dash.current,this.getDisplay=()=>this.queryApp.display.current,this.enterLoading=e=>{this.commandGroup.current.setState({loading:!0}),this.resourceProgressRef.current.enter({jobName:e}),this.jobProgressRef.enter({jobName:e}),this.taskProgressRef.current.enter({jobName:e})},this.exitLoading=()=>{this.commandGroup.current.setState({loading:!1}),this.jobProgressRef.exit(),this.resourceProgressRef.current.exit(),this.taskProgressRef.current.exit()},this.etOver=e=>{const t=this.queryApp.etRef.current,a=t.getData("eventName"),n=t.getData("popName"),r=t.getData("processType"),s=t.getData("pathAlias"),o=t.getData("tableHidden"),i=t.getData("pathHidden"),c=t.getData("outputTableHidden"),l=t.getData("outputTableAlias"),u=t.getData("tableAlias");"direct"===r?this.appendToEditor((new Re).makeSQL(a)):t.setState({etPop:!0,eventName:a,popName:n,processType:r,pathAlias:s,tableHidden:o,pathHidden:i,outputTableHidden:c,outputTableAlias:l,tableAlias:u})},this.language=this.props.language||"sql",this.queryApp=this.props.parent,this.aceEditorRef=n.createRef(),this.commandGroup=n.createRef(),this.taskProgressRef=n.createRef(),this.cancelQuery=this.cancelQuery.bind(this),this.executeQuery=this.executeQuery.bind(this),this.state={value:"",loading:!1}}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this);var e={getCompletions:function(){var e=Object(l.a)(c.a.mark((function e(t,a,n,r,s){var o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye.getSuggestList(t.getValue(),n.row,n.column);case 2:o=e.sent,s(null,o.map((function(e){let t="";return"desc"in e.extra&&(t=e.extra.desc),{caption:e.name,value:e.name,meta:t}})));case 4:case"end":return e.stop()}}),e)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()};this.getAceEditor().completers=[e]}onChange(e){}executeQuery(){var e=this;return Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.executor||e.executor.closed){t.next=4;break}return e.log("Job ".concat(e.jobName," is still running.")),e.log("Try to kill this job or wait it to finish"),t.abrupt("return");case 4:return e.executor=new qe(e),t.next=7,e.executor.run({});case 7:return a=t.sent,e.executor.closed||(e.executor.closed=!0),t.abrupt("return",a);case 10:case"end":return t.stop()}}),t)})))()}cancelQuery(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.executor&&e.executor.killJob();case 1:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:e=>e.preventDefault(),onDrop:this.etOver},n.createElement(De.Resizable,{defaultSize:{height:"500px"},onResize:()=>{this.aceEditorRef.current.editor.resize()}},n.createElement(be.a,{ref:this.aceEditorRef,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(We,{ref:this.commandGroup,parent:this}),n.createElement(Ge,{ref:e=>{this.jobProgressRef=e},parent:this}),n.createElement(Qe,{ref:this.taskProgressRef,parent:this}))}}class We extends n.Component{constructor(e){super(e),this.onChange=e=>{this.setState({timeout:e})},this.state={loading:!1,timeout:"-1"},this.parent=e.parent}render(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(Q.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(Q.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(Q.a,{onClick:this.parent.executeSave},"Save"),"Job Timeout:",n.createElement(_e.a,{onChange:this.onChange,style:{width:"120px"}},n.createElement(Ke,{value:"10000"},"10s"),n.createElement(Ke,{value:"30000"},"30s"),n.createElement(Ke,{value:"60000"},"60s"),n.createElement(Ke,{value:"1800000"},"30m"),n.createElement(Ke,{value:"7200000"},"2h"),n.createElement(Ke,{value:"28800000"},"8h"),n.createElement(Ke,{value:"-1"},"unlimited")),n.createElement(R.a,{type:"vertical"}),"Engine:",n.createElement(Je,{useEngine:e=>{this.engineName=e}}))}}class Qe extends n.Component{constructor(e){super(e),this.enter=e=>{const t=this;this.setState({mark:!0}),setTimeout(()=>{t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(()=>{if("loading"===t.taskCompute)return;t.taskCompute="loading";const a=new Ie(Oe);((e,t)=>{if(!e){if(t=t||"Assertion failed","undefined"!==typeof Error)throw new Error(t);throw t}})(e.hasOwnProperty("jobName"),"jobName is required");const n=e.jobName;a.runScript({},"load _mlsql_.`jobs/".concat(n,"` as output;"),e=>{t.taskCompute="loaded";const a=e[0],n={numTasks:0,numActiveTasks:0,numCompletedTasks:0};a.activeJobs.forEach(e=>{n.numTasks+=e.numTasks,n.numActiveTasks+=e.numActiveTasks,n.numCompletedTasks+=e.numCompletedTasks}),t.setState({percent:n.numActiveTasks/n.numTasks*100,successPercent:n.numCompletedTasks/n.numTasks*100,title:"Tasks (for all stages): Succeeded/Total:\n".concat(n.numCompletedTasks,"/").concat(n.numTasks,"(").concat(n.numActiveTasks," running)")})},e=>{t.taskCompute="loaded";try{t.parent.appendLog(e)}catch(a){console.log(a)}})},1e3))},1e3)},this.exit=()=>{this.taskCompute="loaded",this.resourceCompute="loaded",this.setState({loading:!1,percent:0,successPercent:0,mark:!1}),this.intervalTimer&&clearInterval(this.intervalTimer)},this.state={loading:!1,percent:0,successPercent:0,mark:!1},this.parent=e.parent}render(){return this.state.loading?n.createElement("div",null,this.state.title,n.createElement(ve.a,{percent:this.state.percent,successPercent:this.state.successPercent})):n.createElement("div",null)}}var ze=He,Ye=(a(774),a(1141)),Xe=a(1149);const $e=a(211);class Ze extends n.Component{constructor(e){super(e),this.setRender=(e,t)=>{const a=t[0][e.key];if(this.config&&this.config.render){const t=this.config.render[e.key];t&&(e.render=t)}else{try{if(n.Component.isPrototypeOf(a.type))return void(e.render=e=>n.createElement("span",null,e))}catch(r){}"html"!=e.key?"object"!==typeof a?"array"!==typeof a?"boolean"!==typeof a?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300)):e.render=e=>n.createElement("pre",null,e.substring(0,300))}},this.update=(e,t)=>{this.config=t;let a=[],n={},r=[];const s=this;e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),this.setState({columns:a,data:r})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1}},this.config={}}render(){const e=this;return n.createElement("div",{style:this.tableStyle},n.createElement(Ye.a,{onRow:(t,a)=>({onDoubleClick:n=>{e.rowDoubleClick(t,a,n)}}),columns:this.state.columns,dataSource:this.state.data}),n.createElement(Xe.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement($e,{source:this.state.view.content||""})))}}var et=a(1145),tt=a(360),at=a(554),nt=a(551),rt=a(514),st=a.n(rt);const ot={width:200,height:200,borderWidth:2,borderColor:"#666",borderStyle:"dashed",borderRadius:5},it={borderStyle:"solid",borderColor:"#6c6",backgroundColor:"#eee"},ct={borderStyle:"solid",borderColor:"#c66",backgroundColor:"#eee"},lt={display:"flex"};class ut extends r.a.Component{constructor(){super(),this.onDrop=e=>{this.setState({files:e});const t=st.a.post("/api_v1/file/upload");t.set("Access-Token",sessionStorage.getItem(Se)||""),e.forEach(e=>{t.attach(e.path,e)}),t.end((t,a)=>{this.setState({files:[]}),t?(console.log(t),this.setState({msg:t.toString()+"\n Sometimes this caused by your upload space is not enough or backend fails"})):a.ok&&this.setState({msg:"total files:"+e.length+" are uploaded. \n You can check the files with command: !hdfs -ls /tmp/upload; "})})},this.state={files:[]}}render(){const e=this.state.files.map(e=>r.a.createElement("li",{key:e.name},e.path," - ",e.size," bytes"));return r.a.createElement("section",{style:lt},r.a.createElement("div",null,r.a.createElement(at.a,{onDrop:this.onDrop,getDataTransferItems:e=>Object(nt.a)(e)},({getRootProps:e,getInputProps:t,isDragActive:a,isDragAccept:n,isDragReject:s,acceptedFiles:o,rejectedFiles:i})=>{let c=Object(y.a)({},ot);return c=a?Object(y.a)(Object(y.a)({},c),it):c,c=s?Object(y.a)(Object(y.a)({},c),ct):c,r.a.createElement("div",Object.assign({},e(),{style:c}),r.a.createElement("input",t()),r.a.createElement("div",null,n?"Drop":"Drag"," files here..."),s&&r.a.createElement("div",null,"Unsupported file type..."))})),r.a.createElement("aside",null,r.a.createElement("h4",null,0===e.length?"":"Files"),r.a.createElement("ul",null,e)),r.a.createElement("div",null,this.state.msg?this.state.msg:""))}}var pt=a(33);const dt=a(452),mt=()=>{let e=dt();return"#000000"===e&&(e="#8884d8"),e};class ht{static render(e){let t=e[0].hasOwnProperty("z");e.hasOwnProperty("dataType")||e.forEach(e=>{e.dataType="default",t||(e.z=0)});const a=e.reduce((e,t)=>{t.x,t.y,t.z;const a=t.dataType,n=e.get(a);return n?n.push(t):e.set(a,[t]),e},new Map),n=e[0]._dash_config||{},s=[...a.keys()].map(e=>{const t=Object.assign({fill:mt(),shape:"triangle"},n[e]||{});return r.a.createElement(pt.g,Object.assign({key:e,name:e,data:a.get(e)},t))}),o=Object.assign({type:"number",dataKey:"x"},n.x||{}),i=Object.assign({type:"number",dataKey:"y"},n.y||{}),c=Object.assign({type:"number",dataKey:"z"},n.z||{});return r.a.createElement(pt.h,{width:400,height:400,margin:{top:20,right:20,bottom:20,left:20}},r.a.createElement(pt.c,null),r.a.createElement(pt.j,o),r.a.createElement(pt.k,i),t?r.a.createElement(pt.l,c):"",r.a.createElement(pt.i,{cursor:{strokeDasharray:"3 3"}}),r.a.createElement(pt.d,null),s)}}ht.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},ht.isShouldRender=e=>ht.basicCheck(e,e=>e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&(e.hasOwnProperty("_dash_config")||e.hasOwnProperty("dash"))&&("scatter"===e.dash||"scatter"===(e._dash_config||{}).dash));const ft=a(452),bt=()=>{let e=ft();return"#000000"===e&&(e="#8884d8"),e};class gt{static render(e){const t=e[0],a=[],n=t._dash_config||{};return"line"===t.dash||"line"===n.dash?(Object.keys(t).forEach(e=>{if("number"===typeof t[e]){const t=Object.assign({stroke:bt()},n[e]||{});a.push(r.a.createElement(pt.e,Object.assign({key:e,type:"monotone",dataKey:e},t)))}}),r.a.createElement(pt.f,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(pt.c,{strokeDasharray:"3 3"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.i,null),r.a.createElement(pt.d,null),a)):"bar"===t.dash||"bar"===n.dash?(Object.keys(t).forEach(e=>{if("number"===typeof t[e]){const t=Object.assign({fill:bt()},n[e]||{});a.push(r.a.createElement(pt.a,Object.assign({key:e,dataKey:e},t)))}}),r.a.createElement(pt.b,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(pt.c,{strokeDasharray:"3 3"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.i,null),r.a.createElement(pt.d,null),a)):void 0}}gt.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},gt.isShouldRender=e=>gt.basicCheck(e,e=>e.hasOwnProperty("x")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config")));var Et=a(525),yt=a.n(Et);class vt extends n.Component{constructor(e){super(e),this.renderStream=()=>{const e=this.state.data,t=[],a=[];e.forEach(e=>{const n=JSON.parse(e.value),r=yt.a.utc(n.timestamp).format("DD,h:mm:ss");t.push({x:r,inputRowsPerSecond:n.inputRowsPerSecond,processedRowsPerSecond:n.processedRowsPerSecond}),a.push({x:r,numInputRows:n.numInputRows})}),this.setState({dataForRender:t,dataForRender2:a})},this.queryApp=e.parent.parent,this.state={data:e.data,dataForRender:[],titleMap:{}}}componentDidMount(){this.renderStream()}render(){return 0===this.state.dataForRender.length?null:r.a.createElement("div",null,r.a.createElement(pt.f,{width:800,height:300,data:this.state.dataForRender},r.a.createElement(pt.e,{type:"monotone",dataKey:"inputRowsPerSecond",stroke:"#8884d8"}),r.a.createElement(pt.e,{type:"monotone",dataKey:"processedRowsPerSecond",stroke:"#82ca9d"}),r.a.createElement(pt.c,{stroke:"#ccc"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.d,null)),r.a.createElement(pt.f,{width:800,height:300,data:this.state.dataForRender2},r.a.createElement(pt.e,{type:"monotone",dataKey:"numInputRows",stroke:"#8884d8"}),r.a.createElement(pt.c,{stroke:"#ccc"}),r.a.createElement(pt.j,{dataKey:"x"}),r.a.createElement(pt.k,null),r.a.createElement(pt.d,null)))}}vt.isStream=e=>{if(e.length<1)return!1;try{if(!JSON.parse(e[0].value).runId)return!1}catch(t){return!1}return!0},vt.isShouldRender=e=>vt.isStream(e),vt.renderRawData=e=>{if(!vt.isShouldRender(e))return"";const t=[];return e.forEach(e=>{const a=JSON.parse(e.value);t.push(JSON.stringify(a,null,2))}),t.join("\n")};class wt{static render(e){const t=e[0];return r.a.createElement(kt,{data:t})}}wt.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},wt.isShouldRender=e=>wt.basicCheck(e,e=>e.hasOwnProperty("html")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config")));class kt extends r.a.Component{constructor(e){super(e),this.refresh=e=>{this.setState({data:e})},this.state={data:this.props.data}}render(){return r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(De.Resizable,{defaultSize:{height:"500px"}},r.a.createElement("iframe",{sandbox:"allow-scripts",style:{width:"100%",height:"100%"},srcDoc:this.state.data.html,frameBorder:"0",scrolling:"yes",ref:e=>{this.ifr=e}})))}}class xt extends r.a.Component{constructor(e){var t;super(e),t=this,this.toggleDetail=()=>{this.setState({showDetail:!this.state.showDetail})},this.toggleResponse=()=>{this.setState({showResponse:!this.state.showResponse})},this.cleanSQL=e=>{try{return e.split("\n").filter(e=>!e.includes("password")).join("\n")}catch(t){return e}},this.queryApp=e.parent.queryApp,this.client=new m.ActionProxy,this.state={showDetail:!1,executeAgainStatus:{}};let a=(e,a)=>r.a.createElement(Q.a,{type:"link",onClick:function(){var e=Object(l.a)(c.a.mark((function e(n){var r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.target.parentNode,s=r.parentNode.cellIndex,o="",e.t0=s,e.next=2===e.t0?6:4===e.t0?8:7===e.t0?10:12;break;case 6:return o="content",e.abrupt("break",12);case 8:return o="reason",e.abrupt("break",12);case 10:return o="response",e.abrupt("break",12);case 12:return console.log(s),e.next=15,t.showDetail(a.name,o);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e));this.renderConfig={render:{content:a,response:(e,a)=>r.a.createElement(Q.a,{type:"link",onClick:function(){var e=Object(l.a)(c.a.mark((function e(n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.showResponse(a.name);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e)),reason:a,status:e=>{let t="",a={};switch(e){case"fail":case"killed":t="danger";break;case"success":t="primary",a={backgroundColor:"green"};break;case"running":t="primary"}return r.a.createElement(Q.a,{type:t,style:a},e)},__command__:(e,a)=>{const n=a.name;return"running"!==a.status?r.a.createElement(Q.a,{type:"primary",key:n,loading:this.state.executeAgainStatus[n],onClick:function(){var e=Object(l.a)(c.a.mark((function e(r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state.executeAgainStatus[n]=!0,t.setState(t.state.executeAgainStatus),e.next=4,Le.runJob(a.content);case 4:t.reload();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Execute again"):r.a.createElement(Q.a,{key:n,onClick:function(){var e=Object(l.a)(c.a.mark((function e(a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.killJob(n);case 2:e.sent,t.reload();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"Kill")}}}}reload(){var e=this;return Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({executeAgainStatus:{}}),t.next=3,e.client.get(h.default.JOB_LIST,{});case 3:200==(a=t.sent).status&&e.display&&e.display.update(e.processData(a.content),e.renderConfig);case 5:case"end":return t.stop()}}),t)})))()}processData(e){return e.map(e=>{const t="running"===e.status?e.jobName:"";return Object.assign(e,{__command__:t})})}showDetail(e,t){var a=this;return Object(l.a)(c.a.mark((function n(){var r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.client.get(h.default.JOB_DETAIL,{jobName:e});case 2:r=n.sent,a.setState({showDetail:!0,detailConsoleMessage:r.content[t]});case 4:case"end":return n.stop()}}),n)})))()}showResponse(e){var t=this;return Object(l.a)(c.a.mark((function a(){var n;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.client.get(h.default.JOB_DETAIL,{jobName:e});case 2:n=a.sent,t.setState({showResponse:!0}),t.respDisplay&&t.respDisplay.update(JSON.parse(n.content.response));case 5:case"end":return a.stop()}}),a)})))()}componentDidMount(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(Xe.a,{title:"View",visible:this.state.showDetail,onCancel:this.toggleDetail,onOk:this.toggleDetail,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(be.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.cleanSQL(this.state.detailConsoleMessage)||""})),r.a.createElement(Xe.a,{title:"View",visible:this.state.showResponse,onCancel:this.toggleResponse,onOk:this.toggleResponse,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(Ze,{style:{overflow:"scroll"},ref:e=>{this.respDisplay=e},parent:this})),r.a.createElement("div",{style:{marginBottom:16}},r.a.createElement(Q.a,{type:"primary",onClick:()=>{this.reload()}},"Reload")),r.a.createElement(Ze,{ref:e=>{this.display=e},parent:this}))}}const St=et.a.Panel,Ot=tt.a.TabPane;function Ct(e){}class jt extends n.PureComponent{constructor(e){super(e),this.isNormalXY=e=>jt.basicCheck(e,e=>e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&"number"===typeof e.y),this.xYRender=e=>r.a.createElement(pt.a,{height:200,title:"Bar",data:e}),this.renderDash=()=>{const e=this.state.data;return vt.isShouldRender(e)?r.a.createElement(vt,{data:e,parent:this}):ht.isShouldRender(e)?ht.render(e):this.isNormalXY(e)?this.xYRender(e):gt.isShouldRender(e)?gt.render(e):wt.isShouldRender(e)?wt.render(e):r.a.createElement("div",null)},this.queryApp=e.parent,this.state={data:[],dataForRender:[],titleMap:{}}}refresh(){try{const e=this.queryApp.queryResData||[];this.setState({data:e})}catch(e){}}render(){return r.a.createElement(et.a,{onChange:Ct},r.a.createElement(St,{header:"Tools/Dashboard",key:"0"},r.a.createElement(tt.a,{defaultActiveKey:"0",onChange:Ct,onTabClick:e=>{"0"===e&&this.resourceProgressRef.reload()}},r.a.createElement(Ot,{tab:"Cluster Info",key:"0"},r.a.createElement(Ue,{ref:e=>this.resourceProgressRef=e,parent:this})),r.a.createElement(Ot,{tab:"Upload",key:"1"},r.a.createElement(ut,null)),r.a.createElement(Ot,{tab:"Dashboard",key:"2"},this.renderDash()),r.a.createElement(Ot,{tab:"RawData",key:"3"},r.a.createElement("pre",null,vt.renderRawData(this.state.data))),r.a.createElement(Ot,{tab:"History",key:"4"},r.a.createElement(xt,{ref:e=>this.queryHistory=e,parent:this})))))}}jt.basicCheck=(e,t)=>{if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0};class Tt extends r.a.Component{constructor(e){super(e),this.originalEditor=()=>this.editor.editor}componentDidMount(){this.originalEditor().container.style.lineHeight=3}render(){return r.a.createElement(be.a,{maxLines:1/0,width:"100%",ref:e=>{this.editor=e},value:this.props.initialCode,mode:"sql",theme:"github"})}}var Nt=a(1140);class It extends r.a.Component{constructor(e){super(e),this.evtExecute=()=>{this.setState({isExecute:!0}),this.state.executeUnit.execute()},this.cancelExecute=()=>{this.setState({isExecute:!1})},this.state={isExecute:!1,executeUnit:e.executeUnit}}render(){return r.a.createElement("div",null,this.state.isExecute?r.a.createElement("span",{onClick:this.cancelExecute},r.a.createElement(Nt.a,{type:"sync",spin:!0})):r.a.createElement("span",{onClick:this.evtExecute},r.a.createElement(Nt.a,{type:"caret-right"})))}}const Rt=a(105);class _t{constructor(e){this.run=(e,t,a)=>{const n=Rt();new Ie(Oe).newRunScript({jobName:n,timeout:this.timeout},e,t,a)},this.saveFile=(e,t,a)=>{new Ie("/api_v1/script_file").request(ke,{id:t,content:e},e=>{200!=e.status?e.json(e=>{a(e.msg)},e=>{a(e)}):a("saved")},e=>{a(e)})},this.timeout=e}}const Dt=a(211);class At extends n.Component{constructor(e){super(e),this.setRender=(e,t,a)=>{const r=t[0][e.key];if(a&&a.render){const t=this.state.config.render[e.key];t&&(e.render=t)}else{try{if(n.Component.isPrototypeOf(r.type))return void(e.render=e=>n.createElement("span",null,e))}catch(s){}"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300))}},this.parseData=(e,t)=>{let a=[],n={},r=[];const s=this;return e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),[a,r]},this.refresh=(e,t)=>{const a=this.parseData(e,t),n=Object(u.a)(a,2),r=n[0],s=n[1];this.setState({columns:r,rows:s,config:t})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})};const t=this.parseData(e.data||[],e.config||{}),a=Object(u.a)(t,2),r=a[0],s=a[1];this.state={columns:r,rows:s,view:{enabled:!1}}}render(){const e=this;return n.createElement("div",null,n.createElement(Ye.a,{onRow:(t,a)=>({onDoubleClick:n=>{e.rowDoubleClick(t,a,n)}}),columns:e.state.columns,dataSource:e.state.rows}),n.createElement(Xe.a,{title:"View",visible:e.state.view.enabled,onCancel:e.disablePreview,onOk:e.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(Dt,{source:e.state.view.content||""})))}}class Pt extends r.a.Component{constructor(e){super(e),this.refresh=e=>{if(this.setState({displayData:e,errorMsg:""}),this.displayTableRef&&this.displayTableRef.refresh(this.state.displayData,{}),this.displayDashRef){const e=this.state.displayData[0];this.displayDashRef.refresh(e)}},this.fail=e=>{this.setState({errorMsg:e}),this.editor&&this.editor.editor.setValue(e)},this.displayDash=()=>{if(this.state.displayData&&wt.isShouldRender(this.state.displayData)){const e=this.state.displayData[0];return r.a.createElement(kt,{data:e,ref:e=>this.displayDashRef=e})}return r.a.createElement("div",null)},this.displayError=()=>this.state.errorMsg?r.a.createElement("div",null,r.a.createElement(be.a,{maxLines:1/0,width:"100%",ref:e=>{this.editor=e},value:this.state.errorMsg,mode:"text",theme:"ace/theme/textmate"})):r.a.createElement("div",null),this.displayTable=()=>this.state.displayData?r.a.createElement(At,{data:this.state.displayData,ref:e=>this.displayTableRef=e}):r.a.createElement("div",null),this.state={errorMsg:""}}render(){return r.a.createElement("div",null,this.displayError(),this.displayTable(),this.displayDash())}}class Ft extends r.a.Component{constructor(e){super(e),this.execute=()=>{const e=this.codeBlock.originalEditor().getValue();new _t(3e5).run(e,e=>{this.displayGroup.refresh(e),this.commandGroup.setState({isExecute:!1}),this.notebook.nextExecuteUnit()},e=>{this.displayGroup.fail(e),this.commandGroup.setState({isExecute:!1})})},this.codeBlockIsEmpty=()=>""===this.getCodeStr(),this.getCodeStr=()=>this.codeBlock.originalEditor().getValue(),this.notebook=e.parent}render(){return r.a.createElement("div",null,r.a.createElement(Tt,{initialCode:this.props.initialCode,ref:e=>{this.codeBlock=e},executeUnit:this}),r.a.createElement(It,{ref:e=>{this.commandGroup=e},executeUnit:this}),r.a.createElement(Pt,{ref:e=>this.displayGroup=e}))}}const Lt="set notebooksplitter='notebooksplitter';";class Mt extends r.a.Component{constructor(e){super(e),this.createNewExecuteUnit=e=>r.a.createElement(Ft,{parent:this,initialCode:e,ref:e=>this.addRef(e)}),this.addRef=e=>{e&&this.executeUnitRefs.push(e)},this.nextExecuteUnit=()=>{(()=>this.executeUnitRefs.slice(-1)[0].codeBlockIsEmpty())()||(this.executeUnits.push(this.createNewExecuteUnit()),this.setState({executeUnits:this.executeUnits})),this.saveNoteBook()},this.saveNoteBook=()=>{const e=this.executeUnitRefs.map(e=>e.getCodeStr()).join(Lt);this.engine.saveFile(e,this.scriptId,e=>{})},this.text=(e,t)=>{this.scriptId=t,this.initialCode=e,e&&"undefined"!==e&&(this.executeUnitRefs=[],this.executeUnits=this.initialCode.split(Lt).map(e=>this.createNewExecuteUnit(e)),this.setState({executeUnits:this.executeUnits}))},this.executeUnitRefs=[],this.executeUnits=[this.createNewExecuteUnit("")],this.state={executeUnits:this.executeUnits},this.engine=new _t(3e5)}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}render(){return r.a.createElement("div",null,this.state.executeUnits)}}const qt=a(105);class Vt{constructor(e){this.appendLog=e,this.log={}}cancelQueryLog(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.intervalTimer&&(clearInterval(e.intervalTimer),e.intervalTimer=null);case 1:case"end":return t.stop()}}),t)})))()}queryLog(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.cancelQueryLog(),e.intervalTimer=setInterval(Object(l.a)(c.a.mark((function t(){var a,n,r,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=qt(),n=new m.ActionProxy,t.next=4,n.runScript("load _mlsql_.`log/".concat(e.log.offset||-1,'` where filePath="engine_log" as output;'),a,{});case 4:r=t.sent,(s=r.content[0]).value.length>0&&e.appendLog(s.value.map(e=>e.split("__MMMMMM__")[1]).join("\n")),e.log.offset=s.offset;case 8:case"end":return t.stop()}}),t)}))),2e3);case 2:case"end":return t.stop()}}),t)})))()}}_e.a.Option;const Bt=a(105);class Gt extends n.Component{constructor(e){super(e),this.text=(e,t)=>{this.setState({value:e,scriptId:t},()=>{this.aceEditorRef.editor.setValue(e,1)})},this.executeSave=()=>{const e=new Ie("/api_v1/script_file"),t=this,a=this.getMessageBoxAceEditor();t.state.scriptId?e.request(ke,{id:t.state.scriptId,content:t.getAceEditor().getValue()},e=>{200!=e.status?e.json(e=>{t.appendLog(e.msg)},e=>{t.appendLog(e)}):t.appendLog("saved")},e=>{t.appendLog(e)}):a.setValue("no file are opened, cannot executeSave")},this.getAllText=()=>this.getAceEditor().getValue(),this.getSelection=()=>{let e=this.getAceEditor().getSelectionRange();return this.getAceEditor().session.getTextRange(e)},this.appendToEditor=e=>{const t=this.getAceEditor(),a=t.getCursorPosition();t.session.insert(a,e),t.focus()},this.getAceEditor=()=>this.aceEditorRef.editor,this.getMessageBoxAceEditor=()=>this.queryApp.messageBox.current.editor,this.appendLog=e=>{const t=this.getMessageBoxAceEditor().session;t.insert({row:t.getLength(),column:0},"\n"+e)},this.getDashBoard=()=>this.queryApp.dash.current,this.getDisplay=()=>this.queryApp.display.current,this.language=this.props.language||"sql",this.queryApp=this.props.parent.queryApp,this.state={value:"",loading:!1},this.executeQuery=this.executeQuery.bind(this),this.cancelQuery=this.cancelQuery.bind(this),this.logMonitor=new Vt(this.appendLog),this.log={}}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}onChange(e){}executeQuery(){var e=this;return Object(l.a)(c.a.mark((function t(){var a,n,r,s,o,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.commandGroup.setState({loading:!0}),e.jobName=Bt(),a=new m.ActionProxy,(n=e).getMessageBoxAceEditor().setValue(""),n.getDisplay().update(JSON.parse("[]")),r=n.getSelection(),s=n.getAllText(),""!==r&&(s=r),o=n.state.scriptId,e.logMonitor.queryLog(),t.next=13,a.runScript(s,e.jobName,{scriptId:o,runMode:"python",executeMode:"python"});case 13:if(200===(i=t.sent).status){t.next=19;break}return e.logMonitor.cancelQueryLog(),e.appendLog(i.content),e.commandGroup.setState({loading:!1}),t.abrupt("return");case 19:try{e.appendLog(i.content.join("\n"))}catch(c){e.appendLog(i.content.msg)}e.logMonitor.cancelQueryLog(),e.commandGroup.setState({loading:!1});case 22:case"end":return t.stop()}}),t)})))()}cancelQuery(){var e=this;return Object(l.a)(c.a.mark((function t(){var a,n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.jobName){t.next=2;break}return t.abrupt("return");case 2:return a=Bt(),n=new m.ActionProxy,t.next=6,n.runScript("!kill "+e.jobName+";",a,{});case 6:r=t.sent;try{e.appendLog(r.content[0].description)}catch(s){e.appendLog(r.content)}e.jobName=null,e.logMonitor.cancelQueryLog();case 10:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:e=>e.preventDefault(),onDrop:this.etOver},n.createElement(De.Resizable,{defaultSize:{height:"500px"},onResize:()=>{this.aceEditorRef.current.editor.resize()}},n.createElement(be.a,{ref:e=>this.aceEditorRef=e,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(Ut,{ref:e=>this.commandGroup=e,parent:this}))}}class Ut extends n.Component{constructor(e){super(e),this.onChange=e=>{this.setState({timeout:e})},this.state={loading:!1,timeout:"-1"},this.parent=e.parent}render(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(Q.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(Q.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(Q.a,{onClick:this.parent.executeSave},"Save"))}}var Jt=Gt;class Kt extends r.a.Component{constructor(e){super(e),this.addRef=e=>{e&&(this.editor=e)},this.text=(e,t)=>{this.editor.text(e,t)},this.queryApp=this.props.parent}componentDidMount(){this.props.parentCallback&&this.props.parentCallback(this)}render(){return r.a.createElement("div",null,r.a.createElement(Jt,{parent:this,ref:e=>this.addRef(e),language:"python"}))}}const Ht=tt.a.TabPane;class Wt extends n.Component{constructor(e){super(e),this.pushRef=e=>{this.myRefs.push(e)},this.getCurrentEditor=()=>{const e=this.state.activeKey;let t=null;return this.myRefs.forEach(a=>{a.activeKey===e&&(t=a)}),t},this.onChange=e=>{let t=null;this.state.panes.forEach(a=>{a.key===e&&(t=a)}),t&&!t.title.endsWith(".mlsql")?this.parent.setState({displayEditor:"normal"}):t&&!t.title.endsWith(".nb")?this.parent.setState({displayEditor:"notebook"}):this.parent.setState({displayEditor:"pythoneditor"}),this.setState({activeKey:e})},this.onEdit=(e,t)=>{this[t](e)},this.addFull=(e,t)=>{const a=this.state.panes,r="newTab".concat(this.newTabIndex++);a.push({title:e||"MLSQL "+this.newTabIndex,content:(a=>e.endsWith(".mlsql")?n.createElement(ze,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:a}),t&&t({ref:e,activeKey:a})},activeKey:a}):e.endsWith(".nb")?n.createElement(Mt,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:a}),t&&t({ref:e,activeKey:a})},activeKey:a}):e.endsWith(".py")?n.createElement(Kt,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:a}),t&&t({ref:e,activeKey:a})},activeKey:a}):void 0)(r),key:r}),this.setState({panes:a,activeKey:r})},this.add=()=>{this.addFull("MLSQL "+(this.newTabIndex+1),e=>{})},this.getPaneIndexByActiveKey=e=>{let t;return this.state.panes.forEach((a,n)=>{a.key===e&&(t=n-1)}),t},this.remove=e=>{let t=this.state.activeKey,a=this.getPaneIndexByActiveKey(e);const n=this.state.panes.filter(t=>t.key!==e);n.length&&t===e&&(t=a>=0?n[a].key:n[0].key);const r=this.myRefs.filter(t=>t.activeKey===e);this.myRefs=this.myRefs.filter(t=>t.activeKey!==e),this.parent.closeEditor(r[0]),this.setState({panes:n,activeKey:t})},this.parent=e.parent,this.myRefs=[],this.newTabIndex=0;const t=[{title:"MLSQL 1",content:n.createElement(ze,{parent:this.parent,parentCallback:e=>{this.pushRef({ref:e,activeKey:"newTab0"})},activeKey:"newTab0"}),key:"newTab0"}];this.state={activeKey:t[0].key,panes:t},this.newTabIndex++}render(){return n.createElement(tt.a,{onChange:this.onChange,activeKey:this.state.activeKey,type:"editable-card",onEdit:this.onEdit},this.state.panes.map(e=>n.createElement(Ht,{tab:e.title,key:e.key,closable:e.closable},e.content)))}}var Qt=a(186),zt=a(99);const Yt=W.a.Group;class Xt extends n.Component{constructor(e){super(e),this.etPopLoad=e.parent,this.state={}}render(){return n.createElement("div",null,n.createElement("span",null,"parameters:"),n.createElement(Yt,{compact:!0},this.state.dataForRender))}}const $t=a(105);class Zt{}Zt.getTempTableName=()=>($t()+"").replace(/-/g,""),Zt.getJobName=()=>$t()+"",Zt.escapeQuote=e=>e?e.replace(/[\""]/g,'\\"'):e,Zt.quote=e=>e?'"'.concat(Zt.escapeQuote(e),'"'):e,Zt.unQuote=e=>e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,e.length-1):e.startsWith("'''")&&e.endsWith("'''")?e.slice(3,e.length-3):e,Zt.visitDown=(e,t)=>{t(e),e.children&&e.children.map(e=>{Zt.visitDown(e,t)})},Zt.visitUp=(e,t)=>{e.children&&e.children.map(e=>{Zt.visitUp(e,t)}),t(e)},Zt.robotFetchParam=()=>({queryType:"robot",fetchType:"take",includeSchema:!0}),Zt.robotFetchParamWithCollect=()=>({queryType:"robot",includeSchema:!0}),Zt.getField=e=>e.startsWith("`")&&e.endsWith("`")?e:"`".concat(e,"`"),Zt.distinct=(e,t)=>{if(!t)return[...new Set(e)];const a={};return e.filter(e=>!(e[t]in a)&&(a[e[t]]=e[t],!0))},Zt.fastCompareObject=(e,t)=>JSON.stringify(e)===JSON.stringify(t),Zt.deepCompareObject=(e,t)=>function e(t,a){var n;if(isNaN(t)&&isNaN(a)&&"number"===typeof t&&"number"===typeof a)return!0;if(t===a)return!0;if("function"===typeof t&&"function"===typeof a||t instanceof Date&&a instanceof Date||t instanceof RegExp&&a instanceof RegExp||t instanceof String&&a instanceof String||t instanceof Number&&a instanceof Number)return t.toString()===a.toString();if(!(t instanceof Object&&a instanceof Object))return!1;if(t.isPrototypeOf(a)||a.isPrototypeOf(t))return!1;if(t.constructor!==a.constructor)return!1;if(t.prototype!==a.prototype)return!1;if((void 0).indexOf(t)>-1||(void 0).indexOf(a)>-1)return!1;for(n in a){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof a[n]!==typeof t[n])return!1}for(n in t){if(a.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof a[n]!==typeof t[n])return!1;switch(typeof t[n]){case"object":case"function":if((void 0).push(t),(void 0).push(a),!e(t[n],a[n]))return!1;(void 0).pop(),(void 0).pop();break;default:if(t[n]!==a[n])return!1}}return!0}(e,t);const ea=W.a.Group,ta=_e.a.Option;class aa extends n.Component{constructor(e){var t;super(e),t=this,this.componentDidMount=Object(l.a)(c.a.mark((function e(){var a,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t,a=new m.ActionProxy,e.next=4,a.runScript("load _mlsql_.`datasources` as output;",Zt.getJobName(),Zt.robotFetchParamWithCollect());case 4:r=e.sent,s=Zt.distinct(r.content.data,"name"),o=[],s.forEach(e=>{o.push(n.createElement(ta,{key:e.name,value:e.name},e.name))}),t.setState({datasourcesRender:o});case 9:case"end":return e.stop()}}),e)}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.sourceType=(e,t)=>{this.data.sourceTypeV=e;const a=this;new Ie(Oe).runScript({},"load _mlsql_.`datasources/params/".concat(e,"` as output;"),e=>{const t=[];e.forEach(e=>{t.push(n.createElement(Qt.a,{key:"row-".concat(e.param)},n.createElement(zt.a,null,n.createElement(W.a,{key:"input-".concat(e.param),style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",addonBefore:e.param,placeholder:e.description}))))}),a.loadParamsRef.current.setState({dataForRender:t})},e=>{})},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.makeMLSQL=()=>{let e=[];for(let a in this.data.params){let t=this.data.params[a];if(t){let n='"'+t+'"';"code"!==a&&"fitParam.[group].code"!==a||(n="'''"+t+"'''"),e.push(a.replace(/\[group\]/g,"0")+"="+n)}}let t="";return e.length>0&&(t="where"),"load ".concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` ").concat(t," ").concat(e.join("and\\n ")," as ").concat(this.data.tableNameV,";")},this.etpop=e.parent,this.data={params:{}},this.state={datasourcesRender:[]},this.loadParamsRef=n.createRef()}render(){return n.createElement("div",null,n.createElement(ea,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,"soureType:",n.createElement(_e.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.datasourcesRender)))),n.createElement("br",null),this.props.ignorePath?n.createElement("div",null):n.createElement(ea,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{onChange:this.path,type:"text",label:"Path",addonBefore:"Path",placeholder:"File path or tableName"})))),n.createElement("br",null),this.props.ignoreTableName?n.createElement("div",null):n.createElement(ea,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"tableName"})))),n.createElement("br",null),n.createElement(Xt,{parent:this,ref:this.loadParamsRef}))}}const na=W.a.Group,ra=(_e.a.Option,W.a.TextArea);class sa extends n.Component{constructor(e){super(e),this.renderParam=e=>"keepVersion"===e.param&&"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(Qt.a,null,n.createElement(zt.a,null,e.param,":",n.createElement(ra,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",rows:10}))):n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",addonBefore:e.param,placeholder:e.description}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.makeMLSQL=()=>{let e=[];for(let t in this.data.params){let a=this.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+a+'"')}return 0==e.length&&e.push('keepVersion="true"'),"train ".concat(this.data.tableNameV," as ").concat(this.name,".`").concat(this.data.pathV,"` where \n").concat(e.join(" and\n "),";")},this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[]}}componentDidMount(){const e=this;new Ie(Oe).runScript({},"load modelParams.`".concat(e.name,"` as output;"),t=>{const a=[];t.forEach(e=>{const t=this.renderParam(e);null!==t&&(a.push(t),a.push(n.createElement("br",null)))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement("span",null,"Training data and model path:"),n.createElement(na,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:"tableName",placeholder:"the table of training data"})))),n.createElement("br",null),n.createElement(na,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{onChange:this.path,type:"text",size:"large",addonBefore:"Model save path",placeholder:"the location you save you model"})))),n.createElement("br",null),n.createElement("span",null,"Algorithm parameters:"),n.createElement(na,{compact:!0},this.state.dataForRender))}}const oa=W.a.Group,ia=_e.a.Option;class ca extends n.Component{constructor(e){super(e),this.sourceType=(e,t)=>{this.data.sourceTypeV=e},this.saveMode=(e,t)=>{this.data.saveModeV=e},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.partitionBy=e=>{this.data.partitionByV=e.target.value},this.fileNum=e=>{this.data.fileNumV=e.target.value},this.makeMLSQL=()=>{let e="";this.data.partitionByV&&(e="partitionBy "+this.data.partitionByV);let t='key="value"';return this.data.fileNumV&&(t='fileNum="'.concat(this.data.fileNumV,'"')),"save ".concat(this.data.saveModeV," ").concat(this.data.tableNameV," as ").concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` \n where ").concat(t," ").concat(e,";")},this.etpop=e.parent,this.data={},this.state={datasourcesRender:[]}}componentDidMount(){const e=this;new Ie(Oe).runScript({},"load _mlsql_.`datasources` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(ia,{key:e.name,value:e.name},e.name))}),e.setState({datasourcesRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(oa,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,"soureType:",n.createElement(_e.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.datasourcesRender)))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,"SaveMode:",n.createElement(_e.a,{onChange:this.saveMode,showSearch:!0,style:{width:200},placeholder:"Choose save mode type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ia,{key:"overwrite",value:"overwrite"},"overwrite"),n.createElement(ia,{key:"append",value:"append"},"append"),n.createElement(ia,{key:"errorIfExists",value:"errorIfExists"},"errorIfExists"),n.createElement(ia,{key:"ignore",value:"ignore"},"ignore"))))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"the tableName will be saved"})))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{onChange:this.path,type:"text",addonBefore:"Target Path",placeholder:"File path or tableName"})))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{type:"text",onChange:this.partitionBy,addonBefore:"partitionBy",placeholder:"partitionBy"})))),n.createElement("br",null),n.createElement(oa,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{type:"text",onChange:this.fileNum,addonBefore:"fileNum",placeholder:"fileNum"})))),n.createElement("br",null))}}const la=W.a.Group,ua=(_e.a.Option,W.a.TextArea);class pa extends n.Component{constructor(e){super(e),this.renderParam=e=>"keepVersion"===e.param||"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(Qt.a,null,n.createElement(zt.a,null,e.param,":",n.createElement(ua,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",rows:10}))):n.createElement(Qt.a,{key:e.param},n.createElement(zt.a,null,n.createElement(W.a,{style:{marginBottom:"10px"},name:e.param,onChange:this.params,type:"text",addonBefore:e.param,placeholder:e.description}))),this.params=e=>{this.data.params[e.target.getAttribute("name")]=e.target.value},this.path=e=>{this.data.pathV=e.target.value},this.tableName=e=>{this.data.tableNameV=e.target.value},this.outputTableName=e=>{this.data.outputTableNameV=e.target.value},this.showTableName=()=>"true"!==this.state.tableHidden?n.createElement(la,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:this.state.tableAlias?this.state.tableAlias:"Input table",placeholder:""})))):null,this.showOutputTableName=()=>"true"!==this.state.outputTableHidden?n.createElement(la,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{type:"text",onChange:this.outputTableName,size:"large",addonBefore:this.state.outputTableAlias?this.state.outputTableAlias:"Output table",placeholder:""})))):null,this.pathNameForRender=()=>this.state.pathAlias?this.state.pathAlias:"Save path",this.showPathName=()=>"true"!==this.state.pathHidden?n.createElement(la,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{onChange:this.path,type:"text",size:"large",addonBefore:this.pathNameForRender(),placeholder:""})))):"",this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden,outputTableHidden:e.outputTableHidden,outputTableAlias:e.outputTableAlias,tableAlias:e.tableAlias}}componentDidMount(){const e=this;new Ie(Oe).runScript({},"load modelParams.`".concat(e.name,"` as output;"),t=>{const a=[];t.forEach(e=>{const t=this.renderParam(e);null!==t&&(a.push(t),a.push(n.createElement("br",null)))}),e.setState({dataForRender:a})},e=>{})}_makeMLSQL(){let e=[];for(let n in this.data.params){let t=this.data.params[n],a='"'+t+'"';"code"!==n&&"fitParam.[group].code"!==n||(a="'''"+t+"'''"),e.push(n.replace(/\[group\]/g,"0")+"="+a)}let t="";e.length>0&&(t="where");let a="";return this.data.outputTableNameV&&(a="as ".concat(this.data.outputTableNameV)),"run ".concat(this.data.tableNameV||"command"," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(t," ").concat(e.join("and\n ")," ").concat(a,";")}_render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(la,{compact:!0},this.state.dataForRender))}}class da extends pa{constructor(e){super(e),this.makeMLSQL=()=>super._makeMLSQL()}render(){return super._render()}}const ma=W.a.Group;_e.a.Option;class ha extends da{constructor(...e){super(...e),this.makeMLSQL=()=>{let e=[];for(let t in this.data.params){let a=this.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+a+'"')}return 0==e.length&&e.push('keepVersion="true"'),"run command as ".concat(this.name,".`` where \n").concat(e.join(" and\n "),";")}}render(){return n.createElement("div",null,n.createElement(ma,{compact:!0},this.state.dataForRender))}}a(1044),a(1045),a(1046);var fa=a(527),ba=a.n(fa);const ga=_e.a.Option,Ea=W.a.TextArea;class ya extends n.Component{constructor(e){super(e),this.udfName=e=>{this.data.udfNameV=e.target.value},this.dataType=e=>{this.data.dataTypeV=e.target.value},this.udfType=e=>{this.udfTypeV=e},this.code=e=>{this.codeV=e},this.langSelect=e=>{this.lang=e,this.codeCheckRef.current.checked=!1,this.setState({dataType:!1}),"python"===this.lang&&this.setState({dataType:!0}),this.setState({codeLang:e})},this.setCodeExample=e=>{e?this.codeRef.current.editor.setValue(this.codeExample()):this.codeRef.current.editor.setValue("")},this.codeExample=()=>{const e=this.state.codeLang||"scala";return"scala"===e?"def apply(a:Double,b:Double)={\n   a + b\n}":"python"===e?"def apply(self,m):\n    return m":"java"===e?"import java.util.HashMap;\nimport java.util.Map;\npublic class UDF {\n  public Map<String, Integer[]> apply(String s) {\n    Map<String, Integer[]> m = new HashMap<>();\n    Integer[] arr = {1};\n    m.put(s, arr);\n    return m;\n  }\n}":null},this.showDataType=()=>this.state.dataType?n.createElement(Qt.a,null,n.createElement(zt.a,null,"dataType:",n.createElement(Ea,{style:{marginBottom:"10px"},name:"dataType",rows:10,onChange:this.dataType,type:"text",addonBefore:"dataType",placeholder:"This is not required when lang is scala\nAs we know python is not strongly typed language, so\nwe should manually spcify the return type.\nmap(string,string) means a map with key is string type,value also is string type.\narray(string) means a array with string type element.\nnested is support e.g. array(array(map(string,array(string))))\n\n"}))):null,this.showCode=()=>n.createElement("div",null,n.createElement(Qt.a,null,n.createElement(zt.a,null,"code:",n.createElement(be.a,{ref:this.codeRef,mode:this.state.codeLang||"scala",theme:"github",width:"400px",height:"300px",name:"code",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,onChange:this.code,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}}))),n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(zt.a,{span:8},"Show CodeExample:",n.createElement(ba.a,{ref:this.codeCheckRef,onChange:this.setCodeExample}))))),this.makeMLSQL=()=>{let e=[];return e.push('lang="'.concat(this.lang,'"')),e.push("code='''".concat(this.codeV,"'''")),e.push('udfType="'.concat(this.udfTypeV,'"')),this.dataTypeV&&e.push("dataType='''".concat(this.dataTypeV,"'''")),"register ScriptUDF.`` as ".concat(this.data.udfNameV," where \n").concat(e.join("\nand "),";")},this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[]},this.codeRef=n.createRef(),this.codeCheckRef=n.createRef()}componentDidMount(){}render(){return n.createElement("div",null,n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{onChange:this.udfName,type:"text",size:"large",addonBefore:"UDF Name",placeholder:"the name of udf"}))),n.createElement("br",null),n.createElement(Qt.a,null,n.createElement(zt.a,{span:4},n.createElement("span",null,"udfType:")),n.createElement(zt.a,{span:20},n.createElement(_e.a,{showSearch:!0,onChange:this.udfType,style:{width:200},placeholder:"Select udf type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ga,{value:"udf"},"udf"),n.createElement(ga,{value:"udaf"},"udaf")))),n.createElement("br",null),n.createElement(Qt.a,null,n.createElement(zt.a,{span:4},n.createElement("span",null,"Lang:")),n.createElement(zt.a,{span:20},n.createElement(_e.a,{showSearch:!0,style:{width:200},placeholder:"Select language type",optionFilterProp:"children",onChange:this.langSelect,filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(ga,{value:"java"},"java"),n.createElement(ga,{value:"scala"},"scala"),n.createElement(ga,{value:"python"},"python")))),n.createElement("br",null),this.showDataType(),n.createElement("br",null),this.showCode(),n.createElement("br",null),n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{style:{marginBottom:"10px"},name:"methodName",onChange:this.params,type:"text",addonBefore:"methodName",placeholder:"methodName"}))))}}W.a.Group;const va=_e.a.Option;class wa extends n.Component{constructor(e){super(e),this.etName=e=>{this.etName=e},this.makeMLSQL=()=>"load modelExample.`".concat(this.etName,"` as output;"),this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden}}componentDidMount(){const e=this;new Ie(Oe).runScript({},"load model.`list` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(va,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(Qt.a,null,n.createElement(zt.a,null,"ET:",n.createElement(_e.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}W.a.Group;const ka=_e.a.Option;class xa extends da{constructor(...e){super(...e),this.makeMLSQL=()=>"register ".concat(this.data.sourceTypeV,".`").concat(this.data.pathV,"` as ").concat(this.data.outputTableNameV,";"),this.etName=e=>{this.data.sourceTypeV=e}}componentDidMount(){const e=this;new Ie(Oe).runScript({},"load model.`list` as output;",t=>{const a=[];t.forEach(e=>{a.push(n.createElement(ka,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(Qt.a,null,n.createElement(zt.a,null,"ET:",n.createElement(_e.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}const Sa=W.a.Group;class Oa extends pa{constructor(e){super(e),this.makeMLSQL=()=>{let e="";this.data.outputTableNameV&&(e="as ".concat(this.data.outputTableNameV));const t=super._makeMLSQL().replace(e,""),a="predict ".concat(this.data.tableNameV," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(e,";");return"".concat(t,"\n        ").concat(a,"\n        register ").concat(this.name,".`").concat(this.data.pathV||"","` as ").concat(this.data.functionNameV,"; \n        ").stripMargin()},this.functionName=e=>{this.data.functionNameV=e.target.value}}render(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(Sa,{compact:!0},n.createElement(Qt.a,null,n.createElement(zt.a,null,n.createElement(W.a,{onChange:this.functionName,type:"text",size:"large",addonBefore:"functionName",placeholder:"A function you can use to convert String to number or number to String"})))),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(Sa,{compact:!0},this.state.dataForRender))}}class Ca extends pa{constructor(e){super(e),this.makeMLSQL=()=>{const e="/api_v1/public/file/download?fileName=".concat(encodeURIComponent(this.data.pathV)),t=document.createElement("a");return t.href=e,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),""}}componentDidMount(){}render(){return super._render()}}W.a.Group;const ja=_e.a.Option;class Ta extends n.Component{constructor(e){super(e),this.etName=e=>{this.etName=e},this.makeMLSQL=()=>"load _mlsql_.`progress/".concat(this.etName,"` as output;"),this.etpop=e.parent,this.name=e.name,this.data={params:{}},this.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden}}componentDidMount(){const e=this;new Ie(Oe).runScript({},"load _mlsql_.`jobs` as output;",t=>{const a=t.filter(e=>"stream"===e.jobType).map(e=>n.createElement(ja,{key:e.jobName,value:e.jobName},e.jobName));e.setState({dataForRender:a})},e=>{})}render(){return n.createElement("div",null,n.createElement(Qt.a,null,n.createElement(zt.a,null,"Stream Jobs:",n.createElement(_e.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose Stream Name",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.dataForRender))))}}class Na extends n.Component{constructor(e){super(e),this.disableEtModalVisible=()=>{this.et.setState({etPop:!1,etModalVisible:!1})},this.enableEtModalVisible=()=>{const e=this.popChild.current.makeMLSQL();this.et.makeMLSQL(e),this.et.setState({etPop:!1,etModalVisible:!1})},this.renderContent=()=>"load"===this.et.state.eventName?n.createElement(aa,{parent:this,ref:this.popChild}):"save"===this.et.state.eventName?n.createElement(ca,{name:this.et.state.eventName,ref:this.popChild}):"DownloadExt"===this.et.state.eventName?n.createElement(ha,{name:this.et.state.eventName,ref:this.popChild}):"StringIndex"===this.et.state.eventName?n.createElement(Oa,{name:this.et.state.eventName,ref:this.popChild}):"DownloadFile"===this.et.state.eventName?n.createElement(Ca,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):"ETExample"===this.et.state.eventName?n.createElement(wa,{name:this.et.state.eventName,ref:this.popChild}):"ETStreamProgress"===this.et.state.eventName?n.createElement(Ta,{name:this.et.state.eventName,ref:this.popChild}):"ScriptUDF"===this.et.state.eventName?n.createElement(ya,{name:this.et.state.eventName,ref:this.popChild}):"register"===this.et.state.eventName?n.createElement(xa,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):"tool"===this.et.state.processType?n.createElement(da,Object.assign({name:this.et.state.eventName,ref:this.popChild},this.et.state)):n.createElement(sa,{name:this.et.state.eventName,ref:this.popChild}),this.et=e.parent,this.popChild=n.createRef(),this.state={etModalVisible:!0,title:e.title},this.data={}}render(){return n.createElement("div",null,n.createElement(V.a,{title:this.state.title,visible:this.state.etModalVisible,onCancel:this.disableEtModalVisible,onOk:this.enableEtModalVisible,okText:"Ok",cancelText:"Cancel"},this.renderContent()))}}var Ia=a(44),Ra=a.n(Ia);const _a=et.a.Panel;tt.a.TabPane;class Da extends n.Component{constructor(e){super(e),this.setData=(e,t)=>{this.itemData[e]=t},this.getData=e=>this.itemData[e],this.onDragStart=e=>{const t=e.target.getAttribute("processtype");this.setData("eventName",e.target.getAttribute("name")),this.setData("popName",e.target.getAttribute("help")),this.setData("processType",t),this.setData("pathAlias",e.target.getAttribute("pathalias")||""),this.setData("outputTableAlias",e.target.getAttribute("outputtablealias")||""),this.setData("tableAlias",e.target.getAttribute("tablealias")||""),this.setData("tableHidden",e.target.getAttribute("tablehidden")||!1),this.setData("pathHidden",e.target.getAttribute("pathhidden")||!1),this.setData("outputTableHidden",e.target.getAttribute("outputtablehidden")||!1)},this.makeMLSQL=e=>{this.queryApp.getCurrentEditor().ref.appendToEditor(e)},this.renderPop=()=>this.state.etPop?n.createElement(Na,{parent:this,title:this.state.popName}):null,this.etDoubleClick=e=>{this.onDragStart(e),this.queryApp.getCurrentEditor().ref.etOver(e)},this.queryApp=e.parent,this.state={},this.itemData={}}componentDidMount(){}render(){return n.createElement("div",null,n.createElement(et.a,{style:{margin:"0px 0px",padding:"0px 0px"}},n.createElement(_a,{header:"Quick Menu",key:"1"},n.createElement(Qt.a,{gutter:16},n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Load/Save Data"},n.createElement(Ra.a,{tyle:{marginBottom:"10px"},title:"Load/Save Data",onDragStart:this.onDragStart,name:"load",help:"Load file/db as table",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Load data"),n.createElement(Ra.a,{tyle:{marginBottom:"10px"},title:"Save Data",onDragStart:this.onDragStart,name:"save",help:"Save table into file/db ",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Save data"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Algorithms"},n.createElement(Ra.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"TfIdfInPlace",help:"Use TfIdfInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"TfIdf"),n.createElement(Ra.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Word2VecInPlace",help:"Use Word2VecInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Word2vec"),n.createElement(Ra.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RandomForest",help:"Use RandomForest to train a model",draggable:!0,color:"magenta"},"RandomForest"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonAlg",help:"Run python lib to train",draggable:!0,color:"magenta"},"Python Algorithm"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"BigDLClassifyExt",help:"Use BigDL to develop deep learning algorithm",draggable:!0,color:"magenta"},"Deep Learning"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"NaiveBayes",help:"Use NaiveBayes",draggable:!0,color:"magenta"},"NaiveBayes"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Python"},n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonEnvExt",processtype:"tool",help:"Create Python Env",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Create Python Env"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonParallelExt",processtype:"tool",help:"Run python project",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Run python project")))),n.createElement("br",null),n.createElement(Qt.a,{gutter:16},n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Register model as Function"},n.createElement(Ra.a,{onDragStart:this.onDragStart,name:"ScriptUDF",processtype:"tool",onDoubleClick:this.etDoubleClick,help:"Use ScriptUDF create udf",draggable:!0,color:"magenta"},"Create UDF"),n.createElement(Ra.a,{onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"register",help:"Register model to function ",pathalias:"Model saved path",outputtablealias:"Function name",tablealias:"Function name",tablehidden:"true",pathhidden:"false",outputtablehidden:"false",draggable:!0,color:"magenta"},"Register Model As Function"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Jobs"},n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"JobList",onDoubleClick:this.etDoubleClick,processtype:"direct",draggable:!0,color:"magenta"},"Show jobs"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Kill",onDoubleClick:this.etDoubleClick,processtype:"tool",pathalias:"groupId or jobName",tablehidden:"true",help:"Kill your job",draggable:!0,color:"magenta"},"Kill job"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETStreamProgress",processtype:"",help:"Show Progress of Stream",draggable:!0,color:"magenta"},"Show Stream Job Progress"))),n.createElement(zt.a,{span:8},n.createElement(K.a,{title:"Tools"},n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadExt",processtype:"tool",help:"Use DownloadExt to download files you have uploaded",draggable:!0,color:"magenta"},"Download uploaded file"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ImageLoaderExt",processtype:"tool",help:"Use ImageLoaderExt to load images",pathalias:"",tablehidden:"true",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Load images"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ConnectMySQL",processtype:"direct",help:"",draggable:!0,color:"magenta"},"Connect MySQL"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"JDBC",processtype:"tool",pathalias:"DB name in connect",tablehidden:"false",help:"Run DLL on MySQL",draggable:!0,color:"magenta"},"MySQL DDL"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"TreeBuildExt",processtype:"tool",pathalias:"",tablehidden:"false",pathhidden:"true",help:"Build tree from parent-child",draggable:!0,color:"magenta"},"Parent-Child"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETExample",processtype:"",help:"Show Example of ET",draggable:!0,color:"magenta"},"Show ET Example"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RepartitionExt",processtype:"tool",help:"Change Table Partition Num",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Repartition table"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"SendMessage",processtype:"tool",help:"Send email",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Send Mail"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"CacheExt",processtype:"tool",help:"Cache table",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Cache Table"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"StringIndex",processtype:"tool",help:"Convert String to number",pathalias:"Mapping path",tablehidden:"false",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Convert String to number"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadFile",processtype:"tool",help:"Download File",pathalias:"Target file",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Download File to computer"),n.createElement(Ra.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ShowResource",processtype:"direct",draggable:!0,color:"magenta"},"Cluster Resource")))))),this.renderPop())}}var Aa=a(1153),Pa=a(259),Fa=a(494);const La=Aa.a.TreeNode,Ma=Aa.a.DirectoryTree;class qa extends n.Component{constructor(e){super(e),this.state={dbs:{},loading:!1}}reload(){var e=this;return Object(l.a)(c.a.mark((function t(){var a,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.next=3,Le.tablesInDeltaLake();case 3:200===(a=t.sent).status&&(n={},a.content.forEach(e=>{n[e.database]?n[e.database].push(e.table):n[e.database]=[e.table]}),e.setState({dbs:n})),e.setState({loading:!1});case 6:case"end":return t.stop()}}),t)})))()}show(){return Object.entries(this.state.dbs).map(([e,t])=>n.createElement(La,{title:e,key:e},t.map(t=>n.createElement(La,{icon:n.createElement(Fa.a,null),title:t,key:"".concat(e,".").concat(t),isLeaf:!0}))))}componentDidMount(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return n.createElement(Pa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Ma,null,this.show()))}}const Va=Aa.a.TreeNode,Ba=Aa.a.DirectoryTree;class Ga extends n.Component{constructor(e){var t;super(e),t=this,this.getFileList=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.ls(a);case 2:if(200!==(n=e.sent).status||n.content[0]._corrupt_record){e.next=6;break}return r=n.content.map(e=>(e.is_dir=t.isDir(e),e.key=e.path,e.title=e.path.split("/").slice(-1)[0],e.isLeaf=!e.is_dir,e)),e.abrupt("return",r);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isDir=e=>e.permission.startsWith("d"),this.onLoadData=function(){var e=Object(l.a)(c.a.mark((function e(a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getFileList(a.props.dataRef.path);case 2:a.props.dataRef.children=e.sent,t.setState({root:[...t.state.root]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.renderTreeNodes=e=>e.map(e=>e.children?n.createElement(Va,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e},this.renderTreeNodes(e.children)):n.createElement(Va,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e})),this.state={root:[],loading:!1}}reload(){var e=this;return Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.next=3,e.getFileList("/");case 3:a=t.sent,e.setState({loading:!1,root:a});case 5:case"end":return t.stop()}}),t)})))()}componentDidMount(){var e=this;return Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reload();case 2:case"end":return t.stop()}}),t)})))()}render(){return n.createElement("div",null,n.createElement(Pa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Ba,{loadData:this.onLoadData},this.renderTreeNodes(this.state.root))))}}a(454);var Ua=a(488),Ja=a(486),Ka=a(484),Ha=a(485);const Wa=a(75),Qa={setState:Wa.SetStateActionHandler},za={setState:Wa.SetStateAction},Ya=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new m.ActionProxy,n=t.data,r=n.node,s=n.consoleApp,r.isDir){e.next=10;break}return e.next=5,a.get(h.default.SCRIPT_FILE_GET,{id:r.id});case 5:if(200===(o=e.sent).status){e.next=8;break}return e.abrupt("return",{data:{error:"Fail to get file ".concat(r.label,". Reason: ").concat(o.content)}});case 8:i=o.content,s.openExistsOrNewEditor({id:r.id,content:i.content,name:i.name});case 10:return e.abrupt("return",{data:{}});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Xa=Ya.handler,$a=Ya.action,Za=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i,l,u,p,d,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new m.ActionProxy,n=t.data,r=n.createType,n.consoleApp,s=n.form,o=n.scriptContent,i=void 0===o?"":o,l=s.getFieldValue(),u=l.fileName){e.next=5;break}return e.abrupt("return",{data:{createFileError:"Please input the file name"}});case 5:p=t.__state.node,d=!1,e.t0=r,e.next="file"===e.t0?10:"folder"===e.t0?14:16;break;case 10:if(d=!1,u.endsWith(".mlsql")||u.endsWith(".nb")||u.endsWith(".py")){e.next=13;break}return e.abrupt("return",{data:{createFileError:"fileName should end with .mlsql or .nb or .py"}});case 13:return e.abrupt("break",16);case 14:return d=!0,e.abrupt("break",16);case 16:return f={fileName:u,isDir:d,content:i,parentId:p.id},e.next=19,a.post(h.default.SAVE_SCRIPT_FILE,f);case 19:return e.sent,e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{reloading:Zt.getJobName()})});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),en=Za.handler,tn=Za.action,an=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.expandedKeys,n=t.__state.expandedKeys,r=a.filter(e=>!n.includes(e)),s=n.filter(e=>!a.includes(e)),o=new m.ActionProxy,r.forEach(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.forEach(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!1});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",{data:{expandedKeys:a}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),nn=an.handler,rn=an.action,sn=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.node,e.next=3,m.ActionProxy.client.post(h.default.SCRIPT_FILE_REMOVE,{id:a.id});case 3:return e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{reloading:Zt.getTempTableName()})});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),on=sn.handler,cn=sn.action;class ln{}ln.openScriptFile="openScriptFile",ln.createScriptFile="createScriptFile",ln.deleteScriptFile="deleteScriptFile",ln.expand="expand";const un=Object(y.a)(Object(y.a)({},Qa),{},{[ln.openScriptFile]:Xa,[ln.createScriptFile]:en,[ln.expand]:nn,[ln.deleteScriptFile]:on}),pn=Object(y.a)(Object(y.a)({},za),{},{[ln.openScriptFile]:$a,[ln.createScriptFile]:tn,[ln.expand]:rn,[ln.deleteScriptFile]:cn});function dn(e,t){return pn[t.type](e,t.data)}var mn=a(490),hn=a(487);a(1133);var fn=class{constructor(){this.build=e=>{let t,a,n={},r=[];for(a=0;a<e.length;a+=1)n[e[a].id]=a,e[a].childNodes=[];for(a=0;a<e.length;a+=1)if(t=e[a],0!==t.parentId)try{e[n[t.parentId]].childNodes.push(t)}catch(s){console.log("------------"),console.log(t),console.log(n[t.parentId])}else r.push(t);return r},this.convert=e=>(e.childNodes&&e.childNodes.length>0&&(e.children=e.childNodes,e.children.map(e=>this.convert(e))),e.id=String(e.id),e.key=e.id,e.title=r.a.createElement("span",null,e.label),e.isLeaf=!e.isDir,e.isDir?e.icon=r.a.createElement(mn.a,null):e.icon=r.a.createElement(hn.a,null),e)}};function bn(){const e=Object(re.a)(["\n  width: 100%; \n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 30px 30px;\n"]);return bn=function(){return e},e}const gn=se.a.div(bn());var En=function(){return r.a.createElement(gn,null,r.a.createElement(Pa.a,{tip:"Loading...."}))};const yn=({contextMenuRef:e,dispacher:t,onRender:a})=>{const s=Object(n.useState)(void 0),o=Object(u.a)(s,2),i=o[0],c=o[1];return{onRightClick:Object(n.useCallback)(t=>{const a=t.event,n=t.node;let r=a.clientX,s=a.clientY;const o=t=>{if(!e.current)return;!e.current.contains(t.target)&&c(void 0)};document.addEventListener("click",o);const i=()=>{c(void 0)};return document.addEventListener("scroll",i),c({pageX:r,pageY:s,id:n.id||n.key}),()=>{document.removeEventListener("click",o),document.removeEventListener("scroll",i)}},[c]),ui:Object(n.useCallback)(()=>{if(!i)return;const n=Object(y.a)({},i),s=n.pageX,o=n.pageY,l=(n.id,{zIndex:1e4,position:"fixed",left:"".concat(s,"px"),top:"".concat(o,"px"),borderRadius:"3px",boxShadow:"0 0 0 1px rgba(16, 22, 26, 0.1), 0 2px 4px rgba(16, 22, 26, 0.2), 0 8px 24px rgba(16, 22, 26, 0.2)"});return r.a.createElement("div",{ref:e,style:l},a({rightClickNodeTreeItem:i,setRightClickNodeTreeItem:c,dispacher:t}))},[i])}},vn=Aa.a.DirectoryTree,wn={nodes:[],error:void 0,createFileError:void 0,createType:void 0,createTitle:void 0,operateModal:!1,reloading:void 0,loading:!0,expandedKeys:[]},kn=r.a.createContext();function xn(e){const t=e.consoleApp,a=Object(p.useReducerAsync)(dn,wn,un),s=Object(u.a)(a,2),o=s[0],i=s[1],d=o.loading,f=o.nodes,b=o.error,g=o.createFileError,E=o.createType,y=o.operateModal,v=o.createTitle,w=o.reloading,k=o.expandedKeys,x=new m.ActionProxy,S=Object(n.useRef)(),O=H.a.useForm(),C=Object(u.a)(O,1)[0];Object(n.useEffect)(()=>{(function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get(h.default.SCRIPT_FILE_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=new fn,n=a.build(t.content).sort((e,t)=>e.id-t.id),r=n.map(e=>a.convert(e)),Zt.visitDown(r[0],e=>{e.isExpanded&&k.push(e.id)}),i({type:"setState",data:{nodes:r,loading:!1,expandedKeys:k}});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[w]);const j=yn({contextMenuRef:S,dispacher:i,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;let s=void 0;return Zt.visitDown(f[0],e=>{e.id===n&&(s=e)}),n===f[0].id?r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(Ua.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"folder",createTitle:"Create Project",operateModal:!0}})}},"Create Project")):s.isDir?r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(Ja.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"file",createTitle:"Create File",operateModal:!0}}),t(void 0)},key:1},"Create Script"),r.a.createElement(N.a.Item,{icon:r.a.createElement(Ua.a,null),onClick:()=>{a({type:"setState",data:{node:s,createType:"folder",createTitle:"Create Folder",operateModal:!0}}),t(void 0)},key:2},"Create Folder"),r.a.createElement(N.a.Item,{icon:r.a.createElement(Ka.a,null),onClick:()=>{a({type:ln.deleteScriptFile,data:{node:s}}),t(void 0)},key:3},"Delete")):r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{onClick:()=>{a({type:ln.deleteScriptFile,data:{node:s}}),t(void 0)},key:1},"Delete"))}}),T=j.onRightClick,I=j.ui;return r.a.createElement(kn.Provider,{value:{dispacher:i}},I(),r.a.createElement(Xe.a,{title:v,visible:y,onCancel:()=>{i({type:"setState",data:{operateModal:!1}})},onOk:()=>{i({type:ln.createScriptFile,data:{operateModal:!1,consoleApp:t,createType:E,form:C}})},cancelText:"Cancel",OkText:"Ok"},g&&r.a.createElement(ce,{message:g}),r.a.createElement(H.a,{form:C},r.a.createElement(H.a.Item,{name:"fileName",label:"File Name"},r.a.createElement(W.a,null)))),b&&r.a.createElement(ce,{message:b}),d&&r.a.createElement(En,null),!d&&r.a.createElement(vn,{height:700,onExpand:e=>{i({type:ln.expand,data:{expandedKeys:e}})},autoExpandParent:!0,expandedKeys:k,onDoubleClick:(e,a)=>{i({type:ln.openScriptFile,data:{consoleApp:t,node:a}})},expandAction:"click",onRightClick:T,switcherIcon:r.a.createElement(Ha.a,null),treeData:f}))}const Sn=tt.a.TabPane;class On extends n.Component{constructor(e){super(e),this.queryApp=e.parent}render(){return n.createElement(tt.a,{defaultActiveKey:"1",style:{maxWidth:"350px"},onTabClick:e=>{"2"===e&&this.deltaLakeTreeRef&&this.deltaLakeTreeRef.reload()}},n.createElement(Sn,{tab:"Script",key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(xn,{consoleApp:this.queryApp}))),n.createElement(Sn,{tab:"DeltaLake",key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(qa,{ref:e=>this.deltaLakeTreeRef=e}))),n.createElement(Sn,{tab:"FileSystem",key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Ga,{ref:e=>this.fileSystemTreeRef=e}))))}}a(455);class Cn extends n.Component{constructor(e){super(e),this.openExistsOrNewEditor=e=>{const t=this;if(this.fileToEditorMap.hasOwnProperty(e.id)){const t=this.fileToEditorMap[e.id];t.ref.text(e.content,e.id),this.editorGroup.current.onChange(t.activeKey)}else this.editorGroup.current.addFull(e.name,a=>{a.ref.text(e.content,e.id),t.fileToEditorMap[e.id]=a});e.name.endsWith(".nb")?t.setState({displayEditor:"notebook"}):e.name.endsWith(".py")?t.setState({displayEditor:"pythoneditor"}):t.setState({displayEditor:"normal"})},this.closeEditor=e=>{const t=Object.keys(this.fileToEditorMap).filter(t=>this.fileToEditorMap[t].activeKey!==e.activeKey).reduce((e,t)=>(e[t]=this.fileToEditorMap[t],e),{});this.fileToEditorMap=t},this.getCurrentEditor=()=>this.editorGroup.current.getCurrentEditor(),this.setData=e=>{this.queryResData=e,this.dash.current.refresh()},this.tableAndDash=()=>{if("notebook"!==this.state.displayEditor||"pythoneditor"!==this.state.displayEditor)return r.a.createElement("div",null,r.a.createElement(De.Resizable,{defaultSize:{height:"300px"},onResize:()=>{this.messageBox.current.editor.resize()}},r.a.createElement(be.a,{height:"100%",width:"100%",ref:this.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",null,r.a.createElement(jt,{ref:this.dash,parent:this})),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(Ze,{ref:this.display,parent:this})))},this.state={sqlContent:"",displayEditor:"normal"},this.editorGroup=r.a.createRef(),this.messageBox=r.a.createRef(),this.display=r.a.createRef(),this.dash=r.a.createRef(),this.etRef=r.a.createRef(),this.fileToEditorMap={}}render(){return r.a.createElement("div",{className:"ws-app"},r.a.createElement("div",{className:"ws-left-pane"},r.a.createElement(De.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},r.a.createElement(On,{ref:e=>this.leftTreePaneRef=e,parent:this}))),r.a.createElement("div",{className:"ws-right-pane"},r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(Da,{ref:this.etRef,parent:this})),r.a.createElement(Wt,{ref:this.editorGroup,parent:this}),this.tableAndDash()))}}var jn=Cn,Tn=a(1154);class Nn{constructor(e){this.superclass=e}with(...e){return e.reduce((e,t)=>t(e),this.superclass)}}var In=e=>new Nn(e);const Rn=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.toggleNewSession=()=>{this.setState({showNewSession:!this.state.showNewSession})},this.showNewSession=e=>{if(!e.node.props.table)return;const t={table:e.node.props.table,db:e.node.props.db};this.setState({showNewSession:!0,currentTable:t})},this.currentTableName=()=>this.state.currentTable?this.state.currentTable.db+"."+this.state.currentTable.table:"",this.showTable=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({showNewSession:!1}),n=t.state.currentTable,r=n.db,s=n.table,t.workshop.newSession(a,r,s);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},_n=(Aa.a.TreeNode,Aa.a.DirectoryTree);class Dn extends(In(Ga).with(Rn)){constructor(e){var t;super(e),t=this,this.showNewSession=e=>{const t={table:e.node.props.dataRef.path,db:""};this.setState({showNewSession:!0,currentTable:t})},this.showTable=function(){var e=Object(l.a)(c.a.mark((function e(a,n,r){var s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({showNewSession:!1}),s=t.state.currentTable,s.db,o=s.table,t.workshop.newSession(a,n,o,r);case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.render=()=>n.createElement("div",null,n.createElement(Xe.a,{title:"Open Table: [".concat(this.currentTableName(),"]?"),visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:()=>{this.showTable("file",this.loadPopRef.data.sourceTypeV,this.loadPopRef.data.params)},cancelText:"Cancel",OkText:"Ok"},n.createElement(aa,{key:this.currentTableName(),ignorePath:!0,ignoreTableName:!0,ref:e=>this.loadPopRef=e,parent:this})),n.createElement(Pa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(_n,{height:700,loadData:this.onLoadData,expandAction:"doubleClick",onRightClick:this.showNewSession},this.renderTreeNodes(this.state.root)))),this.workshop=e.parent.workshop}}const An=Aa.a.TreeNode,Pn=Aa.a.DirectoryTree;class Fn extends(In(qa).with(Rn)){constructor(e){super(e),this.tableClick=e=>{this.setState({rightClickNodeTreeItem:{pageX:e.event.pageX,pageY:e.event.pageY,table:e.node.props.table,db:e.node.props.db}})},this.workshop=e.parent.workshop}show(){return Object.entries(this.state.dbs).map(([e,t])=>n.createElement(An,{title:e,key:e},t.map(t=>n.createElement(An,{icon:n.createElement(Fa.a,null),title:t,table:t,db:e,key:"".concat(e,".").concat(t),isLeaf:!0}))))}render(){return n.createElement("div",null,n.createElement(Xe.a,{title:"Open Table",visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:()=>{this.showTable("delta")},cancelText:"Cancel",OkText:"Ok"},"Open  ".concat(this.currentTableName(),"]?")),n.createElement(Pa.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Pn,{onRightClick:this.showNewSession},this.show())))}}const Ln=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.tablesInWorkshop();case 2:if(200!==(a=e.sent).status){e.next=7;break}return n={},a.content.forEach(e=>{n[e.sessionId]?n[e.sessionId].push(e.tableName):n[e.sessionId]=[e.tableName]}),e.abrupt("return",{data:Object(y.a)({dbs:n},t.data)});case 7:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Mn=Ln.handler,qn=Ln.action,Vn=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.openTable,a.workshop.newSession("temp","",n),e.abrupt("return",{data:{}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Bn=Vn.handler,Gn=Vn.action,Un=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.id,n=new m.ActionProxy,e.next=4,n.get(h.default.ANALYSIS_TABLE_DELETE,{tableName:a});case 4:return e.abrupt("return",{data:{reloading:Zt.getJobName()}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Jn=Un.handler,Kn=Un.action,Hn=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i,l,u,p,d,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.targetPath,r=a.workshop,s=t.__state.exportTable,o=s.name,i=s.type,e.next=5,r.buildLoadSQL("temp","",o);case 5:l=e.sent,u=l.sql,p=l.tableName,d=e=>{h.runScript("\n             ".concat(u,"\n             save ignore ").concat(p," as ").concat(e,".`").concat(n,"`;\n            "),Zt.getJobName(),{async:!0})},h=new m.ActionProxy,e.t0=i,e.next="hive"===e.t0?13:"file"===e.t0?15:"delta"===e.t0?17:19;break;case 13:return d("hive"),e.abrupt("break",19);case 15:return d("parquet"),e.abrupt("break",19);case 17:return d("delta"),e.abrupt("break",19);case 19:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Wn=Hn.handler,Qn=Hn.action;class zn{}zn.LOAD="load",zn.OPEN="open",zn.DELETE="delete",zn.EXPORT_TO="exportTo";const Yn=Object(y.a)(Object(y.a)({},Qa),{},{[zn.LOAD]:Mn,[zn.OPEN]:Bn,[zn.DELETE]:Jn,[zn.EXPORT_TO]:Wn}),Xn=Object(y.a)(Object(y.a)({},za),{},{[zn.LOAD]:qn,[zn.OPEN]:Gn,[zn.DELETE]:Kn,[zn.EXPORT_TO]:Qn});function $n(e,t){return Xn[t.type](e,t.data)}var Zn=a(489),er=a(483),tr=a(482);const ar=Aa.a.TreeNode,nr=Aa.a.DirectoryTree,rr=N.a.SubMenu,sr={dbs:{},loading:!1,openTable:void 0,confirm:!1,reloading:void 0,exportTo:!1,exportTable:{name:void 0,type:void 0}},or=r.a.createContext();function ir(e){const t=e.workshop,a=e.reload,s=Object(p.useReducerAsync)($n,sr,Yn),o=Object(u.a)(s,2),i=o[0],c=o[1],l=i.dbs,d=i.loading,m=i.openTable,h=i.confirm,f=i.reloading,b=i.exportTo,g=i.exportTable,E=Object(n.useRef)(),y=H.a.useForm(),v=Object(u.a)(y,1)[0],w=yn({contextMenuRef:E,dispacher:c,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:a,dispacher:n})=>{const s=e.id;return r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(Zn.a,null),onClick:()=>{n({type:zn.OPEN,data:{openTable:s,workshop:t}}),n({type:"setState",data:{confirm:!1}}),a(void 0)},key:1},"Open Table"),r.a.createElement(rr,{icon:r.a.createElement(er.a,null),title:"Export"},r.a.createElement(N.a.Item,{icon:r.a.createElement(tr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"hive"},exportTo:!0,workshop:t}}),a(void 0)},key:1.1},"to Hive"),r.a.createElement(N.a.Item,{icon:r.a.createElement(tr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"delta"},exportTo:!0}}),a(void 0)},key:1.2},"to Delta"),r.a.createElement(N.a.Item,{icon:r.a.createElement(tr.a,null),onClick:()=>{n({type:"setState",data:{exportTable:{name:s,type:"file"},exportTo:!0}}),a(void 0)},key:1.3},"to FileSystem")),r.a.createElement(N.a.Item,{onClick:()=>{n({type:zn.DELETE,data:{id:s}}),a(void 0)},key:2,icon:r.a.createElement(Ka.a,null)},"Delete"))}}),k=w.onRightClick,x=w.ui;return Object(n.useEffect)(()=>{c({type:"setState",data:{loading:!0}}),c({type:zn.LOAD,data:{loading:!1}})},[f,a]),r.a.createElement(or.Provider,{value:{dispacher:c}},r.a.createElement(Xe.a,{title:"Export to ".concat(g.type),visible:b,onCancel:()=>{c({type:"setState",data:{exportTo:!1}})},onOk:()=>{const e=v.getFieldsValue().targetPath;v.resetFields(),c({type:zn.EXPORT_TO,data:{exportTo:!1,targetPath:e,workshop:t}})},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(H.a,{form:v},r.a.createElement(H.a.Item,{rules:[{required:!0,message:"Target is required."}],label:"Target",name:"targetPath"},r.a.createElement(W.a,null)))),r.a.createElement(Xe.a,{title:"Open Table",visible:h,onCancel:()=>{c({type:"setState",data:{confirm:!1}})},onOk:()=>{c({type:"dispatch",data:{openTable:m}})},cancelText:"Cancel",OkText:"Ok"},"Open ".concat(m,"?")),r.a.createElement(Pa.a,{tip:"Loading...",spinning:d},x(),r.a.createElement(nr,{height:700,onDoubleClick:(e,a)=>{c({type:zn.OPEN,data:{openTable:a.id,workshop:t}}),c({type:"setState",data:{confirm:!1}})},onRightClick:k},Object.entries(l).flatMap(([e,t])=>t.map(t=>r.a.createElement(ar,{icon:r.a.createElement(Fa.a,null),id:t,table:t,db:e,title:t,key:t,isLeaf:!0}))))))}const cr=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,r,s,o,i,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,r=a.dbName,a.node,s=new m.ActionProxy,r){e.next=9;break}return e.next=5,s.runScript('!profiler sql "show databases";',Zt.getJobName(),Zt.robotFetchParam());case 5:if(200!==(o=e.sent).status){e.next=9;break}return i=o.content.data.map(e=>(e.key=e.databaseName||e.namespace,e.title=e.key,e.isLeaf=!1,e.children=[],e)),e.abrupt("return",{data:Object(y.a)({dbs:i},t.data)});case 9:if(!r){e.next=20;break}return e.next=12,s.runScript('!profiler sql "use '.concat(r,'";'),Zt.getJobName(),Zt.robotFetchParam());case 12:return e.next=14,s.runScript('!profiler sql "show tables";',Zt.getJobName(),Zt.robotFetchParam());case 14:if(200!==(o=e.sent).status){e.next=20;break}return l=o.content.data.filter(e=>(e.database||e.namespace)===r).map(e=>(e.key="".concat(r,".").concat(e.tableName),e.title=e.tableName,e.isLeaf=!0,e.icon=n.createElement(Fa.a,null),e)),i=t.__state.dbs,u=i.map(e=>(e.key===r&&(e.children=l),e)),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{dbs:u})});case 20:return e.abrupt("return",{data:Object(y.a)({},t.data)});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),lr=cr.handler,ur=cr.action,pr=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i,l,p,d,m,h,f,b,g,E;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.openTable,r=a.workshop,s=a.partitionValues,o=a.partitionColumn,i=n.split("."),l=Object(u.a)(i,2),p=l[0],d=l[1],m=s.tableRandom,h=s.tableStart,f=s.tableEnd,b=o&&Zt.getField(o),o&&m?(g=b+" in ("+m.map(e=>'"'.concat(Zt.escapeQuote(e),'"')).join(",")+")",r.newSession("hive",p,d,{__where__:g})):o&&h&&f?(E="".concat(b," >= ").concat(Zt.quote(h)," and ").concat(Zt.quote(f)," >= ").concat(b,"  "),r.newSession("hive",p,d,{__where__:E})):r.newSession("hive",p,d),e.abrupt("return",{data:{}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),dr=pr.handler,mr=pr.action,hr=(e,t)=>e.map(e=>{const a=e.title.indexOf(t),n=e.title.substr(0,a),s=e.title.substr(a+t.length),o=a>-1?r.a.createElement("span",null,n,r.a.createElement("span",{className:"site-tree-search-value"},t),s):r.a.createElement("span",null,e.title);return e.children?Object(y.a)(Object(y.a)({},e),{},{title:o,children:hr(e.children,t)}):Object(y.a)(Object(y.a)({},e),{},{title:o})}),fr=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.dbs,n=t.data.searchValue){e.next=4;break}return e.abrupt("return",{data:{expandedKeys:[],search_dbs:a}});case 4:return r=[],s=a.flatMap(e=>{var t;const a=(null===(t=e.children)||void 0===t?void 0:t.map(t=>t.title.indexOf(n)>-1?e.key:null).filter(e=>e))||[];return e.title.indexOf(n)>-1&&r.push(e.key),a}),s=Zt.distinct(s),o=hr(a,n).filter(e=>s.includes(e.key)||r.includes(e.key)),e.abrupt("return",{data:{expandedKeys:s,search_dbs:o}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),br=fr.handler,gr=fr.action;class Er{}Er.LOAD="load",Er.OPEN="open",Er.SEARCH="search";const yr=Object(y.a)(Object(y.a)({},Qa),{},{[Er.LOAD]:lr,[Er.OPEN]:dr,[Er.SEARCH]:br}),vr=Object(y.a)(Object(y.a)({},za),{},{[Er.LOAD]:ur,[Er.OPEN]:mr,[Er.SEARCH]:gr});function wr(e,t){return vr[t.type](e,t.data)}Aa.a.TreeNode;const kr=Aa.a.DirectoryTree,xr={dbs:[],loading:!1,openTable:void 0,confirm:!1,reloading:void 0,expandedKeys:[]},Sr=r.a.createContext();function Or(e){const t=Oi.workshop,a=e.reload,s=Object(p.useReducerAsync)(wr,xr,yr),o=Object(u.a)(s,2),i=o[0],d=o[1],h=i.dbs,f=i.loading,b=i.openTable,g=i.confirm,E=i.reloading,y=i.search_dbs,v=i.expandedKeys,w=function(){const e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(!1),i=Object(u.a)(o,2),p=i[0],d=i[1],h=Object(n.useState)([]),f=Object(u.a)(h,2),b=f[0],g=f[1],E=Object(n.useState)(void 0),y=Object(u.a)(E,2),v=y[0],w=y[1],k=Object(n.useState)(void 0),x=Object(u.a)(k,2),S=x[0],O=x[1],C=Object(n.useState)(!1),j=Object(u.a)(C,2),T=j[0],N=j[1],_=H.a.useForm(),D=Object(u.a)(_,1)[0],A=new m.ActionProxy;Object(n.useEffect)(()=>{(function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,r,s,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return t=a.split("."),n=Object(u.a)(t,2),r=n[0],s=n[1],d(!0),e.next=6,A.runScript("!profiler sql 'show partitions ".concat(r,".").concat(s,"';"),Zt.getJobName(),Zt.robotFetchParam());case 6:200===(o=e.sent).status?(i=o.content.data.map(e=>{const t=e.partition.split("/")[0].split("="),a=Object(u.a)(t,2),n=a[0],r=a[1];return S||O(n),{column:n,value:r}}),g(i),N(!1),0===i.length&&N(!0)):(g([]),N(!0)),d(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[a]);const P=b.reverse().map(e=>r.a.createElement(_e.a.Option,{value:e.value},e.value));return{ui:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(Pa.a,{spinning:p},v&&r.a.createElement(I.a,{style:{marginBottom:"30px"},type:"error",message:v}),T&&r.a.createElement(B.a,{id:"no_partition_msg"}),!T&&r.a.createElement(H.a,{form:D},r.a.createElement(H.a.Item,{name:"tableStart",label:r.a.createElement(B.a,{id:"table_start"})},r.a.createElement(_e.a,{showSearch:!0},P)),r.a.createElement(H.a.Item,{name:"tableEnd",label:r.a.createElement(B.a,{id:"table_end"})},r.a.createElement(_e.a,{showSearch:!0},P)),r.a.createElement(R.a,null),r.a.createElement(H.a.Item,{name:"tableRandom",label:r.a.createElement(B.a,{id:"table_random"})},r.a.createElement(_e.a,{mode:"tags"},P))))),form:D,setOpenTable:s,setError:w,partitionColumn:S,noPartition:T}}(),k=w.ui,x=w.form,S=w.setOpenTable,O=w.setError,C=w.partitionColumn,j=w.noPartition,T=Object(n.useRef)(),_=yn({contextMenuRef:T,dispacher:d,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;return console.log(n),r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(Zn.a,null),onClick:()=>{a({type:"setState",data:{confirm:!0,openTable:n}}),t(void 0)},key:1},"Open Table"))}}),D=_.onRightClick,A=_.ui;return Object(n.useEffect)(()=>{d({type:"setState",data:{loading:!0}}),d({type:Er.LOAD,data:{loading:!1}})},[E,a]),Object(n.useEffect)(()=>{S(b)},[S,b]),r.a.createElement(Sr.Provider,{value:{dispacher:d}},r.a.createElement(Xe.a,{title:r.a.createElement(B.a,{id:"analysis_range"}),visible:g,onCancel:()=>{d({type:"setState",data:{confirm:!1}}),x.resetFields()},onOk:()=>{const e=x.getFieldsValue();j||e.tableRandom||e.tableStart&&e.tableEnd?(d({type:Er.OPEN,data:{openTable:b,workshop:t,partitionValues:e,partitionColumn:C}}),d({type:"setState",data:{confirm:!1}}),x.resetFields()):O("Partitions is required.")},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(k,null)),r.a.createElement(Pa.a,{tip:"Loading...",spinning:f},A(),r.a.createElement(W.a,{style:{marginBottom:8},placeholder:"Search",onChange:e=>{d({type:Er.SEARCH,data:{searchValue:e.target.value}})}}),r.a.createElement(kr,{height:700,expandedKeys:v,treeData:y||h,loadData:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d({type:"setState",data:{loading:!0}}),d({type:Er.LOAD,data:{dbName:t.key,node:t,loading:!1}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),expandAction:"click",onExpand:e=>{d({type:"setState",data:{expandedKeys:e}})},onDoubleClick:(e,t)=>{t.isLeaf&&d({type:"setState",data:{confirm:!0,openTable:t.key}})},onRightClick:({event:e,node:t})=>{t.isLeaf&&D({event:e,node:t})}})))}const Cr=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i,l,p,d,f,b,g,E,v,w,k,x;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.partitionValues,r=a.openTable,s=a.partitionNumValue,o=a.workshop,i=r.split("."),l=Object(u.a)(i,2),p=l[0],d=l[1],f=n.partitionColumn,b=n.lowerBound,g=n.upperBound,E=new m.ActionProxy,e.next=6,E.get(h.default.DS_MYSQL_CONNECT,{name:p});case 6:return v=e.sent,w=Zt.getTempTableName(),k="",f&&(k='where partitionColumn="'.concat(f,'" \n        and lowerBound="').concat(b,'" \n        and upperBound="').concat(g,'"\n        and numPartitions="').concat(s,'"\n        ')),x="\n      ".concat(v.content.connect,"\n      load jdbc.`").concat(r,"` ").concat(k," as ").concat(w,";    \n    "),o.newSession("jdbc",p,d,{__sql__:x,__tableName__:w}),e.abrupt("return",{data:Object(y.a)({},t.data)});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),jr=Cr.handler,Tr=Cr.action;class Nr{}Nr.OPEN="open";const Ir=Object(y.a)(Object(y.a)({},Qa),{},{[Nr.OPEN]:jr}),Rr=Object(y.a)(Object(y.a)({},za),{},{[Nr.OPEN]:Tr});function _r(e,t){return Rr[t.type](e,t.data)}var Dr=a(1142),Ar=a(1157);function Pr(e){const t=Object(n.useState)(e.initialValue||10),a=Object(u.a)(t,2),s=a[0],o=a[1];return{ui:()=>r.a.createElement(Qt.a,null,r.a.createElement(zt.a,{span:12},r.a.createElement(Dr.a,{min:e.min||10,max:e.max||300,onChange:e=>{o(e)},value:s})),r.a.createElement(zt.a,{span:4},r.a.createElement(Ar.a,{min:e.min||10,max:e.max||300,style:{margin:"0 16px"},value:s,onChange:e=>{o(e)}}))),value:s}}const Fr=Aa.a.DirectoryTree,Lr={dbs:[],loading:!1,confirm:!1,openTable:void 0,error:void 0},Mr=r.a.createContext();function qr(){const e=Oi.workshop,t=Object(p.useReducerAsync)(_r,Lr,Ir),a=Object(u.a)(t,2),s=a[0],o=a[1],i=s.dbs,d=s.loading,f=s.confirm,b=s.openTable,g=(s.error,function(){const e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(!1),i=Object(u.a)(o,2),p=i[0],d=(i[1],Object(n.useState)([])),f=Object(u.a)(d,2),b=f[0],g=f[1],E=Object(n.useState)(void 0),v=Object(u.a)(E,2),w=v[0],k=v[1],x=Object(n.useState)(void 0),S=Object(u.a)(x,2),O=S[0],C=S[1],j=H.a.useForm(),T=Object(u.a)(j,1)[0],N=new m.ActionProxy,_=Pr({initialValue:10,min:2,max:100}),D=_.ui,A=_.value;Object(n.useEffect)(()=>{if(a){const e=a.split("."),t=Object(u.a)(e,2),n=t[0],r=(t[1],Zt.getTempTableName());(function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.runScript("                \n                load jdbc.`".concat(a,"` as ").concat(r,";\n                !desc ").concat(r,";\n               "),Zt.getJobName(),Object(y.a)(Object(y.a)({},Zt.robotFetchParam()),{},{__connect__:n}));case 2:200===(t=e.sent).status?g(t.content.data):g([]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}},[a]),Object(n.useEffect)(()=>{if(O){(function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.split("."),n=Object(u.a)(t,2),r=n[0],s=n[1],e.next=3,N.get(h.default.DS_MYSQL_COLUMN_INFO,{dbName:r,tableName:s,columnName:O});case 3:200===(o=e.sent).status&&T.setFieldsValue({lowerBound:o.content.min,upperBound:o.content.max});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}},[O,a]);const P=b.filter(e=>"string"!==e.data_type).map(e=>r.a.createElement(_e.a.Option,{value:e.col_name},e.col_name));return{ui:()=>0===P.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,{id:"no_mysql_parallel"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(Pa.a,{spinning:p},w&&r.a.createElement(I.a,{style:{marginBottom:"30px"},type:"error",message:w}),r.a.createElement(H.a,{form:T},r.a.createElement(H.a.Item,{name:"partitionColumn",label:r.a.createElement(B.a,{id:"partitionColumn"})},r.a.createElement(_e.a,{onChange:e=>{C(e)}},P)),r.a.createElement(H.a.Item,{name:"lowerBound",label:r.a.createElement(B.a,{id:"lowerBound"})},r.a.createElement(W.a,null)),r.a.createElement(R.a,null),r.a.createElement(H.a.Item,{name:"upperBound",label:r.a.createElement(B.a,{id:"upperBound"})},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,{name:"numPartitions",label:r.a.createElement(B.a,{id:"numPartitions"})},D())))),form:T,setOpenTable:s,setError:k,partitionNumValue:A}}()),E=g.ui,v=g.form,w=g.setOpenTable,k=g.setError,x=g.partitionNumValue,S=Object(n.useRef)(),O=yn({contextMenuRef:S,dispacher:o,onRender:({rightClickNodeTreeItem:e,setRightClickNodeTreeItem:t,dispacher:a})=>{const n=e.id;return r.a.createElement(N.a,null,r.a.createElement(N.a.Item,{icon:r.a.createElement(Zn.a,null),onClick:()=>{a({type:"setState",data:{confirm:!0,openTable:n}}),t(void 0)},key:1},"Open Table"))}}),C=O.onRightClick,j=O.ui;return Object(n.useEffect)(()=>{(function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o({type:"setState",data:{loading:!0}}),t=new m.ActionProxy,e.next=4,t.get(h.default.DS_MYSQL_DBS,{});case 4:200===(a=e.sent).status&&(n=a.content.data.map(e=>(e.key=e.name,e.title=e.name,e.isLeaf=!1,e.children=e.tables.map(t=>({id:"".concat(e.name,".").concat(t),key:"".concat(e.name,".").concat(t),title:t,isLeaf:!0,icon:r.a.createElement(Fa.a,null)})),e)),o({type:"setState",data:{dbs:n}})),o({type:"setState",data:{loading:!1}});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(()=>{w(b)},[b,w]),r.a.createElement("div",{className:"leftview-box"},r.a.createElement(Mr.Provider,{value:{dispacher:o}},r.a.createElement(Xe.a,{title:r.a.createElement(B.a,{id:"mysql_parallel"}),visible:f,onCancel:()=>{o({type:"setState",data:{confirm:!1}}),v.resetFields()},onOk:()=>{const t=v.getFieldsValue(),a=t.partitionColumn,n=t.lowerBound,r=t.upperBound;!a||n&&(r||!x)?(o({type:Nr.OPEN,data:{openTable:b,workshop:e,partitionValues:t,partitionNumValue:x}}),o({type:"setState",data:{confirm:!1}}),v.resetFields()):k("lowerBound/upperBound/partitionNumValue should not be empty.")},cancelText:"Cancel",OkText:"Ok"},r.a.createElement(E,null)),r.a.createElement(Pa.a,{tip:"Loading...",spinning:d},j(),r.a.createElement(Fr,{height:700,treeData:i,expandAction:"click",onDoubleClick:(e,t)=>{t.isLeaf&&o({type:"setState",data:{confirm:!0,openTable:t.key}})},onRightClick:({event:e,node:t})=>{t.isLeaf&&C({event:e,node:t})}}))))}const Vr=tt.a.TabPane;class Br extends n.Component{constructor(e){super(e),this.workshop=e.parent,this.state={reloaWorkshop:void 0}}render(){return n.createElement(tt.a,{defaultActiveKey:"1",onTabClick:e=>{"3"===e&&this.deltaLakeTreeRef&&this.deltaLakeTreeRef.reload(),"4"===e&&this.fileSystemTreeRef&&this.fileSystemTreeRef.reload()}},n.createElement(Vr,{tab:n.createElement(B.a,{id:"table_workshop"}),key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(ir,{reload:this.state.reloaWorkshop,workshop:this.workshop}))),n.createElement(Vr,{tab:n.createElement(B.a,{id:"hive"}),key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(Or,null))),n.createElement(Vr,{tab:n.createElement(B.a,{id:"delta_lake"}),key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Fn,{ref:e=>this.deltaLakeTreeRef=e,parent:this}))),n.createElement(Vr,{tab:n.createElement(B.a,{id:"file_system"}),key:"4"},n.createElement("div",{className:"leftview-box"},n.createElement(Dn,{ref:e=>this.fileSystemTreeRef=e,parent:this}))),n.createElement(Vr,{tab:n.createElement(B.a,{id:"mysql"}),key:"5"},n.createElement(qr,null)))}}a(105);const Gr=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.newSession=function(){var e=Object(l.a)(c.a.mark((function e(a,n,r,s){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.showTable(a,n,r,s),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.buildLoadSQL=function(){var e=Object(l.a)(c.a.mark((function e(t,a,n,r){var s,o,i,l,u,p,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=Zt.getTempTableName(),"".concat(a,"."),a||"",o="where ",r?"where "===(o+=Object.keys(r).filter(e=>"__where__"!==e&&"__sql__"!==e&&"__tableName__"!==e).map(e=>{const t=r[e];return"".concat(e.replace(/\[group\]/g,"0"),"='''").concat(t,"'''")}).join(" and "))&&(o=""):o="",i="load ".concat(t,".`").concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";"),"delta"===t&&(i="load delta.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";")),"jdbc"===t&&(i=r.__sql__||"load jdbc.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(s,";"),s=r.__tableName__||s),"temp"!==t){e.next=14;break}return e.next=11,Le.tableInfo(n);case 11:l=e.sent,u=l.content,i=200===u.status?"load parquet.`/__persisted__/".concat(u.tableName,"`  as ").concat(u.tableName,";\n                select * from ").concat(u.tableName," as ").concat(s,";"):"".concat(u.content," \n                select * from ").concat(u.tableName," as ").concat(s,";");case 14:return"file"===t&&(i="load ".concat(a,".`").concat(n,"` ").concat(o,"  as ").concat(s,";")),"hive"===t&&(p="where ",r&&r.__where__?p+=r.__where__:p="",d=Zt.getTempTableName(),i="load hive.`".concat(a,".").concat(n,"` ").concat(o," as ").concat(d,";"),i+="select * from ".concat(d," ").concat(p," as ").concat(s,";")),e.abrupt("return",{sql:i,tableName:s});case 17:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.showTable=function(){var e=Object(l.a)(c.a.mark((function e(a,n,r,s){var o,i,l,u,p,d,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.sqls=[],e.next=3,t.buildLoadSQL(a,n,r,s);case 3:return o=e.sent,i=o.tableName,l=o.sql,t.sqls.push({tableName:i,sql:l}),t.setState({loadingTable:!0}),e.next=10,t.client.runScript(l,Zt.getJobName(),Zt.robotFetchParam());case 10:if(u=e.sent,t.setState({loadingTable:!1}),200===u.status){e.next=15;break}return t.toggleMessage("Fail to load ".concat(i,": ").concat(u.content)),e.abrupt("return");case 15:p=u.content,d=p.schema,m=p.data,t.setCurrentTable("","",i,d,m),t.sessionId=Zt.getJobName(),t.setState({sessionId:t.sessionId});case 19:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),this.setCurrentTable=(e,t,a,n,r)=>{this.currentTable={prefix:e,db:t,table:a,schema:n,data:r},this.updateDisplay(r,n)}}},Ur=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.getLastApplyTable=()=>this.sqls[this.sqls.length-1],this.rollback=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r,s,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.sqls.length<2)){e.next=3;break}return t.toggleMessage("No apply to rollback."),e.abrupt("return");case 3:return t.sqls.pop(),n=t.sqls.pop(),e.next=7,t.client.get(h.default.APPLY_GET,{name:n.tableName});case 7:if(200!==(r=e.sent).status){e.next=14;break}return s=JSON.parse(r.content.response),o=s.data,i=s.schema,e.next=12,t.apply(Object(y.a)(Object(y.a)({},n),{},{_data:o,_schema:i}));case 12:e.next=16;break;case 14:return e.next=16,t.apply(n);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.runSQLAtCurrentTable=function(){var e=Object(l.a)(c.a.mark((function e(a,n){var r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sqls.map(e=>e.sql).join(""),e.next=3,t.client.runScript("".concat(r,"\n          ").concat(a),Zt.getJobName(),Object(y.a)(Object(y.a)({},Zt.robotFetchParam()),n));case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.apply=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r,s,o,i,l,u,p,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.tableName,r=a.sql,s=a._data,o=a._schema,t.sqls.push({tableName:n,sql:r}),!s||!o){e.next=5;break}return t.setCurrentTable("","",n,o,s),e.abrupt("return",200);case 5:return i=t.sqls.map(e=>e.sql).join(""),e.prev=6,e.next=9,t.client.runScript(i,Zt.getJobName(),Object(y.a)(Object(y.a)({},Zt.robotFetchParam()),{},{queryType:"analysis_workshop_apply_action",analysis_workshop_table_name:n,analysis_workshop_sql:JSON.stringify(t.sqls)}));case 9:if(200===(l=e.sent).status){e.next=14;break}return t.sqls.pop(),t.toggleMessage(l.content),e.abrupt("return",500);case 14:return u=l.content,p=u.data,d=u.schema,t.setCurrentTable("","",n,d,p),e.abrupt("return",200);case 19:return e.prev=19,e.t0=e.catch(6),t.toggleMessage("Execute job fail;(Job is killed)"),e.abrupt("return",500);case 23:case"end":return e.stop()}}),e,null,[[6,19]])})));return function(t){return e.apply(this,arguments)}}(),this.save=function(){var e=Object(l.a)(c.a.mark((function e(a,n){var r,s,o,i,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.sqls.length){e.next=3;break}return t.toggleMessage("Sorry, current session have no applies."),e.abrupt("return",500);case 3:if(r="select * from ".concat(t.getLastApplyTable().tableName," as ").concat(a,";"),t.sqls.push({tableName:a,sql:r}),s=t.sqls.map(e=>e.sql).join("\n"),o=Zt.getJobName(),i={status:5},!n){e.next=13;break}return l="".concat(s,"\n         save overwrite ").concat(a," as parquet.`/__persisted__/").concat(a,"`;"),e.next=12,t.client.runScript(l,o,{persistJobName:o,async:!0});case 12:i={jobName:o,status:1};case 13:return e.next=15,t.client.post(h.default.ANALYSIS_SAVE,Object.assign({tableName:a,sql:s,sessionId:t.sessionId,schema:JSON.stringify(t.currentTable.schema)},i));case 15:return u=e.sent,e.abrupt("return",u.status);case 17:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}};a(1063);var Jr=a(1143),Kr=a(1138);a(1064);N.a.SubMenu;class Hr extends n.Component{constructor(e){super(e),this.enter=()=>{this.setState({applyLoading:!0}),this.workshop.setState({tableLoading:!0})},this.exit=()=>{this.setState({applyLoading:!1}),this.workshop.setState({tableLoading:!1})},this.showSaveDiagram=()=>{this.toggle()},this.toggle=()=>{this.setState({saveDiagram:!this.state.saveDiagram})},this.handleTableInput=()=>{},this.handlePersit=()=>{},this.props=e,this.state={applyLoading:!1,saveDiagram:!1},this.workshop=e.parent.workshop}render(){return n.createElement("div",{style:this.props.style,className:this.props.className||"aos-box"},n.createElement(Xe.a,{title:"View",visible:this.state.saveDiagram,onCancel:this.toggle,onOk:this.props.onSave,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(H.a,{className:"login-form"},n.createElement(H.a.Item,null,n.createElement(W.a,{addonBefore:"tableName",onChange:this.props.handleTableInput||this.handleTableInput,placeholder:""})),n.createElement(H.a.Item,{label:"Persist table(take more space):"},n.createElement(Kr.a,{onChange:this.props.handlePersit||this.handlePersit})))),n.createElement("div",{className:"aos-button"},n.createElement(Q.a,{loading:this.state.applyLoading,onClick:this.props.onApply,type:"primary"},"Apply")),n.createElement("div",{className:"aos-button"},n.createElement(Q.a,{disabled:this.state.applyLoading,onClick:this.toggle,type:"primary"},"Save As")),n.createElement("div",{className:"aos-button"},n.createElement(Q.a,{disabled:this.state.applyLoading,onClick:this.props.onRollback},"Rollback")))}}const Wr=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.onSave=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.workshop.save(t.tableNameForSave,t.persistForSave);case 2:200===e.sent&&(t.workshop.refreshOperateStation(),t.workshop.refreshTableWorkshop());case 4:case"end":return e.stop()}}),e)}))),this.onRollback=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ApplyOrSaveRef.enter(),e.next=3,t.workshop.rollback();case 3:200===e.sent&&(t.workshop.refreshOperateStation(),t.workshop.refreshTableWorkshop()),t.ApplyOrSaveRef.exit();case 6:case"end":return e.stop()}}),e)}))),this.handleTableInput=e=>{this.tableNameForSave=e.target.value},this.handlePersit=e=>{this.persistForSave=e}}};a(456);const Qr=_e.a.Option;class zr extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(l.a)(c.a.mark((function e(){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.joinStation.joinInfo.currentTable.schema,e.next=3,Le.tableInfo(t.joinTable);case 3:200===(n=e.sent).status&&t.setState({currentTableFields:a.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.next=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,e),this.joinStation.next()},this.render=()=>n.createElement(H.a,{className:"login-form",onFinish:this.next},n.createElement(H.a.Item,{name:"leftField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(_e.a,{label:"Current Table",showSearch:!0,style:{width:200},placeholder:this.currentTable,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.currentTableFields.map(e=>n.createElement(Qr,{key:e.name,value:e.name},e.name)))),n.createElement(H.a.Item,{name:"rightField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(_e.a,{label:"Join Table",showSearch:!0,style:{width:200},placeholder:this.joinTable,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.joinTableFields.map(e=>n.createElement(Qr,{key:e.name,value:e.name},e.name)))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Next"))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.currentTable=this.joinStation.joinInfo.currentTable.table,this.joinTable=this.joinStation.joinInfo.joinTable,this.state={currentTableFields:[],joinTableFields:[]}}}var Yr=a(1152);class Xr extends n.Component{constructor(e){super(e),this.filterOption=(e,t)=>t.title.indexOf(e)>-1,this.handleChange=e=>{this.setState({targetKeys:e}),this.props.handleChange&&this.props.handleChange({targetKeys:e})},this.getSelectFields=()=>this.state.targetKeys||[],this.workshop=e.parent.workshop,this.state=this.wow(e)}wow(e){return{data:e.schemaFields.map(e=>({title:e.name,key:e.name})),targetKeys:[]}}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)))}render(){return n.createElement("div",{style:{marginBottom:"30px"}},n.createElement(Yr.a,{listStyle:{width:400,height:300},dataSource:this.state.data,showSearch:!0,filterOption:this.filterOption,targetKeys:this.state.targetKeys,onChange:this.handleChange,render:e=>e.title}))}}class $r extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(l.a)(c.a.mark((function e(){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.joinStation.joinInfo.currentTable.schema,e.next=3,Le.tableInfo(t.joinTable);case 3:200===(n=e.sent).status&&t.setState({currentTableFields:a.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.handleLeft=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,{leftProjectFields:e.targetKeys})},this.handleRight=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,{rightProjectFields:e.targetKeys})},this.reset=()=>{this.joinStation.parent.reload()},this.render=()=>n.createElement(H.a,{labelCol:{span:6}},n.createElement(H.a.Item,{name:"leftProjectFields",label:"currentTable"},n.createElement(Xr,{handleChange:this.handleLeft,schemaFields:this.state.currentTableFields,ref:e=>this.leftProjectFields=e,parent:this})),n.createElement(H.a.Item,{name:"rightProjectFields",label:this.joinTable+""},n.createElement(Xr,{handleChange:this.handleRight,schemaFields:this.state.joinTableFields,ref:e=>this.rightProjectFields=e,parent:this})),n.createElement(H.a.Item,null,n.createElement(H.a.Item,null," ",n.createElement(Q.a,{danger:!0},"Reset")))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.currentTable=this.joinStation.joinInfo.currentTable.table,this.joinTable=this.joinStation.joinInfo.joinTable,this.state={currentTableFields:[],joinTableFields:[]}}}const Zr=_e.a.Option;class es extends n.Component{constructor(e){var t;super(e),t=this,this.reload=Object(l.a)(c.a.mark((function e(){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.tablesInWorkshop();case 2:a=e.sent,n=[],200===a.status&&(n=a.content.map(e=>({name:e.tableName,value:e.tableName}))),t.setState({tables:n});case 6:case"end":return e.stop()}}),e)}))),this.componentDidMount=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.reload();case 2:case"end":return e.stop()}}),e)}))),this.next=e=>{this.joinStation.joinInfo=Object.assign(this.joinStation.joinInfo,e),this.joinStation.next()},this.render=()=>n.createElement(H.a,{className:"login-form",onFinish:this.next},n.createElement(H.a.Item,{name:"joinType",rules:[{required:!0,message:"Please select join type!"}]},n.createElement(_e.a,{showSearch:!0,style:{width:200},placeholder:"Select Join Type",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},n.createElement(Zr,{key:"inner",value:"inner join"},"Inner Join"),n.createElement(Zr,{key:"left",value:"left join"},"Left Join"),n.createElement(Zr,{key:"right",value:"right join"},"Right Join"),n.createElement(Zr,{key:"full",value:"full join"},"Full Join"))),n.createElement(H.a.Item,{name:"joinTable",rules:[{required:!0,message:"Please select join table!"}]},n.createElement(_e.a,{showSearch:!0,style:{width:200},placeholder:"Choose Join Table",optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.tables.map(e=>n.createElement(Zr,{key:e.name,value:e.value},e.name)))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Next"))),this.workshop=e.parent.workshop,this.joinStation=e.parent,this.state={tables:[]}}}function ts(){const e=Object(re.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\ntext-align: center;\npadding-top: 80px;\nwidth: 100%;\n"]);return ts=function(){return e},e}const as=Jr.a.Step,ns=se.a.div(ts());class rs extends(In(n.Component).with(Wr)){constructor(e){var t;super(e),t=this,this.onApply=Object(l.a)(c.a.mark((function e(){var a,n,r,s,o,i,l,u,p,d,m,h,f,b,g,E,y,v;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.workshop.currentTable.table,n=t.joinInfo,r=n.joinTable,s=n.joinType,o=n.leftField,i=n.rightField,l=n.leftProjectFields,u=n.rightProjectFields,l||u){e.next=5;break}return t.workshop.toggleMessage("Fields are not selected."),e.abrupt("return");case 5:return t.ApplyOrSaveRef.enter(),e.next=8,Le.tableInfo(r);case 8:return p=e.sent,d=p.content,m=l&&l.map(e=>"".concat(a,".`").concat(e,"`")).join(","),h=u&&u.map(e=>"".concat(r,".`").concat(e,"`")).join(","),f="".concat(a,".`").concat(o,"`"),b="".concat(r,".`").concat(i,"`"),g="".concat(s," ").concat(r," on ").concat(f," = ").concat(b),E="",m&&h&&(E=m+","+h),m&&!h&&(E=m),!m&&h&&(E=h),y=Zt.getTempTableName(),v="".concat(d.content," \n select ").concat(E," from ").concat(a," ").concat(g," as ").concat(y,";"),console.log(v),e.next=24,t.workshop.apply({tableName:y,sql:v});case 24:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 26:case"end":return e.stop()}}),e)}))),this.next=()=>{this.setState({currentStep:this.state.currentStep+1})},this.preview=()=>{this.setState({currentStep:this.state.currentStep-1})},this.workshop=e.parent.workshop,this.joinInfo={currentTable:this.workshop.currentTable},this.state={currentStep:0,steps:[n.createElement(es,{parent:this}),n.createElement(zr,{parent:this}),n.createElement($r,{parent:this})]}}render(){return n.createElement("div",{className:"join-app"},n.createElement("div",{className:"station-menu"},n.createElement(Hr,{parent:this,onRollback:this.onRollback,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}})),n.createElement("div",null,n.createElement(Jr.a,{current:this.state.currentStep},n.createElement(as,{key:0,title:"Table",description:"Choose the table you wanna join from workshop"}),n.createElement(as,{key:1,title:"Join Condition ",description:"Choose the join condition in both tables"}),n.createElement(as,{key:2,title:"Fields",description:"Choose the fields you want from both tables"}))),n.createElement("div",{className:"join-app-form"}," ",n.createElement(ns,null,this.state.steps[this.state.currentStep])))}}var ss=rs;const os=a(211);class is extends n.Component{constructor(e){super(e),this.setRender=(e,t)=>{const a=t[0][e.key];if(this.config&&this.config.render)Object.keys(this.config).map(t=>{const a=this.config[t][e.key];a&&(e[t]=a)});else{try{if(n.Component.isPrototypeOf(a.type))return void(e.render=e=>n.createElement("span",null,e))}catch(r){}"html"!=e.key?"object"!==typeof a?"array"!==typeof a?"boolean"!==typeof a?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=e=>n.createElement("pre",null,e.toString())):e.render=e=>n.createElement("span",null,e.toString()):e.render=e=>n.createElement("span",null,e.join(",").substring(0,300)):e.render=e=>n.createElement("span",null,JSON.stringify(e).substring(0,300)):e.render=e=>n.createElement("pre",null,e.substring(0,300))}},this.update=(e,t)=>{this.config=t;let a=[],n={},r=[];const s=this;e.forEach((function(t){for(let r in t)if(!n[r]){const t={title:r,dataIndex:r,key:r};s.setRender(t,e),a.push(t),n[r]=!0}})),e.forEach((function(e,t){let n={};a.forEach((function(t){n[t.key]=e[t.key]})),n.key=t,r.push(n)})),this.setState({columns:a,data:r})},this.rowDoubleClick=(e,t,a)=>{"codeExample"!==e.name&&"doc"!==e.name||this.setState({view:{enabled:!0,content:e.value}})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1}},this.config={},this.workshop=e.parent}render(){return n.createElement("div",{style:this.tableStyle},n.createElement(Ye.a,{pagination:{pageSize:3},size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement(Xe.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(os,{source:this.state.view.content||""})))}}const cs=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.enableGroupByField=(e,t)=>{const a=t.field;e?this.groupByFields.push(a):this.groupByFields=this.groupByFields.filter(e=>e.name!==a)},this.generateProjectField=(e,t)=>{this.aggFields.push({name:e,newName:t})},this.onApply=Object(l.a)(c.a.mark((function e(){var a,n,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.ApplyOrSaveRef.enter(),a=Zt.getTempTableName(),n=t.aggFields.map(e=>"".concat(e.name," as `").concat(e.newName,"`")),r="",0!==t.groupByFields.length&&(r="group by ".concat(t.groupByFields.map(e=>"`".concat(e,"`")).join(",")),n=t.groupByFields.map(e=>"`".concat(e,"`")).concat(n)),s="select ".concat(n.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," ").concat(r," as ").concat(a,";"),e.next=8,t.workshop.apply({tableName:a,sql:s});case 8:o=e.sent,t.ApplyOrSaveRef.exit(),200===o&&t.workshop.refreshOperateStation();case 11:case"end":return e.stop()}}),e)})))}};var ls=a(1156);_e.a.Option;class us extends n.Component{constructor(e){super(e),this.show=e=>{this.setState({func:e})},this.funcValue=()=>n.createElement(ls.b.Item,{key:"Func"},n.createElement(ls.b.Item.Meta,{title:"Func",description:this.state.func.funcValue.extra.zhDoc})),this.returnValue=()=>n.createElement(ls.b.Item,{key:"Return value"},n.createElement(ls.b.Item.Meta,{title:"Return value",description:this.state.func.returnValue.extra.zhDoc})),this.parameters=()=>this.state.func.params.map(e=>n.createElement(ls.b.Item,{key:e.name},n.createElement(ls.b.Item.Meta,{title:e.name,description:e.extra.zhDoc}))),this.state=Object(y.a)({},e)}render(){return this.state.func?n.createElement(ls.b,{size:"large",header:n.createElement("div",null,"Function [".concat(this.state.func.value,"] Info")),footer:n.createElement("div",null),bordered:!0},this.funcValue(),this.returnValue(),this.parameters()):n.createElement("div",null)}}const ps=_e.a.Option;class ds extends n.Component{constructor(e){var t;super(e),t=this,this.handleSearch=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=8;break}return e.next=3,Le.showFunctions();case 3:n=e.sent,r=n.content.map(e=>({value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)})),t.setState({data:r}),e.next=9;break;case 8:t.setState({data:[]});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleChange=e=>{const t=this.state.data.filter(t=>t.value===e)[0];this.setState({currentFunc:t}),this.funcDescRef.show(t)},this.handleOperateInput=e=>{this.manuallyTransform=e.target.value},this.isAggChecked=e=>{this.manuallyIsAgg=e},this.handleNewName=e=>{this.newFuncName=e.target.value},this.handleField=e=>{const t=e.target.getAttribute("name");this.funcParams[t]=e.target.value},this.showColumn=e=>(this.funcParams[e.name]=this.operateField,"yes"===e.extra.column?this.operateField:""),this.getTransform=()=>{if(this.manuallyTransform)return{field:this.operateField,isAgg:this.manuallyIsAgg,transformCode:this.manuallyTransform,columnName:this.newFuncName};const e=[];this.state.currentFunc.params.forEach(t=>{const a=this.funcParams[t.name];a&&("yes"===t.extra.column?e.push(Zt.getField(a)):"number"==t.dataType||"boolean"==t.dataType?e.push(a):e.push('"'.concat(a,'"')))});return{field:this.operateField,isAgg:"yes"===this.state.currentFunc.funcValue.extra.agg,transformCode:"".concat(this.state.currentFunc.value,"(").concat(e.join(","),")"),columnName:this.newFuncName}},this.reload=()=>{this.setState({key:Math.random(),data:[],value:void 0,funcPopUp:!1,currentFunc:void 0}),this.collect={}},this.parent=e.parent,this.operateField=e.operateField,this.funcParams={},this.state={data:[],value:void 0,funcPopUp:!1,func:{},key:Math.random()}}render(){const e=this.state.data.map(e=>n.createElement(ps,{key:e.value},e.text));return n.createElement(H.a,{className:"login-form",key:this.state.key},n.createElement(H.a.Item,null,n.createElement(_e.a,{showSearch:!0,value:this.state.value,placeholder:"Search function",defaultActiveFirstOption:!1,showArrow:!1,style:{width:"200px"},filterOption:!1,onSearch:this.handleSearch,onChange:this.handleChange,notFoundContent:"type function name"},e)),n.createElement(H.a.Item,null,n.createElement(us,{ref:e=>this.funcDescRef=e})),this.state.currentFunc?this.state.currentFunc.params.map(e=>n.createElement(H.a.Item,{key:e.name},n.createElement(W.a,{name:e.name,onChange:this.handleField,addonBefore:e.name,defaultValue:this.showColumn(e)}))):n.createElement("div",null),n.createElement(H.a.Item,null,n.createElement(W.a,{addonBefore:"Mannual Transform",onChange:this.handleOperateInput,placeholder:""})),n.createElement(H.a.Item,{label:"Is Agg Function"},n.createElement(Kr.a,{onChange:this.isAggChecked})),n.createElement(H.a.Item,null,n.createElement(W.a,{addonBefore:"New fieldName",onChange:this.handleNewName,placeholder:""})))}}N.a.SubMenu;class ms extends(In(n.Component).with(Wr,cs)){constructor(e){super(e),this.showAggFuncsAndApply=e=>{this.operateField=e.field,this.setState({funcPopUp:!0})},this.reload=()=>{const e=this.workshop.currentTable.schema.fields.map(e=>({field:e.name,groupby:"",agg:""})),t={render:{groupby:(e,t)=>n.createElement(Kr.a,{onChange:e=>this.enableGroupByField(e,t),dataref:t}),agg:(e,t)=>n.createElement(Q.a,{dataref:t,onClick:()=>{this.showAggFuncsAndApply(t)}},"Choose function")}};this.columnsRef.update(e,t)},this.handleFunc=()=>{const e=this.applyFuncToFieldRef.getTransform(),t=(e.field,e.transformCode),a=e.columnName;this.generateProjectField(t,a),this.setState({funcPopUp:!1}),this.applyFuncToFieldRef.reload()},this.workshop=e.parent.workshop,this.state={funcPopUp:!1},this.groupByFields=[],this.aggFields=[]}componentDidMount(){this.reload()}render(){return n.createElement("div",null,n.createElement("div",null,n.createElement(Xe.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:()=>{this.setState({funcPopUp:!1}),this.applyFuncToFieldRef.setState({key:Math.random()})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(ds,{parent:this,ref:e=>this.applyFuncToFieldRef=e,operateField:this.operateField})),n.createElement("div",{className:"station-menu"},n.createElement(Hr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}}))),n.createElement("div",null,n.createElement(is,{parent:this,ref:e=>this.columnsRef=e})))}}a(457);class hs extends n.Component{constructor(e){super(e),this.getSelectFields=()=>this.formRef.getFieldValue(),this.workshop=e.parent.workshop,this.state=this.wow(e)}wow(e){return{data:e.schemaFields.map(e=>({title:e.name,key:e.name})),targetKeys:[]}}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)))}render(){return n.createElement(H.a,{labelCol:{span:6},ref:e=>{this.formRef=e}},this.state.data.map(e=>n.createElement(H.a.Item,{key:e.key,name:e.key,label:e.key,value:e.key},n.createElement(W.a,{placeholder:"input the new name here"}))))}}class fs extends n.Component{constructor(e){super(e),this.wow=e=>({funcPopUp:!1,data:e.schemaFields.map(e=>({field:e.name,func:"",transformCode:"",columnName:""})),config:{render:{func:(e,t)=>n.createElement(Q.a,{dataref:t,onClick:()=>{this.showAggFuncsAndApply(t)}},"Choose function"),transformCode:(e,t)=>e,columnName:(e,t)=>e}}}),this.showAggFuncsAndApply=e=>{this.operateField=e.field,this.setState({funcPopUp:!0})},this.reload=()=>{this.columnsRef.update(this.state.data,this.state.config)},this.handleFunc=()=>{const e=this.applyFuncToFieldRef.getTransform(),t=e.field,a=e.transformCode,n=e.columnName,r=e.isAgg;if(!n)return void this.setState({error:"New fieldName is required."});const s=this.state.data.map(e=>e.field===t?{field:t,func:"",transformCode:a,columnName:n,isAgg:r}:e);this.setState({funcPopUp:!1,data:s,error:void 0},()=>{this.reload()}),this.applyFuncToFieldRef.reload()},this.getSelectFields=()=>this.state.data,this.render=()=>n.createElement("div",null,n.createElement(Xe.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:()=>{this.applyFuncToFieldRef.reload(),this.setState({funcPopUp:!1,error:void 0})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},this.state.error&&n.createElement(ce,{message:this.state.error}),n.createElement(ds,{parent:this,ref:e=>this.applyFuncToFieldRef=e,operateField:this.operateField})),n.createElement(is,{ref:e=>this.columnsRef=e})),this.workshop=e.parent.workshop,this.state=this.wow(e)}componentDidUpdate(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(y.a)({},this.wow(this.props)),()=>{this.reload()})}componentDidMount(){this.reload()}}const bs=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.onSelectApply=Object(l.a)(c.a.mark((function e(){var a,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),0!==(a=t.selectFieldsRef.getSelectFields().map(e=>"`".concat(e,"`"))).length){e.next=6;break}return t.workshop.showInfo("No fields are selected."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=Zt.getTempTableName(),r="select ".concat(a.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(n,";"),e.next=10,t.workshop.apply({tableName:n,sql:r});case 10:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 12:case"end":return e.stop()}}),e)}))),this.onFuncApply=Object(l.a)(c.a.mark((function e(){var a,n,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),0!==(a=t.functionFieldRef.getSelectFields()).length){e.next=6;break}return t.workshop.toggleMessage("No fields are renamed."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=a.filter(e=>e.isAgg).length>0,r=[],r=n?a.filter(e=>e.isAgg).map(e=>"".concat(e.transformCode," as `").concat(e.columnName,"`")):a.map(e=>e.transformCode?"".concat(e.transformCode," as `").concat(e.columnName,"`"):"`".concat(e.field,"` as `").concat(e.field,"`")),s=Zt.getTempTableName(),o="select ".concat(r.join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(s,";"),e.next=13,t.workshop.apply({tableName:s,sql:o});case 13:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 15:case"end":return e.stop()}}),e)}))),this.onRenameApply=Object(l.a)(c.a.mark((function e(){var a,n,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ApplyOrSaveRef.enter(),a=t.renameFieldsRef.getSelectFields(),n=t.workshop.currentTable.schema.fields.map(e=>"`".concat(e.name,"`")),0!==a.length){e.next=7;break}return t.workshop.toggleMessage("No fields are renamed."),t.ApplyOrSaveRef.exit(),e.abrupt("return");case 7:return r=Object.keys(a).map(e=>"`".concat(e,"` as `").concat(a[e],"`")),s=Zt.getTempTableName(),o="select ".concat(n.concat(r).join(",")," from ").concat(t.workshop.getLastApplyTable().tableName," as ").concat(s,";"),e.next=12,t.workshop.apply({tableName:s,sql:o});case 12:t.ApplyOrSaveRef.exit(),t.workshop.refreshOperateStation();case 14:case"end":return e.stop()}}),e)})))}},gs=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields,n=t.__state.operateFileds.filter(e=>a!==e.field),e.abrupt("return",{data:{operateFileds:n}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Es=gs.handler,ys=gs.action,vs=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields.map(e=>({field:e})),e.abrupt("return",{data:{operateFileds:a}});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ws=vs.handler,ks=vs.action;var xs=class{static apply(e,t,a){return Object(l.a)(c.a.mark((function n(){var r,s,o,i,l,u,p,d;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.data,s=r.workshop,o=r.values,i=e.__state.applySaveRollbackDispacher,!(l=t(o))){n.next=6;break}return i({type:"setState",data:{loading:!1}}),n.abrupt("return",{data:Object(y.a)(Object(y.a)({},e.data),{},{error:l,loading:!1})});case 6:return u=a(s,o),p=u.tableName,d=u.sql,n.next=9,s.apply({tableName:p,sql:d});case 9:return 200===n.sent&&s.refreshOperateStation(),i({type:"setState",data:{loading:!1}}),n.abrupt("return",{data:Object(y.a)(Object(y.a)({},e.data),{},{loading:!1})});case 13:case"end":return n.stop()}}),n)})))()}};const Ss=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xs.apply(t,e=>{if(0===Object.keys(e).length)return"Please configure cast fields then click apply"},(e,t)=>{const a=Zt.getTempTableName(),n=Object.keys(t).map(e=>"cast(".concat(Zt.getField(e)," as ").concat(t[e],") as ").concat(Zt.getField(e))),r=Object.keys(t),s=e.currentTable.schema.fields.filter(e=>!r.includes(e.name)).map(e=>Zt.getField(e.name)),o=n.concat(s).join(",");return{tableName:a,sql:"select ".concat(o," from ").concat(e.getLastApplyTable().tableName,"            \n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Os=Ss.handler,Cs=Ss.action;class js{}js.ADD_FIELD="addField",js.REMOVE_FIELD="removeField";const Ts=Object(y.a)(Object(y.a)({},Qa),{},{[js.ADD_FIELD]:ws,[js.REMOVE_FIELD]:Es,apply:Os}),Ns=Object(y.a)(Object(y.a)({},za),{},{[js.ADD_FIELD]:ks,[js.REMOVE_FIELD]:ys,apply:Cs});function Is(e,t){return Ns[t.type](e,t.data)}const Rs=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.workshop,e.next=3,a.rollback();case 3:return e.abrupt("return",{data:t.data});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_s=Rs.handler,Ds=Rs.action,As=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data.workshop,n=t.__state,r=n.saveTablePersisted,s=n.saveTableName){e.next=4;break}return e.abrupt("return",{data:{error:"table name is required"}});case 4:return e.next=6,a.save(s,r);case 6:return a.refreshTableWorkshop(),e.abrupt("return",{data:Object(y.a)(Object(y.a)({},t.data),{},{loading:!1})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ps=As.handler,Fs=As.action;const Ls={setState:O.SetStateActionHandler,rollback:_s,save:Ps};function Ms(e,t){switch(t.type){case"setState":return Object(O.SetStateAction)(e,t.data);case"rollback":return Ds(e,t.data);case"save":return Fs(e,t.data);default:return e}}const qs={saveDiagram:!1,saveTablePersisted:!1,loading:!1,saveTableName:void 0,error:void 0},Vs=r.a.createContext();function Bs(e){const t=e.workshop,a=Object(n.useContext)(e.context).dispacher,s=Object(p.useReducerAsync)(Ms,qs,Ls),o=Object(u.a)(s,2),i=o[0],c=o[1],l=i.saveDiagram,d=(i.saveTablePersisted,i.loading),m=i.error;return r.a.createElement(Vs.Provider,{value:{dispacher:c}},m&&r.a.createElement(ce,{message:m}),r.a.createElement(Xe.a,{title:"View",visible:l,onCancel:()=>{c({type:"setState",data:{saveDiagram:!1}})},onOk:()=>{c({type:"save",data:{saveDiagram:!1,workshop:t}})},cancelText:"Cancel",width:"50%",OkText:"Ok"},r.a.createElement(H.a,{className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(W.a,{addonBefore:"tableName",onChange:e=>{c({type:"setState",data:{saveTableName:e.target.value}})},placeholder:""})),r.a.createElement(H.a.Item,{label:"Persist table(take more space):"},r.a.createElement(Kr.a,{onChange:e=>{c({type:"setState",data:{saveTablePersisted:e}})}})))),r.a.createElement(Q.a,{loading:d,type:"primary",onClick:()=>{c({type:"setState",data:{loading:!0}}),a({type:"setState",data:{applySaveRollbackDispacher:c,applyToken:Zt.getJobName()}})}},"Apply"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{disabled:d,onClick:()=>{c({type:"setState",data:{saveDiagram:!0}})}},"Save As"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{disabled:d,onClick:()=>{c({type:"setState",data:{loading:!0}}),c({type:"rollback",data:{workshop:t,loading:!1}})}},"Rollback"))}const Gs=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xs.apply(t,e=>{if(0===Object.keys(e).length)return"Please configure order fields then click apply"},(e,t)=>{const a=Zt.getTempTableName(),n=Object.keys(t).map(e=>" ".concat(Zt.getField(e)," ").concat(t[e]," ")).join(",");return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            order by  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Us=Gs.handler,Js=Gs.action;class Ks{}Ks.ADD_FIELD="addField",Ks.REMOVE_FIELD="removeField";const Hs={[Ks.ADD_FIELD]:ws,[Ks.REMOVE_FIELD]:Es,setState:O.SetStateActionHandler,apply:Us},Ws={[Ks.ADD_FIELD]:ks,[Ks.REMOVE_FIELD]:ys,setState:O.SetStateAction,apply:Js};function Qs(e,t){return Ws[t.type](e,t.data)}const zs=_e.a.Option,Ys={error:void 0,applySaveRollbackDispacher:void 0,operateFileds:[]},Xs=r.a.createContext();function $s(e){const t=e.workshop,a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=t.currentTable.schema.fields,i=Object(p.useReducerAsync)(Is,Ys,Ts),c=Object(u.a)(i,2),l=c[0],d=c[1],m=l.operateFileds,h=l.error,f=l.applySaveRollbackDispacher,b=o.map(e=>r.a.createElement(zs,{key:e.name},e.name));return Object(n.useEffect)(()=>{f&&s.submit()},[f]),r.a.createElement(Xs.Provider,{value:{dispacher:d}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},h&&r.a.createElement(ce,{message:h}),r.a.createElement(H.a,{form:s,onFinish:e=>{d({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(Bs,{context:Xs,workshop:t})),r.a.createElement(H.a.Item,{label:"Choose fields"},r.a.createElement(_e.a,{mode:"multiple",onDeselect:e=>{d({type:js.REMOVE_FIELD,data:{fields:e}})},onChange:e=>{d({type:js.ADD_FIELD,data:{fields:e}})}},b)),m.map(e=>r.a.createElement(H.a.Item,{key:e.field,label:"Cast ".concat(e.field," to"),name:e.field},r.a.createElement(_e.a,null,r.a.createElement(_e.a.Option,{value:"int"},"int"),r.a.createElement(_e.a.Option,{value:"long"},"long"),r.a.createElement(_e.a.Option,{value:"double"},"double"),r.a.createElement(_e.a.Option,{value:"string"},"string")))))))}const Zs=tt.a.TabPane;class eo extends(In(n.Component).with(Wr,bs)){constructor(e){super(e),this.workshop=e.parent.workshop}render(){return n.createElement("div",{className:"station-menu"},n.createElement(tt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(Zs,{tab:n.createElement(B.a,{id:"select_columns"}),key:"1"},n.createElement(Hr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onSelectApply,style:{marginBottom:"30px"}}),n.createElement(Xr,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.selectFieldsRef=e,parent:this})),n.createElement(Zs,{tab:n.createElement(B.a,{id:"rename_columns"}),key:"2"},n.createElement(Hr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onRenameApply,style:{marginBottom:"30px"}}),n.createElement(hs,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.renameFieldsRef=e,parent:this})),n.createElement(Zs,{tab:n.createElement(B.a,{id:"transform_columns"}),key:"3"},n.createElement(Hr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onFuncApply,style:{marginBottom:"30px"}}),n.createElement(fs,{schemaFields:this.workshop.currentTable.schema.fields,ref:e=>this.functionFieldRef=e,parent:this})),n.createElement(Zs,{tab:n.createElement(B.a,{id:"cast_columns_type"}),key:"4"},n.createElement($s,{workshop:this.workshop}))))}}const to={EQUAL:"=",NON_EQUAL:"!=",IN:"in",CONTAINS:"contains",STARTS_WITH:"startsWith",ENDS_WITH:"endsWith",LIKE:"like",IS_NULL:"is null",IS_NOT_NULL:"is not null",IS_EMPTY:"is empty",IS_NOT_EMPTY:"is not empty"};function ao(e){const t=e.record,a=e.workshop,s=Object(n.useState)(void 0),o=Object(u.a)(s,2),i=o[0],p=o[1],d=(t.dataType,t.field),m=Object(n.useState)([]),h=Object(u.a)(m,2),f=h[0],b=h[1],g=Object(n.useState)(!1),E=Object(u.a)(g,2),y=E[0],v=E[1],w=H.a.useForm(),k=Object(u.a)(w,1)[0];e.forms[d]=k;const x=function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==f.length||"in"!==i){e.next=7;break}return v(!0),e.next=4,a.runSQLAtCurrentTable("select distinct(".concat(Zt.getField(d),") as name \n            from ").concat(a.getLastApplyTable().tableName," \n            as ").concat(Zt.getTempTableName(),";"),{outputSize:5e3,timeout:1e4});case 4:200===(t=e.sent).status&&b(t.content.data),v(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{x()},[i]);return r.a.createElement(H.a,{form:k,layout:"inline"},r.a.createElement(H.a.Item,{name:"compare"},r.a.createElement(_e.a,{initialValue:"=",onChange:e=>{p(e)},placeholder:"compare",style:{width:"200px"}},r.a.createElement(_e.a.Option,{value:"="},"="),r.a.createElement(_e.a.Option,{value:"<"},"<"),r.a.createElement(_e.a.Option,{value:">"},">"),r.a.createElement(_e.a.Option,{value:">="},">="),r.a.createElement(_e.a.Option,{value:"<="},"<="),r.a.createElement(_e.a.Option,{value:"!="},"!="),r.a.createElement(_e.a.Option,{value:to.LIKE},"like"),r.a.createElement(_e.a.Option,{value:to.STARTS_WITH},"startsWith"),r.a.createElement(_e.a.Option,{value:to.ENDS_WITH},"endsWith"),r.a.createElement(_e.a.Option,{value:to.IN},"in"),r.a.createElement(_e.a.Option,{value:to.IS_NULL},"is null"),r.a.createElement(_e.a.Option,{value:to.IS_NOT_NULL},"is not null"),r.a.createElement(_e.a.Option,{value:to.IS_EMPTY},"is empty"),r.a.createElement(_e.a.Option,{value:to.IS_NOT_EMPTY},"is not empty"))),r.a.createElement(H.a.Item,{name:"condition"},(()=>{switch(i){case to.IS_NULL:case to.IS_NOT_NULL:return r.a.createElement(r.a.Fragment,null);case to.IN:return r.a.createElement(_e.a,{loading:y,mode:"tags",style:{width:"300px"}},f.map(e=>r.a.createElement(_e.a.Option,{key:e.name,value:e.name},e.name)));case to.LIKE:return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,null),r.a.createElement("span",null,"LIKE 'a%o' means Finds any values that start with 'a' and ends with 'o' "));default:return r.a.createElement(W.a,null)}})()))}class no extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({funcPopUp:!1,data:e.map(e=>({key:e.name,field:e.name,dataType:e.type,compare:"=",condition:"",command:""})),columns:[{title:"field",dataIndex:"field"},{title:"dataType",dataIndex:"dataType",render:(e,t)=>{switch(typeof e){case"object":return n.createElement("span",null,e.type);default:return n.createElement("span",null,e)}}},{title:"",dataIndex:"compare",render:(e,t)=>n.createElement(ao,{forms:this.forms,record:t,workshop:this.workshop})}]}),this.buildSelectedRows=()=>{const e={};this.state.data.forEach(t=>{e[t.field]=t.dataType});const t=Object.entries(this.forms).map(([t,a])=>{const n=a.getFieldsValue(),r=n.compare,s=n.condition;return r?{field:t,compare:r,condition:s,dataType:e[t]}:{}});return this.selectedRowKeys?t.filter(e=>this.selectedRowKeys.includes(e.field)):[]},this.addGroup=e=>{const t=e.groupName,a=e.groupType;if(!t||!a)return void this.workshop.showInfo("Error: groupName and groupType is required.");if(!this.selectedRowKeys)return void this.workshop.showInfo("Please select fields");const n=this.buildSelectedRows();this.fitlerStation.conGroups[t]={groupName:t,groupType:a,tp:"basic",data:n},this.fitlerStation.applyGroup&&this.fitlerStation.applyGroup.reload({data:this.fitlerStation.conGroups}),this.fitlerStation.groupGroup&&this.fitlerStation.groupGroup.reload({data:this.fitlerStation.conGroups}),this.workshop.showInfo("Add successfully")},this.render=()=>{const e={onChange:(e,t)=>{this.selectedRowKeys=e},getCheckboxProps:e=>({name:e.field})};return n.createElement("div",{className:"common-one-hundred-percent-width common-column-layout"},n.createElement("div",{style:{marginRight:"30px"}},n.createElement(Hr,{parent:this,onRollback:this.fitlerStation.onRollback,handlePersit:this.fitlerStation.handlePersit,handleTableInput:this.fitlerStation.handleTableInput,ref:e=>this.fitlerStation.ApplyOrSaveRef=e,onSave:this.fitlerStation.onSave,onApply:()=>{const e=this.buildSelectedRows();this.fitlerStation.onNonGroupFilterApply(e)},style:{marginBottom:"30px"}}),n.createElement(Ye.a,{pagination:{pageSize:5},rowSelection:Object(y.a)({type:"checkbox"},e),columns:this.state.columns,dataSource:this.state.data})),n.createElement(H.a,{onFinish:this.addGroup},n.createElement(H.a.Item,{name:"groupName",label:"Group Name"},n.createElement(W.a,null)),n.createElement(H.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(_e.a,null,n.createElement(_e.a.Option,{value:"and"},"and"),n.createElement(_e.a.Option,{value:"or"},"or"))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Add selected conditions to group"))))},this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e.schemaFields),this.forms={}}}class ro extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({funcPopUp:!1,data:Object.keys(e.data).map(e=>({groupName:e})).map(e=>({key:e.groupName,groupName:e.groupName})),columns:[{title:"groupName",dataIndex:"groupName"}]}),this.addGroup=e=>{const t=e.groupName,a=e.groupType;if(!t||!a)return void this.workshop.showInfo("Error: groupName and groupType is required.");const n=this.selectedRowKeys.map(e=>this.fitlerStation.conGroups[e]);this.fitlerStation.conGroups[t]={groupName:t,groupType:a,tp:"group",data:n},this.fitlerStation.applyGroup&&this.fitlerStation.applyGroup.reload({data:this.fitlerStation.conGroups}),this.fitlerStation.groupGroup&&this.fitlerStation.groupGroup.reload({data:this.fitlerStation.conGroups}),this.workshop.showInfo("Add successfully")},this.render=()=>{const e={onChange:(e,t)=>{this.selectedRowKeys=e},getCheckboxProps:e=>({name:e.title})};return n.createElement("div",null,n.createElement(H.a,{onFinish:this.addGroup},n.createElement(H.a.Item,{name:"groupName",label:"Group Name"},n.createElement(W.a,null)),n.createElement(H.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(_e.a,null,n.createElement(_e.a.Option,{value:"and"},"and"),n.createElement(_e.a.Option,{value:"or"},"or"))),n.createElement(H.a.Item,null,n.createElement(Q.a,{type:"primary",htmlType:"submit"},"Add selected"))),n.createElement(Ye.a,{rowSelection:Object(y.a)({type:"checkbox"},e),columns:this.state.columns,dataSource:this.state.data}))},this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e)}}class so extends n.Component{constructor(e){super(e),this.reload=e=>{this.setState(Object(y.a)({},this.wow(e)))},this.wow=e=>({data:Object.keys(e.data).map(e=>({groupName:e})).map(e=>({key:e.groupName,groupName:e.groupName})),refresh:Math.random()}),this.onChange=e=>{this.groupName=e},this.render=()=>n.createElement("div",null,n.createElement(H.a,{key:this.state.refresh},n.createElement(H.a.Item,{label:"Select group name to apply:"},n.createElement(_e.a,{onChange:this.onChange},this.state.data.map(e=>n.createElement(_e.a.Option,{key:e.key,value:e.groupName},e.groupName)))))),this.fitlerStation=e.parent,this.workshop=e.parent.workshop,this.state=this.wow(e)}}const oo=tt.a.TabPane;class io extends(In(n.Component).with(Wr)){constructor(e){var t;super(e),t=this,this.onNonGroupFilterApply=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.length){e.next=3;break}return t.workshop.showInfo("Please select fields"),e.abrupt("return");case 3:return n=a.flatMap(e=>io.buildCondition([e])).join(" and "),t.ApplyOrSaveRef.enter(),r=Zt.getTempTableName(),s="select * from ".concat(t.workshop.getLastApplyTable().tableName," \n        where ").concat(n,"\n        as ").concat(r,";"),e.next=9,t.workshop.apply({tableName:r,sql:s});case 9:t.ApplyOrSaveRef.exit();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onFilterApply=Object(l.a)(c.a.mark((function e(){var a,n,r,s,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e){if("basic"===e.tp)return"and"===e.groupType?"(".concat(io.buildCondition(e.data).join(" and "),")"):"(".concat(io.buildCondition(e.data).join(" or "),")");if("and"===e.groupType){const t=e.data.flatMap(e=>r(e)).join(" and ");return"(".concat(t,")")}{const t=e.data.flatMap(e=>r(e));return"(".concat(t.join(" or "),")")}},a=t.applyGroup.groupName){e.next=5;break}return t.workshop.showInfo("Choose the group name to apply."),e.abrupt("return");case 5:return n=t.conGroups[a],s=r(n),t.ApplyOrSaveRef.enter(),o=Zt.getTempTableName(),i="select * from ".concat(t.workshop.getLastApplyTable().tableName," \n        where ").concat(s,"\n        as ").concat(o,";"),e.next=12,t.workshop.apply({tableName:o,sql:i});case 12:t.ApplyOrSaveRef.exit();case 13:case"end":return e.stop()}}),e)}))),this.workshop=e.parent.workshop,this.conGroups={},this.currentConditions={}}render(){return n.createElement("div",null,n.createElement("div",{className:"station-menu"},n.createElement(tt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(oo,{tab:"Add Conditions to Group",key:"1"},n.createElement(no,{ref:e=>this.compare=e,parent:this,schemaFields:this.workshop.currentTable.schema.fields})),n.createElement(oo,{tab:"Apply Group",key:"2"},n.createElement(Hr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:e=>this.ApplyOrSaveRef=e,onSave:this.onSave,onApply:this.onFilterApply,style:{marginBottom:"30px"}}),n.createElement(R.a,null),n.createElement(so,{ref:e=>this.applyGroup=e,parent:this,data:this.conGroups})),n.createElement(oo,{tab:"Add Groups to Group",key:"3"},n.createElement(ro,{ref:e=>this.groupGroup=e,parent:this,data:this.conGroups})))),n.createElement("div",null))}}io.buildCondition=e=>e.map(e=>(e=>{const t=e.field,a=e.dataType,n=e.compare,r=e.condition;if(n===to.IN){let e="";switch(a){case"integer":case"long":case"float":case"double":e=r.map(e=>e).join(",");break;default:e=r.map(e=>'"'.concat(Zt.escapeQuote(e),'"')).join(",")}const s="(".concat(e,")");return"".concat(Zt.getField(t)," ").concat(n," ").concat(s)}if(n===to.IS_NOT_NULL||n===to.IS_NULL)return"".concat(Zt.getField(t)," ").concat(n);if(n===to.IS_EMPTY)return"".concat(Zt.getField(t),' = ""');if(n===to.IS_NOT_EMPT)return"".concat(Zt.getField(t),' != ""');if(n===to.LIKE)return"".concat(Zt.getField(t),' like "').concat(Zt.escapeQuote(r),'"');if(n===to.STARTS_WITH)return"".concat(Zt.getField(t),' like "').concat(Zt.escapeQuote(r),'%"');if(n===to.ENDS_WITH)return"".concat(Zt.getField(t),' like "%').concat(Zt.escapeQuote(r),'"');let s="";switch(a){case"string":s='"'.concat(Zt.escapeQuote(r),'"');break;default:s=r}return"".concat(Zt.getField(t)," ").concat(n," ").concat(s)})(e));const co={operateFileds:[],error:void 0,applySaveRollbackDispacher:void 0},lo=r.a.createContext(),uo=_e.a.Option;function po(e){const t=e.parent.workshop,a=t.currentTable.schema.fields,s=Object(p.useReducerAsync)(Qs,co,Hs),o=Object(u.a)(s,2),i=o[0],c=o[1],l=i.operateFileds,d=i.error,m=i.applySaveRollbackDispacher,h=H.a.useForm(),f=Object(u.a)(h,1)[0],b=a.map(e=>r.a.createElement(uo,{key:e.name},e.name));return Object(n.useEffect)(()=>{m&&f.submit()},[m]),r.a.createElement(lo.Provider,{value:{dispacher:c}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},d&&r.a.createElement(ce,{message:d}),r.a.createElement(H.a,{form:f,onFinish:e=>{c({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(Bs,{context:lo,workshop:t})),r.a.createElement(H.a.Item,{label:"Choose fields"},r.a.createElement(_e.a,{mode:"multiple",onDeselect:e=>{c({type:Ks.REMOVE_FIELD,data:{fields:e}})},onChange:e=>{c({type:Ks.ADD_FIELD,data:{fields:e}})}},b)),l.map(e=>r.a.createElement(H.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(_e.a,null,r.a.createElement(_e.a.Option,{value:"desc"},"desc"),r.a.createElement(_e.a.Option,{value:"asc"},"asc")))))))}const mo=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xs.apply(t,e=>0==Object.keys(e).length?"Please configure limit size then click apply.":e.limitSize?void 0:"Please configure limit size then click apply.",(e,t)=>{const a=Zt.getTempTableName(),n=t.limitSize;return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            limit  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ho=mo.handler,fo=mo.action;const bo=Object(y.a)(Object(y.a)({},Qa),{},{apply:ho}),go=Object(y.a)(Object(y.a)({},za),{},{apply:fo});function Eo(e,t){return go[t.type](e,t.data)}const yo={limitSize:void 0,error:void 0,applySaveRollbackDispacher:void 0},vo=r.a.createContext();function wo(e){const t=e.parent.workshop,a=Object(p.useReducerAsync)(Eo,yo,bo),s=Object(u.a)(a,2),o=s[0],i=s[1],c=(o.limitSize,o.error),l=o.applySaveRollbackDispacher,d=H.a.useForm(),m=Object(u.a)(d,1)[0];return Object(n.useEffect)(()=>{l&&m.submit()},[l]),r.a.createElement(vo.Provider,{value:{dispacher:i}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},c&&r.a.createElement(ce,{message:c}),r.a.createElement(H.a,{form:m,onFinish:e=>{i({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(H.a.Item,null,r.a.createElement(Bs,{context:vo,workshop:t})),r.a.createElement(H.a.Item,{name:"limitSize"},r.a.createElement(W.a,null)))))}const ko=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).groupFields=t.data.groupFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),xo=ko.handler,So=ko.action,Oo=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).orderFields=t.data.orderFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Co=Oo.handler,jo=Oo.action,To=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).rowWindows=t.data.rowWindows,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),No=To.handler,Io=To.action,Ro=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i,l,u,p,d,m,h,f,b,g,E,y,v,w,k;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.result,n=a.groupFields,r=a.orderFields,s=a.rowWindows,o=t.data,i=o.workshop,l=o.functions,u=n.map(e=>Zt.getField(e.field)).join(","),p=r.map(e=>"".concat(Zt.getField(e.field)," ").concat(e.value)),d="",p.length>0&&(d="order by ".concat(p.join(","))),m=s.windowType,h=s.preceding,f=s.following,b="",g=h&&"".concat(h," PRECEDING")||"UNBOUNDED PRECEDING",E=f&&"".concat(f," FOLLOWING")||"UNBOUNDED FOLLOWING","UNBOUNDED PRECEDING"===g&&"UNBOUNDED FOLLOWING"===E&&(E="CURRENT ROW"),!m){e.next=19;break}e.t0=m,e.next="row window"===e.t0?15:"range window"===e.t0?17:19;break;case 15:return b="ROWS BETWEEN ".concat(g,"  and ").concat(E," "),e.abrupt("break",19);case 17:return b="RANGE BETWEEN ".concat(g,"  and ").concat(E," "),e.abrupt("break",19);case 19:return y=l.map(e=>{e.field,e.isAgg;const t=e.transformCode,a=e.columnName;return"".concat(t," over w as ").concat(a)}).join(","),v=i.currentTable.schema.fields.map(e=>Zt.getField(e.name)).join(","),w=Zt.getTempTableName(),k="\n     select ".concat(v,",").concat(y,"\n     from ").concat(i.getLastApplyTable().tableName," \n     window w as (\n         partition by ").concat(u," ").concat(d," ").concat(b,"\n     ) as ").concat(w,";\n    "),e.next=25,i.apply({tableName:w,sql:k});case 25:return i.refreshOperateStation(),e.abrupt("return",{data:{}});case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_o=Ro.handler,Do=Ro.action;class Ao{}Ao.buildGroup="buildGroup",Ao.buildOrder="buildOrder",Ao.buildRowWindows="buildRowWindows",Ao.apply="apply";const Po=Object(y.a)(Object(y.a)({},Qa),{},{[Ao.buildGroup]:xo,[Ao.buildOrder]:Co,[Ao.buildRowWindows]:No,apply:_o}),Fo=Object(y.a)(Object(y.a)({},za),{},{[Ao.buildGroup]:So,[Ao.buildOrder]:jo,[Ao.buildRowWindows]:Io,apply:Do});function Lo(e,t){return Fo[t.type](e,t.data)}const Mo=_e.a.Option;var qo=function(e){const t=e.workshop,a=(e.dispacher,e.context),s=e.enableApply,o=void 0!==s&&s,i=e.fieldWrapper,c=e.submit,l=e.selectFields,p=e.selectFieldsLabel,d=void 0===p?"Choose fields":p,m=e.selectFieldsMode,h=void 0===m?"multiple":m,f=l||t.currentTable.schema.fields,b=Object(n.useState)([]),g=Object(u.a)(b,2),E=g[0],y=g[1],v=Object(n.useState)(void 0),w=Object(u.a)(v,2),k=w[0],x=w[1],S=H.a.useForm(),O=Object(u.a)(S,1)[0],C=f.map(e=>r.a.createElement(Mo,{key:e.name},e.name));return{ui:e=>r.a.createElement(H.a,{form:O,className:"login-form",onFinish:c},k&&r.a.createElement(ce,{onClose:()=>{x(void 0)},message:k}),o&&r.a.createElement(H.a.Item,null,r.a.createElement(Bs,{context:a,workshop:t})),r.a.createElement(H.a.Item,{label:d,name:"selectFieldsName"},r.a.createElement(_e.a,{style:{minWidth:"200px"},mode:h,onDeselect:e=>{y(E.filter(t=>e!==t.field))},onChange:e=>{y("multiple"===h?e.map(e=>({field:e})):[{field:e}])}},C)),E.map(e=>i(e)),e),operateFields:E,form:O,setError:x}};function Vo(e){const t=Object(n.useContext)(zo).dispacher,a=qo({workshop:e.workshop,fieldWrapper:e=>r.a.createElement(r.a.Fragment,null)}),s=a.ui,o=a.operateFields,i=a.setError;return s([r.a.createElement(H.a.Item,{key:"button"},r.a.createElement(Q.a,{type:"primary",onClick:()=>{0!==o.length?t({type:Ao.buildGroup,data:{groupFields:o}}):i("Fields are required.")}},"Next"))])}function Bo(e){const t=Object(n.useContext)(zo).dispacher,a=qo({workshop:e.workshop,fieldWrapper:e=>r.a.createElement(H.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(_e.a,null,r.a.createElement(_e.a.Option,{value:"desc"},"desc"),r.a.createElement(_e.a.Option,{value:"asc"},"asc")))}),s=a.ui,o=a.operateFields,i=(a.setError,a.form);return s([r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",onClick:()=>{const e=i.getFieldValue(),a=o.map(t=>({field:t.field,value:e[t.field]}));t({type:Ao.buildOrder,data:{orderFields:a}})}},"Next"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{t({type:"setState",data:{current:0}})}},"Previous"))])}function Go(e){const t=Object(n.useContext)(zo).dispacher,a=qo({workshop:e.workshop,fieldWrapper:e=>{switch(e.field){case"row window":case"range window":return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:"Preceding",name:"preceding"},r.a.createElement(W.a,{placeholder:"number"})),r.a.createElement(H.a.Item,{label:"Following",name:"following"},r.a.createElement(W.a,{placeholder:"number"})))}},selectFields:[{name:"row window"},{name:"range window"}],selectFieldsLabel:"Window Type",selectFieldsMode:"single"}),s=a.ui,o=(a.operateFields,a.setError,a.form);return s([r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",onClick:()=>{const e=o.getFieldValue().selectFieldsName,a=Object(y.a)(Object(y.a)({},o.getFieldValue()),{},{windowType:e});t({type:Ao.buildRowWindows,data:{rowWindows:a}})}},"Next"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{t({type:"setState",data:{current:1}})}},"Previous"))])}const Uo=et.a.Panel;var Jo=a(1146);et.a.Panel;function Ko(e){const t=e.workshop,a=Object(n.useContext)(zo).dispacher,s=function(e){const t=e.operateField,a=Object(n.useState)([]),s=Object(u.a)(a,2),o=s[0],i=s[1],p=Object(n.useState)(void 0),d=Object(u.a)(p,2),m=d[0],h=d[1],f=H.a.useForm(),b=Object(u.a)(f,1)[0],g=Object(n.useState)(void 0),E=Object(u.a)(g,2),y=E[0],v=E[1],w=function(){var e=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.showFunctions();case 2:t=e.sent,a=t.content.map(e=>({value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)})),i(a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{w()},[]);const k=Object(n.useCallback)(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=o.filter(e=>e.value===t)[0],h(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[o]),x=e=>"yes"===e.extra.column?t:"";return{ui:(e,t)=>r.a.createElement(H.a,{form:b,className:"login-form"},y&&r.a.createElement(ce,{onClose:()=>{v(void 0)},message:y}),r.a.createElement(H.a.Item,{label:"Search function"},r.a.createElement(_e.a,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!0,style:{width:"200px"},filterOption:!0,onChange:k,notFoundContent:"type function name"},o.map(e=>r.a.createElement(_e.a.Option,{key:e.value},e.text)))),m&&r.a.createElement(H.a.Item,{key:m.value},r.a.createElement(us,{func:m})),m&&m.params.map(e=>r.a.createElement(H.a.Item,{initialValue:x(e),key:e.name,name:e.name,label:e.name},r.a.createElement(W.a,null))),r.a.createElement(H.a.Item,null,r.a.createElement(et.a,null,r.a.createElement(Uo,{header:"Mannually Apply Function"},r.a.createElement(R.a,{type:"horizontal"}),r.a.createElement(H.a.Item,{name:"mannualTransform",label:"Mannual Transform"},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,{name:"isMannualAgg",label:"Is Agg Function"},r.a.createElement(Kr.a,null))))),t,r.a.createElement(H.a.Item,{name:"newFieldName",label:"New Field Name",required:!0},r.a.createElement(W.a,null)),e),form:b,getTransform:()=>{const e=b.getFieldValue(),a=e.mannualTransform,n=e.isMannualAgg,r=e.newFieldName;if(a)return{field:t,isAgg:n||!1,transformCode:a,columnName:r};if(!m)return v("Operate is required."),{};const s=[];m.params.forEach(e=>{let a=b.getFieldValue()[e.name];a||"yes"!==e.extra.column||(a=t),a&&("yes"===e.extra.column?s.push(Zt.getField(a)):"number"==e.dataType||"boolean"==e.dataType?s.push(a):s.push('"'.concat(a,'"')))});return{field:t,isAgg:"yes"===m.funcValue.extra.agg,transformCode:"".concat(m.value,"(").concat(s.join(","),")"),columnName:r}},setError:v}}({operateField:""}),o=s.ui,i=s.form,p=s.getTransform,d=s.setError,m=Object(n.useState)(!1),h=Object(u.a)(m,2),f=h[0],b=h[1],g=Object(n.useState)([]),E=Object(u.a)(g,2),y=E[0],v=E[1];return r.a.createElement(r.a.Fragment,null,o([r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",loading:f,onClick:()=>{let e=[];if(0===y.length){const t=p(),a=t.field,n=t.isAgg,r=t.transformCode,s=t.columnName;if(e.push({field:a,isAgg:n,transformCode:r,columnName:s}),!s)return void d("New Field Name is required.")}else e=y;b(!0),a({type:Ao.apply,data:{setLoading:b,workshop:t,functions:e}})}},"Apply"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{loading:f,onClick:()=>{const e=p(),t=e.field,a=e.isAgg,n=e.transformCode,r=e.columnName;r?(v(y.concat([{field:t,isAgg:a,transformCode:n,columnName:r}])),i.resetFields()):d("New Field Name is required.")}},"Add"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{a({type:"setState",data:{current:2}})}},"Previous"))]),y.length>0&&r.a.createElement(ls.b,{style:{width:"500px"},header:r.a.createElement("div",null,"Added Functions"),bordered:!0,dataSource:y.map(e=>"".concat(e.transformCode," as ").concat(e.columnName)),renderItem:e=>r.a.createElement(ls.b.Item,null,r.a.createElement(Jo.a.Text,{mark:!0},"Func")," ",e)}))}function Ho(){const e=Object(re.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\npadding: 30px 30px;\nwidth: 100%;\ndisplay:flex;\nalign-items:center;\njustify-content:center;\nflex-direction: column;\n"]);return Ho=function(){return e},e}const Wo=Jr.a.Step,Qo=se.a.div(Ho()),zo=r.a.createContext();function Yo(e){const t=e.parent.workshop,a={steps:[r.a.createElement(Vo,{workshop:t}),r.a.createElement(Bo,{workshop:t}),r.a.createElement(Go,{workshop:t}),r.a.createElement(Ko,{workshop:t})],current:0,result:{groupFields:[],orderFields:[],rowWindows:[]}},n=Object(p.useReducerAsync)(Lo,a,Po),s=Object(u.a)(n,2),o=s[0],i=s[1],c=o.steps,l=o.current;return r.a.createElement(zo.Provider,{value:{dispacher:i}},r.a.createElement("div",{className:"join-app"},r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(Jr.a,{current:l},r.a.createElement(Wo,{key:0,title:"Build Group",description:"Choose fields to group data"}),r.a.createElement(Wo,{key:1,title:"Setup Group Row Order",description:"Choose fields to order the data in group"}),r.a.createElement(Wo,{key:2,title:"Build Window",description:"Build window on every row of every group"}),r.a.createElement(Wo,{key:3,title:"Apply Function",description:"Apply functions to all windows we have created"}))),r.a.createElement("div",{className:"join-app-form"},r.a.createElement(Qo,null,c[l]," "))))}const Xo=Object(y.a)({},Qa),$o=Object(y.a)({},za);function Zo(e,t){return $o[t.type](e,t.data)}a(1074);var ei=a(539),ti=a.n(ei);a(1078);const ai={applySaveRollbackDispacher:void 0,scriptContent:void 0,applyToken:Zt.getJobName()},ni=r.a.createContext();function ri(e){const t=e.parent.workshop,a=Object(p.useReducerAsync)(Zo,ai,Xo),s=Object(u.a)(a,2),o=s[0],i=s[1],d=function(e){const t=e.parent.workshop.currentTable.schema.fields.map(e=>e.name),a=H.a.useForm(),s=Object(u.a)(a,1)[0],o=Object(n.useState)(),i=Object(u.a)(o,2),c=i[0],l=i[1],p=Object(n.useState)([]),d=Object(u.a)(p,2),m=d[0],h=d[1],f=t.map(e=>r.a.createElement(_e.a.Option,{value:e},e)),b=Object(n.useCallback)(e=>{e.forEach(e=>{"vType"===e.name[0]&&l(e.value)})},[]);return{ui:()=>r.a.createElement(K.a,{title:"Generic"},r.a.createElement(H.a,{form:s,onFieldsChange:b},r.a.createElement(H.a.Item,{label:"Visulizaiton Plugin",name:"vType"},r.a.createElement(_e.a,null,m.map(e=>r.a.createElement(_e.a.Option,{value:e},e)))),r.a.createElement(H.a.Item,{label:"X Column",name:"xColumn"},r.a.createElement(_e.a,null,f)),r.a.createElement(H.a.Item,{label:"Y Column",name:"yColumn"},r.a.createElement(_e.a,null,f)))),form:s,vType:c,setPlugins:h}}(e),f=d.ui,b=d.form,g=d.vType,E=d.setPlugins,y=function(e){const t=H.a.useForm(),a=Object(u.a)(t,1)[0],s=Object(n.useState)([]),o=Object(u.a)(s,2),i=o[0],c=o[1],l=Object(n.useState)(),p=Object(u.a)(l,2),d=p[0],m=p[1];return{ui:()=>r.a.createElement(K.a,{title:"Plugin Parameters"},d&&r.a.createElement("div",{className:"image-wrapper",style:{width:"400px"}},r.a.createElement(ti.a,{src:d})),r.a.createElement(H.a,{form:a},i.map(e=>r.a.createElement(H.a.Item,{key:e.key,name:e.key,label:e.option.label||e.key,initialValue:Zt.unQuote(e.command)},r.a.createElement(W.a,null))))),form:a,setPluginConfigs:c,pluginConfigs:i,setImagePreview:m}}(),v=y.ui,w=y.form,k=y.setPluginConfigs,x=y.setImagePreview,S=new m.ActionProxy,O=o.applySaveRollbackDispacher,C=o.scriptContent,j=o.applyToken,T=function(){var e=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get(h.default.PLUGIN_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=t.content.map(e=>e.name),E(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=14;break}return e.next=3,S.get(h.default.PLUGIN_GET,{pluginName:g});case 3:return t=e.sent,a=t.content.content,e.next=7,S.runScript(a,Zt.getJobName(),{executeMode:"analyze"});case 7:if(200===(n=e.sent).status){e.next=10;break}return e.abrupt("return");case 10:r=n.content.filter(e=>e.mode&&"defaultParam"===e.mode),i({type:"setState",data:{scriptContent:a}}),x(t.content.image),k(r);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(()=>{N()},[g]),Object(n.useEffect)(()=>{T()},[]);const I=function(){var e=Object(l.a)(c.a.mark((function e(){var a,n,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O){e.next=8;break}return a=b.getFieldValue(),n=w.getFieldValue(),r=n.tableName||Zt.getTempTableName(),s="\n             select ".concat(Zt.getField(a.xColumn)," as x,").concat(Zt.getField(a.yColumn)," as y \n             from ").concat(t.getLastApplyTable().tableName," as ").concat(r,";\n             ").concat(C,"\n            "),e.next=7,t.apply({tableName:r,sql:s});case 7:O({type:"setState",data:{loading:!1}});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(()=>{I()},[j]),r.a.createElement(ni.Provider,{value:{dispacher:i}},r.a.createElement(Bs,{workshop:t,context:ni}),r.a.createElement("div",{className:"dash-station"},r.a.createElement("div",{className:"dash-station-data-page"},f()),r.a.createElement(R.a,{type:"vertical",style:{height:"300px"}}),r.a.createElement("div",{className:"dash-station-dash-page"},v())))}const si=tt.a.TabPane;class oi extends n.Component{constructor(e){super(e),this.reload=()=>{this.setState({key:Math.random()})},this.workshop=Oi.workshop,this.state={key:Math.random()}}render(){return n.createElement("div",{className:"os-pane",style:{backgroundColor:"white"}},n.createElement("div",{className:"os-tabs"},n.createElement(De.Resizable,{style:{borderBottom:"solid",width:"100%",overflow:"scroll"}},n.createElement(tt.a,{defaultActiveKey:"1",tabPosition:"left",key:this.state.key},n.createElement(si,{tab:n.createElement(B.a,{id:"project"}),key:1},n.createElement(eo,{parent:this})),n.createElement(si,{tab:n.createElement(B.a,{id:"filter"}),key:2},n.createElement(io,{parent:this})),n.createElement(si,{tab:n.createElement(B.a,{id:"agg"}),key:4},n.createElement(ms,{parent:this})),n.createElement(si,{tab:n.createElement(B.a,{id:"order"}),key:5},n.createElement(po,{parent:this})),n.createElement(si,{tab:n.createElement(B.a,{id:"more"}),key:100},n.createElement(tt.a,{tabPosition:"left"},n.createElement(si,{tab:n.createElement(B.a,{id:"join"}),key:3},n.createElement(ss,{parent:this})),n.createElement(si,{tab:n.createElement(B.a,{id:"limit"}),key:6},n.createElement(wo,{parent:this})),n.createElement(si,{tab:n.createElement(B.a,{id:"window"}),key:7},n.createElement(Yo,{parent:this})),n.createElement(si,{tab:n.createElement(B.a,{id:"dash"}),key:8},n.createElement(ri,{parent:this}))))))))}}const ii=e=>class extends e{constructor(...e){super(...e),this.toggleMessage=e=>{this.state.showMessage?this.setState({showMessage:!this.state.showMessage}):this.setState({showMessage:!this.state.showMessage,consoleMessage:e})},this.showInfo=e=>{this.setState({showInfoMessage:!0,infoMessage:e})}}},ci=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.updateDisplay=function(){var e=Object(l.a)(c.a.mark((function e(a,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({tableLoading:!0}),t.displayRef.update(a,n.fields),t.setState({tableLoading:!1});case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.refreshOperateStation=()=>{this.stationRef.setState({key:Math.random()})},this.refreshTableWorkshop=()=>{this.leftTreePaneRef.setState({reloaWorkshop:Zt.getJobName()})}}};var li=a(1139),ui=a(540),pi=a.n(ui),di=a(493);const mi=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.getColumnSearchProps=e=>({filterDropdown:({setSelectedKeys:t,selectedKeys:a,confirm:r,clearFilters:s})=>n.createElement("div",{style:{padding:8}},n.createElement(W.a,{ref:e=>{this.searchInput=e},placeholder:"Search ".concat(e),value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>this.handleSearch(a,r,e),style:{width:188,marginBottom:8,display:"block"}}),n.createElement(li.a,null,n.createElement(Q.a,{type:"primary",onClick:()=>this.handleSearch(a,r,e),icon:n.createElement(di.a,null),size:"small",style:{width:90}},"Search"),n.createElement(Q.a,{onClick:()=>this.handleReset(s),size:"small",style:{width:90}},"Reset"))),filterIcon:e=>n.createElement(di.a,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>!0,onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>this.searchInput.select())},render:t=>this.state.searchedColumn===e?n.createElement(pi.a,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[this.state.searchText],autoEscape:!0,textToHighlight:t?t.toString():""}):t}),this.handleSearch=function(){var e=Object(l.a)(c.a.mark((function e(a,n,r){var s,o,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Zt.getTempTableName(),o=a[0],i=Zt.getField(r),l={tableName:s,sql:"select * from ".concat(t.workshop.getLastApplyTable().tableName," \n            where ").concat(i," like '%").concat(o,"%' as ").concat(s,";")},n(),t.setState({loading:!0}),e.next=8,t.workshop.apply(l);case 8:t.setState({loading:!1,searchText:a[0],searchedColumn:r});case 9:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.handleReset=e=>{e(),this.setState({searchText:""})}}};var hi=a(171),fi=a(481);const bi=e=>class extends e{constructor(...e){var t;super(...e),t=this,this.dropdownStat=function(){var e=Object(l.a)(c.a.mark((function e(a,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({loading:!0}),r=Zt.getTempTableName(),e.t0=a,e.next="count"===e.t0?5:"count(distinct)"===e.t0?9:13;break;case 5:return e.next=7,t.workshop.apply({tableName:r,sql:"select count(".concat(Zt.getField(n),") \n                    from ").concat(t.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 7:return t.setState({loading:!1}),e.abrupt("return");case 9:return e.next=11,t.workshop.apply({tableName:r,sql:"select count(distinct ".concat(Zt.getField(n),") \n                    from ").concat(t.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 11:return t.setState({loading:!1}),e.abrupt("return");case 13:t.setState({loading:!1});case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.dropdown=e=>{const t=n.createElement(N.a,{onClick:t=>{this.dropdownStat(t.key,e.name)}},n.createElement(N.a.Item,{key:"count",icon:n.createElement(fi.a,null)},"Count"),n.createElement(N.a.Item,{key:"count(distinct)",icon:n.createElement(fi.a,null)},"Count&distinct"));return n.createElement(hi.a,{overlay:t},n.createElement("span",null,e.name,n.createElement(R.a,{type:"vertical"}),n.createElement(Ha.a,null)))}}},gi=a(211);class Ei extends(In(n.Component).with(mi,bi)){constructor(e){super(e),this.getDefaultRender=e=>{e.name;const t=e.type;if("object"===typeof t)return(e,t)=>JSON.stringify(e);switch(t){case"string":default:return(e,t)=>e}},this.getDefaultSearch=e=>{const t=e.name;switch(e.type){case"string":return this.getColumnSearchProps(t);case"array":case"map":default:return{}}},this.getDefaultTitleRender=e=>this.dropdown(e),this.update=(e,t)=>{let a=!1;t[0]&&"html"===t[0].name&&t[1]&&"dash"===t[1].name&&(a=!0);const n=t.map(e=>Object(y.a)(Object(y.a)({},e),{},{dataIndex:e.name,title:this.getDefaultTitleRender(e),render:this.getDefaultRender(e)},this.getDefaultSearch(e)));this.setState({columns:n,data:e,isDash:a})},this.disablePreview=()=>{this.setState({view:{enabled:!1}})},this.tableStyle=e.style||{},this.state={columns:[],rows:[],view:{enabled:!1},searchText:"",searchedColumn:"",loading:!1,isDash:!1},this.config={},this.workshop=Oi.workshop}render(){return this.state.isDash?wt.render(this.state.data):n.createElement("div",{style:this.tableStyle},n.createElement(Ye.a,{loading:this.state.loading,size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement(Xe.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(gi,{source:this.state.view.content||""})))}}var yi=a(185),vi=a(491);function wi(){const e=Object(re.a)(["\n      display:flex;\n      align-items:right;    \n    "]);return wi=function(){return e},e}function ki(e){se.a.div(wi());const t=Object(yi.b)();return r.a.createElement("div",{className:"common-one-hundred-percent-width"},r.a.createElement(et.a,{style:{marginBottom:"10px"}},r.a.createElement(et.a.Panel,{header:r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{icon:r.a.createElement(vi.a,null),onClick:e=>{e.preventDefault(),e.stopPropagation(),t.enter(e)}}),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(B.a,{id:"operate_panel"}))},r.a.createElement(yi.a,{handle:t},r.a.createElement(oi,{ref:e=>Oi.workshop.stationRef=e})))))}function xi(e){const t=Object(yi.b)();return r.a.createElement(et.a,{defaultActiveKey:"1",style:{marginBottom:"30px",width:"100%"}},r.a.createElement(et.a.Panel,{key:"1",header:r.a.createElement(r.a.Fragment,null,Oi.workshop.sessionId&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{icon:r.a.createElement(vi.a,null),onClick:e=>{e.preventDefault(),e.stopPropagation(),t.enter(e)}}),r.a.createElement(R.a,{type:"vertical"})),r.a.createElement(B.a,{id:"data_panel"}))},r.a.createElement(yi.a,{handle:t},r.a.createElement(Ei,{tableStyle:{width:"90%"},ref:e=>Oi.workshop.displayRef=e}))))}class Si extends(In(n.Component).with(Gr,Ur,ii,ci)){constructor(e){super(e),this.client=new m.ActionProxy,this.state={tableLoading:!1},this.sqls=[],Si.workshop=this}componentDidMount(){}operateStationView(){return this.state.loadingTable?n.createElement(En,null):this.sessionId?n.createElement(ki,null):n.createElement(Tn.a,{style:{width:"100%"},title:"No Aanalysis Session Is Opened",subTitle:"Right click the table in the left panel(DeltaLake/FileSystem) to begin your analysis"})}render(){return n.createElement("div",{className:"ws-app"},n.createElement("div",{className:"ws-left-pane"},n.createElement(De.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},n.createElement(Br,{ref:e=>this.leftTreePaneRef=e,parent:this}))),n.createElement("div",{className:"ws-right-pane"},n.createElement(Xe.a,{title:"Message",visible:this.state.showMessage||!1,onCancel:this.toggleMessage,onOk:this.toggleMessage,cancelText:"Cancel",width:"60%",OkText:"Ok"},n.createElement(be.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.consoleMessage||""})),n.createElement(Xe.a,{title:"Message",visible:this.state.showInfoMessage||!1,onCancel:()=>{this.setState({showInfoMessage:!1})},onOk:()=>{this.setState({showInfoMessage:!1})},cancelText:"Cancel",OkText:"Ok"},this.state.infoMessage),n.createElement("div",{className:"ws-operate-pane"},this.operateStationView()),n.createElement("div",{className:"ws-table-pane"},n.createElement(xi,null))))}}Si.workshop=void 0;var Oi=Si;const Ci=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.enableRegister,r=a.enableLogin,s=a.enableConsole,o={},void 0!==n&&(o.register=n),void 0!==r&&(o.login=r),void 0!==s&&(o.console=s),i=new m.ActionProxy,e.next=8,i.post(h.default.APP_SAVE,o);case 8:if(200!==(l=e.sent).status){e.next=11;break}return e.abrupt("return",{data:{applySuccess:!0}});case 11:return e.abrupt("return",{data:{error:l.content}});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ji=Ci.handler,Ti=Ci.action;class Ni{}Ni.LR_CONTROL="lrControl",Ni.SET_STATE="setState";const Ii={[Ni.LR_CONTROL]:ji,[Ni.SET_STATE]:O.SetStateActionHandler};function Ri(e,t){switch(t.type){case Ni.LR_CONTROL:return Ti(e,t.data);case Ni.SET_STATE:return Object(O.SetStateAction)(e,t.data);default:return e}}a(458);var _i=a(492);const Di={enableLogin:!1,enableRegister:!1,enableConsole:!1,applySuccess:!1,error:void 0,loading:!0},Ai=r.a.createContext();function Pi(){const e=Object(p.useReducerAsync)(Ri,Di,Ii),t=Object(u.a)(e,2),a=t[0],s=t[1],o=w.formLayout1(),i=o.formItemLayout,f=o.tailLayout,b=a.enableLogin,g=a.enableRegister,E=a.enableConsole,y=a.applySuccess,v=a.error,k=a.loading;function x(){return(x=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new m.ActionProxy,e.next=3,t.get(h.default.APP_INFO,{});case 3:200===(a=e.sent).status&&s({type:Ni.SET_STATE,data:{enableLogin:Boolean(a.content.login),enableRegister:Boolean(a.content.register),enableConsole:Boolean(a.content.console),loading:!1}});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)(()=>{!function(){x.apply(this,arguments)}()},[y,v]),r.a.createElement(Ai.Provider,{value:{dispacher:s}},y&&r.a.createElement(I.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),v&&r.a.createElement(I.a,{closable:!0,message:"Fail",description:v,type:"error",showIcon:!0}),k&&r.a.createElement(En,null),!k&&r.a.createElement(K.a,{title:"Control Website Register/Login"},r.a.createElement(H.a,Object.assign({},i,{className:"login-form",onFinish:e=>{s(d.a.buildEvent(Ni.LR_CONTROL,e))}}),r.a.createElement(H.a.Item,{label:"Allow Register New User",name:"enableRegister"},r.a.createElement(Kr.a,{defaultChecked:g,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,{label:"Allow User Login",name:"enableLogin"},r.a.createElement(Kr.a,{defaultChecked:b,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,{label:"Enable Console(SQL)",name:"enableConsole"},r.a.createElement(Kr.a,{defaultChecked:E,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(H.a.Item,f,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Apply")))))}var Fi=a(547),Li=a(553);function Mi(e){const t=e.renderConfig,a=e.createInitRow,s=e.submit,o=e.remove,i=H.a.useForm(),p=Object(u.a)(i,1)[0],d=Object(n.useState)([]),m=Object(u.a)(d,2),h=m[0],f=m[1],b=Object(n.useState)([]),g=Object(u.a)(b,2),E=g[0],y=g[1],v=Object(n.useState)({}),w=Object(u.a)(v,2),k=w[0],x=w[1],S=Object(n.useState)(!1),O=Object(u.a)(S,2),C=O[0],j=O[1],T=Object(n.useState)(!1),N=Object(u.a)(T,2),I=N[0],R=N[1],_=Object(n.useState)(void 0),D=Object(u.a)(_,2),A=D[0],P=D[1],F=Object(Fi.c)(E),L=F.list,M=F.remove,q=F.getKey,V=F.move,B=F.push,G=(F.sortForm,F.resetList),U=p.getFieldsValue;Object(n.useEffect)(()=>{G(E)},[E]);const J=h.filter(e=>"id"!==e).map(e=>t&&t[e]?t[e]({getKey:q}):{title:e,dataIndex:e,key:e,render:(t,a,n)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(q(n),"].").concat(e),initialValue:t},r.a.createElement(W.a,{style:{width:120,marginRight:16}})))}).concat([{key:"operate",title:"",dataIndex:"operate",render:(e,t,a)=>r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(q(a),"].operate")},r.a.createElement(Q.a.Group,null,r.a.createElement(Q.a,{type:"danger",onClick:()=>{o&&o(t),M(a)}},"Delete"))))}]),K=Object(n.useCallback)(e=>{x(e);var t=/params\[(\d+)\]\.(\D+)/;(function(){var a=Object(l.a)(c.a.mark((function a(){var n;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=[],Object.entries(e).map(([e,a])=>{const r=t.exec(e),s=Number(r[1]),o=r[2];n[s]||(n[s]={}),a&&(n[s][o]=a)}),s&&s({params:n,setLoading:j});case 3:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}})()()},[j]);return{ui:()=>{if(!I){const e=J.map(e=>(e.render=(e,t,a)=>r.a.createElement("span",null,e),e));return r.a.createElement(Ye.a,{columns:e,dataSource:E,pagination:!1})}return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{form:p},r.a.createElement(Li.a,{onDragEnd:(e,t)=>V(e,t),handleSelector:'i[aria-label="icon: drag"]'},A&&r.a.createElement(ce,{message:A}),r.a.createElement(Ye.a,{columns:J,dataSource:L,rowKey:(e,t)=>q(t).toString(),pagination:!1})),r.a.createElement(Q.a,{style:{marginTop:8},block:!0,type:"dashed",onClick:()=>B((()=>{if(a)return a(J);const e={};return J.map(t=>{e[t]=""}),e})())},"+ Add Row"),r.a.createElement(Q.a,{type:"primary",style:{marginTop:16},loading:C,onClick:()=>{K(U())}},"Submit"),e.debug&&r.a.createElement("div",{style:{whiteSpace:"pre"}},k&&"content: ".concat(JSON.stringify(k,null,2)))))},data:E,schema:h,setData:y,setSchema:f,setLoading:j,setEditorMode:R,setError:P}}function qi(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=a[0],o=a[1],i=new m.ActionProxy,p=Mi({submit:function(){var e=Object(l.a)(c.a.mark((function e({params:t,setLoading:a}){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(!0),E(void 0),n=0;case 3:if(!(n<t.length)){e.next=14;break}return e.next=6,i.post(h.default.ENGINE_ADD,t[n]);case 6:if(200===(r=e.sent).status){e.next=11;break}return a(!1),E(r.content),e.abrupt("return");case 11:n++,e.next=3;break;case 14:o(Zt.getJobName()),a(!1);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{skipAuth:({getKey:e})=>({title:"skipAuth",dataIndex:"skipAuth",key:"skipAuth",render:(t,a,n)=>{let s=!0;return 2===t&&(s=!1),r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"params[".concat(e(n),"].skipAuth"),initialValue:String(s)},r.a.createElement(_e.a,null,r.a.createElement(_e.a.Option,{value:"true"},"true"),r.a.createElement(_e.a.Option,{value:"false"},"false"))))}})}}),d=p.ui,f=p.setData,b=p.setSchema,g=p.setEditorMode,E=p.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.get(h.default.ENGINE_LIST,{});case 2:200===(t=e.sent).status&&(b(t.content.schema),f(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[s]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(Kr.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{g(e)}}),r.a.createElement(R.a,{type:"horizontal"}),d())}var Vi=function(){const e=Object(n.useState)(void 0),t=Object(u.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(void 0),i=Object(u.a)(o,2),p=i[0],d=i[1],f=Object(n.useCallback)(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.password,a=t.newPassword,n=t._newPassword,a===n){e.next=4;break}return s("Two new passwords are not the same"),e.abrupt("return");case 4:r=new m.ActionProxy,r.post(h.default.USER_CHANGE_PASSWORD,t),d("Update password successfully.");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return r.a.createElement(K.a,{className:"common-child-center"},p&&r.a.createElement(I.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),a&&r.a.createElement(I.a,{closable:!0,message:"Fail",description:a,type:"error",showIcon:!0}),r.a.createElement(H.a,{className:"login-form",onFinish:e=>{f(e)}},r.a.createElement(H.a.Item,{label:"Oringinal Password",name:"password",rules:[{required:!0,message:"Please input your oringinal password!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,{label:"New Password",name:"newPassword",rules:[{required:!0,message:"Please input your new password!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,{label:"New Password",name:"_newPassword",rules:[{required:!0,message:"Please input your new password again!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Submit"))))};const Bi=N.a.SubMenu,Gi={currentPage:"website-settings"},Ui=r.a.createContext();function Ji(){const e=Object(p.useReducerAsync)(Ri,Gi,Ii),t=Object(u.a)(e,2),a=t[0],n=t[1],s=a.currentPage;return r.a.createElement(Ui.Provider,{value:{dispacher:n}},r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(N.a,{style:{width:256},defaultSelectedKeys:["website-settings"],defaultOpenKeys:["console-settings"],mode:"inline"},r.a.createElement(Bi,{key:"console-settings",title:r.a.createElement("span",null,r.a.createElement(_i.a,null),r.a.createElement("span",null,"Console Settings"))},r.a.createElement(N.a.Item,{key:"website-settings",onClick:()=>{n({type:"setState",data:{currentPage:"website-settings"}})}},"Website Settings")),r.a.createElement(Bi,{key:"engine-settings",title:r.a.createElement("span",null,r.a.createElement(_i.a,null),r.a.createElement("span",null,"Engine Settings"))},r.a.createElement(N.a.Item,{onClick:()=>{n({type:"setState",data:{currentPage:"engines"}})},key:"engines"},"Engines")))),r.a.createElement("div",{className:"app-admin-main"},"website-settings"===s&&r.a.createElement(Pi,null),"engines"===s&&r.a.createElement(qi,null))))}function Ki(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=a[0],o=a[1],i=Object(n.useState)(void 0),c=Object(u.a)(i,2),l=c[0],p=c[1],d=Object(n.useState)(void 0),m=Object(u.a)(d,2),h=m[0],f=m[1],b=Object(n.useState)(!1),g=Object(u.a)(b,2),E=g[0],y=g[1],v=H.a.useForm(),w=Object(u.a)(v,1)[0];return{ui:({formItems:e,title:t,submit:a})=>r.a.createElement("div",{className:"common-margin common-child-center"},r.a.createElement(K.a,{title:t,style:{width:"50%"}},r.a.createElement(H.a,{form:w},s&&r.a.createElement(ce,{message:r.a.createElement(B.a,{id:s})}),l&&r.a.createElement(ce,{title:r.a.createElement(B.a,{id:"congratulation"}),type:"success",message:r.a.createElement(B.a,{id:l})}),e),r.a.createElement(H.a.Item,null,r.a.createElement(Q.a,{type:"primary",loading:E,onClick:a},r.a.createElement(B.a,{id:"apply"}))))),form:w,setError:o,setLoading:y,getParams:()=>w.getFieldsValue(),setCurrent:f,current:h,setSuccess:p}}function Hi(e){const t=Ki(),a=t.ui,s=t.setError,o=t.setSuccess,i=Object(n.useState)(void 0),p=Object(u.a)(i,2),d=p[0],f=p[1],b=function(){var e=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=3;break}return s("set_default_backend_error"),e.abrupt("return");case 3:return t=new m.ActionProxy,e.next=6,t.post(h.default.USER_EXTRA,{backend:d});case 6:if(200!==(a=e.sent).status){e.next=11;break}return w.updateUser(a),o("done"),e.abrupt("return");case 11:s(a.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(B.a,{id:"set_default_backend"}),submit:b,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"curent_value"})},w.extraOption().backend||"Not Set Yet"),r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"choose"})},r.a.createElement(Je,{useEngine:e=>{f(e)}})))})}function Wi(e){const t=Ki(),a=t.ui,n=t.setError,s=t.setSuccess,o=Pr({initialValue:w.extraOption().apply_timeout||10}),i=o.ui,u=o.value,p=function(){var e=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=3;break}return n("set_default_backend_error"),e.abrupt("return");case 3:return t=new m.ActionProxy,e.next=6,t.post(h.default.USER_EXTRA,{apply_timeout:u});case 6:if(200!==(a=e.sent).status){e.next=11;break}return w.updateUser(a),s("done"),e.abrupt("return");case 11:n(a.content);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(B.a,{id:"set_apply_timeout"}),submit:p,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"curent_value"})},u),r.a.createElement(H.a.Item,{label:r.a.createElement(B.a,{id:"choose"})},i()))})}function Qi(e){const t=Object(n.useState)(void 0),a=Object(u.a)(t,2),s=a[0],o=a[1],i=new m.ActionProxy,p=Mi({submit:function(){var e=Object(l.a)(c.a.mark((function e({params:t,setLoading:a}){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a(!0),E(void 0),n=0;n<t.length;n++);o(Zt.getJobName()),a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{}}),d=p.ui,f=p.setData,b=p.setSchema,g=p.setEditorMode,E=p.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.get(h.default.TEMA_LIST,{});case 2:200===(t=e.sent).status&&(b(t.content.schema),f(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[s]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(Kr.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{g(e)}}),r.a.createElement(R.a,{type:"horizontal"}),d())}function zi(){const e=Ki(),t=e.ui,a=e.setError,n=e.setSuccess,s=e.form,o=function(){var e=Object(l.a)(c.a.mark((function e(){var t,r,o,i,l,u,p,d,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.getFieldsValue(),r=t.host,o=t.port,i=t.db,l=t.user,u=t.password,(p=t.name)||(p=i),o||(o="3306"),d=new m.ActionProxy,e.next=6,d.post(h.default.DS_ADD,{host:r,port:o,db:i,user:l,password:u,name:p,format:"jdbc",jType:"mysql"});case 6:200===(f=e.sent).status?n("Create Connect Success"):a(f.content);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t({title:r.a.createElement(B.a,{id:"connect_mysql"}),submit:o,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Item,{name:"host",required:!0,label:r.a.createElement(B.a,{id:"host"})},r.a.createElement(W.a,{placeholder:"127.0.0.1"})),r.a.createElement(H.a.Item,{name:"port",initialValue:"3306",label:r.a.createElement(B.a,{id:"port"})},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,{name:"db",required:!0,label:r.a.createElement(B.a,{id:"db"})},r.a.createElement(W.a,null)),r.a.createElement(R.a,null),r.a.createElement(H.a.Item,{name:"user",required:!0,label:r.a.createElement(B.a,{id:"user"})},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,{name:"password",required:!0,label:r.a.createElement(B.a,{id:"password"})},r.a.createElement(W.a,null)),r.a.createElement(R.a,null),r.a.createElement(H.a.Item,{name:"name",label:r.a.createElement(B.a,{id:"alias"})},r.a.createElement(W.a,null)))})}function Yi(){const e=Object(n.useState)(void 0),t=Object(u.a)(e,2),a=t[0],s=t[1],o=new m.ActionProxy,i=Mi({submit:function(){var e=Object(l.a)(c.a.mark((function e({params:t,setLoading:a}){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a(!0),g(void 0),n=0;n<t.length;n++);s(Zt.getJobName()),a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post(h.default.DS_REMOVE,{id:t.id});case 2:200===(a=e.sent).status&&(f(a.content.schema),d(a.content.data));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),renderConfig:{}}),p=i.ui,d=i.setData,f=i.setSchema,b=i.setEditorMode,g=i.setError;return Object(n.useEffect)(()=>{(function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.get(h.default.DS_LIST,{});case 2:200===(t=e.sent).status&&(f(t.content.schema),d(t.content.data));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},[a]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(Kr.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:e=>{b(e)}}),r.a.createElement(R.a,{type:"horizontal"}),p())}const Xi=N.a.SubMenu;function $i(){const e=Object(n.useState)("default-backend"),t=Object(u.a)(e,2),a=t[0],s=t[1];return r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(N.a,{style:{width:256},defaultSelectedKeys:["default-backend"],defaultOpenKeys:["analysis-workshop"],mode:"inline"},r.a.createElement(Xi,{key:"analysis-workshop",title:r.a.createElement("span",null,r.a.createElement(_i.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"analysis_workshop"})))},r.a.createElement(N.a.Item,{key:"default-backend",onClick:()=>{s("default-backend")}},r.a.createElement(B.a,{id:"set_engine"})),r.a.createElement(N.a.Item,{key:"set-timeout",onClick:()=>{s("set-timeout")}},r.a.createElement(B.a,{id:"set_timeout"}))),r.a.createElement(Xi,{key:"user",title:r.a.createElement("span",null,r.a.createElement(_i.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"user_settings"})))},r.a.createElement(N.a.Item,{key:"change-admin-password",onClick:()=>{s("change-admin-password")}},r.a.createElement(B.a,{id:"change_password"}))),r.a.createElement(Xi,{key:"team",title:r.a.createElement("span",null,r.a.createElement(_i.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"team"})))},r.a.createElement(N.a.Item,{key:"team_manager",onClick:()=>{s("team_manager")}},r.a.createElement(B.a,{id:"team_manager"}))),r.a.createElement(Xi,{key:"datasource",title:r.a.createElement("span",null,r.a.createElement(_i.a,null),r.a.createElement("span",null,r.a.createElement(B.a,{id:"datasource"})))},r.a.createElement(N.a.Item,{key:"mysql",onClick:()=>{s("mysql")}},r.a.createElement(B.a,{id:"connect_mysql"})),r.a.createElement(N.a.Item,{key:"list_mysql",onClick:()=>{s("list_mysql")}},r.a.createElement(B.a,{id:"list_mysql"}))))),r.a.createElement("div",{className:"app-admin-main"},"default-backend"===a&&r.a.createElement(Hi,null),"set-timeout"===a&&r.a.createElement(Wi,null),"change-admin-password"===a&&r.a.createElement(Vi,null),"team_manager"===a&&r.a.createElement(Qi,null),"mysql"===a&&r.a.createElement(zi,null),"list_mysql"===a&&r.a.createElement(Yi,null)))}const Zi={currentPage:"login",logined:!1},ec=r.a.createContext();function tc(e){const t=e.appInfo,a=Object(p.useReducerAsync)(T,Zi,j),s=Object(u.a)(a,2),o=s[0],i=s[1],c=o.currentPage,l=o.logined;return Object(n.useEffect)(()=>{i(d.a.buildEvent(C.CHECK_LOGINED,{}))},[]),r.a.createElement(ec.Provider,{value:{dispacher:i}},r.a.createElement("div",{className:"app-console"},r.a.createElement("div",{className:"app-console-header"},r.a.createElement(J,{appInfo:t,userLogined:l,isUserAdmin:w.isAdmin(),currentPage:c})),r.a.createElement("div",{className:"app-console-main"},"register"===c&&r.a.createElement(pe,null),"register"!==c&&!l&&r.a.createElement(he,null),"console"===c&&l&&r.a.createElement(jn,null),"workshop"===c&&l&&r.a.createElement(Oi,null),"admin"===c&&l&&w.isAdmin()&&r.a.createElement(Ji,null),"settings"===c&&l&&r.a.createElement($i,null)),r.a.createElement("div",{className:"app-console-footer"},r.a.createElement("div",{style:{bottom:"100px",textAlign:"center",width:"100%"}},"MLSQL Licensed under the Apache License, Version 2.0. @",r.a.createElement("a",{className:"copyright",href:"http://www.miitbeian.gov.cn/"},"\u6d59ICP\u590718052520\u53f7"),r.a.createElement("div",null,"@",r.a.createElement("a",{target:"_blank",href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010802009683"},r.a.createElement("img",{src:""}),"\u6d59\u516c\u7f51\u5b89\u5907 33010802009683\u53f7"))))))}const ac=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new m.ActionProxy,n=t.data,r=n.name,s=n.url,e.next=4,a.post(h.default.ENGINE_ADD,{name:r,url:s});case 4:if(200===(o=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{error:JSON.parse(o.content).msg}});case 7:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),nc=ac.handler,rc=ac.action,sc=d.a.buildHandler(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),oc=sc.handler,ic=sc.action;class cc{}cc.registerAdmin="registerAdmin",cc.addEngine="addEngine",cc.skipAddEngine="skipAddEngine";const lc={[cc.registerAdmin]:Y,[cc.addEngine]:nc,[cc.skipAddEngine]:oc};function uc(e,t){switch(t.type){case cc.registerAdmin:return X(e,t.data);case cc.addEngine:return rc(e,t.data);case cc.skipAddEngine:return ic(e,t.data);default:return e}}var pc=a(1151);var dc=function(){const e=Object(n.useContext)(Pc).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout;return r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:t=>{e({type:cc.registerAdmin,data:t})}}),r.a.createElement(H.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(W.a.Password,null)),r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go")))};var mc=function(){const e=Object(n.useContext)(Pc).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout,o={required:!0,message:"required"};return r.a.createElement(H.a,Object.assign({},a,{className:"login-form",onFinish:t=>{e({type:cc.addEngine,data:t})}}),r.a.createElement(H.a.Item,{label:"Engine Name",name:"name",rules:[o]},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,{label:"Engine Url",name:"url",rules:[o]},r.a.createElement(W.a,null)),r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",htmlType:"submit"},"Go"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:t=>{t.preventDefault(),e({type:cc.skipAddEngine,data:{}})},htmlType:"submit"},"Skip")))};const hc=d.a.buildHandler(e=>({data:e.data})),fc=hc.handler,bc=hc.action,gc=d.a.buildHandler(e=>({data:{appConfigured:!0}})),Ec=gc.handler,yc=gc.action,vc=d.a.buildHandler(e=>({data:{appConfigured:!0}})),wc=vc.handler,kc=vc.action;class xc{}xc.GO_CONSOLE="goConsole",xc.GO_ADMIN="goAdmin",xc.appConfigured="appConfigured";const Sc={[xc.GO_ADMIN]:Ec,[xc.GO_CONSOLE]:wc,[xc.appConfigured]:fc};function Oc(e,t){switch(t.type){case xc.GO_ADMIN:return yc(e,t.data);case xc.GO_CONSOLE:return kc(e,t.data);case xc.appConfigured:return bc(e,t.data);default:return e}}var Cc=function(){const e=Object(n.useContext)(Uc).dispacher,t=w.formLayout1(),a=t.formItemLayout,s=t.tailLayout;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I.a,{message:"Congratuation!",description:"You have finished the setup of MLSQL Console.",type:"success"}),r.a.createElement(R.a,null),r.a.createElement(H.a,a,r.a.createElement(H.a.Item,s,r.a.createElement(Q.a,{type:"primary",onClick:()=>{e({type:xc.GO_ADMIN,data:{}})}},"Go to Admin Page"),r.a.createElement(R.a,{type:"vertical"}),r.a.createElement(Q.a,{onClick:()=>{e({type:xc.GO_CONSOLE,data:{}})}},"Go to Console Page"))))};function jc(){const e=Object(re.a)(["\n width:100%;\n display:flex;\n max-width: 800px;\n flex-direction: column;\n"]);return jc=function(){return e},e}function Tc(){const e=Object(re.a)(["\n  width:100%;\n  margin-top:6px;\n"]);return Tc=function(){return e},e}function Nc(){const e=Object(re.a)(["\ndisplay: flex;\nflex-direction: column;\nwidth:100%;\njustify-content:center;\n align-items:  center;\n"]);return Nc=function(){return e},e}const Ic=Jr.a.Step,Rc=se.a.div(Nc()),_c=se.a.div(Tc()),Dc=se.a.div(jc()),Ac={error:void 0,current:0},Pc=r.a.createContext();var Fc=function(){const e=Object(p.useReducerAsync)(uc,Ac,lc),t=Object(u.a)(e,2),a=t[0],n=t[1],s=a.error,o=a.current;return r.a.createElement(Pc.Provider,{value:{dispacher:n}},r.a.createElement(Rc,null,r.a.createElement(_c,null,r.a.createElement(pc.a,{title:"Setup MLSQL Console in 2 Steps"})),r.a.createElement(R.a,null),r.a.createElement(Dc,null,r.a.createElement(Jr.a,{current:o},r.a.createElement(Ic,{title:"Admin User/Password",description:"Setup Admin accout"}),r.a.createElement(Ic,{title:"Add Engines",description:"Add default MLSQL Engine"}),r.a.createElement(Ic,{title:"Done",description:"Congratuation"})),r.a.createElement(R.a,null),s&&r.a.createElement(I.a,{message:"Message",description:s,type:"error",closable:!0}),0===o&&r.a.createElement(K.a,null,r.a.createElement(dc,null)),1===o&&r.a.createElement(K.a,null,r.a.createElement(mc,null)),2===o&&r.a.createElement(K.a,null,r.a.createElement(Cc,null)))))},Lc=a(21),Mc=a(1148);var qc={login:"\u767b\u5f55",register:"\u6ce8\u518c",console:"\u63a7\u5236\u53f0",analysis_workshop:"\u5206\u6790\u5de5\u574a",settings:"\u8bbe\u7f6e",admin:"\u7ba1\u7406\u5458",more:"\u66f4\u591a",apply:"\u5e94\u7528",set_default_backend:"\u8bbe\u7f6e\u9ed8\u8ba4Engine",set_default_backend_error:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u5f15\u64ce\u8fdb\u884c\u8bbe\u7f6e",set_engine:"\u8bbe\u7f6e\u5f15\u64ce",curent_value:"\u5f53\u524d\u503c",choose:"\u9009\u62e9",done:"\u5b8c\u6210",congratulation:"\u606d\u559c",set_timeout:"\u8d85\u65f6\u8bbe\u7f6e",set_apply_timeout:"\u8bbe\u7f6e\u3010\u5e94\u7528\u3011\u8d85\u65f6\uff08\u5355\u4f4d\u79d2\uff09",table_workshop:"\u6682\u5b58\u533a",delta_lake:"\u6570\u636e\u6e56",file_system:"\u6587\u4ef6\u7cfb\u7edf",project:"\u5b57\u6bb5",filter:"\u8fc7\u6ee4",join:"\u5173\u8054",window:"\u7a97\u53e3",dash:"\u53ef\u89c6\u5316",limit:"\u6761\u6570",agg:"\u805a\u5408",order:"\u6392\u5e8f",select_columns:"\u7b5b\u9009\u5b57\u6bb5",rename_columns:"\u91cd\u547d\u540d\u5b57\u6bb5",transform_columns:"\u8f6c\u6362\u5b57\u6bb5",cast_columns_type:"\u4fee\u6539\u5b57\u6bb5\u7c7b\u578b",hive:"\u6570\u4ed3",operate_panel:"\u64cd\u4f5c\u533a",data_panel:"\u6570\u636e\u533a",user_settings:"\u7528\u6237\u8bbe\u7f6e",change_password:"\u4fee\u6539\u5bc6\u7801",team:"\u56e2\u961f",team_manager:"\u56e2\u961f\u7ba1\u7406",datasource:"\u6570\u636e\u6e90",analysis_range:"\u8bf7\u9009\u62e9\u8868\u5206\u6790\u533a\u95f4",table_start:"\u9009\u62e9\u5f00\u59cb\u533a\u95f4[\u5305\u542b]",table_end:"\u9009\u62e9\u7ed3\u675f\u533a\u95f4[\u5305\u542b]",table_random:"\u9009\u62e9\u4efb\u610f\u503c",or:"\u6216\u8005",no_partition_msg:"\u8be5\u8868\u6ca1\u6709\u5206\u533a\u4fe1\u606f\u3002\u8bf7\u76f4\u63a5\u70b9\u51fb\u3010\u786e\u8ba4\u3011",ds_mysql:"MySQL\u7ba1\u7406",host:"\u4e3b\u673a\u540d",port:"\u7aef\u53e3",db:"\u6570\u636e\u5e93\u540d",user:"\u7528\u6237\u540d",password:"\u5bc6\u7801",alias:"\u522b\u540d",connect_mysql:"\u8fde\u63a5 MySQL",list_mysql:"MySQL\u5217\u8868",mysql:"MySQL",partitionColumn:"\u5206\u533a\u5217",lowerBound:"\u6700\u4f4e\u503c",upperBound:"\u6700\u5927\u503c",numPartitions:"\u5206\u533a\u6570",mysql_parallel:"MySQL\u6253\u5f00\u5e76\u884c\u5ea6\u8bbe\u7f6e",no_mysql_parallel:"\u8be5\u8868\u6ca1\u6709\u6570\u5b57\u7c7b\u578b\u7684\u5217\uff0c\u65e0\u6cd5\u8bbe\u7f6e\u5e76\u884c\u5ea6\u3002\u8bf7\u76f4\u63a5\u70b9\u51fb\u3010\u786e\u5b9a\u3011"};var Vc=a(546),Bc=a.n(Vc);const Gc={appConfigured:!1,loading:!0,lang:"zh",enableConsole:!1},Uc=r.a.createContext();var Jc=function(){const e=Object(p.useReducerAsync)(Oc,Gc,Sc),t=Object(u.a)(e,2),a=t[0],s=t[1],o=a.appConfigured,i=a.loading,d=a.lang,f=a.enableConsole;function b(){return(b=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new m.ActionProxy,e.next=3,t.get(h.default.APP_INFO,{});case 3:200===(a=e.sent).status&&s({type:xc.appConfigured,data:{appConfigured:a.content.configured,enableConsole:a.content.console||!1,loading:!1}});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)(()=>{!function(){b.apply(this,arguments)}()},[]),r.a.createElement(Mc.a,{locale:d,messages:qc},r.a.createElement(Lc.b,{locale:Bc.a},r.a.createElement(Uc.Provider,{value:{dispacher:s}},i&&r.a.createElement(En,null),!i&&!o&&r.a.createElement(Fc,null),!i&&o&&r.a.createElement(tc,{appInfo:{enableConsole:f}}))))};o.a.render(r.a.createElement(Jc,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},14:function(e,t,a){"use strict";a.r(t),a.d(t,"ActionProxy",(function(){return d}));var n=a(4),r=a.n(n),s=a(7),o=a(9),i=a(85);class c{}c.USER_NAME="userName",c.USER_ID="userId",c.ADMIN_TOKEN="admin_token",c.LOGIN_TOKEN="access-token";class l{constructor(e,t,a){this.status=e,this.content=t,this.resp=a}}class u{constructor(e,t={}){this.url=e,this.url||(this.url=i.b),this.fetch_config=t}request(e,t,a="GET"){var n=this;return Object(s.a)(r.a.mark((function s(){var u,p,d,m,h,f,b,g,E,y,v;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(d in a=a.toUpperCase(),(u=sessionStorage.getItem(c.USER_NAME))&&(t[c.USER_NAME]=u),p=[],t)m=encodeURIComponent(d),h=encodeURIComponent(t[d]),p.push(m+"="+h);return f=n.url+e,p.length>0&&(f+="?"),"GET"===a?(f+=p.join("&"),p=void 0):p=p.join("&"),b={method:a,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(i.a)||""},body:p},g=Object(o.a)(Object(o.a)({},b),n.fetch_config),r.prev=10,r.next=13,fetch(f,g);case 13:if((E=r.sent).ok){r.next=19;break}return r.next=17,E.text();case 17:return y=r.sent,r.abrupt("return",new l(E.status,y));case 19:return r.next=21,E.json();case 21:return v=r.sent,r.abrupt("return",new l(200,v,E));case 25:return r.prev=25,r.t0=r.catch(10),r.abrupt("return",new l(500,r.t0,void 0));case 28:case"end":return r.stop()}}),s,null,[[10,25]])})))()}}var p=a(16);class d{constructor(){this.backend=new u}userName(){var e=this;return Object(s.a)(r.a.mark((function t(){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(p.default.USER_NAME,{});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()}runScript(e,t,a){var n=this;return Object(s.a)(r.a.mark((function s(){var o,i,c,l,u,d;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.userName();case 2:if(200===(o=r.sent).status){r.next=5;break}return r.abrupt("return",o);case 5:return i=o.content,c=i.userName,l=i.backendTags,u={sql:e,owner:c,jobName:t,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""},Object.assign(u,a),r.next=10,n.post(p.default.RUN,u);case 10:return d=r.sent,r.abrupt("return",d);case 12:case"end":return r.stop()}}),s)})))()}get(e,t){var a=this;return Object(s.a)(r.a.mark((function n(){var s;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.backend.request(e,t,i.c.GET);case 2:return s=n.sent,n.abrupt("return",s);case 4:case"end":return n.stop()}}),n)})))()}post(e,t){var a=this;return Object(s.a)(r.a.mark((function n(){var s;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.backend.request(e,t,i.c.POST);case 2:return s=n.sent,n.abrupt("return",s);case 4:case"end":return n.stop()}}),n)})))()}}d.client=new d},15:function(e,t,a){"use strict";var n=a(4),r=a.n(n),s=a(9),o=a(7);t.a=class{static buildHandler(e){return{handler:({dispatch:t,getState:a,signal:n})=>{const i=t;return function(){var t=Object(o.a)(r.a.mark((function t(n){var o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(Object(s.a)(Object(s.a)({},n),{},{__state:a()}));case 2:o=t.sent,i(Object(s.a)({type:n.type},o));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},action:(e,t)=>Object(s.a)(Object(s.a)({},e),t)}}static buildEvent(e,t){return{type:e,data:t}}}},16:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return n}));class n{}n.RUN="/api_v1/run/script",n.USER_NAME="/api_v1/user/userName",n.JOB_LIST="/api_v1/job/list",n.JOB_DETAIL="/api_v1/job",n.JOB_KILL="/api_v1/job/kill",n.SAVE_SCRIPT_FILE="/api_v1/script_file",n.ANALYSIS_TABLES="/api_v1/analysis/tables",n.ANALYSIS_TABLE_INFO="/api_v1/analysis/table/get",n.ANALYSIS_SAVE="/api_v1/analysis/tables/save",n.ANALYSIS_TABLE_DELETE="/api_v1/analysis/table/delete",n.APP_INFO="/api_v1/app",n.APP_SAVE="/api_v1/app/save",n.REGISTER="/api_v1/user/register",n.LOGIN="/api_v1/user/login",n.LOGOUT="/api_v1/user/logout",n.ENGINE_ADD="/api_v1/engine/add",n.ENGINE_LIST="/api_v1/engine/list",n.SCRIPT_FILE_LIST="/api_v1/script_file",n.SCRIPT_FILE_GET="/api_v1/script_file/get",n.SCRIPT_FILE_REMOVE="/api_v1/script_file/remove",n.PLUGIN_LIST="/api_v1/plugin/list",n.PLUGIN_GET="/api_v1/plugin/get",n.USER_EXTRA="/api_v1/user/extra/update",n.USER_CHANGE_PASSWORD="/api_v1/changepassword",n.APPLY_GET="/api_v1/analysis/apply",n.TEMA_LIST="/api_v1/team",n.DS_ADD="/api_v1/ds/add",n.DS_LIST="/api_v1/ds/list",n.DS_REMOVE="/api_v1/ds/remove",n.DS_MYSQL_DBS="/api_v1/ds/mysql/dbs",n.DS_MYSQL_CONNECT="/api_v1/ds/mysql/connect/get",n.DS_MYSQL_COLUMN_INFO="/api_v1/ds/mysql/column"},383:function(e,t,a){},398:function(e,t,a){},454:function(e,t,a){},455:function(e,t,a){},456:function(e,t,a){},457:function(e,t,a){},458:function(e,t,a){},576:function(e,t,a){e.exports=a(1132)},582:function(e,t,a){},583:function(e,t,a){},585:function(e,t,a){},586:function(e,t,a){},75:function(e,t,a){"use strict";a.r(t),a.d(t,"SetStateActionHandler",(function(){return c})),a.d(t,"SetStateAction",(function(){return l}));var n=a(4),r=a.n(n),s=a(9),o=a(7);const i=a(15).a.buildHandler(function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:Object(s.a)({},t.data)});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c=i.handler,l=i.action},771:function(e,t,a){},774:function(e,t,a){},85:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return s}));const n="";class r{}r.GET="get",r.POST="post",r.PUT="put",r.DELETE="delete";const s={name:"access-token"}}},[[576,1,2]]]);
//# sourceMappingURL=main.c408aec9.chunk.js.map