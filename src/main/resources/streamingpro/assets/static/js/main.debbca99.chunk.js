(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1065:function(e,t,a){},1066:function(e,t,a){},1076:function(e,t,a){},1080:function(e,t,a){},1136:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(22),c=a.n(o);a(584),a(585),a(586),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i,l=a(5),s=a.n(l),u=a(8),p=a(13),d=(a(589),a(49)),m=a(27),f=a(7),h=a(26),b=a(32),g=a(30),v=a(87),y=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("logout"!==t.data.currentPage){e.next=7;break}return a=new b.ActionProxy,e.next=4,a.post(g.default.LOGOUT,{});case 4:return sessionStorage.removeItem(v.a.name),sessionStorage.removeItem("user"),e.abrupt("return",{data:{currentPage:"admin",logined:!1}});case 7:return e.abrupt("return",{data:{currentPage:t.data.currentPage}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),E=y.handler,O=y.action,k=a(20),j=a(12),w=a(284),S=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"setupLogin",value:function(e){var t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags},a=e.resp.headers.get(v.a.name);sessionStorage.setItem(v.a.name,a),sessionStorage.setItem("user",JSON.stringify(t)),(new w.a).set(v.a.name,a,{path:"/"})}},{key:"updateUser",value:function(e){var t={userName:e.content.name,role:e.content.role,extraOption:e.content.backendTags};sessionStorage.setItem("user",JSON.stringify(t))}},{key:"extraOption",value:function(){var e=sessionStorage.getItem("user");if(!e)return{};try{return JSON.parse(JSON.parse(e).extraOption)}catch(t){return{}}}},{key:"isAdmin",value:function(){var e=sessionStorage.getItem("user");return!!e&&"admin"===JSON.parse(e).role}},{key:"logined",value:function(){return!!sessionStorage.getItem(v.a.name)}},{key:"formLayout2",value:function(){return{formItemLayout:{labelCol:{xs:{span:4},sm:{span:8}},wrapperCol:{xs:{span:4},sm:{span:8}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}},{key:"formLayout1",value:function(){return{formItemLayout:{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},tailLayout:{wrapperCol:{offset:8,span:16}}}}}]),e}(),x=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="workshop","register"!==t.__state.currentPage||S.logined()||(a="register"),e.abrupt("return",{data:Object(k.a)({},t.data,{logined:S.logined(),currentPage:a})});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),T=x.handler,C=x.action,N=a(80),I=function e(){Object(f.a)(this,e)};I.SWITCH="switch",I.CHECK_LOGINED="checkLogined";var R=(i={},Object(m.a)(i,I.SWITCH,E),Object(m.a)(i,I.CHECK_LOGINED,T),Object(m.a)(i,"setState",N.SetStateActionHandler),i);function A(e,t){switch(t.type){case I.SWITCH:return O(e,t.data);case I.CHECK_LOGINED:return C(e,t.data);case"setState":return Object(N.SetStateAction)(e,t.data);default:return e}}a(590);var D=a(67),F=a(1154),P=a(1140),L=a(481),_=a(482),M=a(497),q=a(483),V=a(484),G=a(485),B=a(486),U=a(172),K=a.n(U),J=a(1141),H=D.a.SubMenu,W=r.a.createContext();function Q(e){var t=e.currentPage,a=e.userLogined,o=e.isUserAdmin,c=Object(n.useContext)(oi).dispacher,i=Object(n.useState)(t),l=Object(p.a)(i,2),s=l[0],u=l[1],d=Object(n.useState)(a),m=Object(p.a)(d,2),f=m[0],b=m[1],g=Object(n.useState)(o),v=Object(p.a)(g,2),y=v[0],E=v[1],O=Object(n.useState)(void 0),k=Object(p.a)(O,2),j=k[0],w=k[1],S=Object(n.useRef)();return Object(n.useEffect)(function(){var t=e.currentPage,a=e.userLogined,n=e.isUserAdmin;u(t),b(a),E(n)},[e]),r.a.createElement(W.Provider,null,r.a.createElement(K.a,{title:"Confirm",visible:j||!1,onCancel:function(){w(void 0)},onOk:function(){w(void 0),u(S.current),c(h.a.buildEvent(I.SWITCH,{currentPage:S.current}))},cancelText:"Cancel",okText:"Leave"},r.a.createElement(F.a,{description:j,type:"info"})),r.a.createElement(D.a,{onClick:function(e){f&&"workshop"===s&&"workshop"!==e.key?(S.current=e.key,w("Do you wanna leave workshop? Please make sure you have saved your work before you leave.")):(u(e.key),c(h.a.buildEvent(I.SWITCH,{currentPage:e.key})))},selectedKeys:[s],mode:"horizontal"},r.a.createElement(D.a.Item,{key:"home"},r.a.createElement("span",{style:{fontSize:32}},"MLSQL Web Console")),r.a.createElement(P.a,{type:"vertical"}),!f&&r.a.createElement(D.a.Item,{key:"login",icon:r.a.createElement(L.a,null)},r.a.createElement(J.a,{id:"login"})),!f&&r.a.createElement(D.a.Item,{key:"register",icon:r.a.createElement(_.a,null)},r.a.createElement(J.a,{id:"register"})),f&&r.a.createElement(D.a.Item,{key:"console",icon:r.a.createElement(M.a,null)},r.a.createElement(J.a,{id:"console"})),f&&r.a.createElement(D.a.Item,{key:"workshop",icon:r.a.createElement(q.a,null)},r.a.createElement(J.a,{id:"analysis_workshop"})),f&&r.a.createElement(D.a.Item,{key:"settings",icon:r.a.createElement(V.a,null)},r.a.createElement(J.a,{id:"settings"})),f&&y&&r.a.createElement(D.a.Item,{key:"admin",icon:r.a.createElement(V.a,null)},r.a.createElement(J.a,{id:"admin"})),f&&r.a.createElement(H,{icon:r.a.createElement(G.a,null),title:r.a.createElement(J.a,{id:"more"})},r.a.createElement(D.a.Item,{key:"doc"},"\u4e2d\u6587\u6587\u6863"),r.a.createElement(D.a.Item,{key:"logout",icon:r.a.createElement(B.a,null)},"Logout"))))}var z,Y=a(1159),X=a(1148),$=a(556),Z=a(66),ee=(a(390),h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c,i,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,n=a.userName,r=a.password,o=a.password2,r===o){e.next=3;break}return e.abrupt("return",{data:{error:"Passwords are not matched"}});case 3:return c=new b.ActionProxy,e.next=6,c.post(g.default.REGISTER,{userName:n,password:r});case 6:return i=e.sent,l={},200!==i.status?l={error:JSON.parse(i.content).msg}:(S.setupLogin(i),l={error:void 0,logined:!0,current:t.__state.current+1}),e.abrupt("return",{data:l});case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),te=ee.handler,ae=ee.action,ne=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.ActionProxy,e.next=3,a.post(g.default.LOGIN,t.data);case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",{data:{logined:!1,error:JSON.parse(n.content).msg}});case 6:return S.setupLogin(n),e.abrupt("return",{data:{logined:!0}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),re=ne.handler,oe=ne.action,ce=function e(){Object(f.a)(this,e)};ce.REGISTER="register",ce.LOGIN="login";var ie=(z={},Object(m.a)(z,ce.REGISTER,te),Object(m.a)(z,ce.LOGIN,re),z);function le(e,t){switch(t.type){case ce.REGISTER:return ae(e,t.data);case ce.LOGIN:return oe(e,t.data);default:return e}}var se=a(91),ue=a(92);function pe(){var e=Object(se.a)(["\n  width: 100%;    \n  margin: 0px 10px 10px 0px;\n"]);return pe=function(){return e},e}var de=ue.a.div(pe());var me=function(e){return r.a.createElement(de,null,r.a.createElement(F.a,Object.assign({},e,{closable:!0,type:e.type||"error",message:e.title||"Message",description:e.message})))},fe=r.a.createContext(),he={logined:!1,error:void 0};function be(){var e=Object(n.useContext)(oi).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout,c=Object(d.useReducerAsync)(le,he,ie),i=Object(p.a)(c,2),l=i[0],s=i[1],u=l.logined,m=l.error;return Object(n.useEffect)(function(){e({type:I.CHECK_LOGINED,data:{}})},[u]),r.a.createElement(fe.Provider,{value:{}},r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(Y.a,{title:"Register"},m&&r.a.createElement(me,{type:"error",message:m}),r.a.createElement(X.a,Object.assign({},a,{className:"login-form",onFinish:function(e){s({type:ce.REGISTER,data:e})}}),r.a.createElement(X.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement($.a,null)),r.a.createElement(X.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement($.a.Password,null)),r.a.createElement(X.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement($.a.Password,null)),r.a.createElement(X.a.Item,o,r.a.createElement(Z.a,{type:"primary",htmlType:"submit"},"Go"))))))}var ge={logined:!1,error:void 0},ve=r.a.createContext();function ye(){var e=S.formLayout1(),t=e.formItemLayout,a=e.tailLayout,o=Object(n.useContext)(oi).dispacher,c=Object(d.useReducerAsync)(le,ge,ie),i=Object(p.a)(c,2),l=i[0],s=i[1],u=l.logined,m=l.error;return Object(n.useEffect)(function(){o({type:I.CHECK_LOGINED,data:{logined:u}})},[u]),r.a.createElement(ve.Provider,null,r.a.createElement("div",{className:"app-console-main-register"},r.a.createElement(Y.a,{title:"Login"},m&&r.a.createElement(me,{type:"error",message:m}),r.a.createElement(X.a,Object.assign({},t,{className:"login-form",onFinish:function(e){s(h.a.buildEvent(ce.LOGIN,e))}}),r.a.createElement(X.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement($.a,null)),r.a.createElement(X.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement($.a.Password,null)),r.a.createElement(X.a.Item,a,r.a.createElement(Z.a,{type:"primary",htmlType:"submit"},"Go"))))))}var Ee=a(11),Oe=a(9),ke=a(10),je=a(14),we=(a(196),a(305),a(74)),Se=a.n(we),xe=(a(404),a(306),a(307),a(32).ActionProxy),Te=a(30).default,Ce=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"getSuggestList",value:function(){var e=Object(u.a)(s.a.mark(function e(t,a,n){var r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new xe,e.next=3,r.post(Te.RUN,{executeMode:"autoSuggest",sql:t,lineNum:a+1,columnNum:n,isDebug:!1,queryType:"robot"});case 3:if(!(o=e.sent)||200!==o.status){e.next=9;break}return c=o.content,e.abrupt("return",c);case 9:return e.abrupt("return",[]);case 10:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()}]),e}(),Ne=(a(405),a(1151)),Ie={GET:"get",POST:"post",PUT:"put"},Re=401,Ae={name:"access-token"},De="/api_v1/script_file",Fe="/api_v1/run/script",Pe="/api_v1/file/upload",Le=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,[{key:"isLogin",value:function(){return null!==sessionStorage.getItem(Ae.name)}},{key:"userName",value:function(e){new Ve("/api_v1/user/userName").request(Ie.GET,{},function(t){t.status===Re?sessionStorage.removeItem(Ae.name):t.content.then(function(t){e(JSON.parse(t).userName)}).catch(function(e){})},function(e){console.log(e)})}},{key:"user",value:function(e){new Ve("/api_v1/user/userName").request2({},function(t){e(t)},function(e){})}},{key:"login",value:function(e,t,a,n){this.registerOrLogin("/api_v1/user/login",e,t,a,n)}},{key:"logout",value:function(){sessionStorage.removeItem(Ae.name)}},{key:"register",value:function(e,t,a,n){this.registerOrLogin("/api_v1/user/register",e,t,a,n)}},{key:"registerOrLogin",value:function(e,t,a,n,r){var o={userName:t,password:a};new Ve(e).request(Ie.POST,o,function(e){e.accessToken&&(sessionStorage.setItem(Ae.name,e.accessToken),(new w.a).set(Ae.name,e.accessToken,{path:"/"}));n(e)},function(e){r(e)})}}]),e}(),_e=a(110),Me=function e(t){Object(f.a)(this,e),this.value=t},qe=function e(t,a,n){var r=this;Object(f.a)(this,e),this.json=function(e,t){r.content.then(function(a){try{var n=JSON.parse(a);e(n)}catch(r){console.log(r),t(a)}})},this.status=t,this.content=a,this.accessToken=n},Ve=function(){function e(t){Object(f.a)(this,e),this.url=t}return Object(j.a)(e,[{key:"request2",value:function(e,t,a){this.request(Ie.POST,e,function(e){e.json(function(e){t(e)},function(e){a(e)})},function(e){try{e.value().content(function(e){var t=e;try{t=JSON.parse(e).msg}catch(n){}a(t)})}catch(t){a(e?e.toString():"result is null")}})}},{key:"runScript",value:function(e,t,a,n){var r=new Le,o=_e(),c=this;r.user(function(r){var i=r.userName,l=r.backendTags,s={sql:t,owner:i,jobName:o,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""};Object.assign(s,e),(e.background||!1)&&Object.assign(s,{async:!0,callback:""}),c.request(Ie.POST,s,function(e){if(200===e.status)e.json(function(e){a(e)},function(e){n(e)});else try{e.content.then(function(t){var a=t;try{a=JSON.parse(t).msg}catch(r){}n("backend status:"+e.status+"\n"+a)})}catch(t){n("backend status:"+e.status)}},function(e){try{e.value().content(function(e){var t=e;try{t=JSON.parse(e).msg}catch(a){}n(t)})}catch(t){n(e?e.toString():"result is null")}})})}},{key:"request",value:function(e,t,a,n){e=e.toUpperCase();var r=[];for(var o in t){var c=encodeURIComponent(o),i=encodeURIComponent(t[o]);r.push(c+"="+i)}var l=this.url;return"GET"===e?(l=l+"?"+r,r=void 0):r=r.join("&"),fetch(l,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(Ae.name)||""},body:r}).then(function(e){a(new qe(e.status,e.text(),e.headers.get(Ae.name)))}).catch(function(e){n(new Me(e))})}},{key:"newRunScript",value:function(e,t,a,n){var r=new Le,o=_e(),c=this;r.user(function(r){var i=r.userName,l=r.backendTags;if(l){var s={sql:t,owner:i,jobName:o,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""};Object.assign(s,e),(e.background||!1)&&Object.assign(s,{async:!0,callback:""}),c.new_request(Ie.POST,s,a,n)}else n("\n                \n                ---------------Warning--------------------\n                \n                Please make sure you have backend configured. \n                If not, please contact admin;\n                \n                ------------------------------------------\n                ")})}},{key:"new_request",value:function(e,t,a,n){e=e.toUpperCase();var r=[];for(var o in t){var c=encodeURIComponent(o),i=encodeURIComponent(t[o]);r.push(c+"="+i)}var l=this.url;"GET"===e?(l=l+"?"+r,r=void 0):r=r.join("&");var s=0;return fetch(l,{method:e,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(Ae.name)||""},body:r}).then(function(e){return 200===(s=e.status)&&e.json().then(function(e){a(e)}),e}).then(function(e){var t=function(){e.text().then(function(e){try{n(JSON.parse(e).msg)}catch(t){n(e)}})};switch(s){case 201:break;case 400:case 500:t();break;default:console.log("unhandled")}}).catch(function(e){n(e.message)})}}]),e}(),Ge=function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!==typeof Error)throw new Error(t);throw t}},Be=function e(){Object(f.a)(this,e),this.makeSQL=function(e){return"JobList"===e?"load _mlsql_.`jobs` as output;":"ConnectMySQL"===e?'connect jdbc where\n url="jdbc:mysql://127.0.0.1:3306/wow?characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&tinyInt1isBit=false"\n and driver="com.mysql.jdbc.Driver"\n and user=""\n and password=""\n as db_1;':"ShowResource"===e?"load _mlsql_.`resource` as output;":""}},Ue=a(209),Ke=a(99),Je=function(e){function t(e){return Object(f.a)(this,t),Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"getText",value:function(){return this.editor.getValue()}},{key:"getSelection",value:function(){var e=this.editor.getSelectionRange();return this.session.getTextRange(e)}}]),t}(function(){function e(t){Object(f.a)(this,e),this.inner=t,this.session=this.inner.editor.session,this.editor=this.inner.editor}return Object(j.a)(e,[{key:"setText",value:function(e){return this.editor.setValue(e),this}},{key:"append",value:function(e){return this.session.insert({row:this.session.getLength(),column:0},"\n"+e),this}},{key:"insertAfterCursor",value:function(e){var t=this.editor.getCursorPosition();return this.session.insert(t,e),this.editor.focus(),this}}]),e}()),He=a(110),We=new b.ActionProxy,Qe=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"ls",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.ActionProxy,e.next=3,a.runScript("!hdfs -ls -F ".concat(t,";"),He(),{queryType:"robot"});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"killJob",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.runScript("!kill "+t+";",He(),{queryType:"robot"});case 2:return a=e.sent,e.next=5,We.get(g.default.JOB_KILL,{jobName:t});case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"runJob",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]&&r[1],e.next=3,We.runScript(t,He(),{async:a});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"showFunctions",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.runScript("",He(),{executeMode:"sqlFunctions"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"jobs",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=He(),e.next=3,We.runScript("load _mlsql_.`jobs` as wow;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",{jobName:t,res:a});case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"tablesInDeltaLake",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=He(),e.next=3,We.runScript("!delta show tables;",t,{queryType:"robot"});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"tablesInWorkshop",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.get(g.default.ANALYSIS_TABLES,{});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"tableInfo",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.get(g.default.ANALYSIS_TABLE_INFO,{tableName:t});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"jobProgress",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.runScript("load _mlsql_.`jobs/get/".concat(t,"` as wow;"),He(),{queryType:"robot"});case 2:if(a=e.sent,n={currentJobIndex:0,totalJobs:1},200!==a.status){e.next=17;break}if(r=a.content[0]){e.next=8;break}return e.abrupt("return",n);case 8:if(o=r.progress.currentJobIndex,1!==(c=r.progress.totalJob)){e.next=16;break}return e.next=13,We.runScript("load _mlsql_.`jobs/".concat(t,"` as wow;"),He(),{queryType:"robot"});case 13:i=e.sent,o=i.content[0].completedJobsNum,c=i.content[0].activeJobsNum+o;case 16:return e.abrupt("return",{currentJobIndex:o,totalJobs:c});case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"resourceInfo",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.runScript("load _mlsql_.`resource` as output;",He(),{queryType:"robot"});case 2:return t=e.sent,a=t.content[0].totalCores,n=t.content[0].activeTasks,e.abrupt("return",{activeTasks:n,totalCores:a});case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}(),ze=a(110),Ye=function(){function e(t){var a=this;Object(f.a)(this,e),this.enterLoading=function(){a.commandGroupRef.setState({loading:!0})},this.exitLoading=function(){a.commandGroupRef.setState({loading:!1})},this.queryPanel=t,this.client=new b.ActionProxy,this.jobName=ze(),this.editorOp=this.queryPanel.getEditorOp(),this.consoleOp=this.queryPanel.getConsoleOp();var n=this.editorOp.getSelection();this.sql=n||this.editorOp.getText(),this.commandGroupRef=this.queryPanel.commandGroup.current,this.jobProgressRef=this.queryPanel.jobProgressRef,this.taskProgressRef=this.queryPanel.taskProgressRef.current,this.displayRef=this.queryPanel.queryApp.display.current,this.dashRef=this.queryPanel.queryApp.dash.current,this.timeout=this.commandGroupRef.state.timeout,this.logInfo={},this.closed=!1}return Object(j.a)(e,[{key:"log",value:function(e){return this.consoleOp.append(e),this}},{key:"prepare",value:function(){this.enterLoading(),this.consoleOp.setText(""),this.displayRef.update(JSON.parse("[]"))}},{key:"measureTime",value:function(e){return this.exitLoading(),(new Date).getTime()-e}},{key:"saveFile",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.queryPanel.state.scriptId){e.next=4;break}return this.log("No file are opened, cannot execute save action"),e.abrupt("return");case 4:return e.next=6,this.client.post(g.default.SAVE_SCRIPT_FILE,{id:a,content:this.editorOp.getText()});case 6:return 200!==(n=e.sent).status&&this.log(n.content),200===n.status&&this.log("File[".concat(a,"] have been saved.")),e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.prepare(),a=(new Date).getTime(),e.next=4,this.client.runScript(this.sql,this.jobName,Object.assign(t,{jobName:this.jobName,async:!0,timeout:this.timeout,engineName:this.queryPanel.engineName}));case 4:if(200===(n=e.sent).status){e.next=8;break}return this.log("Fail to submit job\nTime cost:"+this.measureTime(a)+"ms"),e.abrupt("return",[]);case 8:return this.intervalTimer=setInterval(Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.monitorJob();case 2:return e.next=4,r.monitorLog();case 4:case"end":return e.stop()}},e)})),1e3),this.dashRef.queryHistory&&this.dashRef.queryHistory.reload(),this.jobProgressRef.enter(),e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelMonitor",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null),this.jobProgressRef.exit();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"monitorJob",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(g.default.JOB_DETAIL,{jobName:this.jobName});case 2:t=e.sent,3===(a=t.content).status&&(this.closed=!0,this.cancelMonitor(),this.exitLoading(),this.jobProgressRef.exit(),this.log(a.reason)),2===a.status&&(this.closed=!0,this.cancelMonitor(),this.exitLoading(),this.jobProgressRef.exit(),n=JSON.parse(a.response),this.displayRef.update(n),this.queryPanel.queryApp.setData(n));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"monitorLog",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=ze(),e.next=3,this.client.runScript("load _mlsql_.`log/".concat(this.logInfo.offset||-1,'` where filePath="engine_log" as output;'),t,{queryType:"robot"});case 3:if(200===(a=e.sent).status){e.next=6;break}return e.abrupt("return");case 6:(n=a.content[0]).value&&n.value.length>0&&this.log(n.value.map(function(e){return e.split("__MMMMMM__")[1]}).join("\n")),this.logInfo.offset=n.offset;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"killJob",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jobName){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Qe.killJob(this.jobName);case 4:t=e.sent;try{this.log(t.content[0].description)}catch(a){this.log(t.content)}this.closed=!0,this.jobName=null,this.cancelMonitor(),this.exitLoading();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Xe=a(290),$e=a.n(Xe),Ze=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).enter=function(e){a.setState({loading:!0}),a.intervalTimer=setInterval(Object(u.a)(s.a.mark(function e(){var t,n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.queryPanel.executor.jobName,e.next=3,Qe.jobProgress(t);case 3:n=e.sent,r=n.currentJobIndex,o=n.totalJobs,a.setState({progress:r/o*100});case 7:case"end":return e.stop()}},e)})),1e3)},a.exit=function(){a.intervalTimer&&(clearInterval(a.intervalTimer),a.intervalTimer=null,a.finalTime=(a.timer.getTime()/1e3).toFixed(2)+"s",a.setState({loading:!1}))},a.queryPanel=e.parent,a.state={loading:!1,progress:0},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return this.state.loading?n.createElement("div",null,n.createElement(Z.a,{type:"primary",style:{marginRight:"20px"}},"Time Cost:",n.createElement($e.a,{ref:function(t){return e.timer=t}},n.createElement($e.a.Minutes,{formatValue:function(e){return"".concat(e," m. ")}}),n.createElement($e.a.Seconds,{formatValue:function(e){return"".concat(e," s. ")}}))),n.createElement(Ne.a,{type:"circle",percent:this.state.progress})):this.finalTime?n.createElement(Z.a,{type:"primary",style:{margin:"0px 0px 20px 0px"}},"Time Cost: ",this.finalTime):n.createElement("div",null)}}]),t}(n.Component),et=(a(775),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).enter=function(e){},a.exit=function(){},a.queryPanel=e.parent,a.state={percent:0},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n,r,o,c,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.resourceInfo();case 2:return t=e.sent,a=t.activeTasks,n=t.totalCores,e.next=7,Qe.jobs();case 7:r=e.sent,o=r.jobName,c=r.res,i=c.content.filter(function(e){return e.jobName!==o}).length,this.setState({percent:a/n*100,totalCores:n,activeTasks:a,jobNum:i});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return n.createElement("div",{className:"rp-main"},n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"CPU Usage(total cores:",this.state.totalCores,"): "),n.createElement(Ne.a,{percent:this.state.percent,style:{maxWidth:"300px"}})),n.createElement("div",{className:"rp-block"},n.createElement("div",{className:"rp-name"},"Jobs Running: ",n.createElement("span",null,this.state.jobNum))))}}]),t}(n.Component));function tt(e){var t=Object(n.useState)(void 0),a=Object(p.a)(t,2),o=(a[0],a[1],Object(n.useState)([])),c=Object(p.a)(o,2),i=c[0],l=c[1],d=Object(n.useState)(!1),m=Object(p.a)(d,2),f=(m[0],m[1]),h=Object(n.useState)(void 0),v=Object(p.a)(h,2),y=v[0],E=v[1];Object(n.useEffect)(function(){(function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),t=new b.ActionProxy,e.next=4,t.get(g.default.ENGINE_LIST,{});case 4:a=e.sent,l(a.content.data),n=S.extraOption().backend,a.content.data.length>0&&!n&&E(a.content.data[0].name),f(!1);case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[]),Object(n.useEffect)(function(){e.useEngine(y)},[y]);return r.a.createElement(Ue.a,{onChange:function(e){E(e)},style:{width:"120px"}},i.map(function(e){return r.a.createElement(Ue.a.Option,{value:e.name},e.name)}))}var at=Ue.a.Option,nt=(a(110),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).text=function(e,t){a.setState({value:e,scriptId:t},function(){a.aceEditorRef.current.editor.setValue(e,1)})},a.executeSave=Object(u.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ye(Object(je.a)(Object(je.a)(a))),e.next=3,t.saveFile({});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)})),a.getAllText=function(){return a.getAceEditor().getValue()},a.getSelection=function(){return a.getEditorOp().getSelection()},a.appendToEditor=function(e){return a.getEditorOp().insertAfterCursor(e)},a.getEditorOp=function(){return new Je(a.aceEditorRef.current)},a.getConsoleOp=function(){return new Je(a.queryApp.messageBox.current)},a.getAceEditor=function(){return a.getEditorOp().editor},a.getMessageBoxAceEditor=function(){return a.getConsoleOp().editor},a.appendLog=function(e){return a.getConsoleOp().append(e)},a.getDashBoard=function(){return a.queryApp.dash.current},a.getDisplay=function(){return a.queryApp.display.current},a.enterLoading=function(e){a.commandGroup.current.setState({loading:!0}),a.resourceProgressRef.current.enter({jobName:e}),a.jobProgressRef.enter({jobName:e}),a.taskProgressRef.current.enter({jobName:e})},a.exitLoading=function(){a.commandGroup.current.setState({loading:!1}),a.jobProgressRef.exit(),a.resourceProgressRef.current.exit(),a.taskProgressRef.current.exit()},a.etOver=function(e){var t=a.queryApp.etRef.current,n=t.getData("eventName"),r=t.getData("popName"),o=t.getData("processType"),c=t.getData("pathAlias"),i=t.getData("tableHidden"),l=t.getData("pathHidden"),s=t.getData("outputTableHidden"),u=t.getData("outputTableAlias"),p=t.getData("tableAlias");"direct"===o?a.appendToEditor((new Be).makeSQL(n)):t.setState({etPop:!0,eventName:n,popName:r,processType:o,pathAlias:c,tableHidden:i,pathHidden:l,outputTableHidden:s,outputTableAlias:u,tableAlias:p})},a.language=a.props.language||"sql",a.queryApp=a.props.parent,a.aceEditorRef=n.createRef(),a.commandGroup=n.createRef(),a.taskProgressRef=n.createRef(),a.cancelQuery=a.cancelQuery.bind(Object(je.a)(Object(je.a)(a))),a.executeQuery=a.executeQuery.bind(Object(je.a)(Object(je.a)(a))),a.state={value:"",loading:!1},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this);var e={getCompletions:function(){var e=Object(u.a)(s.a.mark(function e(t,a,n,r,o){var c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.getSuggestList(t.getValue(),n.row,n.column);case 2:c=e.sent,o(null,c.map(function(e){var t="";return"desc"in e.extra&&(t=e.extra.desc),{caption:e.name,value:e.name,meta:t}}));case 4:case"end":return e.stop()}},e)}));return function(t,a,n,r,o){return e.apply(this,arguments)}}()};this.getAceEditor().completers=[e]}},{key:"onChange",value:function(e){}},{key:"executeQuery",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.executor||this.executor.closed){e.next=4;break}return this.log("Job ".concat(this.jobName," is still running.")),this.log("Try to kill this job or wait it to finish"),e.abrupt("return");case 4:return this.executor=new Ye(this),e.next=7,this.executor.run({});case 7:return t=e.sent,this.executor.closed||(this.executor.closed=!0),e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cancelQuery",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.executor&&this.executor.killJob();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:function(e){return e.preventDefault()},onDrop:this.etOver},n.createElement(Ke.Resizable,{defaultSize:{height:"500px"},onResize:function(){e.aceEditorRef.current.editor.resize()}},n.createElement(Se.a,{ref:this.aceEditorRef,mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(rt,{ref:this.commandGroup,parent:this}),n.createElement(Ze,{ref:function(t){e.jobProgressRef=t},parent:this}),n.createElement(ot,{ref:this.taskProgressRef,parent:this}))}}]),t}(n.Component)),rt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).onChange=function(e){a.setState({timeout:e})},a.state={loading:!1,timeout:"-1"},a.parent=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(Z.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(Z.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(Z.a,{onClick:this.parent.executeSave},"Save"),"Job Timeout:",n.createElement(Ue.a,{onChange:this.onChange,style:{width:"120px"}},n.createElement(at,{value:"10000"},"10s"),n.createElement(at,{value:"30000"},"30s"),n.createElement(at,{value:"60000"},"60s"),n.createElement(at,{value:"1800000"},"30m"),n.createElement(at,{value:"7200000"},"2h"),n.createElement(at,{value:"28800000"},"8h"),n.createElement(at,{value:"-1"},"unlimited")),n.createElement(P.a,{type:"vertical"}),"Engine:",n.createElement(tt,{useEngine:function(t){e.engineName=t}}))}}]),t}(n.Component),ot=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).enter=function(e){var t=Object(je.a)(Object(je.a)(a));a.setState({mark:!0}),setTimeout(function(){t.state.mark&&(t.setState({loading:!0}),t.intervalTimer=setInterval(function(){if("loading"!==t.taskCompute){t.taskCompute="loading";var a=new Ve(Fe);Ge(e.hasOwnProperty("jobName"),"jobName is required");var n=e.jobName;a.runScript({},"load _mlsql_.`jobs/".concat(n,"` as output;"),function(e){t.taskCompute="loaded";var a=e[0],n={numTasks:0,numActiveTasks:0,numCompletedTasks:0};a.activeJobs.forEach(function(e){n.numTasks+=e.numTasks,n.numActiveTasks+=e.numActiveTasks,n.numCompletedTasks+=e.numCompletedTasks}),t.setState({percent:n.numActiveTasks/n.numTasks*100,successPercent:n.numCompletedTasks/n.numTasks*100,title:"Tasks (for all stages): Succeeded/Total:\n".concat(n.numCompletedTasks,"/").concat(n.numTasks,"(").concat(n.numActiveTasks," running)")})},function(e){t.taskCompute="loaded";try{t.parent.appendLog(e)}catch(a){console.log(a)}})}},1e3))},1e3)},a.exit=function(){a.taskCompute="loaded",a.resourceCompute="loaded",a.setState({loading:!1,percent:0,successPercent:0,mark:!1}),a.intervalTimer&&clearInterval(a.intervalTimer)},a.state={loading:!1,percent:0,successPercent:0,mark:!1},a.parent=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return this.state.loading?n.createElement("div",null,this.state.title,n.createElement(Ne.a,{percent:this.state.percent,successPercent:this.state.successPercent})):n.createElement("div",null)}}]),t}(n.Component),ct=nt,it=(a(778),a(1145)),lt=a(1153),st=a(217),ut=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).setRender=function(e,t){var r=t[0][e.key];if(a.config&&a.config.render){var o=a.config.render[e.key];o&&(e.render=o)}else{try{if(n.Component.isPrototypeOf(r.type))return void(e.render=function(e){return n.createElement("span",null,e)})}catch(c){}"html"!=e.key?"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=function(e){return n.createElement("pre",null,e.toString())}):e.render=function(e){return n.createElement("span",null,e.toString())}:e.render=function(e){return n.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return n.createElement("span",null,JSON.stringify(e).substring(0,300))}:e.render=function(e){return n.createElement("pre",null,e.substring(0,300))}}},a.update=function(e,t){a.config=t;var n=[],r={},o=[],c=Object(je.a)(Object(je.a)(a));e.forEach(function(t){for(var a in t)if(!r[a]){var o={title:a,dataIndex:a,key:a};c.setRender(o,e),n.push(o),r[a]=!0}}),e.forEach(function(e,t){var a={};n.forEach(function(t){a[t.key]=e[t.key]}),a.key=t,o.push(a)}),a.setState({columns:n,data:o})},a.rowDoubleClick=function(e,t,n){"codeExample"!==e.name&&"doc"!==e.name||a.setState({view:{enabled:!0,content:e.value}})},a.disablePreview=function(){a.setState({view:{enabled:!1}})},a.tableStyle=e.style||{},a.state={columns:[],rows:[],view:{enabled:!1}},a.config={},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",{style:this.tableStyle},n.createElement(it.a,{onRow:function(t,a){return{onDoubleClick:function(n){e.rowDoubleClick(t,a,n)}}},columns:this.state.columns,dataSource:this.state.data}),n.createElement(lt.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(st,{source:this.state.view.content||""})))}}]),t}(n.Component),pt=a(1149),dt=a(367),mt=a(557),ft=a(553),ht=a(517),bt=a.n(ht),gt={width:200,height:200,borderWidth:2,borderColor:"#666",borderStyle:"dashed",borderRadius:5},vt={borderStyle:"solid",borderColor:"#6c6",backgroundColor:"#eee"},yt={borderStyle:"solid",borderColor:"#c66",backgroundColor:"#eee"},Et={display:"flex"},Ot=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Ee.a)(this,Object(Oe.a)(t).call(this))).onDrop=function(t){e.setState({files:t});var a=bt.a.post(Pe);a.set("Access-Token",sessionStorage.getItem(Ae.name)||""),t.forEach(function(e){a.attach(e.path,e)}),a.end(function(a,n){e.setState({files:[]}),a?(console.log(a),e.setState({msg:a.toString()+"\n Sometimes this caused by your upload space is not enough or backend fails"})):n.ok&&e.setState({msg:"total files:"+t.length+" are uploaded. \n You can check the files with command: !hdfs -ls /tmp/upload; "})})},e.state={files:[]},e}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this.state.files.map(function(e){return r.a.createElement("li",{key:e.name},e.path," - ",e.size," bytes")});return r.a.createElement("section",{style:Et},r.a.createElement("div",null,r.a.createElement(mt.a,{onDrop:this.onDrop,getDataTransferItems:function(e){return Object(ft.a)(e)}},function(e){var t=e.getRootProps,a=e.getInputProps,n=e.isDragActive,o=e.isDragAccept,c=e.isDragReject,i=(e.acceptedFiles,e.rejectedFiles,Object(k.a)({},gt));return i=n?Object(k.a)({},i,vt):i,i=c?Object(k.a)({},i,yt):i,r.a.createElement("div",Object.assign({},t(),{style:i}),r.a.createElement("input",a()),r.a.createElement("div",null,o?"Drop":"Drag"," files here..."),c&&r.a.createElement("div",null,"Unsupported file type..."))})),r.a.createElement("aside",null,r.a.createElement("h4",null,0===e.length?"":"Files"),r.a.createElement("ul",null,e)),r.a.createElement("div",null,this.state.msg?this.state.msg:""))}}]),t}(r.a.Component),kt=a(282),jt=a(40),wt=a(459),St=function(){var e=wt();return"#000000"===e&&(e="#8884d8"),e},xt=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"render",value:function(e){var t=e[0].hasOwnProperty("z");e.hasOwnProperty("dataType")||e.forEach(function(e){e.dataType="default",t||(e.z=0)});var a=e.reduce(function(e,t){t.x,t.y,t.z;var a=t.dataType,n=e.get(a);return n?n.push(t):e.set(a,[t]),e},new Map),n=e[0]._dash_config||{},o=Object(kt.a)(a.keys()).map(function(e){var t=Object.assign({fill:St(),shape:"triangle"},n[e]||{});return r.a.createElement(jt.g,Object.assign({key:e,name:e,data:a.get(e)},t))}),c=Object.assign({type:"number",dataKey:"x"},n.x||{}),i=Object.assign({type:"number",dataKey:"y"},n.y||{}),l=Object.assign({type:"number",dataKey:"z"},n.z||{});return r.a.createElement(jt.h,{width:400,height:400,margin:{top:20,right:20,bottom:20,left:20}},r.a.createElement(jt.c,null),r.a.createElement(jt.j,c),r.a.createElement(jt.k,i),t?r.a.createElement(jt.l,l):"",r.a.createElement(jt.i,{cursor:{strokeDasharray:"3 3"}}),r.a.createElement(jt.d,null),o)}}]),e}();xt.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},xt.isShouldRender=function(e){return xt.basicCheck(e,function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&(e.hasOwnProperty("_dash_config")||e.hasOwnProperty("dash"))&&("scatter"===e.dash||"scatter"===(e._dash_config||{}).dash)})};var Tt=a(459),Ct=function(){var e=Tt();return"#000000"===e&&(e="#8884d8"),e},Nt=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"render",value:function(e){var t=e[0],a=[],n=t._dash_config||{};return"line"===t.dash||"line"===n.dash?(Object.keys(t).forEach(function(e){if("number"===typeof t[e]){var o=Object.assign({stroke:Ct()},n[e]||{});a.push(r.a.createElement(jt.e,Object.assign({key:e,type:"monotone",dataKey:e},o)))}}),r.a.createElement(jt.f,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(jt.c,{strokeDasharray:"3 3"}),r.a.createElement(jt.j,{dataKey:"x"}),r.a.createElement(jt.k,null),r.a.createElement(jt.i,null),r.a.createElement(jt.d,null),a)):"bar"===t.dash||"bar"===n.dash?(Object.keys(t).forEach(function(e){if("number"===typeof t[e]){var o=Object.assign({fill:Ct()},n[e]||{});a.push(r.a.createElement(jt.a,Object.assign({key:e,dataKey:e},o)))}}),r.a.createElement(jt.b,{width:500,height:300,data:e,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(jt.c,{strokeDasharray:"3 3"}),r.a.createElement(jt.j,{dataKey:"x"}),r.a.createElement(jt.k,null),r.a.createElement(jt.i,null),r.a.createElement(jt.d,null),a)):void 0}}]),e}();Nt.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},Nt.isShouldRender=function(e){return Nt.basicCheck(e,function(e){return e.hasOwnProperty("x")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config"))})};var It=a(528),Rt=a.n(It),At=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).renderStream=function(){var e=a.state.data,t=[],n=[];e.forEach(function(e){var a=JSON.parse(e.value),r=Rt.a.utc(a.timestamp).format("DD,h:mm:ss");t.push({x:r,inputRowsPerSecond:a.inputRowsPerSecond,processedRowsPerSecond:a.processedRowsPerSecond}),n.push({x:r,numInputRows:a.numInputRows})}),a.setState({dataForRender:t,dataForRender2:n})},a.queryApp=e.parent.parent,a.state={data:e.data,dataForRender:[],titleMap:{}},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.renderStream()}},{key:"render",value:function(){return 0===this.state.dataForRender.length?null:r.a.createElement("div",null,r.a.createElement(jt.f,{width:800,height:300,data:this.state.dataForRender},r.a.createElement(jt.e,{type:"monotone",dataKey:"inputRowsPerSecond",stroke:"#8884d8"}),r.a.createElement(jt.e,{type:"monotone",dataKey:"processedRowsPerSecond",stroke:"#82ca9d"}),r.a.createElement(jt.c,{stroke:"#ccc"}),r.a.createElement(jt.j,{dataKey:"x"}),r.a.createElement(jt.k,null),r.a.createElement(jt.d,null)),r.a.createElement(jt.f,{width:800,height:300,data:this.state.dataForRender2},r.a.createElement(jt.e,{type:"monotone",dataKey:"numInputRows",stroke:"#8884d8"}),r.a.createElement(jt.c,{stroke:"#ccc"}),r.a.createElement(jt.j,{dataKey:"x"}),r.a.createElement(jt.k,null),r.a.createElement(jt.d,null)))}}]),t}(n.Component);At.isStream=function(e){if(e.length<1)return!1;try{if(!JSON.parse(e[0].value).runId)return!1}catch(t){return!1}return!0},At.isShouldRender=function(e){return At.isStream(e)},At.renderRawData=function(e){if(!At.isShouldRender(e))return"";var t=[];return e.forEach(function(e){var a=JSON.parse(e.value);t.push(JSON.stringify(a,null,2))}),t.join("\n")};var Dt=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"render",value:function(e){var t=e[0];return r.a.createElement(Ft,{data:t})}}]),e}();Dt.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0},Dt.isShouldRender=function(e){return Dt.basicCheck(e,function(e){return e.hasOwnProperty("html")&&(e.hasOwnProperty("dash")||e.hasOwnProperty("_dash_config"))})};var Ft=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).refresh=function(e){a.setState({data:e})},a.state={data:a.props.data},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Ke.Resizable,{defaultSize:{height:"500px"}},r.a.createElement("iframe",{sandbox:"allow-scripts",style:{width:"100%",height:"100%"},srcDoc:this.state.data.html,frameBorder:"0",scrolling:"yes",ref:function(t){e.ifr=t}})))}}]),t}(r.a.Component),Pt=function(e){function t(e){var a;Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).toggleDetail=function(){a.setState({showDetail:!a.state.showDetail})},a.toggleResponse=function(){a.setState({showResponse:!a.state.showResponse})},a.queryApp=e.parent.queryApp,a.client=new b.ActionProxy,a.state={showDetail:!1,executeAgainStatus:{}};var n=function(e,t){return r.a.createElement(Z.a,{type:"link",onClick:function(){var e=Object(u.a)(s.a.mark(function e(n){var r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.target.parentNode,o=r.parentNode.cellIndex,c="",e.t0=o,e.next=2===e.t0?6:4===e.t0?8:7===e.t0?10:12;break;case 6:return c="content",e.abrupt("break",12);case 8:return c="reason",e.abrupt("break",12);case 10:return c="response",e.abrupt("break",12);case 12:return console.log(o),e.next=15,a.showDetail(t.name,c);case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e))};return a.renderConfig={render:{content:n,response:function(e,t){return r.a.createElement(Z.a,{type:"link",onClick:function(){var e=Object(u.a)(s.a.mark(function e(n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.showResponse(t.name);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},r.a.createElement("span",{style:{whiteSpace:"normal",wordWrap:"break-word",width:"100px"}},e))},reason:n,status:function(e){var t="",a={};switch(e){case"fail":case"killed":t="danger";break;case"success":t="primary",a={backgroundColor:"green"};break;case"running":t="primary"}return r.a.createElement(Z.a,{type:t,style:a},e)},__command__:function(e,t){var n=t.name;return"running"!==t.status?r.a.createElement(Z.a,{type:"primary",key:n,loading:a.state.executeAgainStatus[n],onClick:function(){var e=Object(u.a)(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.state.executeAgainStatus[n]=!0,a.setState(a.state.executeAgainStatus),e.next=4,Qe.runJob(t.content);case 4:a.reload();case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},"Execute again"):r.a.createElement(Z.a,{key:n,onClick:function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.killJob(n);case 2:e.sent,a.reload();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},"Kill")}}},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({executeAgainStatus:{}}),e.next=3,this.client.get(g.default.JOB_LIST,{});case 3:200==(t=e.sent).status&&this.display&&this.display.update(this.processData(t.content),this.renderConfig);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"processData",value:function(e){return e.map(function(e){var t="running"===e.status?e.jobName:"";return Object.assign(e,{__command__:t})})}},{key:"showDetail",value:function(){var e=Object(u.a)(s.a.mark(function e(t,a){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(g.default.JOB_DETAIL,{jobName:t});case 2:n=e.sent,this.setState({showDetail:!0,detailConsoleMessage:n.content[a]});case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"showResponse",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(g.default.JOB_DETAIL,{jobName:t});case 2:a=e.sent,this.setState({showResponse:!0}),this.respDisplay&&this.respDisplay.update(JSON.parse(a.content.response));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(lt.a,{title:"View",visible:this.state.showDetail,onCancel:this.toggleDetail,onOk:this.toggleDetail,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(Se.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.detailConsoleMessage||""})),r.a.createElement(lt.a,{title:"View",visible:this.state.showResponse,onCancel:this.toggleResponse,onOk:this.toggleResponse,cancelText:"Cancel",width:"70%",OkText:"Ok"},r.a.createElement(ut,{style:{overflow:"scroll"},ref:function(t){e.respDisplay=t},parent:this})),r.a.createElement("div",{style:{marginBottom:16}},r.a.createElement(Z.a,{type:"primary",onClick:function(){e.reload()}},"Reload")),r.a.createElement(ut,{ref:function(t){e.display=t},parent:this}))}}]),t}(r.a.Component),Lt=pt.a.Panel,_t=dt.a.TabPane;function Mt(e){}var qt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).isNormalXY=function(e){return t.basicCheck(e,function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&"number"===typeof e.y})},a.xYRender=function(e){return r.a.createElement(jt.a,{height:200,title:"Bar",data:e})},a.renderDash=function(){var e=a.state.data;return At.isShouldRender(e)?r.a.createElement(At,{data:e,parent:Object(je.a)(Object(je.a)(a))}):xt.isShouldRender(e)?xt.render(e):a.isNormalXY(e)?a.xYRender(e):Nt.isShouldRender(e)?Nt.render(e):Dt.isShouldRender(e)?Dt.render(e):r.a.createElement("div",null)},a.queryApp=e.parent,a.state={data:[],dataForRender:[],titleMap:{}},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"refresh",value:function(){try{var e=this.queryApp.queryResData||[];this.setState({data:e})}catch(t){}}},{key:"render",value:function(){var e=this;return r.a.createElement(pt.a,{onChange:Mt},r.a.createElement(Lt,{header:"Tools/Dashboard",key:"0"},r.a.createElement(dt.a,{defaultActiveKey:"0",onChange:Mt,onTabClick:function(t){"0"===t&&e.resourceProgressRef.reload()}},r.a.createElement(_t,{tab:"Cluster Info",key:"0"},r.a.createElement(et,{ref:function(t){return e.resourceProgressRef=t},parent:this})),r.a.createElement(_t,{tab:"Upload",key:"1"},r.a.createElement(Ot,null)),r.a.createElement(_t,{tab:"Dashboard",key:"2"},this.renderDash()),r.a.createElement(_t,{tab:"RawData",key:"3"},r.a.createElement("pre",null,At.renderRawData(this.state.data))),r.a.createElement(_t,{tab:"History",key:"4"},r.a.createElement(Pt,{ref:function(t){return e.queryHistory=t},parent:this})))))}}]),t}(n.PureComponent);qt.basicCheck=function(e,t){if(e.length<1)return!1;try{return t(e[0])}catch(a){return!1}return!0};var Vt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).originalEditor=function(){return a.editor.editor},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.originalEditor().container.style.lineHeight=3}},{key:"render",value:function(){var e=this;return r.a.createElement(Se.a,{maxLines:1/0,width:"100%",ref:function(t){e.editor=t},value:this.props.initialCode,mode:"sql",theme:"github"})}}]),t}(r.a.Component),Gt=a(1144),Bt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).evtExecute=function(){a.setState({isExecute:!0}),a.state.executeUnit.execute()},a.cancelExecute=function(){a.setState({isExecute:!1})},a.state={isExecute:!1,executeUnit:e.executeUnit},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.state.isExecute?r.a.createElement("span",{onClick:this.cancelExecute},r.a.createElement(Gt.a,{type:"sync",spin:!0})):r.a.createElement("span",{onClick:this.evtExecute},r.a.createElement(Gt.a,{type:"caret-right"})))}}]),t}(r.a.Component),Ut=a(110),Kt=function e(t){var a=this;Object(f.a)(this,e),this.run=function(e,t,n){var r=Ut();new Ve(Fe).newRunScript({jobName:r,timeout:a.timeout},e,t,n)},this.saveFile=function(e,t,a){new Ve(De).request(Ie.POST,{id:t,content:e},function(e){200!=e.status?e.json(function(e){a(e.msg)},function(e){a(e)}):a("saved")},function(e){a(e)})},this.timeout=t},Jt=a(217),Ht=function(e){function t(e){var a;Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).setRender=function(e,t,r){var o=t[0][e.key];if(r&&r.render){var c=a.state.config.render[e.key];c&&(e.render=c)}else{try{if(n.Component.isPrototypeOf(o.type))return void(e.render=function(e){return n.createElement("span",null,e)})}catch(i){}"object"!==typeof o?"array"!==typeof o?"boolean"!==typeof o?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=function(e){return n.createElement("pre",null,e.toString())}):e.render=function(e){return n.createElement("span",null,e.toString())}:e.render=function(e){return n.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return n.createElement("span",null,JSON.stringify(e).substring(0,300))}}},a.parseData=function(e,t){var n=[],r={},o=[],c=Object(je.a)(Object(je.a)(a));return e.forEach(function(t){for(var a in t)if(!r[a]){var o={title:a,dataIndex:a,key:a};c.setRender(o,e),n.push(o),r[a]=!0}}),e.forEach(function(e,t){var a={};n.forEach(function(t){a[t.key]=e[t.key]}),a.key=t,o.push(a)}),[n,o]},a.refresh=function(e,t){var n=a.parseData(e,t),r=Object(p.a)(n,2),o=r[0],c=r[1];a.setState({columns:o,rows:c,config:t})},a.rowDoubleClick=function(e,t,n){"codeExample"!==e.name&&"doc"!==e.name||a.setState({view:{enabled:!0,content:e.value}})},a.disablePreview=function(){a.setState({view:{enabled:!1}})};var r=a.parseData(e.data||[],e.config||{}),o=Object(p.a)(r,2),c=o[0],i=o[1];return a.state={columns:c,rows:i,view:{enabled:!1}},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement(it.a,{onRow:function(t,a){return{onDoubleClick:function(n){e.rowDoubleClick(t,a,n)}}},columns:e.state.columns,dataSource:e.state.rows}),n.createElement(lt.a,{title:"View",visible:e.state.view.enabled,onCancel:e.disablePreview,onOk:e.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(Jt,{source:e.state.view.content||""})))}}]),t}(n.Component),Wt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).refresh=function(e){if(a.setState({displayData:e,errorMsg:""}),a.displayTableRef&&a.displayTableRef.refresh(a.state.displayData,{}),a.displayDashRef){var t=a.state.displayData[0];a.displayDashRef.refresh(t)}},a.fail=function(e){a.setState({errorMsg:e}),a.editor&&a.editor.editor.setValue(e)},a.displayDash=function(){if(a.state.displayData&&Dt.isShouldRender(a.state.displayData)){var e=a.state.displayData[0];return r.a.createElement(Ft,{data:e,ref:function(e){return a.displayDashRef=e}})}return r.a.createElement("div",null)},a.displayError=function(){return a.state.errorMsg?r.a.createElement("div",null,r.a.createElement(Se.a,{maxLines:1/0,width:"100%",ref:function(e){a.editor=e},value:a.state.errorMsg,mode:"text",theme:"ace/theme/textmate"})):r.a.createElement("div",null)},a.displayTable=function(){return a.state.displayData?r.a.createElement(Ht,{data:a.state.displayData,ref:function(e){return a.displayTableRef=e}}):r.a.createElement("div",null)},a.state={errorMsg:""},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.displayError(),this.displayTable(),this.displayDash())}}]),t}(r.a.Component),Qt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).execute=function(){var e=a.codeBlock.originalEditor().getValue();new Kt(3e5).run(e,function(e){a.displayGroup.refresh(e),a.commandGroup.setState({isExecute:!1}),a.notebook.nextExecuteUnit()},function(e){a.displayGroup.fail(e),a.commandGroup.setState({isExecute:!1})})},a.codeBlockIsEmpty=function(){return""===a.getCodeStr()},a.getCodeStr=function(){return a.codeBlock.originalEditor().getValue()},a.notebook=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(Vt,{initialCode:this.props.initialCode,ref:function(t){e.codeBlock=t},executeUnit:this}),r.a.createElement(Bt,{ref:function(t){e.commandGroup=t},executeUnit:this}),r.a.createElement(Wt,{ref:function(t){return e.displayGroup=t}}))}}]),t}(r.a.Component),zt="set notebooksplitter='notebooksplitter';",Yt=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).createNewExecuteUnit=function(e){return r.a.createElement(Qt,{parent:Object(je.a)(Object(je.a)(a)),initialCode:e,ref:function(e){return a.addRef(e)}})},a.addRef=function(e){e&&a.executeUnitRefs.push(e)},a.nextExecuteUnit=function(){a.executeUnitRefs.slice(-1)[0].codeBlockIsEmpty()||(a.executeUnits.push(a.createNewExecuteUnit()),a.setState({executeUnits:a.executeUnits})),a.saveNoteBook()},a.saveNoteBook=function(){var e=a.executeUnitRefs.map(function(e){return e.getCodeStr()}).join(zt);a.engine.saveFile(e,a.scriptId,function(e){})},a.text=function(e,t){a.scriptId=t,a.initialCode=e,e&&"undefined"!==e&&(a.executeUnitRefs=[],a.executeUnits=a.initialCode.split(zt).map(function(e){return a.createNewExecuteUnit(e)}),a.setState({executeUnits:a.executeUnits}))},a.executeUnitRefs=[],a.executeUnits=[a.createNewExecuteUnit("")],a.state={executeUnits:a.executeUnits},a.engine=new Kt(3e5),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this)}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.executeUnits)}}]),t}(r.a.Component),Xt=a(110),$t=function(){function e(t){Object(f.a)(this,e),this.appendLog=t,this.log={}}return Object(j.a)(e,[{key:"cancelQueryLog",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryLog",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.cancelQueryLog(),this.intervalTimer=setInterval(Object(u.a)(s.a.mark(function e(){var a,n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Xt(),n=new b.ActionProxy,e.next=4,n.runScript("load _mlsql_.`log/".concat(t.log.offset||-1,'` where filePath="engine_log" as output;'),a,{});case 4:r=e.sent,(o=r.content[0]).value.length>0&&t.appendLog(o.value.map(function(e){return e.split("__MMMMMM__")[1]}).join("\n")),t.log.offset=o.offset;case 8:case"end":return e.stop()}},e)})),2e3);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Zt=(Ue.a.Option,a(110)),ea=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).text=function(e,t){a.setState({value:e,scriptId:t},function(){a.aceEditorRef.editor.setValue(e,1)})},a.executeSave=function(){var e=new Ve(De),t=Object(je.a)(Object(je.a)(a)),n=a.getMessageBoxAceEditor();t.state.scriptId?e.request(Ie.POST,{id:t.state.scriptId,content:t.getAceEditor().getValue()},function(e){200!=e.status?e.json(function(e){t.appendLog(e.msg)},function(e){t.appendLog(e)}):t.appendLog("saved")},function(e){t.appendLog(e)}):n.setValue("no file are opened, cannot executeSave")},a.getAllText=function(){return a.getAceEditor().getValue()},a.getSelection=function(){var e=a.getAceEditor().getSelectionRange();return a.getAceEditor().session.getTextRange(e)},a.appendToEditor=function(e){var t=a.getAceEditor(),n=t.getCursorPosition();t.session.insert(n,e),t.focus()},a.getAceEditor=function(){return a.aceEditorRef.editor},a.getMessageBoxAceEditor=function(){return a.queryApp.messageBox.current.editor},a.appendLog=function(e){var t=a.getMessageBoxAceEditor().session;t.insert({row:t.getLength(),column:0},"\n"+e)},a.getDashBoard=function(){return a.queryApp.dash.current},a.getDisplay=function(){return a.queryApp.display.current},a.language=a.props.language||"sql",a.queryApp=a.props.parent.queryApp,a.state={value:"",loading:!1},a.executeQuery=a.executeQuery.bind(Object(je.a)(Object(je.a)(a))),a.cancelQuery=a.cancelQuery.bind(Object(je.a)(Object(je.a)(a))),a.logMonitor=new $t(a.appendLog),a.log={},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this)}},{key:"onChange",value:function(e){}},{key:"executeQuery",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n,r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.commandGroup.setState({loading:!0}),this.jobName=Zt(),t=new b.ActionProxy,(a=this).getMessageBoxAceEditor().setValue(""),a.getDisplay().update(JSON.parse("[]")),n=a.getSelection(),r=a.getAllText(),""!==n&&(r=n),o=a.state.scriptId,this.logMonitor.queryLog(),e.next=13,t.runScript(r,this.jobName,{scriptId:o,runMode:"python",executeMode:"python"});case 13:if(200===(c=e.sent).status){e.next=19;break}return this.logMonitor.cancelQueryLog(),this.appendLog(c.content),this.commandGroup.setState({loading:!1}),e.abrupt("return");case 19:try{this.appendLog(c.content.join("\n"))}catch(i){this.appendLog(c.content.msg)}this.logMonitor.cancelQueryLog(),this.commandGroup.setState({loading:!1});case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cancelQuery",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jobName){e.next=2;break}return e.abrupt("return");case 2:return t=Zt(),a=new b.ActionProxy,e.next=6,a.runScript("!kill "+this.jobName+";",t,{});case 6:n=e.sent;try{this.appendLog(n.content[0].description)}catch(r){this.appendLog(n.content)}this.jobName=null,this.logMonitor.cancelQueryLog();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"mlsql-editor-area"},n.createElement("div",{onDragOver:function(e){return e.preventDefault()},onDrop:this.etOver},n.createElement(Ke.Resizable,{defaultSize:{height:"500px"},onResize:function(){e.aceEditorRef.current.editor.resize()}},n.createElement(Se.a,{ref:function(t){return e.aceEditorRef=t},mode:this.language,theme:"github",width:"100%",height:"100%",onChange:this.onChange,name:"mlsql_editor",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2,autoScrollEditorIntoView:!0}}))),n.createElement(ta,{ref:function(t){return e.commandGroup=t},parent:this}))}}]),t}(n.Component),ta=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).onChange=function(e){a.setState({timeout:e})},a.state={loading:!1,timeout:"-1"},a.parent=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{className:"mslql-editor-buttons"},n.createElement(Z.a,{onClick:this.parent.executeQuery,loading:this.state.loading},"Run"),n.createElement(Z.a,{onClick:this.parent.cancelQuery},"Cancel"),n.createElement(Z.a,{onClick:this.parent.executeSave},"Save"))}}]),t}(n.Component),aa=ea,na=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).addRef=function(e){e&&(a.editor=e)},a.text=function(e,t){a.editor.text(e,t)},a.queryApp=a.props.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.props.parentCallback&&this.props.parentCallback(this)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(aa,{parent:this,ref:function(t){return e.addRef(t)},language:"python"}))}}]),t}(r.a.Component),ra=dt.a.TabPane,oa=function(e){function t(e){var a;Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).pushRef=function(e){a.myRefs.push(e)},a.getCurrentEditor=function(){var e=a.state.activeKey,t=null;return a.myRefs.forEach(function(a){a.activeKey===e&&(t=a)}),t},a.onChange=function(e){var t=null;a.state.panes.forEach(function(a){a.key===e&&(t=a)}),t&&!t.title.endsWith(".mlsql")?a.parent.setState({displayEditor:"normal"}):t&&!t.title.endsWith(".nb")?a.parent.setState({displayEditor:"notebook"}):a.parent.setState({displayEditor:"pythoneditor"}),a.setState({activeKey:e})},a.onEdit=function(e,t){a[t](e)},a.addFull=function(e,t){var r=a.state.panes,o="newTab".concat(a.newTabIndex++);r.push({title:e||"MLSQL "+a.newTabIndex,content:function(r){return e.endsWith(".mlsql")?n.createElement(ct,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:r}),t&&t({ref:e,activeKey:r})},activeKey:r}):e.endsWith(".nb")?n.createElement(Yt,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:r}),t&&t({ref:e,activeKey:r})},activeKey:r}):e.endsWith(".py")?n.createElement(na,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:r}),t&&t({ref:e,activeKey:r})},activeKey:r}):void 0}(o),key:o}),a.setState({panes:r,activeKey:o})},a.add=function(){a.addFull("MLSQL "+(a.newTabIndex+1),function(e){})},a.getPaneIndexByActiveKey=function(e){var t;return a.state.panes.forEach(function(a,n){a.key===e&&(t=n-1)}),t},a.remove=function(e){var t=a.state.activeKey,n=a.getPaneIndexByActiveKey(e),r=a.state.panes.filter(function(t){return t.key!==e});r.length&&t===e&&(t=n>=0?r[n].key:r[0].key);var o=a.myRefs.filter(function(t){return t.activeKey===e});a.myRefs=a.myRefs.filter(function(t){return t.activeKey!==e}),a.parent.closeEditor(o[0]),a.setState({panes:r,activeKey:t})},a.parent=e.parent,a.myRefs=[],a.newTabIndex=0;var r=[{title:"MLSQL 1",content:n.createElement(ct,{parent:a.parent,parentCallback:function(e){a.pushRef({ref:e,activeKey:"newTab0"})},activeKey:"newTab0"}),key:"newTab0"}];return a.state={activeKey:r[0].key,panes:r},a.newTabIndex++,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement(dt.a,{onChange:this.onChange,activeKey:this.state.activeKey,type:"editable-card",onEdit:this.onEdit},this.state.panes.map(function(e){return n.createElement(ra,{tab:e.title,key:e.key,closable:e.closable},e.content)}))}}]),t}(n.Component),ca=a(192),ia=a(104),la=$.a.Group,sa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).etPopLoad=e.parent,a.state={},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement("span",null,"parameters:"),n.createElement(la,{compact:!0},this.state.dataForRender))}}]),t}(n.Component),ua=a(110),pa=function e(){Object(f.a)(this,e)};pa.getTempTableName=function(){return(ua()+"").replace(/-/g,"")},pa.getJobName=function(){return ua()+""},pa.escapeQuote=function(e){return e?e.replace(/[\""]/g,'\\"'):e},pa.unQuote=function(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,e.length-1):e.startsWith("'")&&e.endsWith("'")?e.slice(1,e.length-1):e.startsWith("'''")&&e.endsWith("'''")?e.slice(3,e.length-3):e},pa.visitDown=function(e,t){t(e),e.children&&e.children.map(function(e){pa.visitDown(e,t)})},pa.visitUp=function(e,t){e.children&&e.children.map(function(e){pa.visitUp(e,t)}),t(e)},pa.robotFetchParam=function(){return{queryType:"robot",fetchType:"take",includeSchema:!0}},pa.robotFetchParamWithCollect=function(){return{queryType:"robot",includeSchema:!0}},pa.getField=function(e){return e.startsWith("`")&&e.endsWith("`")?e:"`".concat(e,"`")},pa.distinct=function(e,t){var a={};return e.filter(function(e){return!(e[t]in a)&&(a[e[t]]=e[t],!0)})},pa.fastCompareObject=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},pa.deepCompareObject=function(e,t){var a,n;return function e(t,r){var o;if(isNaN(t)&&isNaN(r)&&"number"===typeof t&&"number"===typeof r)return!0;if(t===r)return!0;if("function"===typeof t&&"function"===typeof r||t instanceof Date&&r instanceof Date||t instanceof RegExp&&r instanceof RegExp||t instanceof String&&r instanceof String||t instanceof Number&&r instanceof Number)return t.toString()===r.toString();if(!(t instanceof Object&&r instanceof Object))return!1;if(t.isPrototypeOf(r)||r.isPrototypeOf(t))return!1;if(t.constructor!==r.constructor)return!1;if(t.prototype!==r.prototype)return!1;if(a.indexOf(t)>-1||n.indexOf(r)>-1)return!1;for(o in r){if(r.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof r[o]!==typeof t[o])return!1}for(o in t){if(r.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof r[o]!==typeof t[o])return!1;switch(typeof t[o]){case"object":case"function":if(a.push(t),n.push(r),!e(t[o],r[o]))return!1;a.pop(),n.pop();break;default:if(t[o]!==r[o])return!1}}return!0}(e,t)};var da,ma,fa=$.a.Group,ha=Ue.a.Option,ba=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).componentDidMount=Object(u.a)(s.a.mark(function e(){var t,r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object(je.a)(Object(je.a)(a)),t=new b.ActionProxy,e.next=4,t.runScript("load _mlsql_.`datasources` as output;",pa.getJobName(),pa.robotFetchParamWithCollect());case 4:r=e.sent,o=pa.distinct(r.content.data,"name"),c=[],o.forEach(function(e){c.push(n.createElement(ha,{key:e.name,value:e.name},e.name))}),a.setState({datasourcesRender:c});case 9:case"end":return e.stop()}},e)})),a.params=function(e){a.data.params[e.target.getAttribute("name")]=e.target.value},a.sourceType=function(e,t){a.data.sourceTypeV=e;var r=Object(je.a)(Object(je.a)(a));new Ve(Fe).runScript({},"load _mlsql_.`datasources/params/".concat(e,"` as output;"),function(e){var t=[];e.forEach(function(e){t.push(n.createElement(ca.a,{key:"row-".concat(e.param)},n.createElement(ia.a,null,n.createElement($.a,{key:"input-".concat(e.param),style:{marginBottom:"10px"},name:e.param,onChange:r.params,type:"text",addonBefore:e.param,placeholder:e.description}))))}),r.loadParamsRef.current.setState({dataForRender:t})},function(e){})},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.makeMLSQL=function(){var e=Object(je.a)(Object(je.a)(a)),t=[];for(var n in a.data.params){var r=a.data.params[n];if(r){var o='"'+r+'"';"code"!==n&&"fitParam.[group].code"!==n||(o="'''"+r+"'''"),t.push(n.replace(/\[group\]/g,"0")+"="+o)}}var c="";return t.length>0&&(c="where"),"load ".concat(e.data.sourceTypeV,".`").concat(e.data.pathV,"` ").concat(c," ").concat(t.join("and\\n ")," as ").concat(e.data.tableNameV,";")},a.etpop=e.parent,a.data={params:{}},a.state={datasourcesRender:[]},a.loadParamsRef=n.createRef(),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement(fa,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,"soureType:",n.createElement(Ue.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.datasourcesRender)))),n.createElement("br",null),this.props.ignorePath?n.createElement("div",null):n.createElement(fa,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{onChange:this.path,type:"text",label:"Path",addonBefore:"Path",placeholder:"File path or tableName"})))),n.createElement("br",null),this.props.ignoreTableName?n.createElement("div",null):n.createElement(fa,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"tableName"})))),n.createElement("br",null),n.createElement(sa,{parent:this,ref:this.loadParamsRef}))}}]),t}(n.Component),ga=$.a.Group,va=(Ue.a.Option,$.a.TextArea),ya=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).renderParam=function(e){return"keepVersion"===e.param&&"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(ca.a,null,n.createElement(ia.a,null,e.param,":",n.createElement(va,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",rows:10}))):n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",addonBefore:e.param,placeholder:e.description})))},a.params=function(e){a.data.params[e.target.getAttribute("name")]=e.target.value},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.makeMLSQL=function(){Object(je.a)(Object(je.a)(a));var e=[];for(var t in a.data.params){var n=a.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+n+'"')}return 0==e.length&&e.push('keepVersion="true"'),"train ".concat(a.data.tableNameV," as ").concat(a.name,".`").concat(a.data.pathV,"` where \n").concat(e.join(" and\n "),";")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[]},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this;new Ve(Fe).runScript({},"load modelParams.`".concat(t.name,"` as output;"),function(a){var r=[];a.forEach(function(t){var a=e.renderParam(t);null!==a&&(r.push(a),r.push(n.createElement("br",null)))}),t.setState({dataForRender:r})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement("span",null,"Training data and model path:"),n.createElement(ga,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{type:"text",onChange:this.tableName,size:"large",addonBefore:"tableName",placeholder:"the table of training data"})))),n.createElement("br",null),n.createElement(ga,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{onChange:this.path,type:"text",size:"large",addonBefore:"Model save path",placeholder:"the location you save you model"})))),n.createElement("br",null),n.createElement("span",null,"Algorithm parameters:"),n.createElement(ga,{compact:!0},this.state.dataForRender))}}]),t}(n.Component),Ea=$.a.Group,Oa=Ue.a.Option,ka=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).sourceType=function(e,t){a.data.sourceTypeV=e},a.saveMode=function(e,t){a.data.saveModeV=e},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.partitionBy=function(e){a.data.partitionByV=e.target.value},a.fileNum=function(e){a.data.fileNumV=e.target.value},a.makeMLSQL=function(){var e=Object(je.a)(Object(je.a)(a)),t="";a.data.partitionByV&&(t="partitionBy "+a.data.partitionByV);var n='key="value"';return a.data.fileNumV&&(n='fileNum="'.concat(a.data.fileNumV,'"')),"save ".concat(e.data.saveModeV," ").concat(e.data.tableNameV," as ").concat(e.data.sourceTypeV,".`").concat(e.data.pathV,"` \n where ").concat(n," ").concat(t,";")},a.etpop=e.parent,a.data={},a.state={datasourcesRender:[]},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new Ve(Fe).runScript({},"load _mlsql_.`datasources` as output;",function(t){var a=[];t.forEach(function(e){a.push(n.createElement(Oa,{key:e.name,value:e.name},e.name))}),e.setState({datasourcesRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(Ea,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,"soureType:",n.createElement(Ue.a,{onChange:this.sourceType,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.datasourcesRender)))),n.createElement("br",null),n.createElement(Ea,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,"SaveMode:",n.createElement(Ue.a,{onChange:this.saveMode,showSearch:!0,style:{width:200},placeholder:"Choose save mode type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(Oa,{key:"overwrite",value:"overwrite"},"overwrite"),n.createElement(Oa,{key:"append",value:"append"},"append"),n.createElement(Oa,{key:"errorIfExists",value:"errorIfExists"},"errorIfExists"),n.createElement(Oa,{key:"ignore",value:"ignore"},"ignore"))))),n.createElement("br",null),n.createElement(Ea,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{type:"text",onChange:this.tableName,label:"tableName",addonBefore:"tableName",placeholder:"the tableName will be saved"})))),n.createElement("br",null),n.createElement(Ea,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{onChange:this.path,type:"text",addonBefore:"Target Path",placeholder:"File path or tableName"})))),n.createElement("br",null),n.createElement(Ea,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{type:"text",onChange:this.partitionBy,addonBefore:"partitionBy",placeholder:"partitionBy"})))),n.createElement("br",null),n.createElement(Ea,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{type:"text",onChange:this.fileNum,addonBefore:"fileNum",placeholder:"fileNum"})))),n.createElement("br",null))}}]),t}(n.Component),ja=a(156),wa=$.a.Group,Sa=(Ue.a.Option,$.a.TextArea),xa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).renderParam=function(e){return"keepVersion"===e.param||"evaluateTable"===e.param?null:"code"===e.param||"fitParam.[group].code"===e.param?n.createElement(ca.a,null,n.createElement(ia.a,null,e.param,":",n.createElement(Sa,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",rows:10}))):n.createElement(ca.a,{key:e.param},n.createElement(ia.a,null,n.createElement($.a,{style:{marginBottom:"10px"},name:e.param,onChange:a.params,type:"text",addonBefore:e.param,placeholder:e.description})))},a.params=function(e){a.data.params[e.target.getAttribute("name")]=e.target.value},a.path=function(e){a.data.pathV=e.target.value},a.tableName=function(e){a.data.tableNameV=e.target.value},a.outputTableName=function(e){a.data.outputTableNameV=e.target.value},a.showTableName=function(){return"true"!==a.state.tableHidden?n.createElement(wa,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{type:"text",onChange:a.tableName,size:"large",addonBefore:a.state.tableAlias?a.state.tableAlias:"Input table",placeholder:""})))):null},a.showOutputTableName=function(){return"true"!==a.state.outputTableHidden?n.createElement(wa,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{type:"text",onChange:a.outputTableName,size:"large",addonBefore:a.state.outputTableAlias?a.state.outputTableAlias:"Output table",placeholder:""})))):null},a.pathNameForRender=function(){return a.state.pathAlias?a.state.pathAlias:"Save path"},a.showPathName=function(){return"true"!==a.state.pathHidden?n.createElement(wa,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{onChange:a.path,type:"text",size:"large",addonBefore:a.pathNameForRender(),placeholder:""})))):""},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden,outputTableHidden:e.outputTableHidden,outputTableAlias:e.outputTableAlias,tableAlias:e.tableAlias},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this;new Ve(Fe).runScript({},"load modelParams.`".concat(t.name,"` as output;"),function(a){var r=[];a.forEach(function(t){var a=e.renderParam(t);null!==a&&(r.push(a),r.push(n.createElement("br",null)))}),t.setState({dataForRender:r})},function(e){})}},{key:"_makeMLSQL",value:function(){var e=[];for(var t in this.data.params){var a=this.data.params[t],n='"'+a+'"';"code"!==t&&"fitParam.[group].code"!==t||(n="'''"+a+"'''"),e.push(t.replace(/\[group\]/g,"0")+"="+n)}var r="";e.length>0&&(r="where");var o="";return this.data.outputTableNameV&&(o="as ".concat(this.data.outputTableNameV)),"run ".concat(this.data.tableNameV||"command"," as ").concat(this.name,".`").concat(this.data.pathV||"","` ").concat(r," ").concat(e.join("and\n ")," ").concat(o,";")}},{key:"_render",value:function(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(wa,{compact:!0},this.state.dataForRender))}}]),t}(n.Component),Ta=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).makeMLSQL=function(){return Object(ja.a)(Object(Oe.a)(t.prototype),"_makeMLSQL",Object(je.a)(a)).call(Object(je.a)(a))},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return Object(ja.a)(Object(Oe.a)(t.prototype),"_render",this).call(this)}}]),t}(xa),Ca=$.a.Group,Na=(Ue.a.Option,function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).makeMLSQL=function(){Object(je.a)(Object(je.a)(a));var e=[];for(var t in a.data.params){var n=a.data.params[t];e.push(t.replace(/\[group\]/g,"0")+'="'+n+'"')}return 0==e.length&&e.push('keepVersion="true"'),"run command as ".concat(a.name,".`` where \n").concat(e.join(" and\n "),";")},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement(Ca,{compact:!0},this.state.dataForRender))}}]),t}(Ta)),Ia=(a(1048),a(1049),a(1050),a(530)),Ra=a.n(Ia),Aa=Ue.a.Option,Da=$.a.TextArea,Fa=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).udfName=function(e){a.data.udfNameV=e.target.value},a.dataType=function(e){a.data.dataTypeV=e.target.value},a.udfType=function(e){a.udfTypeV=e},a.code=function(e){a.codeV=e},a.langSelect=function(e){a.lang=e,a.codeCheckRef.current.checked=!1,a.setState({dataType:!1}),"python"===a.lang&&a.setState({dataType:!0}),a.setState({codeLang:e})},a.setCodeExample=function(e){e?a.codeRef.current.editor.setValue(a.codeExample()):a.codeRef.current.editor.setValue("")},a.codeExample=function(){var e=a.state.codeLang||"scala";return"scala"===e?"def apply(a:Double,b:Double)={\n   a + b\n}":"python"===e?"def apply(self,m):\n    return m":"java"===e?"import java.util.HashMap;\nimport java.util.Map;\npublic class UDF {\n  public Map<String, Integer[]> apply(String s) {\n    Map<String, Integer[]> m = new HashMap<>();\n    Integer[] arr = {1};\n    m.put(s, arr);\n    return m;\n  }\n}":null},a.showDataType=function(){return a.state.dataType?n.createElement(ca.a,null,n.createElement(ia.a,null,"dataType:",n.createElement(Da,{style:{marginBottom:"10px"},name:"dataType",rows:10,onChange:a.dataType,type:"text",addonBefore:"dataType",placeholder:"This is not required when lang is scala\nAs we know python is not strongly typed language, so\nwe should manually spcify the return type.\nmap(string,string) means a map with key is string type,value also is string type.\narray(string) means a array with string type element.\nnested is support e.g. array(array(map(string,array(string))))\n\n"}))):null},a.showCode=function(){return n.createElement("div",null,n.createElement(ca.a,null,n.createElement(ia.a,null,"code:",n.createElement(Se.a,{ref:a.codeRef,mode:a.state.codeLang||"scala",theme:"github",width:"400px",height:"300px",name:"code",fontSize:16,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,onChange:a.code,editorProps:{$blockScrolling:1/0},setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2}}))),n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement(ia.a,{span:8},"Show CodeExample:",n.createElement(Ra.a,{ref:a.codeCheckRef,onChange:a.setCodeExample})))))},a.makeMLSQL=function(){Object(je.a)(Object(je.a)(a));var e=[];return e.push('lang="'.concat(a.lang,'"')),e.push("code='''".concat(a.codeV,"'''")),e.push('udfType="'.concat(a.udfTypeV,'"')),a.dataTypeV&&e.push("dataType='''".concat(a.dataTypeV,"'''")),"register ScriptUDF.`` as ".concat(a.data.udfNameV," where \n").concat(e.join("\nand "),";")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[]},a.codeRef=n.createRef(),a.codeCheckRef=n.createRef(),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{onChange:this.udfName,type:"text",size:"large",addonBefore:"UDF Name",placeholder:"the name of udf"}))),n.createElement("br",null),n.createElement(ca.a,null,n.createElement(ia.a,{span:4},n.createElement("span",null,"udfType:")),n.createElement(ia.a,{span:20},n.createElement(Ue.a,{showSearch:!0,onChange:this.udfType,style:{width:200},placeholder:"Select udf type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(Aa,{value:"udf"},"udf"),n.createElement(Aa,{value:"udaf"},"udaf")))),n.createElement("br",null),n.createElement(ca.a,null,n.createElement(ia.a,{span:4},n.createElement("span",null,"Lang:")),n.createElement(ia.a,{span:20},n.createElement(Ue.a,{showSearch:!0,style:{width:200},placeholder:"Select language type",optionFilterProp:"children",onChange:this.langSelect,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(Aa,{value:"java"},"java"),n.createElement(Aa,{value:"scala"},"scala"),n.createElement(Aa,{value:"python"},"python")))),n.createElement("br",null),this.showDataType(),n.createElement("br",null),this.showCode(),n.createElement("br",null),n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{style:{marginBottom:"10px"},name:"methodName",onChange:this.params,type:"text",addonBefore:"methodName",placeholder:"methodName"}))))}}]),t}(n.Component),Pa=($.a.Group,Ue.a.Option),La=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).etName=function(e){a.etName=e},a.makeMLSQL=function(){return"load modelExample.`".concat(a.etName,"` as output;")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new Ve(Fe).runScript({},"load model.`list` as output;",function(t){var a=[];t.forEach(function(e){a.push(n.createElement(Pa,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(ca.a,null,n.createElement(ia.a,null,"ET:",n.createElement(Ue.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.dataForRender))))}}]),t}(n.Component),_a=($.a.Group,Ue.a.Option),Ma=function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).makeMLSQL=function(){var e=Object(je.a)(Object(je.a)(a));return"register ".concat(e.data.sourceTypeV,".`").concat(e.data.pathV,"` as ").concat(e.data.outputTableNameV,";")},a.etName=function(e){a.data.sourceTypeV=e},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new Ve(Fe).runScript({},"load model.`list` as output;",function(t){var a=[];t.forEach(function(e){a.push(n.createElement(_a,{key:e.name,value:e.name},e.name))}),e.setState({dataForRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(ca.a,null,n.createElement(ia.a,null,"ET:",n.createElement(Ue.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose DataSource type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.dataForRender))))}}]),t}(Ta),qa=$.a.Group,Va=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).makeMLSQL=function(){var e="";a.data.outputTableNameV&&(e="as ".concat(a.data.outputTableNameV));var n=Object(ja.a)(Object(Oe.a)(t.prototype),"_makeMLSQL",Object(je.a)(a)).call(Object(je.a)(a)).replace(e,""),r="predict ".concat(a.data.tableNameV," as ").concat(a.name,".`").concat(a.data.pathV||"","` ").concat(e,";");return"".concat(n,"\n        ").concat(r,"\n        register ").concat(a.name,".`").concat(a.data.pathV||"","` as ").concat(a.data.functionNameV,"; \n        ").stripMargin()},a.functionName=function(e){a.data.functionNameV=e.target.value},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,this.showTableName(),n.createElement("br",null),this.showOutputTableName(),n.createElement("br",null),this.showPathName(),n.createElement("br",null),n.createElement(qa,{compact:!0},n.createElement(ca.a,null,n.createElement(ia.a,null,n.createElement($.a,{onChange:this.functionName,type:"text",size:"large",addonBefore:"functionName",placeholder:"A function you can use to convert String to number or number to String"})))),n.createElement("br",null),0==this.state.dataForRender.length?"":n.createElement("span",null,"Parameters:"),n.createElement(qa,{compact:!0},this.state.dataForRender))}}]),t}(xa),Ga=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).makeMLSQL=function(){var e="/api_v1/public/file/download?fileName=".concat(encodeURIComponent(a.data.pathV)),t=document.createElement("a");return t.href=e,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),""},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(ja.a)(Object(Oe.a)(t.prototype),"_render",this).call(this)}}]),t}(xa),Ba=($.a.Group,Ue.a.Option),Ua=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).etName=function(e){a.etName=e},a.makeMLSQL=function(){return"load _mlsql_.`progress/".concat(a.etName,"` as output;")},a.etpop=e.parent,a.name=e.name,a.data={params:{}},a.state={dataForRender:[],tableHidden:e.tableHidden,pathAlias:e.pathAlias,pathHidden:e.pathHidden},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this;new Ve(Fe).runScript({},"load _mlsql_.`jobs` as output;",function(t){var a=t.filter(function(e){return"stream"===e.jobType}).map(function(e){return n.createElement(Ba,{key:e.jobName,value:e.jobName},e.jobName)});e.setState({dataForRender:a})},function(e){})}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(ca.a,null,n.createElement(ia.a,null,"Stream Jobs:",n.createElement(Ue.a,{onChange:this.etName,showSearch:!0,style:{width:200},placeholder:"Choose Stream Name",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.state.dataForRender))))}}]),t}(n.Component),Ka=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).disableEtModalVisible=function(){a.et.setState({etPop:!1,etModalVisible:!1})},a.enableEtModalVisible=function(){var e=a.popChild.current.makeMLSQL();a.et.makeMLSQL(e),a.et.setState({etPop:!1,etModalVisible:!1})},a.renderContent=function(){return"load"===a.et.state.eventName?n.createElement(ba,{parent:Object(je.a)(Object(je.a)(a)),ref:a.popChild}):"save"===a.et.state.eventName?n.createElement(ka,{name:a.et.state.eventName,ref:a.popChild}):"DownloadExt"===a.et.state.eventName?n.createElement(Na,{name:a.et.state.eventName,ref:a.popChild}):"StringIndex"===a.et.state.eventName?n.createElement(Va,{name:a.et.state.eventName,ref:a.popChild}):"DownloadFile"===a.et.state.eventName?n.createElement(Ga,Object.assign({name:a.et.state.eventName,ref:a.popChild},a.et.state)):"ETExample"===a.et.state.eventName?n.createElement(La,{name:a.et.state.eventName,ref:a.popChild}):"ETStreamProgress"===a.et.state.eventName?n.createElement(Ua,{name:a.et.state.eventName,ref:a.popChild}):"ScriptUDF"===a.et.state.eventName?n.createElement(Fa,{name:a.et.state.eventName,ref:a.popChild}):"register"===a.et.state.eventName?n.createElement(Ma,Object.assign({name:a.et.state.eventName,ref:a.popChild},a.et.state)):"tool"===a.et.state.processType?n.createElement(Ta,Object.assign({name:a.et.state.eventName,ref:a.popChild},a.et.state)):n.createElement(ya,{name:a.et.state.eventName,ref:a.popChild})},a.et=e.parent,a.popChild=n.createRef(),a.state={etModalVisible:!0,title:e.title},a.data={},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",null,n.createElement(K.a,{title:this.state.title,visible:this.state.etModalVisible,onCancel:this.disableEtModalVisible,onOk:this.enableEtModalVisible,okText:"Ok",cancelText:"Cancel"},this.renderContent()))}}]),t}(n.Component),Ja=a(51),Ha=a.n(Ja),Wa=pt.a.Panel,Qa=(dt.a.TabPane,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).setData=function(e,t){a.itemData[e]=t},a.getData=function(e){return a.itemData[e]},a.onDragStart=function(e){var t=e.target.getAttribute("processtype");a.setData("eventName",e.target.getAttribute("name")),a.setData("popName",e.target.getAttribute("help")),a.setData("processType",t),a.setData("pathAlias",e.target.getAttribute("pathalias")||""),a.setData("outputTableAlias",e.target.getAttribute("outputtablealias")||""),a.setData("tableAlias",e.target.getAttribute("tablealias")||""),a.setData("tableHidden",e.target.getAttribute("tablehidden")||!1),a.setData("pathHidden",e.target.getAttribute("pathhidden")||!1),a.setData("outputTableHidden",e.target.getAttribute("outputtablehidden")||!1)},a.makeMLSQL=function(e){a.queryApp.getCurrentEditor().ref.appendToEditor(e)},a.renderPop=function(){return a.state.etPop?n.createElement(Ka,{parent:Object(je.a)(Object(je.a)(a)),title:a.state.popName}):null},a.etDoubleClick=function(e){a.onDragStart(e),a.queryApp.getCurrentEditor().ref.etOver(e)},a.queryApp=e.parent,a.state={},a.itemData={},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(pt.a,{style:{margin:"0px 0px",padding:"0px 0px"}},n.createElement(Wa,{header:"Quick Menu",key:"1"},n.createElement(ca.a,{gutter:16},n.createElement(ia.a,{span:8},n.createElement(Y.a,{title:"Load/Save Data"},n.createElement(Ha.a,{tyle:{marginBottom:"10px"},title:"Load/Save Data",onDragStart:this.onDragStart,name:"load",help:"Load file/db as table",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Load data"),n.createElement(Ha.a,{tyle:{marginBottom:"10px"},title:"Save Data",onDragStart:this.onDragStart,name:"save",help:"Save table into file/db ",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Save data"))),n.createElement(ia.a,{span:8},n.createElement(Y.a,{title:"Algorithms"},n.createElement(Ha.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"TfIdfInPlace",help:"Use TfIdfInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"TfIdf"),n.createElement(Ha.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Word2VecInPlace",help:"Use Word2VecInPlace vectorize text",draggable:!0,color:"magenta",onDoubleClick:this.etDoubleClick},"Word2vec"),n.createElement(Ha.a,{tyle:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RandomForest",help:"Use RandomForest to train a model",draggable:!0,color:"magenta"},"RandomForest"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonAlg",help:"Run python lib to train",draggable:!0,color:"magenta"},"Python Algorithm"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"BigDLClassifyExt",help:"Use BigDL to develop deep learning algorithm",draggable:!0,color:"magenta"},"Deep Learning"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"NaiveBayes",help:"Use NaiveBayes",draggable:!0,color:"magenta"},"NaiveBayes"))),n.createElement(ia.a,{span:8},n.createElement(Y.a,{title:"Python"},n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonEnvExt",processtype:"tool",help:"Create Python Env",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Create Python Env"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"PythonParallelExt",processtype:"tool",help:"Run python project",pathalias:"Temp directory",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Run python project")))),n.createElement("br",null),n.createElement(ca.a,{gutter:16},n.createElement(ia.a,{span:8},n.createElement(Y.a,{title:"Register model as Function"},n.createElement(Ha.a,{onDragStart:this.onDragStart,name:"ScriptUDF",processtype:"tool",onDoubleClick:this.etDoubleClick,help:"Use ScriptUDF create udf",draggable:!0,color:"magenta"},"Create UDF"),n.createElement(Ha.a,{onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"register",help:"Register model to function ",pathalias:"Model saved path",outputtablealias:"Function name",tablealias:"Function name",tablehidden:"true",pathhidden:"false",outputtablehidden:"false",draggable:!0,color:"magenta"},"Register Model As Function"))),n.createElement(ia.a,{span:8},n.createElement(Y.a,{title:"Jobs"},n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"JobList",onDoubleClick:this.etDoubleClick,processtype:"direct",draggable:!0,color:"magenta"},"Show jobs"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,name:"Kill",onDoubleClick:this.etDoubleClick,processtype:"tool",pathalias:"groupId or jobName",tablehidden:"true",help:"Kill your job",draggable:!0,color:"magenta"},"Kill job"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETStreamProgress",processtype:"",help:"Show Progress of Stream",draggable:!0,color:"magenta"},"Show Stream Job Progress"))),n.createElement(ia.a,{span:8},n.createElement(Y.a,{title:"Tools"},n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadExt",processtype:"tool",help:"Use DownloadExt to download files you have uploaded",draggable:!0,color:"magenta"},"Download uploaded file"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ImageLoaderExt",processtype:"tool",help:"Use ImageLoaderExt to load images",pathalias:"",tablehidden:"true",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Load images"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ConnectMySQL",processtype:"direct",help:"",draggable:!0,color:"magenta"},"Connect MySQL"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"JDBC",processtype:"tool",pathalias:"DB name in connect",tablehidden:"false",help:"Run DLL on MySQL",draggable:!0,color:"magenta"},"MySQL DDL"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"TreeBuildExt",processtype:"tool",pathalias:"",tablehidden:"false",pathhidden:"true",help:"Build tree from parent-child",draggable:!0,color:"magenta"},"Parent-Child"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ETExample",processtype:"",help:"Show Example of ET",draggable:!0,color:"magenta"},"Show ET Example"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"RepartitionExt",processtype:"tool",help:"Change Table Partition Num",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"false",draggable:!0,color:"magenta"},"Repartition table"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"SendMessage",processtype:"tool",help:"Send email",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Send Mail"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"CacheExt",processtype:"tool",help:"Cache table",pathalias:"",tablehidden:"false",pathhidden:"true",outputtablehidden:"true",draggable:!0,color:"magenta"},"Cache Table"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"StringIndex",processtype:"tool",help:"Convert String to number",pathalias:"Mapping path",tablehidden:"false",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Convert String to number"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"DownloadFile",processtype:"tool",help:"Download File",pathalias:"Target file",tablehidden:"true",pathhidden:"false",outputtablehidden:"true",draggable:!0,color:"magenta"},"Download File to computer"),n.createElement(Ha.a,{style:{marginBottom:"10px"},onDragStart:this.onDragStart,onDoubleClick:this.etDoubleClick,name:"ShowResource",processtype:"direct",draggable:!0,color:"magenta"},"Cluster Resource")))))),this.renderPop())}}]),t}(n.Component)),za=a(1157),Ya=a(265),Xa=a(496),$a=za.a.TreeNode,Za=za.a.DirectoryTree,en=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).state={dbs:{},loading:!1},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,Qe.tablesInDeltaLake();case 3:200===(t=e.sent).status&&(a={},t.content.forEach(function(e){a[e.database]?a[e.database].push(e.table):a[e.database]=[e.table]}),this.setState({dbs:a})),this.setState({loading:!1});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"show",value:function(){return Object.entries(this.state.dbs).map(function(e){var t=Object(p.a)(e,2),a=t[0],r=t[1];return n.createElement($a,{title:a,key:a},r.map(function(e){return n.createElement($a,{icon:n.createElement(Xa.a,null),title:e,key:"".concat(a,".").concat(e),isLeaf:!0})}))})}},{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return n.createElement(Ya.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(Za,null,this.show()))}}]),t}(n.Component),tn=za.a.TreeNode,an=za.a.DirectoryTree,nn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).getFileList=function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.ls(t);case 2:if(200!==(n=e.sent).status||n.content[0]._corrupt_record){e.next=6;break}return r=n.content.map(function(e){return e.is_dir=a.isDir(e),e.key=e.path,e.title=e.path.split("/").slice(-1)[0],e.isLeaf=!e.is_dir,e}),e.abrupt("return",r);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.isDir=function(e){return e.permission.startsWith("d")},a.onLoadData=function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getFileList(t.props.dataRef.path);case 2:t.props.dataRef.children=e.sent,a.setState({root:Object(kt.a)(a.state.root)});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.renderTreeNodes=function(e){return e.map(function(e){return e.children?n.createElement(tn,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e},a.renderTreeNodes(e.children)):n.createElement(tn,{title:e.title,key:e.key,isLeaf:e.isLeaf,dataRef:e})})},a.state={root:[],loading:!1},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,this.getFileList("/");case 3:t=e.sent,this.setState({loading:!1,root:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return n.createElement("div",null,n.createElement(Ya.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(an,{loadData:this.onLoadData},this.renderTreeNodes(this.state.root))))}}]),t}(n.Component),rn=(a(461),a(492)),on=a(490),cn=a(488),ln=a(489),sn=a(80),un={setState:sn.SetStateActionHandler},pn={setState:sn.SetStateAction},dn=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new b.ActionProxy,n=t.data,r=n.node,o=n.consoleApp,r.isDir){e.next=10;break}return e.next=5,a.get(g.default.SCRIPT_FILE_GET,{id:r.id});case 5:if(200===(c=e.sent).status){e.next=8;break}return e.abrupt("return",{data:{error:"Fail to get file ".concat(r.label,". Reason: ").concat(c.content)}});case 8:i=c.content,o.openExistsOrNewEditor({id:r.id,content:i.content,name:i.name});case 10:return e.abrupt("return",{data:{}});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),mn=dn.handler,fn=dn.action,hn=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c,i,l,u,p,d,m;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new b.ActionProxy,n=t.data,r=n.createType,n.consoleApp,o=n.form,c=n.scriptContent,i=void 0===c?"":c,l=o.getFieldValue(),u=l.fileName){e.next=5;break}return e.abrupt("return",{data:{createFileError:"Please input the file name"}});case 5:p=t.__state.node,d=!1,e.t0=r,e.next="file"===e.t0?10:"folder"===e.t0?14:16;break;case 10:if(d=!1,u.endsWith(".mlsql")||u.endsWith(".nb")||u.endsWith(".py")){e.next=13;break}return e.abrupt("return",{data:{createFileError:"fileName should end with .mlsql or .nb or .py"}});case 13:return e.abrupt("break",16);case 14:return d=!0,e.abrupt("break",16);case 16:return m={fileName:u,isDir:d,content:i,parentId:p.id},e.next=19,a.post(g.default.SAVE_SCRIPT_FILE,m);case 19:return e.sent,e.abrupt("return",{data:Object(k.a)({},t.data,{reloading:pa.getJobName()})});case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),bn=hn.handler,gn=hn.action,vn=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.expandedKeys,n=t.__state.expandedKeys,r=a.filter(function(e){return!n.includes(e)}),o=n.filter(function(e){return!a.includes(e)}),c=new b.ActionProxy,r.forEach(function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.post(g.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!0});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o.forEach(function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.post(g.default.SAVE_SCRIPT_FILE,{id:t,isExpanded:!1});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",{data:{expandedKeys:a}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),yn=vn.handler,En=vn.action,On=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.node,e.next=3,b.ActionProxy.client.post(g.default.SCRIPT_FILE_REMOVE,{id:a.id});case 3:return e.abrupt("return",{data:Object(k.a)({},t.data,{reloading:pa.getTempTableName()})});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),kn=On.handler,jn=On.action,wn=function e(){Object(f.a)(this,e)};wn.openScriptFile="openScriptFile",wn.createScriptFile="createScriptFile",wn.deleteScriptFile="deleteScriptFile",wn.expand="expand";var Sn=Object(k.a)({},un,(da={},Object(m.a)(da,wn.openScriptFile,mn),Object(m.a)(da,wn.createScriptFile,bn),Object(m.a)(da,wn.expand,yn),Object(m.a)(da,wn.deleteScriptFile,kn),da)),xn=Object(k.a)({},pn,(ma={},Object(m.a)(ma,wn.openScriptFile,fn),Object(m.a)(ma,wn.createScriptFile,gn),Object(m.a)(ma,wn.expand,En),Object(m.a)(ma,wn.deleteScriptFile,jn),ma));function Tn(e,t){return xn[t.type](e,t.data)}var Cn=a(493),Nn=a(491),In=(a(1137),function e(){var t=this;Object(f.a)(this,e),this.build=function(e){var t,a,n={},r=[];for(a=0;a<e.length;a+=1)n[e[a].id]=a,e[a].childNodes=[];for(a=0;a<e.length;a+=1)if(0!==(t=e[a]).parentId)try{e[n[t.parentId]].childNodes.push(t)}catch(o){console.log("------------"),console.log(t),console.log(n[t.parentId])}else r.push(t);return r},this.convert=function(e){return e.childNodes&&e.childNodes.length>0&&(e.children=e.childNodes,e.children.map(function(e){return t.convert(e)})),e.id=String(e.id),e.key=e.id,e.title=r.a.createElement("span",null,e.label),e.isLeaf=!e.isDir,e.isDir?e.icon=r.a.createElement(Cn.a,null):e.icon=r.a.createElement(Nn.a,null),e}});function Rn(){var e=Object(se.a)(["\n  width: 100%; \n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 30px 30px;\n"]);return Rn=function(){return e},e}var An=ue.a.div(Rn());var Dn=function(){return r.a.createElement(An,null,r.a.createElement(Ya.a,{tip:"Loading...."}))},Fn=function(e){var t=e.contextMenuRef,a=e.dispacher,o=e.onRender,c=Object(n.useState)(void 0),i=Object(p.a)(c,2),l=i[0],s=i[1];return{onRightClick:Object(n.useCallback)(function(e){var a=e.event,n=e.node,r=a.clientX,o=a.clientY,c=function(e){t.current&&(!t.current.contains(e.target)&&s(void 0))};document.addEventListener("click",c);var i=function(){s(void 0)};return document.addEventListener("scroll",i),s({pageX:r,pageY:o,id:n.id}),function(){document.removeEventListener("click",c),document.removeEventListener("scroll",i)}},[s]),ui:Object(n.useCallback)(function(){if(l){var e=Object(k.a)({},l),n=e.pageX,c=e.pageY,i=(e.id,{zIndex:1e4,position:"fixed",left:"".concat(n,"px"),top:"".concat(c,"px"),borderRadius:"3px",boxShadow:"0 0 0 1px rgba(16, 22, 26, 0.1), 0 2px 4px rgba(16, 22, 26, 0.2), 0 8px 24px rgba(16, 22, 26, 0.2)"});return r.a.createElement("div",{ref:t,style:i},o({rightClickNodeTreeItem:l,setRightClickNodeTreeItem:s,dispacher:a}))}},[l])}},Pn=za.a.DirectoryTree,Ln={nodes:[],error:void 0,createFileError:void 0,createType:void 0,createTitle:void 0,operateModal:!1,reloading:void 0,loading:!0,expandedKeys:[]},_n=r.a.createContext();function Mn(e){var t=e.consoleApp,a=Object(d.useReducerAsync)(Tn,Ln,Sn),o=Object(p.a)(a,2),c=o[0],i=o[1],l=c.loading,m=c.nodes,f=c.error,h=c.createFileError,v=c.createType,y=c.operateModal,E=c.createTitle,O=c.reloading,k=c.expandedKeys,j=new b.ActionProxy,w=Object(n.useRef)(),S=X.a.useForm(),x=Object(p.a)(S,1)[0];Object(n.useEffect)(function(){(function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.get(g.default.SCRIPT_FILE_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=new In,n=a.build(t.content).sort(function(e,t){return e.id-t.id}),r=n.map(function(e){return a.convert(e)}),pa.visitDown(r[0],function(e){e.isExpanded&&k.push(e.id)}),i({type:"setState",data:{nodes:r,loading:!1,expandedKeys:k}});case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[O]);var T=Fn({contextMenuRef:w,dispacher:i,onRender:function(e){var t=e.rightClickNodeTreeItem,a=e.setRightClickNodeTreeItem,n=e.dispacher,o=t.id,c=void 0;return pa.visitDown(m[0],function(e){e.id===o&&(c=e)}),o===m[0].id?r.a.createElement(D.a,null,r.a.createElement(D.a.Item,{icon:r.a.createElement(rn.a,null),onClick:function(){n({type:"setState",data:{node:c,createType:"folder",createTitle:"Create Project",operateModal:!0}})}},"Create Project")):c.isDir?r.a.createElement(D.a,null,r.a.createElement(D.a.Item,{icon:r.a.createElement(on.a,null),onClick:function(){n({type:"setState",data:{node:c,createType:"file",createTitle:"Create File",operateModal:!0}}),a(void 0)},key:1},"Create Script"),r.a.createElement(D.a.Item,{icon:r.a.createElement(rn.a,null),onClick:function(){n({type:"setState",data:{node:c,createType:"folder",createTitle:"Create Folder",operateModal:!0}}),a(void 0)},key:2},"Create Folder"),r.a.createElement(D.a.Item,{icon:r.a.createElement(cn.a,null),onClick:function(){n({type:wn.deleteScriptFile,data:{node:c}}),a(void 0)},key:3},"Delete")):r.a.createElement(D.a,null,r.a.createElement(D.a.Item,{onClick:function(){n({type:wn.deleteScriptFile,data:{node:c}}),a(void 0)},key:1},"Delete"))}}),C=T.onRightClick,N=T.ui;return r.a.createElement(_n.Provider,{value:{dispacher:i}},N(),r.a.createElement(lt.a,{title:E,visible:y,onCancel:function(){i({type:"setState",data:{operateModal:!1}})},onOk:function(){i({type:wn.createScriptFile,data:{operateModal:!1,consoleApp:t,createType:v,form:x}})},cancelText:"Cancel",OkText:"Ok"},h&&r.a.createElement(me,{message:h}),r.a.createElement(X.a,{form:x},r.a.createElement(X.a.Item,{name:"fileName",label:"File Name"},r.a.createElement($.a,null)))),f&&r.a.createElement(me,{message:f}),l&&r.a.createElement(Dn,null),!l&&r.a.createElement(Pn,{onExpand:function(e){i({type:wn.expand,data:{expandedKeys:e}})},autoExpandParent:!0,expandedKeys:k,onDoubleClick:function(e,a){i({type:wn.openScriptFile,data:{consoleApp:t,node:a}})},expandAction:"click",onRightClick:C,switcherIcon:r.a.createElement(ln.a,null),treeData:m}))}var qn=dt.a.TabPane,Vn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).queryApp=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement(dt.a,{defaultActiveKey:"1",style:{maxWidth:"350px"},onTabClick:function(t){"2"===t&&e.deltaLakeTreeRef&&e.deltaLakeTreeRef.reload()}},n.createElement(qn,{tab:"Script",key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(Mn,{consoleApp:this.queryApp}))),n.createElement(qn,{tab:"DeltaLake",key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(en,{ref:function(t){return e.deltaLakeTreeRef=t}}))),n.createElement(qn,{tab:"FileSystem",key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(nn,{ref:function(t){return e.fileSystemTreeRef=t}}))))}}]),t}(n.Component),Gn=(a(462),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).openExistsOrNewEditor=function(e){var t=Object(je.a)(Object(je.a)(a));if(a.fileToEditorMap.hasOwnProperty(e.id)){var n=a.fileToEditorMap[e.id];n.ref.text(e.content,e.id),a.editorGroup.current.onChange(n.activeKey)}else a.editorGroup.current.addFull(e.name,function(a){a.ref.text(e.content,e.id),t.fileToEditorMap[e.id]=a});e.name.endsWith(".nb")?t.setState({displayEditor:"notebook"}):e.name.endsWith(".py")?t.setState({displayEditor:"pythoneditor"}):t.setState({displayEditor:"normal"})},a.closeEditor=function(e){var t=Object.keys(a.fileToEditorMap).filter(function(t){return a.fileToEditorMap[t].activeKey!==e.activeKey}).reduce(function(e,t){return e[t]=a.fileToEditorMap[t],e},{});a.fileToEditorMap=t},a.getCurrentEditor=function(){return a.editorGroup.current.getCurrentEditor()},a.setData=function(e){a.queryResData=e,a.dash.current.refresh()},a.tableAndDash=function(){if("notebook"!==a.state.displayEditor||"pythoneditor"!==a.state.displayEditor)return r.a.createElement("div",null,r.a.createElement(Ke.Resizable,{defaultSize:{height:"300px"},onResize:function(){a.messageBox.current.editor.resize()}},r.a.createElement(Se.a,{height:"100%",width:"100%",ref:a.messageBox,mode:"text",theme:"github",name:"message_box"})),r.a.createElement("div",null,r.a.createElement(qt,{ref:a.dash,parent:Object(je.a)(Object(je.a)(a))})),r.a.createElement("div",{className:"mlsql-query-display"},r.a.createElement(ut,{ref:a.display,parent:Object(je.a)(Object(je.a)(a))})))},a.state={sqlContent:"",displayEditor:"normal"},a.editorGroup=r.a.createRef(),a.messageBox=r.a.createRef(),a.display=r.a.createRef(),a.dash=r.a.createRef(),a.etRef=r.a.createRef(),a.fileToEditorMap={},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"ws-app"},r.a.createElement("div",{className:"ws-left-pane"},r.a.createElement(Ke.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},r.a.createElement(Vn,{ref:function(t){return e.leftTreePaneRef=t},parent:this}))),r.a.createElement("div",{className:"ws-right-pane"},r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(Qa,{ref:this.etRef,parent:this})),r.a.createElement(oa,{ref:this.editorGroup,parent:this}),this.tableAndDash()))}}]),t}(n.Component)),Bn=a(1158),Un=function(){function e(t){Object(f.a)(this,e),this.superclass=t}return Object(j.a)(e,[{key:"with",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.reduce(function(e,t){return t(e)},this.superclass)}}]),e}(),Kn=function(e){return new Un(e)},Jn=function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).toggleNewSession=function(){a.setState({showNewSession:!a.state.showNewSession})},a.showNewSession=function(e){if(e.node.props.table){var t={table:e.node.props.table,db:e.node.props.db};a.setState({showNewSession:!0,currentTable:t})}},a.currentTableName=function(){return a.state.currentTable?a.state.currentTable.db+"."+a.state.currentTable.table:""},a.showTable=function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({showNewSession:!1}),n=a.state.currentTable,r=n.db,o=n.table,Ac.workshop.newSession(t,r,o),a.workshop.newSession(t,r,o);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(ke.a)(t,e),t}(e)},Hn=(za.a.TreeNode,za.a.DirectoryTree),Wn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).showNewSession=function(e){var t={table:e.node.props.dataRef.path,db:""};a.setState({showNewSession:!0,currentTable:t})},a.showTable=function(){var e=Object(u.a)(s.a.mark(function e(t,n,r){var o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({showNewSession:!1}),o=a.state.currentTable,o.db,c=o.table,a.workshop.newSession(t,n,c,r);case 3:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.render=function(){return n.createElement("div",null,n.createElement(lt.a,{title:"Open Table: [".concat(a.currentTableName(),"]?"),visible:a.state.showNewSession,onCancel:a.toggleNewSession,onOk:function(){a.showTable("file",a.loadPopRef.data.sourceTypeV,a.loadPopRef.data.params)},cancelText:"Cancel",OkText:"Ok"},n.createElement(ba,{key:a.currentTableName(),ignorePath:!0,ignoreTableName:!0,ref:function(e){return a.loadPopRef=e},parent:Object(je.a)(Object(je.a)(a))})),n.createElement(Ya.a,{tip:"Loading...",spinning:a.state.loading},n.createElement(Hn,{loadData:a.onLoadData,expandAction:"doubleClick",onRightClick:a.showNewSession},a.renderTreeNodes(a.state.root))))},a.workshop=e.parent.workshop,a}return Object(ke.a)(t,e),t}(Kn(nn).with(Jn)),Qn=za.a.TreeNode,zn=za.a.DirectoryTree,Yn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).tableClick=function(e){a.setState({rightClickNodeTreeItem:{pageX:e.event.pageX,pageY:e.event.pageY,table:e.node.props.table,db:e.node.props.db}})},a.workshop=e.parent.workshop,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"show",value:function(){return Object.entries(this.state.dbs).map(function(e){var t=Object(p.a)(e,2),a=t[0],r=t[1];return n.createElement(Qn,{title:a,key:a},r.map(function(e){return n.createElement(Qn,{icon:n.createElement(Xa.a,null),title:e,table:e,db:a,key:"".concat(a,".").concat(e),isLeaf:!0})}))})}},{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement(lt.a,{title:"Open Table",visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:function(){e.showTable("delta")},cancelText:"Cancel",OkText:"Ok"},"Open  ".concat(this.currentTableName(),"]?")),n.createElement(Ya.a,{tip:"Loading...",spinning:this.state.loading},n.createElement(zn,{onRightClick:this.showNewSession},this.show())))}}]),t}(Kn(en).with(Jn)),Xn=za.a.TreeNode,$n=za.a.DirectoryTree,Zn=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).state={dbs:{},loading:!1},a.workshop=e.parent.workshop,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"reload",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,Qe.tablesInWorkshop();case 3:200===(t=e.sent).status&&(a={},t.content.forEach(function(e){a[e.sessionId]?a[e.sessionId].push(e.tableName):a[e.sessionId]=[e.tableName]}),this.setState({dbs:a})),this.setState({loading:!1});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"show",value:function(){return Object.entries(this.state.dbs).flatMap(function(e){var t=Object(p.a)(e,2),a=t[0];return t[1].map(function(e){return n.createElement(Xn,{icon:n.createElement(Xa.a,null),table:e,db:a,title:e,key:e,isLeaf:!0})})})}},{key:"componentDidMount",value:function(){var e=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reload();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement(lt.a,{title:"Open Table",visible:this.state.showNewSession,onCancel:this.toggleNewSession,onOk:function(){e.showTable("temp")},cancelText:"Cancel",OkText:"Ok"},"Open  ".concat(this.currentTableName(),"]?")),n.createElement(Ya.a,{tip:"Loading...",spinning:this.state.loading},n.createElement($n,{onRightClick:this.showNewSession},this.show())))}}]),t}(Kn(n.Component).with(Jn)),er=dt.a.TabPane,tr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).workshop=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement(dt.a,{defaultActiveKey:"1",onTabClick:function(t){"2"===t&&e.deltaLakeTreeRef&&e.deltaLakeTreeRef.reload()}},n.createElement(er,{tab:n.createElement(J.a,{id:"table_workshop"}),key:"1"},n.createElement("div",{className:"leftview-box"},n.createElement(Zn,{ref:function(t){return e.workshopTableTreeRef=t},parent:this}))),n.createElement(er,{tab:n.createElement(J.a,{id:"delta_lake"}),key:"2"},n.createElement("div",{className:"leftview-box"},n.createElement(Yn,{ref:function(t){return e.deltaLakeTreeRef=t},parent:this}))),n.createElement(er,{tab:n.createElement(J.a,{id:"file_system"}),key:"3"},n.createElement("div",{className:"leftview-box"},n.createElement(Wn,{ref:function(t){return e.fileSystemTreeRef=t},parent:this}))))}}]),t}(n.Component),ar=(a(110),a(1065),a(1147)),nr=a(1142),rr=(a(1066),D.a.SubMenu,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).enter=function(){a.setState({applyLoading:!0}),a.workshop.setState({tableLoading:!0})},a.exit=function(){a.setState({applyLoading:!1}),a.workshop.setState({tableLoading:!1})},a.showSaveDiagram=function(){a.toggle()},a.toggle=function(){a.setState({saveDiagram:!a.state.saveDiagram})},a.handleTableInput=function(){},a.handlePersit=function(){},a.props=e,a.state={applyLoading:!1,saveDiagram:!1},a.workshop=e.parent.workshop,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{style:this.props.style,className:this.props.className||"aos-box"},n.createElement(lt.a,{title:"View",visible:this.state.saveDiagram,onCancel:this.toggle,onOk:this.props.onSave,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(X.a,{className:"login-form"},n.createElement(X.a.Item,null,n.createElement($.a,{addonBefore:"tableName",onChange:this.props.handleTableInput||this.handleTableInput,placeholder:""})),n.createElement(X.a.Item,{label:"Persist table(take more space):"},n.createElement(nr.a,{onChange:this.props.handlePersit||this.handlePersit})))),n.createElement("div",{className:"aos-button"},n.createElement(Z.a,{loading:this.state.applyLoading,onClick:this.props.onApply,type:"primary"},"Apply")),n.createElement("div",{className:"aos-button"},n.createElement(Z.a,{disabled:this.state.applyLoading,onClick:this.toggle,type:"primary"},"Save As")),n.createElement("div",{className:"aos-button"},n.createElement(Z.a,{disabled:this.state.applyLoading,onClick:this.props.onRollback},"Rollback")))}}]),t}(n.Component)),or=function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).onSave=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.workshop.save(a.tableNameForSave,a.persistForSave);case 2:200===e.sent&&(a.workshop.refreshOperateStation(),a.workshop.refreshTableWorkshop());case 4:case"end":return e.stop()}},e)})),a.onRollback=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.ApplyOrSaveRef.enter(),e.next=3,a.workshop.rollback();case 3:200===e.sent&&(a.workshop.refreshOperateStation(),a.workshop.refreshTableWorkshop()),a.ApplyOrSaveRef.exit();case 6:case"end":return e.stop()}},e)})),a.handleTableInput=function(e){a.tableNameForSave=e.target.value},a.handlePersit=function(e){a.persistForSave=e},a}return Object(ke.a)(t,e),t}(e)},cr=(a(463),Ue.a.Option),ir=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).reload=Object(u.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.joinStation.joinInfo.currentTable.schema,e.next=3,Qe.tableInfo(a.joinTable);case 3:200===(n=e.sent).status&&a.setState({currentTableFields:t.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}},e)})),a.componentDidMount=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.reload();case 2:case"end":return e.stop()}},e)})),a.next=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,e),a.joinStation.next()},a.render=function(){return n.createElement(X.a,{className:"login-form",onFinish:a.next},n.createElement(X.a.Item,{name:"leftField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(Ue.a,{label:"Current Table",showSearch:!0,style:{width:200},placeholder:a.currentTable,optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},a.state.currentTableFields.map(function(e){return n.createElement(cr,{key:e.name,value:e.name},e.name)}))),n.createElement(X.a.Item,{name:"rightField",rules:[{required:!0,message:"Please select condition field!"}]},n.createElement(Ue.a,{label:"Join Table",showSearch:!0,style:{width:200},placeholder:a.joinTable,optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},a.state.joinTableFields.map(function(e){return n.createElement(cr,{key:e.name,value:e.name},e.name)}))),n.createElement(X.a.Item,null,n.createElement(Z.a,{type:"primary",htmlType:"submit"},"Next")))},a.workshop=e.parent.workshop,a.joinStation=e.parent,a.currentTable=a.joinStation.joinInfo.currentTable.table,a.joinTable=a.joinStation.joinInfo.joinTable,a.state={currentTableFields:[],joinTableFields:[]},a}return Object(ke.a)(t,e),t}(n.Component),lr=a(1156),sr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).filterOption=function(e,t){return t.title.indexOf(e)>-1},a.handleChange=function(e){a.setState({targetKeys:e}),a.props.handleChange&&a.props.handleChange({targetKeys:e})},a.getSelectFields=function(){return a.state.targetKeys||[]},a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"wow",value:function(e){return{data:e.schemaFields.map(function(e){return{title:e.name,key:e.name}}),targetKeys:[]}}},{key:"componentDidUpdate",value:function(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(k.a)({},this.wow(this.props)))}},{key:"render",value:function(){return n.createElement(lr.a,{dataSource:this.state.data,showSearch:!0,filterOption:this.filterOption,targetKeys:this.state.targetKeys,onChange:this.handleChange,render:function(e){return e.title}})}}]),t}(n.Component),ur=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).reload=Object(u.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.joinStation.joinInfo.currentTable.schema,e.next=3,Qe.tableInfo(a.joinTable);case 3:200===(n=e.sent).status&&a.setState({currentTableFields:t.fields,joinTableFields:JSON.parse(n.content.tableSchema).fields});case 5:case"end":return e.stop()}},e)})),a.componentDidMount=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.reload();case 2:case"end":return e.stop()}},e)})),a.handleLeft=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,{leftProjectFields:e.targetKeys})},a.handleRight=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,{rightProjectFields:e.targetKeys})},a.reset=function(){a.joinStation.parent.reload()},a.render=function(){return n.createElement(X.a,{labelCol:{span:6}},n.createElement(X.a.Item,{name:"leftProjectFields",label:"currentTable"},n.createElement(sr,{handleChange:a.handleLeft,schemaFields:a.state.currentTableFields,ref:function(e){return a.leftProjectFields=e},parent:Object(je.a)(Object(je.a)(a))})),n.createElement(X.a.Item,{name:"rightProjectFields",label:a.joinTable+""},n.createElement(sr,{handleChange:a.handleRight,schemaFields:a.state.joinTableFields,ref:function(e){return a.rightProjectFields=e},parent:Object(je.a)(Object(je.a)(a))})),n.createElement(X.a.Item,null,n.createElement(X.a.Item,null," ",n.createElement(Z.a,{danger:!0},"Reset"))))},a.workshop=e.parent.workshop,a.joinStation=e.parent,a.currentTable=a.joinStation.joinInfo.currentTable.table,a.joinTable=a.joinStation.joinInfo.joinTable,a.state={currentTableFields:[],joinTableFields:[]},a}return Object(ke.a)(t,e),t}(n.Component),pr=Ue.a.Option,dr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).reload=Object(u.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.tablesInWorkshop();case 2:t=e.sent,n=[],200===t.status&&(n=t.content.map(function(e){return{name:e.tableName,value:e.tableName}})),a.setState({tables:n});case 6:case"end":return e.stop()}},e)})),a.componentDidMount=Object(u.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.reload();case 2:case"end":return e.stop()}},e)})),a.next=function(e){a.joinStation.joinInfo=Object.assign(a.joinStation.joinInfo,e),a.joinStation.next()},a.render=function(){return n.createElement(X.a,{className:"login-form",onFinish:a.next},n.createElement(X.a.Item,{name:"joinType",rules:[{required:!0,message:"Please select join type!"}]},n.createElement(Ue.a,{showSearch:!0,style:{width:200},placeholder:"Select Join Type",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},n.createElement(pr,{key:"inner",value:"inner join"},"Inner Join"),n.createElement(pr,{key:"left",value:"left join"},"Left Join"),n.createElement(pr,{key:"right",value:"right join"},"Right Join"),n.createElement(pr,{key:"full",value:"full join"},"Full Join"))),n.createElement(X.a.Item,{name:"joinTable",rules:[{required:!0,message:"Please select join table!"}]},n.createElement(Ue.a,{showSearch:!0,style:{width:200},placeholder:"Choose Join Table",optionFilterProp:"children",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},a.state.tables.map(function(e){return n.createElement(pr,{key:e.name,value:e.value},e.name)}))),n.createElement(X.a.Item,null,n.createElement(Z.a,{type:"primary",htmlType:"submit"},"Next")))},a.workshop=e.parent.workshop,a.joinStation=e.parent,a.state={tables:[]},a}return Object(ke.a)(t,e),t}(n.Component);function mr(){var e=Object(se.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\ntext-align: center;\npadding-top: 80px;\nwidth: 100%;\n"]);return mr=function(){return e},e}var fr,hr,br=ar.a.Step,gr=ue.a.div(mr()),vr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).onApply=Object(u.a)(s.a.mark(function e(){var t,n,r,o,c,i,l,u,p,d,m,f,h,b,g,v,y,E;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.workshop.currentTable.table,n=a.joinInfo,r=n.joinTable,o=n.joinType,c=n.leftField,i=n.rightField,l=n.leftProjectFields,u=n.rightProjectFields,l||u){e.next=5;break}return a.workshop.toggleMessage("Fields are not selected."),e.abrupt("return");case 5:return a.ApplyOrSaveRef.enter(),e.next=8,Qe.tableInfo(r);case 8:return p=e.sent,d=p.content,m=l&&l.map(function(e){return"".concat(t,".`").concat(e,"`")}).join(","),f=u&&u.map(function(e){return"".concat(r,".`").concat(e,"`")}).join(","),h="".concat(t,".`").concat(c,"`"),b="".concat(r,".`").concat(i,"`"),g="".concat(o," ").concat(r," on ").concat(h," = ").concat(b),v="",m&&f&&(v=m+","+f),m&&!f&&(v=m),!m&&f&&(v=f),y=pa.getTempTableName(),E="".concat(d.content," \n select ").concat(v," from ").concat(t," ").concat(g," as ").concat(y,";"),console.log(E),e.next=24,a.workshop.apply({tableName:y,sql:E});case 24:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 26:case"end":return e.stop()}},e)})),a.next=function(){a.setState({currentStep:a.state.currentStep+1})},a.preview=function(){a.setState({currentStep:a.state.currentStep-1})},a.workshop=e.parent.workshop,a.joinInfo={currentTable:a.workshop.currentTable},a.state={currentStep:0,steps:[n.createElement(dr,{parent:Object(je.a)(Object(je.a)(a))}),n.createElement(ir,{parent:Object(je.a)(Object(je.a)(a))}),n.createElement(ur,{parent:Object(je.a)(Object(je.a)(a))})]},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",{className:"join-app"},n.createElement("div",{className:"station-menu"},n.createElement(rr,{parent:this,onRollback:this.onRollback,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}})),n.createElement("div",null,n.createElement(ar.a,{current:this.state.currentStep},n.createElement(br,{key:0,title:"Table",description:"Choose the table you wanna join from workshop"}),n.createElement(br,{key:1,title:"Join Condition ",description:"Choose the join condition in both tables"}),n.createElement(br,{key:2,title:"Fields",description:"Choose the fields you want from both tables"}))),n.createElement("div",{className:"join-app-form"}," ",n.createElement(gr,null,this.state.steps[this.state.currentStep])))}}]),t}(Kn(n.Component).with(or)),yr=a(217),Er=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).setRender=function(e,t){var r=t[0][e.key];if(a.config&&a.config.render)Object.keys(a.config).map(function(t){var n=a.config[t][e.key];n&&(e[t]=n)});else{try{if(n.Component.isPrototypeOf(r.type))return void(e.render=function(e){return n.createElement("span",null,e)})}catch(o){}"html"!=e.key?"object"!==typeof r?"array"!==typeof r?"boolean"!==typeof r?"fileSystem"!=e.key&&"message"!=e.key&&"info"!=e.key||(e.render=function(e){return n.createElement("pre",null,e.toString())}):e.render=function(e){return n.createElement("span",null,e.toString())}:e.render=function(e){return n.createElement("span",null,e.join(",").substring(0,300))}:e.render=function(e){return n.createElement("span",null,JSON.stringify(e).substring(0,300))}:e.render=function(e){return n.createElement("pre",null,e.substring(0,300))}}},a.update=function(e,t){a.config=t;var n=[],r={},o=[],c=Object(je.a)(Object(je.a)(a));e.forEach(function(t){for(var a in t)if(!r[a]){var o={title:a,dataIndex:a,key:a};c.setRender(o,e),n.push(o),r[a]=!0}}),e.forEach(function(e,t){var a={};n.forEach(function(t){a[t.key]=e[t.key]}),a.key=t,o.push(a)}),a.setState({columns:n,data:o})},a.rowDoubleClick=function(e,t,n){"codeExample"!==e.name&&"doc"!==e.name||a.setState({view:{enabled:!0,content:e.value}})},a.disablePreview=function(){a.setState({view:{enabled:!1}})},a.tableStyle=e.style||{},a.state={columns:[],rows:[],view:{enabled:!1}},a.config={},a.workshop=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{style:this.tableStyle},n.createElement(it.a,{size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement(lt.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(yr,{source:this.state.view.content||""})))}}]),t}(n.Component),Or=a(1161),kr=(Ue.a.Option,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).show=function(e){a.setState({func:e})},a.funcValue=function(){return n.createElement(Or.b.Item,{key:"Func"},n.createElement(Or.b.Item.Meta,{title:"Func",description:a.state.func.funcValue.extra.zhDoc}))},a.returnValue=function(){return n.createElement(Or.b.Item,{key:"Return value"},n.createElement(Or.b.Item.Meta,{title:"Return value",description:a.state.func.returnValue.extra.zhDoc}))},a.parameters=function(){return a.state.func.params.map(function(e){return n.createElement(Or.b.Item,{key:e.name},n.createElement(Or.b.Item.Meta,{title:e.name,description:e.extra.zhDoc}))})},a.state=Object(k.a)({},e),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return this.state.func?n.createElement(Or.b,{size:"large",header:n.createElement("div",null,"Function [".concat(this.state.func.value,"] Info")),footer:n.createElement("div",null),bordered:!0},this.funcValue(),this.returnValue(),this.parameters()):n.createElement("div",null)}}]),t}(n.Component)),jr=Ue.a.Option,wr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).handleSearch=function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,Qe.showFunctions();case 3:n=e.sent,r=n.content.map(function(e){return{value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)}}),a.setState({data:r}),e.next=9;break;case 8:a.setState({data:[]});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleChange=function(e){var t=a.state.data.filter(function(t){return t.value===e})[0];a.setState({currentFunc:t}),a.funcDescRef.show(t)},a.handleOperateInput=function(e){a.manuallyTransform=e.target.value},a.isAggChecked=function(e){a.manuallyIsAgg=e},a.handleNewName=function(e){a.newFuncName=e.target.value},a.handleField=function(e){var t=e.target.getAttribute("name");a.funcParams[t]=e.target.value},a.showColumn=function(e){return a.funcParams[e.name]=a.operateField,"yes"===e.extra.column?a.operateField:""},a.getTransform=function(){if(a.manuallyTransform)return{field:a.operateField,isAgg:a.manuallyIsAgg,transformCode:a.manuallyTransform,columnName:a.newFuncName};var e=[];return a.state.currentFunc.params.forEach(function(t){var n=a.funcParams[t.name];n&&("yes"===t.extra.column?e.push(pa.getField(n)):"number"==t.dataType||"boolean"==t.dataType?e.push(n):e.push('"'.concat(n,'"')))}),{field:a.operateField,isAgg:"yes"===a.state.currentFunc.funcValue.extra.agg,transformCode:"".concat(a.state.currentFunc.value,"(").concat(e.join(","),")"),columnName:a.newFuncName}},a.reload=function(){a.setState({key:Math.random(),data:[],value:void 0,funcPopUp:!1,currentFunc:void 0}),a.collect={}},a.parent=e.parent,a.operateField=e.operateField,a.funcParams={},a.state={data:[],value:void 0,funcPopUp:!1,func:{},key:Math.random()},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this,t=this.state.data.map(function(e){return n.createElement(jr,{key:e.value},e.text)});return n.createElement(X.a,{className:"login-form",key:this.state.key},n.createElement(X.a.Item,null,n.createElement(Ue.a,{showSearch:!0,value:this.state.value,placeholder:"Search function",defaultActiveFirstOption:!1,showArrow:!1,style:{width:"200px"},filterOption:!1,onSearch:this.handleSearch,onChange:this.handleChange,notFoundContent:"type function name"},t)),n.createElement(X.a.Item,null,n.createElement(kr,{ref:function(t){return e.funcDescRef=t}})),this.state.currentFunc?this.state.currentFunc.params.map(function(t){return n.createElement(X.a.Item,{key:t.name},n.createElement($.a,{name:t.name,onChange:e.handleField,addonBefore:t.name,defaultValue:e.showColumn(t)}))}):n.createElement("div",null),n.createElement(X.a.Item,null,n.createElement($.a,{addonBefore:"Mannual Transform",onChange:this.handleOperateInput,placeholder:""})),n.createElement(X.a.Item,{label:"Is Agg Function"},n.createElement(nr.a,{onChange:this.isAggChecked})),n.createElement(X.a.Item,null,n.createElement($.a,{addonBefore:"New fieldName",onChange:this.handleNewName,placeholder:""})))}}]),t}(n.Component),Sr=(D.a.SubMenu,function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).showAggFuncsAndApply=function(e){a.operateField=e.field,a.setState({funcPopUp:!0})},a.reload=function(){var e=a.workshop.currentTable.schema.fields.map(function(e){return{field:e.name,groupby:"",agg:""}}),t={render:{groupby:function(e,t){return n.createElement(nr.a,{onChange:function(e){return a.enableGroupByField(e,t)},dataref:t})},agg:function(e,t){return n.createElement(Z.a,{dataref:t,onClick:function(){a.showAggFuncsAndApply(t)}},"Choose function")}}};a.columnsRef.update(e,t)},a.handleFunc=function(){var e=a.applyFuncToFieldRef.getTransform(),t=(e.field,e.transformCode),n=e.columnName;a.generateProjectField(t,n),a.setState({funcPopUp:!1}),a.applyFuncToFieldRef.reload()},a.workshop=e.parent.workshop,a.state={funcPopUp:!1},a.groupByFields=[],a.aggFields=[],a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){this.reload()}},{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement("div",null,n.createElement(lt.a,{title:"Apply function to [".concat(this.operateField,"]"),visible:this.state.funcPopUp,onCancel:function(){e.setState({funcPopUp:!1}),e.applyFuncToFieldRef.setState({key:Math.random()})},onOk:this.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},n.createElement(wr,{parent:this,ref:function(t){return e.applyFuncToFieldRef=t},operateField:this.operateField})),n.createElement("div",{className:"station-menu"},n.createElement(rr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onApply,style:{marginBottom:"30px"}}))),n.createElement("div",null,n.createElement(Er,{parent:this,ref:function(t){return e.columnsRef=t}})))}}]),t}(Kn(n.Component).with(or,function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).enableGroupByField=function(e,t){var n=t.field;e?a.groupByFields.push(n):a.groupByFields=a.groupByFields.filter(function(e){return e.name!==n})},a.generateProjectField=function(e,t){a.aggFields.push({name:e,newName:t})},a.onApply=Object(u.a)(s.a.mark(function e(){var t,n,r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.ApplyOrSaveRef.enter(),t=pa.getTempTableName(),n=a.aggFields.map(function(e){return"".concat(e.name," as `").concat(e.newName,"`")}),r="",0!==a.groupByFields.length&&(r="group by ".concat(a.groupByFields.map(function(e){return"`".concat(e,"`")}).join(",")),n=a.groupByFields.map(function(e){return"`".concat(e,"`")}).concat(n)),o="select ".concat(n.join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," ").concat(r," as ").concat(t,";"),e.next=8,a.workshop.apply({tableName:t,sql:o});case 8:c=e.sent,a.ApplyOrSaveRef.exit(),200===c&&a.workshop.refreshOperateStation();case 11:case"end":return e.stop()}},e)})),a}return Object(ke.a)(t,e),t}(e)}))),xr=(a(464),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).getSelectFields=function(){return a.formRef.getFieldValue()},a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"wow",value:function(e){return{data:e.schemaFields.map(function(e){return{title:e.name,key:e.name}}),targetKeys:[]}}},{key:"componentDidUpdate",value:function(e){this.props.schemaFields!==e.schemaFields&&this.setState(Object(k.a)({},this.wow(this.props)))}},{key:"render",value:function(){var e=this;return n.createElement(X.a,{labelCol:{span:6},ref:function(t){e.formRef=t}},this.state.data.map(function(e){return n.createElement(X.a.Item,{key:e.key,name:e.key,label:e.key,value:e.key},n.createElement($.a,{placeholder:"input the new name here"}))}))}}]),t}(n.Component)),Tr=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).wow=function(e){return{funcPopUp:!1,data:e.schemaFields.map(function(e){return{field:e.name,func:"",transformCode:"",columnName:""}}),config:{render:{func:function(e,t){return n.createElement(Z.a,{dataref:t,onClick:function(){a.showAggFuncsAndApply(t)}},"Choose function")},transformCode:function(e,t){return e},columnName:function(e,t){return e}}}}},a.showAggFuncsAndApply=function(e){a.operateField=e.field,a.setState({funcPopUp:!0})},a.reload=function(){a.columnsRef.update(a.state.data,a.state.config)},a.handleFunc=function(){var e=a.applyFuncToFieldRef.getTransform(),t=e.field,n=e.transformCode,r=e.columnName,o=e.isAgg;if(r){var c=a.state.data.map(function(e){return e.field===t?{field:t,func:"",transformCode:n,columnName:r,isAgg:o}:e});a.setState({funcPopUp:!1,data:c,error:void 0},function(){a.reload()}),a.applyFuncToFieldRef.reload()}else a.setState({error:"New fieldName is required."})},a.getSelectFields=function(){return a.state.data},a.render=function(){return n.createElement("div",null,n.createElement(lt.a,{title:"Apply function to [".concat(a.operateField,"]"),visible:a.state.funcPopUp,onCancel:function(){a.applyFuncToFieldRef.reload(),a.setState({funcPopUp:!1,error:void 0})},onOk:a.handleFunc,cancelText:"Cancel",width:"50%",OkText:"Ok"},a.state.error&&n.createElement(me,{message:a.state.error}),n.createElement(wr,{parent:Object(je.a)(Object(je.a)(a)),ref:function(e){return a.applyFuncToFieldRef=e},operateField:a.operateField})),n.createElement(Er,{ref:function(e){return a.columnsRef=e}}))},a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.schemaFields!==e.schemaFields&&this.setState(Object(k.a)({},this.wow(this.props)),function(){t.reload()})}},{key:"componentDidMount",value:function(){this.reload()}}]),t}(n.Component),Cr=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields,n=t.__state.operateFileds.filter(function(e){return a!==e.field}),e.abrupt("return",{data:{operateFileds:n}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Nr=Cr.handler,Ir=Cr.action,Rr=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.fields.map(function(e){return{field:e}}),e.abrupt("return",{data:{operateFileds:a}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Ar=Rr.handler,Dr=Rr.action,Fr=function(){function e(){Object(f.a)(this,e)}return Object(j.a)(e,null,[{key:"apply",value:function(){var e=Object(u.a)(s.a.mark(function e(t,a,n){var r,o,c,i,l,u,p,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,o=r.workshop,c=r.values,i=t.__state.applySaveRollbackDispacher,!(l=a(c))){e.next=6;break}return i({type:"setState",data:{loading:!1}}),e.abrupt("return",{data:Object(k.a)({},t.data,{error:l,loading:!1})});case 6:return u=n(o,c),p=u.tableName,d=u.sql,e.next=9,o.apply({tableName:p,sql:d});case 9:return 200===e.sent&&o.refreshOperateStation(),i({type:"setState",data:{loading:!1}}),e.abrupt("return",{data:Object(k.a)({},t.data,{loading:!1})});case 13:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()}]),e}(),Pr=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Fr.apply(t,function(e){if(0===Object.keys(e).length)return"Please configure cast fields then click apply"},function(e,t){var a=pa.getTempTableName(),n=Object.keys(t).map(function(e){return"cast(".concat(pa.getField(e)," as ").concat(t[e],") as ").concat(pa.getField(e))}),r=Object.keys(t),o=e.currentTable.schema.fields.filter(function(e){return!r.includes(e.name)}).map(function(e){return pa.getField(e.name)}),c=n.concat(o).join(",");return{tableName:a,sql:"select ".concat(c," from ").concat(e.getLastApplyTable().tableName,"            \n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Lr=Pr.handler,_r=Pr.action,Mr=function e(){Object(f.a)(this,e)};Mr.ADD_FIELD="addField",Mr.REMOVE_FIELD="removeField";var qr=Object(k.a)({},un,(fr={},Object(m.a)(fr,Mr.ADD_FIELD,Ar),Object(m.a)(fr,Mr.REMOVE_FIELD,Nr),Object(m.a)(fr,"apply",Lr),fr)),Vr=Object(k.a)({},pn,(hr={},Object(m.a)(hr,Mr.ADD_FIELD,Dr),Object(m.a)(hr,Mr.REMOVE_FIELD,Ir),Object(m.a)(hr,"apply",_r),hr));function Gr(e,t){return Vr[t.type](e,t.data)}var Br=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.workshop,e.next=3,a.rollback();case 3:return e.abrupt("return",{data:t.data});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Ur=Br.handler,Kr=Br.action,Jr=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data.workshop,n=t.__state,r=n.saveTablePersisted,o=n.saveTableName){e.next=4;break}return e.abrupt("return",{data:{error:"table name is required"}});case 4:return e.next=6,a.save(o,r);case 6:return a.refreshTableWorkshop(),e.abrupt("return",{data:Object(k.a)({},t.data,{loading:!1})});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Hr=Jr.handler,Wr=Jr.action,Qr={setState:N.SetStateActionHandler,rollback:Ur,save:Hr};function zr(e,t){switch(t.type){case"setState":return Object(N.SetStateAction)(e,t.data);case"rollback":return Kr(e,t.data);case"save":return Wr(e,t.data);default:return e}}var Yr={saveDiagram:!1,saveTablePersisted:!1,loading:!1,saveTableName:void 0,error:void 0},Xr=r.a.createContext();function $r(e){var t=e.workshop,a=Object(n.useContext)(e.context).dispacher,o=Object(d.useReducerAsync)(zr,Yr,Qr),c=Object(p.a)(o,2),i=c[0],l=c[1],s=i.saveDiagram,u=(i.saveTablePersisted,i.loading),m=i.error;return r.a.createElement(Xr.Provider,{value:{dispacher:l}},m&&r.a.createElement(me,{message:m}),r.a.createElement(lt.a,{title:"View",visible:s,onCancel:function(){l({type:"setState",data:{saveDiagram:!1}})},onOk:function(){l({type:"save",data:{saveDiagram:!1,workshop:t}})},cancelText:"Cancel",width:"50%",OkText:"Ok"},r.a.createElement(X.a,{className:"login-form"},r.a.createElement(X.a.Item,null,r.a.createElement($.a,{addonBefore:"tableName",onChange:function(e){l({type:"setState",data:{saveTableName:e.target.value}})},placeholder:""})),r.a.createElement(X.a.Item,{label:"Persist table(take more space):"},r.a.createElement(nr.a,{onChange:function(e){l({type:"setState",data:{saveTablePersisted:e}})}})))),r.a.createElement(Z.a,{loading:u,type:"primary",onClick:function(){l({type:"setState",data:{loading:!0}}),a({type:"setState",data:{applySaveRollbackDispacher:l,applyToken:pa.getJobName()}})}},"Apply"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{disabled:u,onClick:function(){l({type:"setState",data:{saveDiagram:!0}})}},"Save As"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{disabled:u,onClick:function(){l({type:"setState",data:{loading:!0}}),l({type:"rollback",data:{workshop:t,loading:!1}})}},"Rollback"))}var Zr,eo,to=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Fr.apply(t,function(e){if(0===Object.keys(e).length)return"Please configure order fields then click apply"},function(e,t){var a=pa.getTempTableName(),n=Object.keys(t).map(function(e){return" ".concat(pa.getField(e)," ").concat(t[e]," ")}).join(",");return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            order by  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),ao=to.handler,no=to.action,ro=function e(){Object(f.a)(this,e)};ro.ADD_FIELD="addField",ro.REMOVE_FIELD="removeField";var oo=(Zr={},Object(m.a)(Zr,ro.ADD_FIELD,Ar),Object(m.a)(Zr,ro.REMOVE_FIELD,Nr),Object(m.a)(Zr,"setState",N.SetStateActionHandler),Object(m.a)(Zr,"apply",ao),Zr),co=(eo={},Object(m.a)(eo,ro.ADD_FIELD,Dr),Object(m.a)(eo,ro.REMOVE_FIELD,Ir),Object(m.a)(eo,"setState",N.SetStateAction),Object(m.a)(eo,"apply",no),eo);function io(e,t){return co[t.type](e,t.data)}var lo=Ue.a.Option,so={error:void 0,applySaveRollbackDispacher:void 0,operateFileds:[]},uo=r.a.createContext();function po(e){var t=e.workshop,a=X.a.useForm(),o=Object(p.a)(a,1)[0],c=t.currentTable.schema.fields,i=Object(d.useReducerAsync)(Gr,so,qr),l=Object(p.a)(i,2),s=l[0],u=l[1],m=s.operateFileds,f=s.error,h=s.applySaveRollbackDispacher,b=c.map(function(e){return r.a.createElement(lo,{key:e.name},e.name)});return Object(n.useEffect)(function(){h&&o.submit()},[h]),r.a.createElement(uo.Provider,{value:{dispacher:u}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},f&&r.a.createElement(me,{message:f}),r.a.createElement(X.a,{form:o,onFinish:function(e){u({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(X.a.Item,null,r.a.createElement($r,{context:uo,workshop:t})),r.a.createElement(X.a.Item,{label:"Choose fields"},r.a.createElement(Ue.a,{mode:"multiple",onDeselect:function(e){u({type:Mr.REMOVE_FIELD,data:{fields:e}})},onChange:function(e){u({type:Mr.ADD_FIELD,data:{fields:e}})}},b)),m.map(function(e){return r.a.createElement(X.a.Item,{key:e.field,label:"Cast ".concat(e.field," to"),name:e.field},r.a.createElement(Ue.a,null,r.a.createElement(Ue.a.Option,{value:"int"},"int"),r.a.createElement(Ue.a.Option,{value:"long"},"long"),r.a.createElement(Ue.a.Option,{value:"double"},"double"),r.a.createElement(Ue.a.Option,{value:"string"},"string")))}))))}var mo=dt.a.TabPane,fo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).workshop=e.parent.workshop,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement("div",{className:"station-menu"},n.createElement(dt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(mo,{tab:n.createElement(J.a,{id:"select_columns"}),key:"1"},n.createElement(rr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onSelectApply,style:{marginBottom:"30px"}}),n.createElement(sr,{schemaFields:this.workshop.currentTable.schema.fields,ref:function(t){return e.selectFieldsRef=t},parent:this})),n.createElement(mo,{tab:n.createElement(J.a,{id:"rename_columns"}),key:"2"},n.createElement(rr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onRenameApply,style:{marginBottom:"30px"}}),n.createElement(xr,{schemaFields:this.workshop.currentTable.schema.fields,ref:function(t){return e.renameFieldsRef=t},parent:this})),n.createElement(mo,{tab:n.createElement(J.a,{id:"transform_columns"}),key:"3"},n.createElement(rr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onFuncApply,style:{marginBottom:"30px"}}),n.createElement(Tr,{schemaFields:this.workshop.currentTable.schema.fields,ref:function(t){return e.functionFieldRef=t},parent:this})),n.createElement(mo,{tab:n.createElement(J.a,{id:"cast_columns_type"}),key:"4"},n.createElement(po,{workshop:this.workshop})))),n.createElement("div",null))}}]),t}(Kn(n.Component).with(or,function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).onSelectApply=Object(u.a)(s.a.mark(function e(){var t,n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.ApplyOrSaveRef.enter(),0!==(t=a.selectFieldsRef.getSelectFields().map(function(e){return"`".concat(e,"`")})).length){e.next=6;break}return a.workshop.showInfo("No fields are selected."),a.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=pa.getTempTableName(),r="select ".concat(t.join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," as ").concat(n,";"),e.next=10,a.workshop.apply({tableName:n,sql:r});case 10:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 12:case"end":return e.stop()}},e)})),a.onFuncApply=Object(u.a)(s.a.mark(function e(){var t,n,r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.ApplyOrSaveRef.enter(),0!==(t=a.functionFieldRef.getSelectFields()).length){e.next=6;break}return a.workshop.toggleMessage("No fields are renamed."),a.ApplyOrSaveRef.exit(),e.abrupt("return");case 6:return n=t.filter(function(e){return e.isAgg}).length>0,r=[],r=n?t.filter(function(e){return e.isAgg}).map(function(e){return"".concat(e.transformCode," as `").concat(e.columnName,"`")}):t.map(function(e){return e.transformCode?"".concat(e.transformCode," as `").concat(e.columnName,"`"):"`".concat(e.field,"` as `").concat(e.field,"`")}),o=pa.getTempTableName(),c="select ".concat(r.join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," as ").concat(o,";"),e.next=13,a.workshop.apply({tableName:o,sql:c});case 13:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 15:case"end":return e.stop()}},e)})),a.onRenameApply=Object(u.a)(s.a.mark(function e(){var t,n,r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.ApplyOrSaveRef.enter(),t=a.renameFieldsRef.getSelectFields(),n=a.workshop.currentTable.schema.fields.map(function(e){return"`".concat(e.name,"`")}),0!==t.length){e.next=7;break}return a.workshop.toggleMessage("No fields are renamed."),a.ApplyOrSaveRef.exit(),e.abrupt("return");case 7:return r=Object.keys(t).map(function(e){return"`".concat(e,"` as `").concat(t[e],"`")}),o=pa.getTempTableName(),c="select ".concat(n.concat(r).join(",")," from ").concat(a.workshop.getLastApplyTable().tableName," as ").concat(o,";"),e.next=12,a.workshop.apply({tableName:o,sql:c});case 12:a.ApplyOrSaveRef.exit(),a.workshop.refreshOperateStation();case 14:case"end":return e.stop()}},e)})),a}return Object(ke.a)(t,e),t}(e)})),ho={EQUAL:"=",NON_EQUAL:"!=",IN:"in",CONTAINS:"contains",STARTS_WITH:"startsWith",ENDS_WITH:"endsWith",LIKE:"like",IS_NULL:"is null",IS_NOT_NULL:"is not null",IS_EMPTY:"is empty",IS_NOT_EMPTY:"is not empty"};function bo(e){var t=e.record,a=e.workshop,o=Object(n.useState)(void 0),c=Object(p.a)(o,2),i=c[0],l=c[1],d=(t.dataType,t.field),m=Object(n.useState)([]),f=Object(p.a)(m,2),h=f[0],g=f[1],v=Object(n.useState)(!1),y=Object(p.a)(v,2),E=y[0],O=y[1],j=X.a.useForm(),w=Object(p.a)(j,1)[0];e.forms[d]=w;var S=function(){var e=Object(u.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==h.length||"in"!==i){e.next=8;break}return O(!0),t=new b.ActionProxy,e.next=5,t.runScript("select distinct(".concat(pa.getField(d),") as name \n                from ").concat(a.getLastApplyTable().tableName," \n                as output;"),pa.getJobName(),Object(k.a)({},pa.robotFetchParam(),{outputSize:1e3,timeout:1e4}));case 5:200===(n=e.sent).status&&g(n.content.data),O(!1);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(function(){S()},[i]);return r.a.createElement(X.a,{form:w,layout:"inline"},r.a.createElement(X.a.Item,{name:"compare"},r.a.createElement(Ue.a,{initialValue:"=",onChange:function(e){l(e)},placeholder:"compare",style:{width:"200px"}},r.a.createElement(Ue.a.Option,{value:"="},"="),r.a.createElement(Ue.a.Option,{value:"<"},"<"),r.a.createElement(Ue.a.Option,{value:">"},">"),r.a.createElement(Ue.a.Option,{value:">="},">="),r.a.createElement(Ue.a.Option,{value:"<="},"<="),r.a.createElement(Ue.a.Option,{value:"!="},"!="),r.a.createElement(Ue.a.Option,{value:ho.LIKE},"like"),r.a.createElement(Ue.a.Option,{value:ho.STARTS_WITH},"startsWith"),r.a.createElement(Ue.a.Option,{value:ho.ENDS_WITH},"endsWith"),r.a.createElement(Ue.a.Option,{value:ho.IN},"in"),r.a.createElement(Ue.a.Option,{value:ho.IS_NULL},"is null"),r.a.createElement(Ue.a.Option,{value:ho.IS_NOT_NULL},"is not null"),r.a.createElement(Ue.a.Option,{value:ho.IS_EMPTY},"is empty"),r.a.createElement(Ue.a.Option,{value:ho.IS_NOT_EMPTY},"is not empty"))),r.a.createElement(X.a.Item,{name:"condition"},function(){switch(i){case ho.IS_NULL:case ho.IS_NOT_NULL:return r.a.createElement(r.a.Fragment,null);case ho.IN:return r.a.createElement(Ue.a,{loading:E,mode:"tags",style:{width:"300px"}},h.map(function(e){return r.a.createElement(Ue.a.Option,{key:e.name,value:e.name},e.name)}));case ho.LIKE:return r.a.createElement(r.a.Fragment,null,r.a.createElement($.a,null),r.a.createElement("span",null,"LIKE 'a%o' means Finds any values that start with 'a' and ends with 'o' "));default:return r.a.createElement($.a,null)}}()))}var go=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).reload=function(e){a.setState(Object(k.a)({},a.wow(e)))},a.wow=function(e){return{funcPopUp:!1,data:e.map(function(e){return{key:e.name,field:e.name,dataType:e.type,compare:"=",condition:"",command:""}}),columns:[{title:"field",dataIndex:"field"},{title:"dataType",dataIndex:"dataType",render:function(e,t){switch(typeof e){case"object":return n.createElement("span",null,e.type);default:return n.createElement("span",null,e)}}},{title:"",dataIndex:"compare",render:function(e,t){return n.createElement(bo,{forms:a.forms,record:t,workshop:a.workshop})}}]}},a.buildSelectedRows=function(){var e={};a.state.data.forEach(function(t){e[t.field]=t.dataType});var t=Object.entries(a.forms).map(function(t){var a=Object(p.a)(t,2),n=a[0],r=a[1].getFieldsValue(),o=r.compare,c=r.condition;return o?{field:n,compare:o,condition:c,dataType:e[n]}:{}});return a.selectedRowKeys?t.filter(function(e){return a.selectedRowKeys.includes(e.field)}):[]},a.addGroup=function(e){var t=e.groupName,n=e.groupType;if(t&&n)if(a.selectedRowKeys){var r=a.buildSelectedRows();a.fitlerStation.conGroups[t]={groupName:t,groupType:n,tp:"basic",data:r},a.fitlerStation.applyGroup&&a.fitlerStation.applyGroup.reload({data:a.fitlerStation.conGroups}),a.fitlerStation.groupGroup&&a.fitlerStation.groupGroup.reload({data:a.fitlerStation.conGroups}),a.workshop.showInfo("Add successfully")}else a.workshop.showInfo("Please select fields");else a.workshop.showInfo("Error: groupName and groupType is required.")},a.render=function(){var e={onChange:function(e,t){a.selectedRowKeys=e},getCheckboxProps:function(e){return{name:e.field}}};return n.createElement("div",null,n.createElement(X.a,{onFinish:a.addGroup},n.createElement(X.a.Item,{name:"groupName",label:"Group Name"},n.createElement($.a,null)),n.createElement(X.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(Ue.a,null,n.createElement(Ue.a.Option,{value:"and"},"and"),n.createElement(Ue.a.Option,{value:"or"},"or"))),n.createElement(X.a.Item,null,n.createElement(Z.a,{type:"primary",htmlType:"submit"},"Add selected conditions to group"))),n.createElement(P.a,null),n.createElement(rr,{parent:Object(je.a)(Object(je.a)(a)),onRollback:a.fitlerStation.onRollback,handlePersit:a.fitlerStation.handlePersit,handleTableInput:a.fitlerStation.handleTableInput,ref:function(e){return a.fitlerStation.ApplyOrSaveRef=e},onSave:a.fitlerStation.onSave,onApply:function(){var e=a.buildSelectedRows();a.fitlerStation.onNonGroupFilterApply(e)},style:{marginBottom:"30px"}}),n.createElement(it.a,{rowSelection:Object(k.a)({type:"checkbox"},e),columns:a.state.columns,dataSource:a.state.data}))},a.fitlerStation=e.parent,a.workshop=e.parent.workshop,a.state=a.wow(e.schemaFields),a.forms={},a}return Object(ke.a)(t,e),t}(n.Component),vo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).reload=function(e){a.setState(Object(k.a)({},a.wow(e)))},a.wow=function(e){return{funcPopUp:!1,data:Object.keys(e.data).map(function(e){return{groupName:e}}).map(function(e){return{key:e.groupName,groupName:e.groupName}}),columns:[{title:"groupName",dataIndex:"groupName"}]}},a.addGroup=function(e){var t=e.groupName,n=e.groupType;if(t&&n){var r=a.selectedRowKeys.map(function(e){return a.fitlerStation.conGroups[e]});a.fitlerStation.conGroups[t]={groupName:t,groupType:n,tp:"group",data:r},a.fitlerStation.applyGroup&&a.fitlerStation.applyGroup.reload({data:a.fitlerStation.conGroups}),a.fitlerStation.groupGroup&&a.fitlerStation.groupGroup.reload({data:a.fitlerStation.conGroups}),a.workshop.showInfo("Add successfully")}else a.workshop.showInfo("Error: groupName and groupType is required.")},a.render=function(){var e={onChange:function(e,t){a.selectedRowKeys=e},getCheckboxProps:function(e){return{name:e.title}}};return n.createElement("div",null,n.createElement(X.a,{onFinish:a.addGroup},n.createElement(X.a.Item,{name:"groupName",label:"Group Name"},n.createElement($.a,null)),n.createElement(X.a.Item,{name:"groupType",label:"Group Type",defaultValue:"and"},n.createElement(Ue.a,null,n.createElement(Ue.a.Option,{value:"and"},"and"),n.createElement(Ue.a.Option,{value:"or"},"or"))),n.createElement(X.a.Item,null,n.createElement(Z.a,{type:"primary",htmlType:"submit"},"Add selected"))),n.createElement(it.a,{rowSelection:Object(k.a)({type:"checkbox"},e),columns:a.state.columns,dataSource:a.state.data}))},a.fitlerStation=e.parent,a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(ke.a)(t,e),t}(n.Component),yo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).reload=function(e){a.setState(Object(k.a)({},a.wow(e)))},a.wow=function(e){return{data:Object.keys(e.data).map(function(e){return{groupName:e}}).map(function(e){return{key:e.groupName,groupName:e.groupName}}),refresh:Math.random()}},a.onChange=function(e){a.groupName=e},a.render=function(){return n.createElement("div",null,n.createElement(X.a,{key:a.state.refresh},n.createElement(X.a.Item,{label:"Select group name to apply:"},n.createElement(Ue.a,{onChange:a.onChange},a.state.data.map(function(e){return n.createElement(Ue.a.Option,{key:e.key,value:e.groupName},e.groupName)})))))},a.fitlerStation=e.parent,a.workshop=e.parent.workshop,a.state=a.wow(e),a}return Object(ke.a)(t,e),t}(n.Component),Eo=dt.a.TabPane,Oo=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).onNonGroupFilterApply=function(){var e=Object(u.a)(s.a.mark(function e(n){var r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.length){e.next=3;break}return a.workshop.showInfo("Please select fields"),e.abrupt("return");case 3:return r=n.flatMap(function(e){return t.buildCondition([e])}).join(" and "),a.ApplyOrSaveRef.enter(),o=pa.getTempTableName(),c="select * from ".concat(a.workshop.getLastApplyTable().tableName," \n        where ").concat(r,"\n        as ").concat(o,";"),e.next=9,a.workshop.apply({tableName:o,sql:c});case 9:a.ApplyOrSaveRef.exit();case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onFilterApply=Object(u.a)(s.a.mark(function e(){var n,r,o,c,i,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(e){if("basic"===e.tp)return"and"===e.groupType?"(".concat(t.buildCondition(e.data).join(" and "),")"):"(".concat(t.buildCondition(e.data).join(" or "),")");if("and"===e.groupType){var a=e.data.flatMap(function(e){return o(e)}).join(" and ");return"(".concat(a,")")}var n=e.data.flatMap(function(e){return o(e)});return"(".concat(n.join(" or "),")")},n=a.applyGroup.groupName){e.next=5;break}return a.workshop.showInfo("Choose the group name to apply."),e.abrupt("return");case 5:return r=a.conGroups[n],c=o(r),a.ApplyOrSaveRef.enter(),i=pa.getTempTableName(),l="select * from ".concat(a.workshop.getLastApplyTable().tableName," \n        where ").concat(c,"\n        as ").concat(i,";"),e.next=12,a.workshop.apply({tableName:i,sql:l});case 12:a.ApplyOrSaveRef.exit();case 13:case"end":return e.stop()}},e)})),a.workshop=e.parent.workshop,a.conGroups={},a.currentConditions={},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this;return n.createElement("div",null,n.createElement("div",{className:"station-menu"},n.createElement(dt.a,{defaultActiveKey:"1",className:"station-tabs"},n.createElement(Eo,{tab:"Add Conditions to Group",key:"1"},n.createElement(go,{ref:function(t){return e.compare=t},parent:this,schemaFields:this.workshop.currentTable.schema.fields})),n.createElement(Eo,{tab:"Apply Group",key:"2"},n.createElement(rr,{parent:this,onRollback:this.onRollback,handlePersit:this.handlePersit,handleTableInput:this.handleTableInput,ref:function(t){return e.ApplyOrSaveRef=t},onSave:this.onSave,onApply:this.onFilterApply,style:{marginBottom:"30px"}}),n.createElement(P.a,null),n.createElement(yo,{ref:function(t){return e.applyGroup=t},parent:this,data:this.conGroups})),n.createElement(Eo,{tab:"Add Groups to Group",key:"3"},n.createElement(vo,{ref:function(t){return e.groupGroup=t},parent:this,data:this.conGroups})))),n.createElement("div",null))}}]),t}(Kn(n.Component).with(or));Oo.buildCondition=function(e){return e.map(function(e){return function(e){var t=e.field,a=e.dataType,n=e.compare,r=e.condition;if(n===ho.IN){var o="";switch(a){case"integer":case"long":case"float":case"double":o=r.map(function(e){return e}).join(",");break;default:o=r.map(function(e){return'"'.concat(pa.escapeQuote(e),'"')}).join(",")}var c="(".concat(o,")");return"".concat(pa.getField(t)," ").concat(n," ").concat(c)}if(n===ho.IS_NOT_NULL||n===ho.IS_NULL)return"".concat(pa.getField(t)," ").concat(n);if(n===ho.IS_EMPTY)return"".concat(pa.getField(t),' = ""');if(n===ho.IS_NOT_EMPT)return"".concat(pa.getField(t),' != ""');if(n===ho.LIKE)return"".concat(pa.getField(t),' like "').concat(pa.escapeQuote(r),'"');if(n===ho.STARTS_WITH)return"".concat(pa.getField(t),' like "').concat(pa.escapeQuote(r),'%"');if(n===ho.ENDS_WITH)return"".concat(pa.getField(t),' like "%').concat(pa.escapeQuote(r),'"');var i="";switch(a){case"string":i='"'.concat(pa.escapeQuote(r),'"');break;default:i=r}return"".concat(pa.getField(t)," ").concat(n," ").concat(i)}(e)})};var ko={operateFileds:[],error:void 0,applySaveRollbackDispacher:void 0},jo=r.a.createContext(),wo=Ue.a.Option;function So(e){var t=e.parent.workshop,a=t.currentTable.schema.fields,o=Object(d.useReducerAsync)(io,ko,oo),c=Object(p.a)(o,2),i=c[0],l=c[1],s=i.operateFileds,u=i.error,m=i.applySaveRollbackDispacher,f=X.a.useForm(),h=Object(p.a)(f,1)[0],b=a.map(function(e){return r.a.createElement(wo,{key:e.name},e.name)});return Object(n.useEffect)(function(){m&&h.submit()},[m]),r.a.createElement(jo.Provider,{value:{dispacher:l}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},u&&r.a.createElement(me,{message:u}),r.a.createElement(X.a,{form:h,onFinish:function(e){l({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(X.a.Item,null,r.a.createElement($r,{context:jo,workshop:t})),r.a.createElement(X.a.Item,{label:"Choose fields"},r.a.createElement(Ue.a,{mode:"multiple",onDeselect:function(e){l({type:ro.REMOVE_FIELD,data:{fields:e}})},onChange:function(e){l({type:ro.ADD_FIELD,data:{fields:e}})}},b)),s.map(function(e){return r.a.createElement(X.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(Ue.a,null,r.a.createElement(Ue.a.Option,{value:"desc"},"desc"),r.a.createElement(Ue.a.Option,{value:"asc"},"asc")))}))))}var xo=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Fr.apply(t,function(e){return 0==Object.keys(e).length?"Please configure limit size then click apply.":e.limitSize?void 0:"Please configure limit size then click apply."},function(e,t){var a=pa.getTempTableName(),n=t.limitSize;return{tableName:a,sql:"select * from ".concat(e.getLastApplyTable().tableName,"\n            limit  ").concat(n,"\n            as ").concat(a,";")}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),To=xo.handler,Co=xo.action,No=Object(k.a)({},un,{apply:To}),Io=Object(k.a)({},pn,{apply:Co});function Ro(e,t){return Io[t.type](e,t.data)}var Ao={limitSize:void 0,error:void 0,applySaveRollbackDispacher:void 0},Do=r.a.createContext();function Fo(e){var t=e.parent.workshop,a=Object(d.useReducerAsync)(Ro,Ao,No),o=Object(p.a)(a,2),c=o[0],i=o[1],l=(c.limitSize,c.error),s=c.applySaveRollbackDispacher,u=X.a.useForm(),m=Object(p.a)(u,1)[0];return Object(n.useEffect)(function(){s&&m.submit()},[s]),r.a.createElement(Do.Provider,{value:{dispacher:i}},r.a.createElement("div",{style:{marginTop:"10px",width:"400px"}},l&&r.a.createElement(me,{message:l}),r.a.createElement(X.a,{form:m,onFinish:function(e){i({type:"apply",data:{workshop:t,values:e}})},className:"login-form"},r.a.createElement(X.a.Item,null,r.a.createElement($r,{context:Do,workshop:t})),r.a.createElement(X.a.Item,{name:"limitSize"},r.a.createElement($.a,null)))))}var Po,Lo,_o=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).groupFields=t.data.groupFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Mo=_o.handler,qo=_o.action,Vo=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).orderFields=t.data.orderFields,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Go=Vo.handler,Bo=Vo.action,Uo=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.__state.result).rowWindows=t.data.rowWindows,e.abrupt("return",{data:{current:t.__state.current+1,result:a}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Ko=Uo.handler,Jo=Uo.action,Ho=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c,i,l,u,p,d,m,f,h,b,g,v,y,E,O,k;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.__state.result,n=a.groupFields,r=a.orderFields,o=a.rowWindows,c=t.data,i=c.workshop,l=c.functions,u=n.map(function(e){return pa.getField(e.field)}).join(","),p=r.map(function(e){return"".concat(pa.getField(e.field)," ").concat(e.value)}),d="",p.length>0&&(d="order by ".concat(p.join(","))),m=o.windowType,f=o.preceding,h=o.following,b="",g=f&&"".concat(f," PRECEDING")||"UNBOUNDED PRECEDING",v=h&&"".concat(h," FOLLOWING")||"UNBOUNDED FOLLOWING","UNBOUNDED PRECEDING"===g&&"UNBOUNDED FOLLOWING"===v&&(v="CURRENT ROW"),!m){e.next=19;break}e.t0=m,e.next="row window"===e.t0?15:"range window"===e.t0?17:19;break;case 15:return b="ROWS BETWEEN ".concat(g,"  and ").concat(v," "),e.abrupt("break",19);case 17:return b="RANGE BETWEEN ".concat(g,"  and ").concat(v," "),e.abrupt("break",19);case 19:return y=l.map(function(e){e.field,e.isAgg;var t=e.transformCode,a=e.columnName;return"".concat(t," over w as ").concat(a)}).join(","),E=i.currentTable.schema.fields.map(function(e){return pa.getField(e.name)}).join(","),O=pa.getTempTableName(),k="\n     select ".concat(E,",").concat(y,"\n     from ").concat(i.getLastApplyTable().tableName," \n     window w as (\n         partition by ").concat(u," ").concat(d," ").concat(b,"\n     ) as ").concat(O,";\n    "),e.next=25,i.apply({tableName:O,sql:k});case 25:return i.refreshOperateStation(),e.abrupt("return",{data:{}});case 27:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Wo=Ho.handler,Qo=Ho.action,zo=function e(){Object(f.a)(this,e)};zo.buildGroup="buildGroup",zo.buildOrder="buildOrder",zo.buildRowWindows="buildRowWindows",zo.apply="apply";var Yo=Object(k.a)({},un,(Po={},Object(m.a)(Po,zo.buildGroup,Mo),Object(m.a)(Po,zo.buildOrder,Go),Object(m.a)(Po,zo.buildRowWindows,Ko),Object(m.a)(Po,"apply",Wo),Po)),Xo=Object(k.a)({},pn,(Lo={},Object(m.a)(Lo,zo.buildGroup,qo),Object(m.a)(Lo,zo.buildOrder,Bo),Object(m.a)(Lo,zo.buildRowWindows,Jo),Object(m.a)(Lo,"apply",Qo),Lo));function $o(e,t){return Xo[t.type](e,t.data)}var Zo=Ue.a.Option;var ec=function(e){var t=e.workshop,a=(e.dispacher,e.context),o=e.enableApply,c=void 0!==o&&o,i=e.fieldWrapper,l=e.submit,s=e.selectFields,u=e.selectFieldsLabel,d=void 0===u?"Choose fields":u,m=e.selectFieldsMode,f=void 0===m?"multiple":m,h=s||t.currentTable.schema.fields,b=Object(n.useState)([]),g=Object(p.a)(b,2),v=g[0],y=g[1],E=Object(n.useState)(void 0),O=Object(p.a)(E,2),k=O[0],j=O[1],w=X.a.useForm(),S=Object(p.a)(w,1)[0],x=h.map(function(e){return r.a.createElement(Zo,{key:e.name},e.name)});return{ui:function(e){return r.a.createElement(X.a,{form:S,className:"login-form",onFinish:l},k&&r.a.createElement(me,{onClose:function(){j(void 0)},message:k}),c&&r.a.createElement(X.a.Item,null,r.a.createElement($r,{context:a,workshop:t})),r.a.createElement(X.a.Item,{label:d,name:"selectFieldsName"},r.a.createElement(Ue.a,{style:{minWidth:"200px"},mode:f,onDeselect:function(e){y(v.filter(function(t){return e!==t.field}))},onChange:function(e){y("multiple"===f?e.map(function(e){return{field:e}}):[{field:e}])}},x)),v.map(function(e){return i(e)}),e)},operateFields:v,form:S,setError:j}};function tc(e){var t=Object(n.useContext)(uc).dispacher,a=ec({workshop:e.workshop,fieldWrapper:function(e){return r.a.createElement(r.a.Fragment,null)}}),o=a.ui,c=a.operateFields,i=a.setError;return o([r.a.createElement(X.a.Item,{key:"button"},r.a.createElement(Z.a,{type:"primary",onClick:function(){0!==c.length?t({type:zo.buildGroup,data:{groupFields:c}}):i("Fields are required.")}},"Next"))])}function ac(e){var t=Object(n.useContext)(uc).dispacher,a=ec({workshop:e.workshop,fieldWrapper:function(e){return r.a.createElement(X.a.Item,{initialValue:"desc",key:e.field,label:e.field,name:e.field},r.a.createElement(Ue.a,null,r.a.createElement(Ue.a.Option,{value:"desc"},"desc"),r.a.createElement(Ue.a.Option,{value:"asc"},"asc")))}}),o=a.ui,c=a.operateFields,i=(a.setError,a.form);return o([r.a.createElement(X.a.Item,null,r.a.createElement(Z.a,{type:"primary",onClick:function(){var e=i.getFieldValue(),a=c.map(function(t){return{field:t.field,value:e[t.field]}});t({type:zo.buildOrder,data:{orderFields:a}})}},"Next"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{onClick:function(){t({type:"setState",data:{current:0}})}},"Previous"))])}function nc(e){var t=Object(n.useContext)(uc).dispacher,a=ec({workshop:e.workshop,fieldWrapper:function(e){switch(e.field){case"row window":case"range window":return r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a.Item,{label:"Preceding",name:"preceding"},r.a.createElement($.a,{placeholder:"number"})),r.a.createElement(X.a.Item,{label:"Following",name:"following"},r.a.createElement($.a,{placeholder:"number"})))}},selectFields:[{name:"row window"},{name:"range window"}],selectFieldsLabel:"Window Type",selectFieldsMode:"single"}),o=a.ui,c=(a.operateFields,a.setError,a.form);return o([r.a.createElement(X.a.Item,null,r.a.createElement(Z.a,{type:"primary",onClick:function(){var e=c.getFieldValue().selectFieldsName,a=Object(k.a)({},c.getFieldValue(),{windowType:e});t({type:zo.buildRowWindows,data:{rowWindows:a}})}},"Next"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{onClick:function(){t({type:"setState",data:{current:1}})}},"Previous"))])}var rc=pt.a.Panel;var oc=a(1150);pt.a.Panel;function cc(e){var t=e.workshop,a=Object(n.useContext)(uc).dispacher,o=function(e){var t=e.operateField,a=Object(n.useState)([]),o=Object(p.a)(a,2),c=o[0],i=o[1],l=Object(n.useState)(void 0),d=Object(p.a)(l,2),m=d[0],f=d[1],h=X.a.useForm(),b=Object(p.a)(h,1)[0],g=Object(n.useState)(void 0),v=Object(p.a)(g,2),y=v[0],E=v[1],O=function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.showFunctions();case 2:t=e.sent,a=t.content.map(function(e){return{value:e.key.table,text:e.key.table,funcValue:e.columns[0],returnValue:e.columns[1],params:e.columns.slice(2,e.columns.length)}}),i(a);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(function(){O()},[]);var k=Object(n.useCallback)(function(){var e=Object(u.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=c.filter(function(e){return e.value===t})[0],f(a);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),[c]),j=function(e){return"yes"===e.extra.column?t:""};return{ui:function(e,t){return r.a.createElement(X.a,{form:b,className:"login-form"},y&&r.a.createElement(me,{onClose:function(){E(void 0)},message:y}),r.a.createElement(X.a.Item,{label:"Search function"},r.a.createElement(Ue.a,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!0,style:{width:"200px"},filterOption:!0,onChange:k,notFoundContent:"type function name"},c.map(function(e){return r.a.createElement(Ue.a.Option,{key:e.value},e.text)}))),m&&r.a.createElement(X.a.Item,{key:m.value},r.a.createElement(kr,{func:m})),m&&m.params.map(function(e){return r.a.createElement(X.a.Item,{initialValue:j(e),key:e.name,name:e.name,label:e.name},r.a.createElement($.a,null))}),r.a.createElement(X.a.Item,null,r.a.createElement(pt.a,null,r.a.createElement(rc,{header:"Mannually Apply Function"},r.a.createElement(P.a,{type:"horizontal"}),r.a.createElement(X.a.Item,{name:"mannualTransform",label:"Mannual Transform"},r.a.createElement($.a,null)),r.a.createElement(X.a.Item,{name:"isMannualAgg",label:"Is Agg Function"},r.a.createElement(nr.a,null))))),t,r.a.createElement(X.a.Item,{name:"newFieldName",label:"New Field Name",required:!0},r.a.createElement($.a,null)),e)},form:b,getTransform:function(){var e=b.getFieldValue(),a=e.mannualTransform,n=e.isMannualAgg,r=e.newFieldName;if(a)return{field:t,isAgg:n||!1,transformCode:a,columnName:r};if(!m)return E("Operate is required."),{};var o=[];return m.params.forEach(function(e){var a=b.getFieldValue()[e.name];a||"yes"!==e.extra.column||(a=t),a&&("yes"===e.extra.column?o.push(pa.getField(a)):"number"==e.dataType||"boolean"==e.dataType?o.push(a):o.push('"'.concat(a,'"')))}),{field:t,isAgg:"yes"===m.funcValue.extra.agg,transformCode:"".concat(m.value,"(").concat(o.join(","),")"),columnName:r}},setError:E}}({operateField:""}),c=o.ui,i=o.form,l=o.getTransform,d=o.setError,m=Object(n.useState)(!1),f=Object(p.a)(m,2),h=f[0],b=f[1],g=Object(n.useState)([]),v=Object(p.a)(g,2),y=v[0],E=v[1];return r.a.createElement(r.a.Fragment,null,c([r.a.createElement(X.a.Item,null,r.a.createElement(Z.a,{type:"primary",loading:h,onClick:function(){var e=[];if(0===y.length){var n=l(),r=n.field,o=n.isAgg,c=n.transformCode,i=n.columnName;if(e.push({field:r,isAgg:o,transformCode:c,columnName:i}),!i)return void d("New Field Name is required.")}else e=y;b(!0),a({type:zo.apply,data:{setLoading:b,workshop:t,functions:e}})}},"Apply"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{loading:h,onClick:function(){var e=l(),t=e.field,a=e.isAgg,n=e.transformCode,r=e.columnName;r?(E(y.concat([{field:t,isAgg:a,transformCode:n,columnName:r}])),i.resetFields()):d("New Field Name is required.")}},"Add"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{onClick:function(){a({type:"setState",data:{current:2}})}},"Previous"))]),y.length>0&&r.a.createElement(Or.b,{style:{width:"500px"},header:r.a.createElement("div",null,"Added Functions"),bordered:!0,dataSource:y.map(function(e){return"".concat(e.transformCode," as ").concat(e.columnName)}),renderItem:function(e){return r.a.createElement(Or.b.Item,null,r.a.createElement(oc.a.Text,{mark:!0},"Func")," ",e)}}))}function ic(){var e=Object(se.a)(["\nborder: 1px dashed #e9e9e9;\nborder-radius: 6px;\nbackground-color: #fafafa;\nmin-height: 200px;\npadding: 30px 30px;\nwidth: 100%;\ndisplay:flex;\nalign-items:center;\njustify-content:center;\nflex-direction: column;\n"]);return ic=function(){return e},e}var lc=ar.a.Step,sc=ue.a.div(ic()),uc=r.a.createContext();function pc(e){var t=e.parent.workshop,a={steps:[r.a.createElement(tc,{workshop:t}),r.a.createElement(ac,{workshop:t}),r.a.createElement(nc,{workshop:t}),r.a.createElement(cc,{workshop:t})],current:0,result:{groupFields:[],orderFields:[],rowWindows:[]}},n=Object(d.useReducerAsync)($o,a,Yo),o=Object(p.a)(n,2),c=o[0],i=o[1],l=c.steps,s=c.current;return r.a.createElement(uc.Provider,{value:{dispacher:i}},r.a.createElement("div",{className:"join-app"},r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ar.a,{current:s},r.a.createElement(lc,{key:0,title:"Build Group",description:"Choose fields to group data"}),r.a.createElement(lc,{key:1,title:"Setup Group Row Order",description:"Choose fields to order the data in group"}),r.a.createElement(lc,{key:2,title:"Build Window",description:"Build window on every row of every group"}),r.a.createElement(lc,{key:3,title:"Apply Function",description:"Apply functions to all windows we have created"}))),r.a.createElement("div",{className:"join-app-form"},r.a.createElement(sc,null,l[s]," "))))}var dc=Object(k.a)({},un),mc=Object(k.a)({},pn);function fc(e,t){return mc[t.type](e,t.data)}a(1076);var hc=a(541),bc=a.n(hc);a(1080);var gc={applySaveRollbackDispacher:void 0,scriptContent:void 0,applyToken:pa.getJobName()},vc=r.a.createContext();function yc(e){var t=e.parent.workshop,a=Object(d.useReducerAsync)(fc,gc,dc),o=Object(p.a)(a,2),c=o[0],i=o[1],l=function(e){var t=e.parent.workshop.currentTable.schema.fields.map(function(e){return e.name}),a=X.a.useForm(),o=Object(p.a)(a,1)[0],c=Object(n.useState)(),i=Object(p.a)(c,2),l=i[0],s=i[1],u=Object(n.useState)([]),d=Object(p.a)(u,2),m=d[0],f=d[1],h=t.map(function(e){return r.a.createElement(Ue.a.Option,{value:e},e)}),b=Object(n.useCallback)(function(e){e.forEach(function(e){"vType"===e.name[0]&&s(e.value)})},[]);return{ui:function(){return r.a.createElement(Y.a,{title:"Generic"},r.a.createElement(X.a,{form:o,onFieldsChange:b},r.a.createElement(X.a.Item,{label:"Visulizaiton Plugin",name:"vType"},r.a.createElement(Ue.a,null,m.map(function(e){return r.a.createElement(Ue.a.Option,{value:e},e)}))),r.a.createElement(X.a.Item,{label:"X Column",name:"xColumn"},r.a.createElement(Ue.a,null,h)),r.a.createElement(X.a.Item,{label:"Y Column",name:"yColumn"},r.a.createElement(Ue.a,null,h))))},form:o,vType:l,setPlugins:f}}(e),m=l.ui,f=l.form,h=l.vType,v=l.setPlugins,y=function(e){var t=X.a.useForm(),a=Object(p.a)(t,1)[0],o=Object(n.useState)([]),c=Object(p.a)(o,2),i=c[0],l=c[1],s=Object(n.useState)(),u=Object(p.a)(s,2),d=u[0],m=u[1];return{ui:function(){return r.a.createElement(Y.a,{title:"Plugin Parameters"},d&&r.a.createElement("div",{className:"image-wrapper",style:{width:"400px"}},r.a.createElement(bc.a,{src:d})),r.a.createElement(X.a,{form:a},i.map(function(e){return r.a.createElement(X.a.Item,{key:e.key,name:e.key,label:e.option.label||e.key,initialValue:pa.unQuote(e.command)},r.a.createElement($.a,null))})))},form:a,setPluginConfigs:l,pluginConfigs:i,setImagePreview:m}}(),E=y.ui,O=y.form,k=y.setPluginConfigs,j=y.setImagePreview,w=new b.ActionProxy,S=c.applySaveRollbackDispacher,x=c.scriptContent,T=c.applyToken,C=function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.get(g.default.PLUGIN_LIST,{});case 2:if(200===(t=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:a=t.content.map(function(e){return e.name}),v(a);case 7:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(u.a)(s.a.mark(function e(){var t,a,n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!h){e.next=14;break}return e.next=3,w.get(g.default.PLUGIN_GET,{pluginName:h});case 3:return t=e.sent,a=t.content.content,e.next=7,w.runScript(a,pa.getJobName(),{executeMode:"analyze"});case 7:if(200===(n=e.sent).status){e.next=10;break}return e.abrupt("return");case 10:r=n.content.filter(function(e){return e.mode&&"defaultParam"===e.mode}),i({type:"setState",data:{scriptContent:a}}),j(t.content.image),k(r);case 14:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)(function(){N()},[h]),Object(n.useEffect)(function(){C()},[]);var I=function(){var e=Object(u.a)(s.a.mark(function e(){var a,n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!S){e.next=8;break}return a=f.getFieldValue(),n=O.getFieldValue(),r=n.tableName||pa.getTempTableName(),o="\n             select ".concat(pa.getField(a.xColumn)," as x,").concat(pa.getField(a.yColumn)," as y \n             from ").concat(t.getLastApplyTable().tableName," as ").concat(r,";\n             ").concat(x,"\n            "),e.next=7,t.apply({tableName:r,sql:o});case 7:S({type:"setState",data:{loading:!1}});case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(function(){I()},[T]),r.a.createElement(vc.Provider,{value:{dispacher:i}},r.a.createElement($r,{workshop:t,context:vc}),r.a.createElement("div",{className:"dash-station"},r.a.createElement("div",{className:"dash-station-data-page"},m()),r.a.createElement(P.a,{type:"vertical",style:{height:"300px"}}),r.a.createElement("div",{className:"dash-station-dash-page"},E())))}var Ec=dt.a.TabPane,Oc=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).reload=function(){a.setState({key:Math.random()})},a.workshop=e.parent,a.state={key:Math.random()},a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return n.createElement("div",{className:"os-pane"},n.createElement("div",{className:"os-tabs"},n.createElement(dt.a,{defaultActiveKey:"1",tabPosition:"left",key:this.state.key},n.createElement(Ec,{tab:n.createElement(J.a,{id:"project"}),key:1},n.createElement(fo,{parent:this})),n.createElement(Ec,{tab:n.createElement(J.a,{id:"filter"}),key:2},n.createElement(Oo,{parent:this})),n.createElement(Ec,{tab:n.createElement(J.a,{id:"join"}),key:3},n.createElement(vr,{parent:this})),n.createElement(Ec,{tab:n.createElement(J.a,{id:"agg"}),key:4},n.createElement(Sr,{parent:this})),n.createElement(Ec,{tab:n.createElement(J.a,{id:"order"}),key:5},n.createElement(So,{parent:this})),n.createElement(Ec,{tab:n.createElement(J.a,{id:"limit"}),key:6},n.createElement(Fo,{parent:this})),n.createElement(Ec,{tab:n.createElement(J.a,{id:"window"}),key:7},n.createElement(pc,{parent:this})),n.createElement(Ec,{tab:n.createElement(J.a,{id:"dash"}),key:8},n.createElement(yc,{parent:this})))))}}]),t}(n.Component),kc=a(1143),jc=a(542),wc=a.n(jc),Sc=a(495),xc=a(178),Tc=a(487),Cc=a(217),Nc=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).getDefaultRender=function(e){e.name;switch(e.type){case"string":return function(e,t){return e};case"array":case"map":return function(e,t){return JSON.stringify(e)};default:return function(e,t){return e}}},a.getDefaultSearch=function(e){var t=e.name;switch(e.type){case"string":return a.getColumnSearchProps(t);case"array":case"map":default:return{}}},a.getDefaultTitleRender=function(e){return a.dropdown(e)},a.update=function(e,t){var n=!1;t[0]&&"html"===t[0].name&&t[1]&&"dash"===t[1].name&&(n=!0);var r=t.map(function(e){return Object(k.a)({},e,{dataIndex:e.name,title:a.getDefaultTitleRender(e),render:a.getDefaultRender(e)},a.getDefaultSearch(e))});a.setState({columns:r,data:e,isDash:n})},a.disablePreview=function(){a.setState({view:{enabled:!1}})},a.tableStyle=e.style||{},a.state={columns:[],rows:[],view:{enabled:!1},searchText:"",searchedColumn:"",loading:!1,isDash:!1},a.config={},a.workshop=e.parent,a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return this.state.isDash?Dt.render(this.state.data):n.createElement("div",{style:this.tableStyle},n.createElement(it.a,{loading:this.state.loading,size:"default",columns:this.state.columns,dataSource:this.state.data,scroll:{x:!0}}),n.createElement(lt.a,{title:"View",visible:this.state.view.enabled,onCancel:this.disablePreview,onOk:this.disablePreview,cancelText:"Cancel",OkText:"Ok"},n.createElement(Cc,{source:this.state.view.content||""})))}}]),t}(Kn(n.Component).with(function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(o)))).getColumnSearchProps=function(e){return{filterDropdown:function(t){var r=t.setSelectedKeys,o=t.selectedKeys,c=t.confirm,i=t.clearFilters;return n.createElement("div",{style:{padding:8}},n.createElement($.a,{ref:function(e){a.searchInput=e},placeholder:"Search ".concat(e),value:o[0],onChange:function(e){return r(e.target.value?[e.target.value]:[])},onPressEnter:function(){return a.handleSearch(o,c,e)},style:{width:188,marginBottom:8,display:"block"}}),n.createElement(kc.a,null,n.createElement(Z.a,{type:"primary",onClick:function(){return a.handleSearch(o,c,e)},icon:n.createElement(Sc.a,null),size:"small",style:{width:90}},"Search"),n.createElement(Z.a,{onClick:function(){return a.handleReset(i)},size:"small",style:{width:90}},"Reset")))},filterIcon:function(e){return n.createElement(Sc.a,{style:{color:e?"#1890ff":void 0}})},onFilter:function(e,t){return!0},onFilterDropdownVisibleChange:function(e){e&&setTimeout(function(){return a.searchInput.select()})},render:function(t){return a.state.searchedColumn===e?n.createElement(wc.a,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[a.state.searchText],autoEscape:!0,textToHighlight:t?t.toString():""}):t}}},a.handleSearch=function(){var e=Object(u.a)(s.a.mark(function e(t,n,r){var o,c,i,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=pa.getTempTableName(),c=t[0],i=pa.getField(r),l={tableName:o,sql:"select * from ".concat(a.workshop.getLastApplyTable().tableName," \n            where ").concat(i," like '%").concat(c,"%' as ").concat(o,";")},n(),a.setState({loading:!0}),e.next=8,a.workshop.apply(l);case 8:a.setState({loading:!1,searchText:t[0],searchedColumn:r});case 9:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.handleReset=function(e){e(),a.setState({searchText:""})},a}return Object(ke.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(o)))).dropdownStat=function(){var e=Object(u.a)(s.a.mark(function e(t,n){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({loading:!0}),r=pa.getTempTableName(),e.t0=t,e.next="count"===e.t0?5:"count(distinct)"===e.t0?9:13;break;case 5:return e.next=7,a.workshop.apply({tableName:r,sql:"select count(".concat(pa.getField(n),") \n                    from ").concat(a.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 7:return a.setState({loading:!1}),e.abrupt("return");case 9:return e.next=11,a.workshop.apply({tableName:r,sql:"select count(distinct ".concat(pa.getField(n),") \n                    from ").concat(a.workshop.getLastApplyTable().tableName,"\n                    as ").concat(r,"\n                    ;")});case 11:return a.setState({loading:!1}),e.abrupt("return");case 13:a.setState({loading:!1});case 14:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.dropdown=function(e){var t=n.createElement(D.a,{onClick:function(t){a.dropdownStat(t.key,e.name)}},n.createElement(D.a.Item,{key:"count",icon:n.createElement(Tc.a,null)},"Count"),n.createElement(D.a.Item,{key:"count(distinct)",icon:n.createElement(Tc.a,null)},"Count&distinct"));return n.createElement(xc.a,{overlay:t},n.createElement("span",null,e.name,n.createElement(P.a,{type:"vertical"}),n.createElement(ln.a,null)))},a}return Object(ke.a)(t,e),t}(e)})),Ic=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(Ee.a)(this,Object(Oe.a)(t).call(this,e))).client=new b.ActionProxy,a.state={tableLoading:!1},a.sqls=[],t.workshop=Object(je.a)(Object(je.a)(a)),a}return Object(ke.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){}},{key:"operateStationView",value:function(){var e=this;return this.state.loadingTable?n.createElement(Dn,null):this.sessionId?n.createElement(Oc,{ref:function(t){return e.stationRef=t},parent:this}):n.createElement(Bn.a,{style:{width:"100%"},title:"No Aanalysis Session Is Opened",subTitle:"Right click the table in the left panel(DeltaLake/FileSystem) to begin your analysis"})}},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"ws-app"},n.createElement("div",{className:"ws-left-pane"},n.createElement(Ke.Resizable,{style:{paddingRight:"30px",borderRight:"solid"}},n.createElement(tr,{ref:function(t){return e.leftTreePaneRef=t},parent:this}))),n.createElement("div",{className:"ws-right-pane"},n.createElement(lt.a,{title:"Message",visible:this.state.showMessage||!1,onCancel:this.toggleMessage,onOk:this.toggleMessage,cancelText:"Cancel",width:"60%",OkText:"Ok"},n.createElement(Se.a,{height:"300px",width:"100%",mode:"text",theme:"github",name:"detail_box",value:this.state.consoleMessage||""})),n.createElement(lt.a,{title:"Message",visible:this.state.showInfoMessage||!1,onCancel:function(){e.setState({showInfoMessage:!1})},onOk:function(){e.setState({showInfoMessage:!1})},cancelText:"Cancel",OkText:"Ok"},this.state.infoMessage),n.createElement("div",{className:"ws-operate-pane"},this.operateStationView()),n.createElement(P.a,null),n.createElement("div",{className:"ws-table-pane"},n.createElement(Nc,{style:{width:"90%"},ref:function(t){return e.displayRef=t},parent:this}))))}}]),t}(Kn(n.Component).with(function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).newSession=function(){var e=Object(u.a)(s.a.mark(function e(t,n,r,o){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.showTable(t,n,r,o),e.abrupt("return",Object(je.a)(Object(je.a)(a)));case 2:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),a.showTable=function(){var e=Object(u.a)(s.a.mark(function e(t,n,r,o){var c,i,l,u,p,d,m,f,h,b;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=pa.getTempTableName(),i="".concat(n,"."),n||(i=""),l="select * from ".concat(i).concat(r," as ").concat(c,";"),"delta"===t&&(l="load delta.`".concat(n,".").concat(r,"` as ").concat(c,";")),"temp"!==t){e.next=11;break}return e.next=8,Qe.tableInfo(r);case 8:u=e.sent,p=u.content,l=2===p.status?"load parquet.`/__persisted__/".concat(p.tableName,"`  as ").concat(p.tableName,";\n                select * from ").concat(p.tableName," as ").concat(c,";"):"".concat(p.content," \n                select * from ").concat(p.tableName," as ").concat(c,";");case 11:return"file"===t&&(d="where ",o?d+=Object.keys(o).map(function(e){var t=o[e];return"".concat(e.replace(/\[group\]/g,"0"),"='''").concat(t,"'''")}).join(" and "):d="",l="load ".concat(n,".`").concat(r,"` ").concat(d,"  as ").concat(c,";")),a.sqls.push({tableName:c,sql:l}),a.setState({loadingTable:!0}),e.next=16,a.client.runScript(l,pa.getJobName(),pa.robotFetchParam());case 16:if(m=e.sent,a.setState({loadingTable:!1}),200===m.status){e.next=21;break}return a.toggleMessage("Fail to load ".concat(c,": ").concat(m.content)),e.abrupt("return");case 21:f=m.content,h=f.schema,b=f.data,a.setCurrentTable("","",c,h,b),a.sessionId=pa.getJobName(),a.setState({sessionId:a.sessionId});case 25:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),a.setCurrentTable=function(e,t,n,r,o){a.currentTable={prefix:e,db:t,table:n,schema:r,data:o},a.updateDisplay(o,r)},a}return Object(ke.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).getLastApplyTable=function(){return a.sqls[a.sqls.length-1]},a.rollback=function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r,o,c,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a.sqls.length<2)){e.next=3;break}return a.toggleMessage("No apply to rollback."),e.abrupt("return");case 3:return a.sqls.pop(),n=a.sqls.pop(),e.next=7,a.client.get(g.default.APPLY_GET,{name:n.tableName});case 7:if(200!==(r=e.sent).status){e.next=14;break}return o=JSON.parse(r.content.response),c=o.data,i=o.schema,e.next=12,a.apply(Object(k.a)({},n,{_data:c,_schema:i}));case 12:e.next=16;break;case 14:return e.next=16,a.apply(n);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.apply=function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r,o,c,i,l,u,p;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.tableName,t.sql,r=t._data,o=t._schema,a.sqls.push(t),!r||!o){e.next=5;break}return a.setCurrentTable("","",n,o,r),e.abrupt("return",200);case 5:return c=a.sqls.map(function(e){return e.sql}).join(""),e.prev=6,e.next=9,a.client.runScript(c,pa.getJobName(),Object(k.a)({},pa.robotFetchParam(),{queryType:"analysis_workshop_apply_action",analysis_workshop_table_name:n,analysis_workshop_sql:JSON.stringify(a.sqls)}));case 9:if(200===(i=e.sent).status){e.next=14;break}return a.sqls.pop(),a.toggleMessage(i.content),e.abrupt("return",500);case 14:return l=i.content,u=l.data,p=l.schema,a.setCurrentTable("","",n,p,u),e.abrupt("return",200);case 19:return e.prev=19,e.t0=e.catch(6),a.toggleMessage("Execute job fail;(Job is killed)"),e.abrupt("return",500);case 23:case"end":return e.stop()}},e,null,[[6,19]])}));return function(t){return e.apply(this,arguments)}}(),a.save=function(){var e=Object(u.a)(s.a.mark(function e(t,n){var r,o,c,i,l,u;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.sqls.length){e.next=3;break}return a.toggleMessage("Sorry, current session have no applies."),e.abrupt("return",500);case 3:if(r="select * from ".concat(a.getLastApplyTable().tableName," as ").concat(t,";"),a.sqls.push({tableName:t,sql:r}),o=a.sqls.map(function(e){return e.sql}).join("\n"),c=pa.getJobName(),i={status:5},!n){e.next=13;break}return l="".concat(o,"\n         save overwrite ").concat(t," as parquet.`/__persisted__/").concat(t,"`;"),e.next=12,a.client.runScript(l,c,{persistJobName:c,async:!0});case 12:i={jobName:c,status:1};case 13:return e.next=15,a.client.post(g.default.ANALYSIS_SAVE,Object.assign({tableName:t,sql:o,sessionId:a.sessionId,schema:JSON.stringify(a.currentTable.schema)},i));case 15:return u=e.sent,e.abrupt("return",u.status);case 17:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a}return Object(ke.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).toggleMessage=function(e){a.state.showMessage?a.setState({showMessage:!a.state.showMessage}):a.setState({showMessage:!a.state.showMessage,consoleMessage:e})},a.showInfo=function(e){a.setState({showInfoMessage:!0,infoMessage:e})},a}return Object(ke.a)(t,e),t}(e)},function(e){return function(e){function t(){var e,a;Object(f.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(Ee.a)(this,(e=Object(Oe.a)(t)).call.apply(e,[this].concat(r)))).updateDisplay=function(){var e=Object(u.a)(s.a.mark(function e(t,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({tableLoading:!0}),a.displayRef.update(t,n.fields),a.setState({tableLoading:!1});case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.refreshOperateStation=function(){a.stationRef.setState({key:Math.random()})},a.refreshTableWorkshop=function(){a.leftTreePaneRef.workshopTableTreeRef.reload()},a}return Object(ke.a)(t,e),t}(e)}));Ic.workshop=void 0;var Rc,Ac=Ic,Dc=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c,i,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=a.enableRegister,r=void 0!==n&&n,o=a.enableLogin,c=void 0!==o&&o,i=new b.ActionProxy,e.next=4,i.post(g.default.APP_SAVE,{login:c,register:r});case 4:if(200!==(l=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{applySuccess:!0}});case 7:return e.abrupt("return",{data:{error:l.content}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Fc=Dc.handler,Pc=Dc.action,Lc=function e(){Object(f.a)(this,e)};Lc.LR_CONTROL="lrControl",Lc.SET_STATE="setState";var _c=(Rc={},Object(m.a)(Rc,Lc.LR_CONTROL,Fc),Object(m.a)(Rc,Lc.SET_STATE,N.SetStateActionHandler),Rc);function Mc(e,t){switch(t.type){case Lc.LR_CONTROL:return Pc(e,t.data);case Lc.SET_STATE:return Object(N.SetStateAction)(e,t.data);default:return e}}a(465);var qc=a(494),Vc={enableLogin:!1,enableRegister:!1,applySuccess:!1,error:void 0,loading:!0},Gc=r.a.createContext();function Bc(){var e=Object(d.useReducerAsync)(Mc,Vc,_c),t=Object(p.a)(e,2),a=t[0],o=t[1],c=S.formLayout1(),i=c.formItemLayout,l=c.tailLayout,f=a.enableLogin,v=a.enableRegister,y=a.applySuccess,E=a.error,O=a.loading;function k(){return(k=Object(u.a)(s.a.mark(function e(){var t,a,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.ActionProxy,e.next=3,t.get(g.default.APP_INFO,{});case 3:200===(a=e.sent).status&&o({type:Lc.SET_STATE,data:(n={enableLogin:Boolean(a.content.login)},Object(m.a)(n,"enableLogin",Boolean(a.content.register)),Object(m.a)(n,"loading",!1),n)});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}return Object(n.useEffect)(function(){!function(){k.apply(this,arguments)}()},[y,E]),r.a.createElement(Gc.Provider,{value:{dispacher:o}},y&&r.a.createElement(F.a,{closable:!0,message:"Success",description:"Apply Success",type:"success",showIcon:!0}),E&&r.a.createElement(F.a,{closable:!0,message:"Fail",description:E,type:"error",showIcon:!0}),O&&r.a.createElement(Dn,null),!O&&r.a.createElement(Y.a,{title:"Control Website Register/Login"},r.a.createElement(X.a,Object.assign({},i,{className:"login-form",onFinish:function(e){o(h.a.buildEvent(Lc.LR_CONTROL,e))}}),r.a.createElement(X.a.Item,{label:"Allow Register New User",name:"enableRegister"},r.a.createElement(nr.a,{defaultChecked:v,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(X.a.Item,{label:"Allow User Login",name:"enableLogin"},r.a.createElement(nr.a,{defaultChecked:f,checkedChildren:"enable",unCheckedChildren:"shutdown"})),r.a.createElement(X.a.Item,l,r.a.createElement(Z.a,{type:"primary",htmlType:"submit"},"Apply")))))}var Uc=a(550),Kc=a(555);function Jc(e){var t=e.renderConfig,a=e.createInitRow,o=e.submit,c=X.a.useForm(),i=Object(p.a)(c,1)[0],l=Object(n.useState)([]),d=Object(p.a)(l,2),m=d[0],f=d[1],h=Object(n.useState)([]),b=Object(p.a)(h,2),g=b[0],v=b[1],y=Object(n.useState)({}),E=Object(p.a)(y,2),O=E[0],k=E[1],j=Object(n.useState)(!1),w=Object(p.a)(j,2),S=w[0],x=w[1],T=Object(n.useState)(!1),C=Object(p.a)(T,2),N=C[0],I=C[1],R=Object(n.useState)(void 0),A=Object(p.a)(R,2),D=A[0],F=A[1],P=Object(Uc.c)(g),L=P.list,_=P.remove,M=P.getKey,q=P.move,V=P.push,G=(P.sortForm,P.resetList),B=i.getFieldsValue;Object(n.useEffect)(function(){G(g)},[g]);var U=m.filter(function(e){return"id"!==e}).map(function(e){return t&&t[e]?t[e]({getKey:M}):{title:e,dataIndex:e,key:e,render:function(t,a,n){return r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a.Item,{name:"params[".concat(M(n),"].").concat(e),initialValue:t},r.a.createElement($.a,{style:{width:120,marginRight:16}})))}}}).concat([{key:"operate",title:"",dataIndex:"operate",render:function(e,t,a){return r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a.Item,{name:"params[".concat(M(a),"].operate")},r.a.createElement(Z.a.Group,null,r.a.createElement(Z.a,{type:"danger",onClick:function(){return _(a)}},"Delete"))))}}]),K=Object(n.useCallback)(function(e){k(e);var t=/params\[(\d+)\]\.(\D+)/;(function(){var a=Object(u.a)(s.a.mark(function a(){var n;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n=[],Object.entries(e).map(function(e){var a=Object(p.a)(e,2),r=a[0],o=a[1],c=t.exec(r),i=Number(c[1]),l=c[2];n[i]||(n[i]={}),o&&(n[i][l]=o)}),o&&o({params:n,setLoading:x});case 3:case"end":return a.stop()}},a)}));return function(){return a.apply(this,arguments)}})()()},[x]);return{ui:function(){if(!N){var t=U.map(function(e){return e.render=function(e,t,a){return r.a.createElement("span",null,e)},e});return r.a.createElement(it.a,{columns:t,dataSource:g,pagination:!1})}return r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a,{form:i},r.a.createElement(Kc.a,{onDragEnd:function(e,t){return q(e,t)},handleSelector:'i[aria-label="icon: drag"]'},D&&r.a.createElement(me,{message:D}),r.a.createElement(it.a,{columns:U,dataSource:L,rowKey:function(e,t){return M(t).toString()},pagination:!1})),r.a.createElement(Z.a,{style:{marginTop:8},block:!0,type:"dashed",onClick:function(){return V(function(){if(a)return a(U);var e={};return U.map(function(t){e[t]=""}),e}())}},"+ Add Row"),r.a.createElement(Z.a,{type:"primary",style:{marginTop:16},loading:S,onClick:function(){K(B())}},"Submit"),e.debug&&r.a.createElement("div",{style:{whiteSpace:"pre"}},O&&"content: ".concat(JSON.stringify(O,null,2)))))},data:g,schema:m,setData:v,setSchema:f,setLoading:x,setEditorMode:I,setError:F}}function Hc(e){var t=Object(n.useState)(void 0),a=Object(p.a)(t,2),o=a[0],c=a[1],i=new b.ActionProxy,l=Jc({submit:function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t.params,(n=t.setLoading)(!0),v(void 0),r=0;case 4:if(!(r<a.length)){e.next=15;break}return e.next=7,i.post(g.default.ENGINE_ADD,a[r]);case 7:if(200===(o=e.sent).status){e.next=12;break}return n(!1),v(o.content),e.abrupt("return");case 12:r++,e.next=4;break;case 15:c(pa.getJobName()),n(!1);case 17:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),renderConfig:{skipAuth:function(e){var t=e.getKey;return{title:"skipAuth",dataIndex:"skipAuth",key:"skipAuth",render:function(e,a,n){var o=!0;return 2===e&&(o=!1),r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a.Item,{name:"params[".concat(t(n),"].skipAuth"),initialValue:String(o)},r.a.createElement(Ue.a,null,r.a.createElement(Ue.a.Option,{value:"true"},"true"),r.a.createElement(Ue.a.Option,{value:"false"},"false"))))}}}}}),d=l.ui,m=l.setData,f=l.setSchema,h=l.setEditorMode,v=l.setError;return Object(n.useEffect)(function(){(function(){var e=Object(u.a)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.get(g.default.ENGINE_LIST,{});case 2:200===(t=e.sent).status&&(f(t.content.schema),m(t.content.data));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[o]),r.a.createElement("div",{className:"common-margin"},r.a.createElement(nr.a,{checkedChildren:"Edit Mode",unCheckedChildren:"View Mode",onChange:function(e){h(e)}}),r.a.createElement(P.a,{type:"horizontal"}),d())}var Wc=D.a.SubMenu,Qc={currentPage:"lr-settings"},zc=r.a.createContext();function Yc(){var e=Object(d.useReducerAsync)(Mc,Qc,_c),t=Object(p.a)(e,2),a=t[0],n=t[1],o=a.currentPage;return r.a.createElement(zc.Provider,{value:{dispacher:n}},r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(D.a,{style:{width:256},defaultSelectedKeys:["lr-settings"],defaultOpenKeys:["console-settings"],mode:"inline"},r.a.createElement(Wc,{key:"console-settings",title:r.a.createElement("span",null,r.a.createElement(qc.a,null),r.a.createElement("span",null,"Console Settings"))},r.a.createElement(D.a.Item,{key:"lr-settings",onClick:function(){n({type:"setState",data:{currentPage:"lr-settings"}})}},"Login/Register Control")),r.a.createElement(Wc,{key:"engine-settings",title:r.a.createElement("span",null,r.a.createElement(qc.a,null),r.a.createElement("span",null,"Engine Settings"))},r.a.createElement(D.a.Item,{onClick:function(){n({type:"setState",data:{currentPage:"engines"}})},key:"engines"},"Engines")))),r.a.createElement("div",{className:"app-admin-main"},"lr-settings"===o&&r.a.createElement(Bc,null),"engines"===o&&r.a.createElement(Hc,null))))}function Xc(e){var t=Object(n.useState)(void 0),a=Object(p.a)(t,2),o=a[0],c=a[1],i=Object(n.useState)(void 0),l=Object(p.a)(i,2),s=l[0],u=l[1],d=Object(n.useState)(void 0),m=Object(p.a)(d,2),f=m[0],h=m[1],b=Object(n.useState)(!1),g=Object(p.a)(b,2),v=g[0],y=g[1],E=X.a.useForm(),O=Object(p.a)(E,1)[0];return{ui:function(e){var t=e.formItems,a=e.title,n=e.submit;return r.a.createElement("div",{className:"common-margin common-child-center"},r.a.createElement(Y.a,{title:a,style:{width:"50%"}},r.a.createElement(X.a,{form:O},o&&r.a.createElement(me,{message:r.a.createElement(J.a,{id:o})}),s&&r.a.createElement(me,{title:r.a.createElement(J.a,{id:"congratulation"}),type:"success",message:r.a.createElement(J.a,{id:s})}),t),r.a.createElement(X.a.Item,null,r.a.createElement(Z.a,{type:"primary",loading:v,onClick:n},r.a.createElement(J.a,{id:"apply"})))))},form:O,setError:c,setLoading:y,getParams:function(){return O.getFieldsValue()},setCurrent:h,current:f,setSuccess:u}}function $c(e){var t=Xc(),a=t.ui,o=t.setError,c=t.setSuccess,i=Object(n.useState)(void 0),l=Object(p.a)(i,2),d=l[0],m=l[1],f=function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=3;break}return o("set_default_backend_error"),e.abrupt("return");case 3:return t=new b.ActionProxy,e.next=6,t.post(g.default.USER_EXTRA,{backend:d});case 6:if(200!==(a=e.sent).status){e.next=11;break}return S.updateUser(a),c("done"),e.abrupt("return");case 11:o(a.content);case 12:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(J.a,{id:"set_default_backend"}),submit:f,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a.Item,{label:r.a.createElement(J.a,{id:"curent_value"})},S.extraOption().backend||"Not Set Yet"),r.a.createElement(X.a.Item,{label:r.a.createElement(J.a,{id:"choose"})},r.a.createElement(tt,{useEngine:function(e){m(e)}})))})}var Zc=a(1146),ei=a(1160);function ti(e){var t=Xc(),a=t.ui,o=t.setError,c=t.setSuccess,i=function(e){var t=Object(n.useState)(e.initialValue||10),a=Object(p.a)(t,2),o=a[0],c=a[1];return{ui:function(){return r.a.createElement(ca.a,null,r.a.createElement(ia.a,{span:12},r.a.createElement(Zc.a,{min:10,max:300,onChange:function(e){c(e)},value:o})),r.a.createElement(ia.a,{span:4},r.a.createElement(ei.a,{min:10,max:300,style:{margin:"0 16px"},value:o,onChange:function(e){c(e)}})))},value:o}}({initialValue:S.extraOption().apply_timeout||10}),l=i.ui,d=i.value,m=function(){var e=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=3;break}return o("set_default_backend_error"),e.abrupt("return");case 3:return t=new b.ActionProxy,e.next=6,t.post(g.default.USER_EXTRA,{apply_timeout:d});case 6:if(200!==(a=e.sent).status){e.next=11;break}return S.updateUser(a),c("done"),e.abrupt("return");case 11:o(a.content);case 12:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return a({title:r.a.createElement(J.a,{id:"set_apply_timeout"}),submit:m,formItems:r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a.Item,{label:r.a.createElement(J.a,{id:"curent_value"})},d),r.a.createElement(X.a.Item,{label:r.a.createElement(J.a,{id:"choose"})},l()))})}var ai=D.a.SubMenu;function ni(){var e=Object(n.useState)("default-backend"),t=Object(p.a)(e,2),a=t[0],o=t[1];return r.a.createElement("div",{className:"app-admin"},r.a.createElement("div",{className:"app-admin-side"},r.a.createElement(D.a,{style:{width:256},defaultSelectedKeys:["default-backend"],defaultOpenKeys:["analysis-workshop"],mode:"inline"},r.a.createElement(ai,{key:"analysis-workshop",title:r.a.createElement("span",null,r.a.createElement(qc.a,null),r.a.createElement("span",null,r.a.createElement(J.a,{id:"analysis_workshop"})))},r.a.createElement(D.a.Item,{key:"default-backend",onClick:function(){o("default-backend")}},r.a.createElement(J.a,{id:"set_engine"})),r.a.createElement(D.a.Item,{key:"set-timeout",onClick:function(){o("set-timeout")}},r.a.createElement(J.a,{id:"set_timeout"}))))),r.a.createElement("div",{className:"app-admin-main"},"default-backend"===a&&r.a.createElement($c,null),"set-timeout"===a&&r.a.createElement(ti,null)))}var ri={currentPage:"login",logined:!1},oi=r.a.createContext();function ci(){var e=Object(d.useReducerAsync)(A,ri,R),t=Object(p.a)(e,2),a=t[0],o=t[1],c=a.currentPage,i=a.logined;return Object(n.useEffect)(function(){o(h.a.buildEvent(I.CHECK_LOGINED,{}))},[]),r.a.createElement(oi.Provider,{value:{dispacher:o}},r.a.createElement("div",{className:"app-console"},r.a.createElement("div",{className:"app-console-header"},r.a.createElement(Q,{userLogined:i,isUserAdmin:S.isAdmin(),currentPage:c})),r.a.createElement("div",{className:"app-console-main"},"register"===c&&r.a.createElement(be,null),"register"!==c&&!i&&r.a.createElement(ye,null),"console"===c&&i&&r.a.createElement(Gn,null),"workshop"===c&&i&&r.a.createElement(Ac,null),"admin"===c&&i&&S.isAdmin()&&r.a.createElement(Yc,null),"settings"===c&&i&&r.a.createElement(ni,null)),r.a.createElement("div",{className:"app-console-footer"},r.a.createElement("div",{style:{bottom:"100px",textAlign:"center",width:"100%"}},"MLSQL Licensed under the Apache License, Version 2.0. @",r.a.createElement("a",{className:"copyright",href:"http://www.miitbeian.gov.cn/"},"\u6d59ICP\u590718052520\u53f7"),r.a.createElement("div",null,"@",r.a.createElement("a",{target:"_blank",href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010802009683"},r.a.createElement("img",{src:""}),"\u6d59\u516c\u7f51\u5b89\u5907 33010802009683\u53f7"))))))}var ii,li=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){var a,n,r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.ActionProxy,n=t.data,r=n.name,o=n.url,e.next=4,a.post(g.default.ENGINE_ADD,{name:r,url:o});case 4:if(200===(c=e.sent).status){e.next=7;break}return e.abrupt("return",{data:{error:JSON.parse(c.content).msg}});case 7:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),si=li.handler,ui=li.action,pi=h.a.buildHandler(function(){var e=Object(u.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:{error:void 0,current:t.__state.current+1}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),di=pi.handler,mi=pi.action,fi=function e(){Object(f.a)(this,e)};fi.registerAdmin="registerAdmin",fi.addEngine="addEngine",fi.skipAddEngine="skipAddEngine";var hi=(ii={},Object(m.a)(ii,fi.registerAdmin,te),Object(m.a)(ii,fi.addEngine,si),Object(m.a)(ii,fi.skipAddEngine,di),ii);function bi(e,t){switch(t.type){case fi.registerAdmin:return ae(e,t.data);case fi.addEngine:return ui(e,t.data);case fi.skipAddEngine:return mi(e,t.data);default:return e}}var gi=a(1155);var vi=function(){var e=Object(n.useContext)(Bi).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout;return r.a.createElement(X.a,Object.assign({},a,{className:"login-form",onFinish:function(t){e({type:fi.registerAdmin,data:t})}}),r.a.createElement(X.a.Item,{label:"UserName",name:"userName",rules:[{required:!0,message:"Please input your username!"}]},r.a.createElement($.a,null)),r.a.createElement(X.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement($.a.Password,null)),r.a.createElement(X.a.Item,{label:"Repeated Password",name:"password2",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement($.a.Password,null)),r.a.createElement(X.a.Item,o,r.a.createElement(Z.a,{type:"primary",htmlType:"submit"},"Go")))};var yi,Ei=function(){var e=Object(n.useContext)(Bi).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout,c={required:!0,message:"required"};return r.a.createElement(X.a,Object.assign({},a,{className:"login-form",onFinish:function(t){e({type:fi.addEngine,data:t})}}),r.a.createElement(X.a.Item,{label:"Engine Name",name:"name",rules:[c]},r.a.createElement($.a,null)),r.a.createElement(X.a.Item,{label:"Engine Url",name:"url",rules:[c]},r.a.createElement($.a,null)),r.a.createElement(X.a.Item,o,r.a.createElement(Z.a,{type:"primary",htmlType:"submit"},"Go"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{onClick:function(t){t.preventDefault(),e({type:fi.skipAddEngine,data:{}})},htmlType:"submit"},"Skip")))},Oi=h.a.buildHandler(function(e){return{data:e.data}}),ki=Oi.handler,ji=Oi.action,wi=h.a.buildHandler(function(e){return{data:{appConfigured:!0}}}),Si=wi.handler,xi=wi.action,Ti=h.a.buildHandler(function(e){return{data:{appConfigured:!0}}}),Ci=Ti.handler,Ni=Ti.action,Ii=function e(){Object(f.a)(this,e)};Ii.GO_CONSOLE="goConsole",Ii.GO_ADMIN="goAdmin",Ii.appConfigured="appConfigured";var Ri=(yi={},Object(m.a)(yi,Ii.GO_ADMIN,Si),Object(m.a)(yi,Ii.GO_CONSOLE,Ci),Object(m.a)(yi,Ii.appConfigured,ki),yi);function Ai(e,t){switch(t.type){case Ii.GO_ADMIN:return xi(e,t.data);case Ii.GO_CONSOLE:return Ni(e,t.data);case Ii.appConfigured:return ji(e,t.data);default:return e}}var Di=function(){var e=Object(n.useContext)(Yi).dispacher,t=S.formLayout1(),a=t.formItemLayout,o=t.tailLayout;return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,{message:"Congratuation!",description:"You have finished the setup of MLSQL Console.",type:"success"}),r.a.createElement(P.a,null),r.a.createElement(X.a,a,r.a.createElement(X.a.Item,o,r.a.createElement(Z.a,{type:"primary",onClick:function(){e({type:Ii.GO_ADMIN,data:{}})}},"Go to Admin Page"),r.a.createElement(P.a,{type:"vertical"}),r.a.createElement(Z.a,{onClick:function(){e({type:Ii.GO_CONSOLE,data:{}})}},"Go to Console Page"))))};function Fi(){var e=Object(se.a)(["\n width:100%;\n display:flex;\n max-width: 800px;\n flex-direction: column;\n"]);return Fi=function(){return e},e}function Pi(){var e=Object(se.a)(["\n  width:100%;\n  margin-top:6px;\n"]);return Pi=function(){return e},e}function Li(){var e=Object(se.a)(["\ndisplay: flex;\nflex-direction: column;\nwidth:100%;\njustify-content:center;\n align-items:  center;\n"]);return Li=function(){return e},e}var _i=ar.a.Step,Mi=ue.a.div(Li()),qi=ue.a.div(Pi()),Vi=ue.a.div(Fi()),Gi={error:void 0,current:0},Bi=r.a.createContext();var Ui=function(){var e=Object(d.useReducerAsync)(bi,Gi,hi),t=Object(p.a)(e,2),a=t[0],n=t[1],o=a.error,c=a.current;return r.a.createElement(Bi.Provider,{value:{dispacher:n}},r.a.createElement(Mi,null,r.a.createElement(qi,null,r.a.createElement(gi.a,{title:"Setup MLSQL Console in 2 Steps"})),r.a.createElement(P.a,null),r.a.createElement(Vi,null,r.a.createElement(ar.a,{current:c},r.a.createElement(_i,{title:"Admin User/Password",description:"Setup Admin accout"}),r.a.createElement(_i,{title:"Add Engines",description:"Add default MLSQL Engine"}),r.a.createElement(_i,{title:"Done",description:"Congratuation"})),r.a.createElement(P.a,null),o&&r.a.createElement(F.a,{message:"Message",description:o,type:"error",closable:!0}),0===c&&r.a.createElement(Y.a,null,r.a.createElement(vi,null)),1===c&&r.a.createElement(Y.a,null,r.a.createElement(Ei,null)),2===c&&r.a.createElement(Y.a,null,r.a.createElement(Di,null)))))},Ki=a(24),Ji=a(1152),Hi={login:"\u767b\u5f55",register:"\u6ce8\u518c",console:"\u63a7\u5236\u53f0",analysis_workshop:"\u5206\u6790\u5de5\u574a",settings:"\u8bbe\u7f6e",admin:"\u7ba1\u7406\u5458",more:"\u66f4\u591a",apply:"\u5e94\u7528",set_default_backend:"\u8bbe\u7f6e\u9ed8\u8ba4Engine",set_default_backend_error:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u5f15\u64ce\u8fdb\u884c\u8bbe\u7f6e",set_engine:"\u8bbe\u7f6e\u5f15\u64ce",curent_value:"\u5f53\u524d\u503c",choose:"\u9009\u62e9",done:"\u5b8c\u6210",congratulation:"\u606d\u559c",set_timeout:"\u8d85\u65f6\u8bbe\u7f6e",set_apply_timeout:"\u8bbe\u7f6e\u3010\u5e94\u7528\u3011\u8d85\u65f6\uff08\u5355\u4f4d\u79d2\uff09",table_workshop:"\u6682\u5b58\u533a",delta_lake:"\u6570\u636e\u6e56",file_system:"\u6587\u4ef6\u7cfb\u7edf",project:"\u5b57\u6bb5",filter:"\u8fc7\u6ee4",join:"\u5173\u8054",window:"\u7a97\u53e3",dash:"\u53ef\u89c6\u5316",limit:"\u6761\u6570",agg:"\u805a\u5408",order:"\u6392\u5e8f",select_columns:"\u7b5b\u9009\u5b57\u6bb5",rename_columns:"\u91cd\u547d\u540d\u5b57\u6bb5",transform_columns:"\u8f6c\u6362\u5b57\u6bb5",cast_columns_type:"\u4fee\u6539\u5b57\u6bb5\u7c7b\u578b"},Wi=a(549),Qi=a.n(Wi),zi={appConfigured:!1,loading:!0,lang:Hi},Yi=r.a.createContext();var Xi=function(){var e=Object(d.useReducerAsync)(Ai,zi,Ri),t=Object(p.a)(e,2),a=t[0],o=t[1],c=a.appConfigured,i=a.loading,l=a.lang;function m(){return(m=Object(u.a)(s.a.mark(function e(){var t,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.ActionProxy,e.next=3,t.get(g.default.APP_INFO,{});case 3:200===(a=e.sent).status&&o({type:Ii.appConfigured,data:{appConfigured:a.content.configured,loading:!1}});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}return Object(n.useEffect)(function(){!function(){m.apply(this,arguments)}()},[]),r.a.createElement(Ji.a,{locale:l,messages:l},r.a.createElement(Ki.b,{locale:Qi.a},r.a.createElement(Yi.Provider,{value:{dispacher:o}},i&&r.a.createElement(Dn,null),!i&&!c&&r.a.createElement(Ui,null),!i&&c&&r.a.createElement(ci,null))))};c.a.render(r.a.createElement(Xi,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},26:function(e,t,a){"use strict";var n=a(5),r=a.n(n),o=a(20),c=a(8),i=a(7),l=a(12),s=function(){function e(){Object(i.a)(this,e)}return Object(l.a)(e,null,[{key:"buildHandler",value:function(e){return{handler:function(t){var a=t.dispatch,n=t.getState,i=(t.signal,a);return function(){var t=Object(c.a)(r.a.mark(function t(a){var c;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(Object(o.a)({},a,{__state:n()}));case 2:c=t.sent,i(Object(o.a)({type:a.type},c));case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},action:function(e,t){return Object(o.a)({},e,t)}}}},{key:"buildEvent",value:function(e,t){return{type:e,data:t}}}]),e}();t.a=s},30:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return r});var n=a(7),r=function e(){Object(n.a)(this,e)};r.RUN="/api_v1/run/script",r.USER_NAME="/api_v1/user/userName",r.JOB_LIST="/api_v1/job/list",r.JOB_DETAIL="/api_v1/job",r.JOB_KILL="/api_v1/job/kill",r.SAVE_SCRIPT_FILE="/api_v1/script_file",r.ANALYSIS_TABLES="/api_v1/analysis/tables",r.ANALYSIS_TABLE_INFO="/api_v1/analysis/table/get",r.ANALYSIS_SAVE="/api_v1/analysis/tables/save",r.APP_INFO="/api_v1/app",r.APP_SAVE="/api_v1/app/save",r.REGISTER="/api_v1/user/register",r.LOGIN="/api_v1/user/login",r.LOGOUT="/api_v1/user/logout",r.ENGINE_ADD="/api_v1/engine/add",r.ENGINE_LIST="/api_v1/engine/list",r.SCRIPT_FILE_LIST="/api_v1/script_file",r.SCRIPT_FILE_GET="/api_v1/script_file/get",r.SCRIPT_FILE_REMOVE="/api_v1/script_file/remove",r.PLUGIN_LIST="/api_v1/plugin/list",r.PLUGIN_GET="/api_v1/plugin/get",r.USER_EXTRA="/api_v1/user/extra/update",r.APPLY_GET="/api_v1/analysis/apply"},32:function(e,t,a){"use strict";a.r(t);var n=a(5),r=a.n(n),o=a(8),c=a(7),i=a(12),l=a(20),s=a(87),u=function e(){Object(c.a)(this,e)};u.USER_NAME="userName",u.USER_ID="userId",u.ADMIN_TOKEN="admin_token",u.LOGIN_TOKEN="access-token";var p=function e(t,a,n){Object(c.a)(this,e),this.status=t,this.content=a,this.resp=n},d=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(c.a)(this,e),this.url=t,this.url||(this.url=s.b),this.fetch_config=a}return Object(i.a)(e,[{key:"request",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a){var n,o,c,i,d,m,f,h,b,g,v,y,E=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i in n=(n=E.length>2&&void 0!==E[2]?E[2]:"GET").toUpperCase(),(o=sessionStorage.getItem(u.USER_NAME))&&(a[u.USER_NAME]=o),c=[],a)d=encodeURIComponent(i),m=encodeURIComponent(a[i]),c.push(d+"="+m);return f=this.url+t,c.length>0&&(f+="?"),"GET"===n?(f+=c.join("&"),c=void 0):c=c.join("&"),h={method:n,timeout:864e5,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Access-Token":sessionStorage.getItem(s.a)||""},body:c},b=Object(l.a)({},h,this.fetch_config),e.prev=11,e.next=14,fetch(f,b);case 14:if((g=e.sent).ok){e.next=20;break}return e.next=18,g.text();case 18:return v=e.sent,e.abrupt("return",new p(g.status,v));case 20:return e.next=22,g.json();case 22:return y=e.sent,e.abrupt("return",new p(200,y,g));case 26:return e.prev=26,e.t0=e.catch(11),e.abrupt("return",new p(500,e.t0,void 0));case 29:case"end":return e.stop()}},e,this,[[11,26]])}));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),m=a(30);a.d(t,"ActionProxy",function(){return f});var f=function(){function e(){Object(c.a)(this,e),this.backend=new d}return Object(i.a)(e,[{key:"userName",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(m.default.USER_NAME,{});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"runScript",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a,n){var o,c,i,l,s,u;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userName();case 2:if(200===(o=e.sent).status){e.next=5;break}return e.abrupt("return",o);case 5:return c=o.content,i=c.userName,l=c.backendTags,s={sql:t,owner:i,jobName:a,sessionPerUser:!0,show_stack:!0,skipAuth:!1,tags:l||""},Object.assign(s,n),e.next=10,this.post(m.default.RUN,s);case 10:return u=e.sent,e.abrupt("return",u);case 12:case"end":return e.stop()}},e,this)}));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.backend.request(t,a,s.c.GET);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(o.a)(r.a.mark(function e(t,a){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.backend.request(t,a,s.c.POST);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}]),e}();f.client=new f},390:function(e,t,a){},405:function(e,t,a){},461:function(e,t,a){},462:function(e,t,a){},463:function(e,t,a){},464:function(e,t,a){},465:function(e,t,a){},579:function(e,t,a){e.exports=a(1136)},585:function(e,t,a){},586:function(e,t,a){},589:function(e,t,a){},590:function(e,t,a){},775:function(e,t,a){},778:function(e,t,a){},80:function(e,t,a){"use strict";a.r(t),a.d(t,"SetStateActionHandler",function(){return l}),a.d(t,"SetStateAction",function(){return s});var n=a(5),r=a.n(n),o=a(20),c=a(8),i=a(26).a.buildHandler(function(){var e=Object(c.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:Object(o.a)({},t.data)});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),l=i.handler,s=i.action},87:function(e,t,a){"use strict";a.d(t,"b",function(){return r}),a.d(t,"c",function(){return o}),a.d(t,"a",function(){return c});var n=a(7),r="",o=function e(){Object(n.a)(this,e)};o.GET="get",o.POST="post",o.PUT="put",o.DELETE="delete";var c={name:"access-token"}}},[[579,1,2]]]);
//# sourceMappingURL=main.debbca99.chunk.js.map